<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>从汇编角度看程序的执行 | 记录每个瞬间</title>
    <meta property="og:title" content="从汇编角度看程序的执行 - 记录每个瞬间">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2021-10-10T14:09:03&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2021-10-10T14:09:03&#43;08:00'>
        
    <meta name="Keywords" content="">
    <meta name="description" content="从汇编角度看程序的执行">
        <meta name="author" content="隔壁老王">
        
    <meta property="og:url" content="https://code0xff.org/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
        <link href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://code0xff.org/">
                        记录每个瞬间
                    </a>
                
                
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://code0xff.org/">首页</a>
                    
                    <a  href="https://code0xff.org/linked/" title="链接">链接</a>
                    
                    <a  href="https://code0xff.org/archives/" title="归档">归档</a>
                    
                    <a  href="https://code0xff.org/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">从汇编角度看程序的执行</h1>
        </header>
        <date class="post-meta meta-date">
            2021年10月10日
        </date>
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#背景">背景</a></li>
        <li><a href="#函数调用">函数调用</a>
          <ul>
            <li>
              <ul>
                <li><a href="#栈分配">栈分配</a></li>
                <li><a href="#函数调用-1">函数调用</a></li>
                <li><a href="#指向函数的指针">指向函数的指针</a></li>
                <li><a href="#传递多个参数">传递多个参数</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#循环和跳转">循环和跳转</a>
          <ul>
            <li>
              <ul>
                <li><a href="#跳转相关的指令">跳转相关的指令</a></li>
                <li><a href="#if判断">if判断</a></li>
                <li><a href="#do-while">do-while</a></li>
                <li><a href="#while循环">while循环</a></li>
                <li><a href="#for循环">for循环</a></li>
                <li><a href="#switch语句">switch语句</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#组合和结构体">组合和结构体</a>
          <ul>
            <li>
              <ul>
                <li><a href="#数组">数组</a></li>
                <li><a href="#结构体">结构体</a></li>
                <li><a href="#联合体">联合体</a></li>
                <li><a href="#动态申请内存">动态申请内存</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#浮点数">浮点数</a></li>
        <li><a href="#参考">参考</a></li>
      </ul>
    </li>
  </ul>
</nav>
        
        <div class="post-meta">
            
            <span class="post-meta meta-tags">
                <ul class="clearfix">
                    <a href='/categories/%E7%B3%BB%E7%BB%9F'>系统</a>
                </ul>
            </span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <h2 id="背景">背景</h2>
<p>本文主要介绍程序的汇编执行逻辑，通过一段段的<code>c</code>程序，经过<code>gcc</code>编译，再用<code>objdump</code>反汇编，来观察每段代码具体到机器级别是怎么执行的。<br>
你会发现汇编语言执行的逻辑跟高级语言差别还是很大的，汇编语言执行的对象是<strong>寄存器</strong>和<strong>内存</strong>。</p>
<p>下图是<strong>x86</strong>架构下的通用寄存器，也就是这些寄存器即可以作为加法的参数，也可以用于位运算。<br>
但因为早期寄存器的数量比较少，所有对不同寄存器的使用就有要求，比如<code>rax</code>一般用于保存函数的返回值。<br>
这里的<code>rax</code>是<strong>64</strong>位寄存器、<code>eax</code>是<strong>32</strong>位寄存器、<code>ax</code>是<strong>16</strong>位寄存器、<strong>al</strong>是<strong>8</strong>位寄存器。<br>

        <a data-fancybox="gallery" href="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/12_%E6%B5%AE%E7%82%B9%E5%AF%84%E5%AD%98%E5%99%A8.jpg">
            <img class="mx-auto" alt="" src="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/12_%E6%B5%AE%E7%82%B9%E5%AF%84%E5%AD%98%E5%99%A8.jpg" />
        </a>
    
上图中的参数1、参数2是用来做函数调用时，传递参数的。一般规定<code>rdi</code>保存<strong>参数1</strong>、<code>rsi</code>保存<strong>参数2</strong>。<br>
由于寄存器的数量有限，不可能无限制使用，比如在函数调用时，如果调用栈很长，那么寄存器就不够用了，这时候就需要将寄存器中的值保存起来，保存到内存中。<br>
有些寄存器规定是函数的调用者保存的，有些寄存器规定是被调用者保存的。<br>
当然，你也可以不遵守这个规定，程序可以执行，但是库函数、第三方库都是遵守这个规定的，你要是不遵守这个规定，胡乱使用寄存器，到时候可能会出现一些离奇的问题，那样排查起来都会很麻烦。</p>
<p>介绍常用的汇编指令
以及 GDB的一些调试参数</p>
<p>gcc编译命令,-g 是加上调试信息，如果用<code>gdb</code>调试的话就比较有用了。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>gcc -g -o hello hello.c 
</span></span></code></pre></td></tr></table>
</div>
</div><p>反汇编命令，将二进制程序显示成汇编代码。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>objdump -d hello
</span></span></code></pre></td></tr></table>
</div>
</div><p>这里的汇编格式是<strong>AT&amp;T</strong>格式的汇编，跟<strong>Intel</strong>格式的汇编显示起来有些不一样。<br>
比如：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#50fa7b">mov</span> <span style="color:#8be9fd;font-style:italic">%rax</span>, <span style="color:#8be9fd;font-style:italic">%rax</span>   <span style="color:#6272a4"># 将寄存器rax的值拷贝到rbx
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>对于<strong>Intel</strong>汇编显示的类似这样，跟<strong>AT&amp;T</strong>格式是相反的：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#50fa7b">mo</span> rbx, rax      <span style="color:#6272a4"># 将寄存器rax的值拷贝到rbx
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>一些比较常用的指令：</p>
<ul>
<li><code>mov</code>: 数据传送指令，把A-&gt;B，<code>mov</code>有很多变种，针对的是不同字节的，比如拷贝单字节、双字节、四字节等</li>
<li><code>push</code>和<code>pop</code>：这两个是操作栈的，将数据放入栈中，以及从栈中弹出，在函数调用的使用会经常用到</li>
<li><code>inc</code>、<code>dec</code>：分别是+1，-1</li>
<li><code>neg</code>、<code>not</code>：取负，取补</li>
<li><code>add</code>、<code>sub</code>、<code>imul</code>、<code>idiv</code>：分别是 加、减、乘、除</li>
<li><code>xor</code>、<code>or</code>、<code>and</code>:分别是异或、或、与</li>
<li><code>shl</code>、<code>sar</code>、<code>shr</code>：分别是左移、算术右移、逻辑右移</li>
</ul>
<p>再来说说<code>lea</code>指令，像<code>mov</code>是把一个内存/寄存器的内容拷贝到另一处，而<code>lea</code>拷贝的是地址，等价的<code>c</code>代码如下：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#8be9fd">int</span> a <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">10</span>;
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#ff79c6">*</span>x <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">&amp;</span>a;   
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>*x = &amp;a</code>等价于<code>lea a的地址,x</code>。</p>
<p>本篇文章将会通过各种简短的<code>c</code>程序来观察反汇编后的运行逻辑，由于<code>gcc</code>编译时没有做优化，所以有些反汇编看起来是在做无用功，比如将寄存器的内容拷贝到内存中，又将内存中的值拷贝回寄存器。</p>
<p>没有优化的好处是能方便的看出<code>c</code>代码和汇编代码的一一对应关系。<br>
本文主要介绍的运行逻辑包括如下部分，通过将下面这些程序片段反汇编，来一一观察程序的底层运行原理：</p>
<ul>
<li>函数执行原理
<ul>
<li>函数调用时的栈分配</li>
<li>函数调用和返回原理</li>
<li>指向函数的指针</li>
<li>函数调用时传递多个参数</li>
</ul>
</li>
<li>循环跳转原理
<ul>
<li>if-else逻辑</li>
<li>do-while逻辑</li>
<li>while逻辑</li>
<li>for循环</li>
<li>switch</li>
</ul>
</li>
<li>数组和结构体原理
<ul>
<li>数组访问原理</li>
<li>结构体、联合体</li>
<li>动态申请内存</li>
</ul>
</li>
<li>浮点数的计算原理</li>
</ul>
<h2 id="函数调用">函数调用</h2>
<h4 id="栈分配">栈分配</h4>
<p>假设一段<code>c</code>程序，代码如下：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#ff79c6">#include</span><span style="color:#ff79c6">&lt;stdio.h&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">fun</span>(<span style="color:#8be9fd">int</span> a, <span style="color:#8be9fd">int</span> b) {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> c <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">10</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> a <span style="color:#ff79c6">+</span> b <span style="color:#ff79c6">+</span> c;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> res <span style="color:#ff79c6">=</span> fun(<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">2</span>);
</span></span><span style="display:flex;"><span>    printf(<span style="color:#f1fa8c">&#34;res-&gt;%d</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>,res);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>程序很简单，<code>main</code>函数调用<code>fun</code>函数，<code>main</code>传递了两个参数<code>a</code>和<code>b</code>。<br>
在<code>fun</code>函数内，计算<code>a + b + 10</code>并返回。<br>
最后回到<code>main</code>函数内，将结果打印。</p>
<p>编译代码，再反汇编后(删减了部分)   <br>
第一列是地址，第二列是机器编码，第三列是汇编代码：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>000000000040052<span style="color:#50fa7b">d</span> &lt;fun&gt;:
</span></span><span style="display:flex;"><span>  40052<span style="color:#8be9fd;font-style:italic">d:</span>       55                      <span style="color:#50fa7b">push</span>   <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  40052<span style="color:#8be9fd;font-style:italic">e:</span>       48 89 <span style="color:#50fa7b">e5</span>                mov    <span style="color:#8be9fd;font-style:italic">%rsp</span>,<span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  400531:       89 7<span style="color:#50fa7b">d</span> ec                mov    <span style="color:#8be9fd;font-style:italic">%edi</span>,-<span style="color:#bd93f9">0x14</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  400534:       89 75 <span style="color:#50fa7b">e8</span>                mov    <span style="color:#8be9fd;font-style:italic">%esi</span>,-<span style="color:#bd93f9">0x18</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  400537:       <span style="color:#50fa7b">c7</span> <span style="color:#bd93f9">45</span> fc <span style="color:#bd93f9">0</span>a <span style="color:#bd93f9">00</span> <span style="color:#bd93f9">00</span> <span style="color:#bd93f9">00</span>    movl   $0xa,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  40053<span style="color:#8be9fd;font-style:italic">e:</span>       8<span style="color:#50fa7b">b</span> <span style="color:#bd93f9">45</span> e8                mov    -<span style="color:#bd93f9">0x18</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  400541:       8<span style="color:#50fa7b">b</span> <span style="color:#bd93f9">55</span> ec                mov    -<span style="color:#bd93f9">0x14</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%edx</span>
</span></span><span style="display:flex;"><span>  400544:       01 <span style="color:#50fa7b">c2</span>                   add    <span style="color:#8be9fd;font-style:italic">%eax</span>,<span style="color:#8be9fd;font-style:italic">%edx</span>
</span></span><span style="display:flex;"><span>  400546:       8<span style="color:#50fa7b">b</span> <span style="color:#bd93f9">45</span> fc                mov    -<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  400549:       01 <span style="color:#50fa7b">d0</span>                   add    <span style="color:#8be9fd;font-style:italic">%edx</span>,<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  40054<span style="color:#8be9fd;font-style:italic">b:</span>       5<span style="color:#50fa7b">d</span>                      pop    <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  40054<span style="color:#8be9fd;font-style:italic">c:</span>       <span style="color:#50fa7b">c3</span>                      retq   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">000000000040054d</span> &lt;main&gt;:
</span></span><span style="display:flex;"><span>  40054<span style="color:#8be9fd;font-style:italic">d:</span>       55                      <span style="color:#50fa7b">push</span>   <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  40054<span style="color:#8be9fd;font-style:italic">e:</span>       48 89 <span style="color:#50fa7b">e5</span>                mov    <span style="color:#8be9fd;font-style:italic">%rsp</span>,<span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  400551:       48 83 <span style="color:#50fa7b">ec</span> <span style="color:#bd93f9">10</span>             sub    $0x10,<span style="color:#8be9fd;font-style:italic">%rsp</span>
</span></span><span style="display:flex;"><span>  400555:       <span style="color:#50fa7b">be</span> <span style="color:#bd93f9">02</span> <span style="color:#bd93f9">00</span> <span style="color:#bd93f9">00</span> <span style="color:#bd93f9">00</span>          mov    $0x2,<span style="color:#8be9fd;font-style:italic">%esi</span>
</span></span><span style="display:flex;"><span>  40055<span style="color:#8be9fd;font-style:italic">a:</span>       <span style="color:#50fa7b">bf</span> <span style="color:#bd93f9">01</span> <span style="color:#bd93f9">00</span> <span style="color:#bd93f9">00</span> <span style="color:#bd93f9">00</span>          mov    $0x1,<span style="color:#8be9fd;font-style:italic">%edi</span>
</span></span><span style="display:flex;"><span>  40055<span style="color:#8be9fd;font-style:italic">f:</span>       <span style="color:#50fa7b">e8</span> c9 ff ff ff          callq  <span style="color:#bd93f9">40052d</span> &lt;fun&gt;
</span></span><span style="display:flex;"><span>  400564:       89 45 <span style="color:#50fa7b">fc</span>                mov    <span style="color:#8be9fd;font-style:italic">%eax</span>,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  400567:       8<span style="color:#50fa7b">b</span> <span style="color:#bd93f9">45</span> fc                mov    -<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  40056<span style="color:#8be9fd;font-style:italic">a:</span>       89 <span style="color:#50fa7b">c6</span>                   mov    <span style="color:#8be9fd;font-style:italic">%eax</span>,<span style="color:#8be9fd;font-style:italic">%esi</span>
</span></span><span style="display:flex;"><span>  40056<span style="color:#8be9fd;font-style:italic">c:</span>       <span style="color:#50fa7b">bf</span> <span style="color:#bd93f9">20</span> <span style="color:#bd93f9">06</span> <span style="color:#bd93f9">40</span> <span style="color:#bd93f9">00</span>          mov    $0x400620,<span style="color:#8be9fd;font-style:italic">%edi</span>
</span></span><span style="display:flex;"><span>  400571:       <span style="color:#50fa7b">b8</span> <span style="color:#bd93f9">00</span> <span style="color:#bd93f9">00</span> <span style="color:#bd93f9">00</span> <span style="color:#bd93f9">00</span>          mov    $0x0,<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  400576:       <span style="color:#50fa7b">e8</span> <span style="color:#bd93f9">95</span> fe ff ff          callq  <span style="color:#bd93f9">400410</span> &lt;printf@plt&gt;
</span></span><span style="display:flex;"><span>  40057<span style="color:#8be9fd;font-style:italic">b:</span>       <span style="color:#50fa7b">b8</span> <span style="color:#bd93f9">01</span> <span style="color:#bd93f9">00</span> <span style="color:#bd93f9">00</span> <span style="color:#bd93f9">00</span>          mov    $0x1,<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  400580:       <span style="color:#50fa7b">c9</span>                      leaveq 
</span></span><span style="display:flex;"><span>  <span style="color:#bd93f9">400581</span>:       c3                      retq   
</span></span><span style="display:flex;"><span>  <span style="color:#bd93f9">400582</span>:       <span style="color:#bd93f9">66</span> <span style="color:#bd93f9">2</span>e <span style="color:#bd93f9">0</span>f <span style="color:#bd93f9">1</span>f <span style="color:#bd93f9">84</span> <span style="color:#bd93f9">00</span> <span style="color:#bd93f9">00</span>    nopw   <span style="color:#8be9fd;font-style:italic">%cs</span>:<span style="color:#bd93f9">0x0</span>(<span style="color:#8be9fd;font-style:italic">%rax</span>,<span style="color:#8be9fd;font-style:italic">%rax</span>,<span style="color:#bd93f9">1</span>)
</span></span><span style="display:flex;"><span>  400589:       00 00 00 
</span></span><span style="display:flex;"><span>  40058<span style="color:#8be9fd;font-style:italic">c:</span>       0<span style="color:#50fa7b">f</span> <span style="color:#bd93f9">1</span>f <span style="color:#bd93f9">40</span> <span style="color:#bd93f9">00</span>             nopl   <span style="color:#bd93f9">0x0</span>(<span style="color:#8be9fd;font-style:italic">%rax</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在，我们从汇编的角度分析下，<code>main</code>函数时如何调用<code>fun</code>函数，并拿到返回结果的。     <br>
在<code>main</code>函数和<code>fun</code>函数开头结尾，都有这么一段：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#50fa7b">push</span> <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">mov</span>  $rsp, $rbp
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">...</span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">...</span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">pop</span>  <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>
        <a data-fancybox="gallery" href="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/1.png">
            <img class="mx-auto" alt="" src="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/1.png" />
        </a>
    <br>
从汇编角度看，每个函数都有一个<strong>栈帧</strong>，而<code>rsp</code>和<code>rbp</code>是指向栈帧的寄存器。<br>
<code>rbp</code>指向栈尾，<code>rsp</code>指向栈顶。<br>
上图中蓝色表示<code>main</code>函数的栈帧，橙色部分表示<code>fun</code>函数的栈帧。<br>
在准备执行<code>push %rbp</code>这句之前，栈帧的布局如上图最左边的结构。<br>
当执行完<code>push %rbp</code>这句后，会把<code>rbp</code>的值保存起来，这是使用者约定，x86架构下的函数调用方和被调用方都有责任保存指定的寄存器。 <br>
同时<code>rsp</code>会减少<code>8</code>个字节，也就是从高地址往低地址方向走，执行完后的结果如上图中间部分。   <br>
之后，再执行<code>mov  $rsp, $rbp</code>，这是将<code>rsp</code>的值赋给<code>rbp</code>，执行完后的结果如上图的右边部分。</p>
<p>函数开头结尾的那几句也可以写成这样：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#50fa7b">sub</span>  $8, <span style="color:#8be9fd;font-style:italic">%rsp</span>           <span style="color:#6272a4">#rsp - 8，栈增长8个字节(栈往下增长)
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>mov  <span style="color:#8be9fd;font-style:italic">%rbp</span>, (<span style="color:#8be9fd;font-style:italic">%rsp</span>)       <span style="color:#6272a4">#将rbp保存到rsp的地址中
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>...
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">...</span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">mov</span>  (<span style="color:#8be9fd;font-style:italic">%rsp</span>), <span style="color:#8be9fd;font-style:italic">%rbp</span>       <span style="color:#6272a4">#将rsp地址中的值拷贝到rbp中(还原)
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>add  $8, <span style="color:#8be9fd;font-style:italic">%rsp</span>           <span style="color:#6272a4">#将rsp + 8，栈缩小8个字节(往上缩小)
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>后面就是<code>fun</code>函数内部的具体逻辑了，在<code>fun</code>函数内部，可能又会使用栈，或者继续调用其他函数，那么<code>rsp</code>会继续增长(往低地址方向增长)，而<code>rbp</code>是保持不变的。<br>
等<code>fun</code>执行完了，会再执行<code>pop  %rbp</code>，这句是将栈中的内容弹出来，放到<code>rbp</code>中。<br>
栈中的内容是什么呢，就是上图橙色的部分，也就是将之前保存的<code>rbp</code>值会还原。</p>
<p>再来看看<code>fun</code>函数内部做的事情：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>  <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%edi</span>,-<span style="color:#bd93f9">0x14</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%esi</span>,-<span style="color:#bd93f9">0x18</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#50fa7b">movl</span>   $0xa,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#50fa7b">mov</span>    -<span style="color:#bd93f9">0x18</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  <span style="color:#50fa7b">mov</span>    -<span style="color:#bd93f9">0x14</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%edx</span>
</span></span><span style="display:flex;"><span>  <span style="color:#50fa7b">add</span>    <span style="color:#8be9fd;font-style:italic">%eax</span>,<span style="color:#8be9fd;font-style:italic">%edx</span>
</span></span><span style="display:flex;"><span>  <span style="color:#50fa7b">mov</span>    -<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  <span style="color:#50fa7b">add</span>    <span style="color:#8be9fd;font-style:italic">%edx</span>,<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>edi</code>和<code>esi</code>对应第一、第二个参数，x86对于函数间传递参数是有要求的，在不超过<code>6</code>个参数的情况下，从参数 1 到 参数 6需要分别使用下面寄存器：<br>

        <a data-fancybox="gallery" href="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/2.png">
            <img class="mx-auto" alt="" src="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/2.png" />
        </a>
    </p>
<pre tabindex="0"><code>mov    %edi,-0x14(%rbp)
mov    %esi,-0x18(%rbp)
</code></pre><p>这两句的是把参数1、参数2的值放到栈中。 <br>

        <a data-fancybox="gallery" href="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/3.png">
            <img class="mx-auto" alt="" src="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/3.png" />
        </a>
    
如上图，<code>-0x14(%rbp)</code>相当于对<code>rbp</code>的地址减<code>20字节</code>记作<strong>x</strong>，<code>mov</code>操作则把第一个参数放到<strong>x</strong>地址中。<br>
<code>-x18(%rbp)</code>相当于把<code>rbp</code>的地址减<code>24字节</code>记作<strong>y</strong>，<code>mov</code>操作则把第二个参数放到<strong>y</strong>地址中。<br>
这两个地址实际上还没有开辟，因为他们比<code>rsp</code>都要小。</p>
<p>下面是<code>fun</code>后面的内容，直接看注释就行了。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>  <span style="color:#50fa7b">movl</span>   $0xa,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)       <span style="color:#6272a4">#把常数10放到rbp地址-10中
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  mov    -<span style="color:#bd93f9">0x18</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>      <span style="color:#6272a4">#刚才存入的y地址内容放入eax
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  mov    -<span style="color:#bd93f9">0x14</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%edx</span>      <span style="color:#6272a4">#刚才存入的y地址内容放入edx
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  add    <span style="color:#8be9fd;font-style:italic">%eax</span>,<span style="color:#8be9fd;font-style:italic">%edx</span>             <span style="color:#6272a4">#相当于参数 a + b，存入edx
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  mov    -<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>       <span style="color:#6272a4">#把10放入eax
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  add    <span style="color:#8be9fd;font-style:italic">%edx</span>,<span style="color:#8be9fd;font-style:italic">%eax</span>             <span style="color:#6272a4">#edx(计算过的a+b) + 10
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>结果保存在<code>eax</code>中，最后执行<code>retq</code>返回。<br>
根据规定返回的值应当保存在<code>eax</code>中，所以<code>main</code>再取<code>eax</code>就可以拿到返回值了。</p>
<h4 id="函数调用-1">函数调用</h4>
<p>回到<code>main</code>函数中，这回说下这几句(省略了机器编码)：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>00000000004005<span style="color:#50fa7b">cf</span> &lt;fun&gt;:
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">cf:</span>       <span style="color:#50fa7b">push</span>   <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  。。。
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">ee:</span>       <span style="color:#50fa7b">retq</span>  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#bd93f9">4005</span>f3:       sub    $0x10,<span style="color:#8be9fd;font-style:italic">%rsp</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">f7:</span>       <span style="color:#50fa7b">mov</span>    $0x2,<span style="color:#8be9fd;font-style:italic">%esi</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">fc:</span>       <span style="color:#50fa7b">mov</span>    $0x1,<span style="color:#8be9fd;font-style:italic">%edi</span>
</span></span><span style="display:flex;"><span>  400601:       <span style="color:#50fa7b">callq</span>  <span style="color:#bd93f9">4005cf</span> &lt;fun&gt;
</span></span><span style="display:flex;"><span>  400606:       <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%eax</span>,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>sub    $0x10,%rsp</code>是扩大栈空间，但最后这个预留的空间其实没有被用到。<br>
然后把<code>2</code>放到<code>esi</code>，<code>1</code>放到<code>edi</code>中。<br>
后面一句很关键，<code>call 4005cf &lt;fun&gt;</code>，<code>call</code>指令是用来调用一个函数的。   <br>
这句是调用<code>fun</code>函数，<strong>4005cf</strong>就是<code>fun</code>函数第一条指令的地址。</p>
<p>
        <a data-fancybox="gallery" href="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/4.png">
            <img class="mx-auto" alt="" src="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/4.png" />
        </a>
    
在执行<code>call</code>指令前，栈的布局如上图左边结构；等执行完<code>call</code>之后后，会将<code>main</code>函数接着<strong>call</strong>之后的下一条<strong>指令地址</strong>放入栈中。<br>
下一条指令地址就是<strong>400606</strong>，同时还会修改<code>rsp</code>。<br>
这时<code>rip</code>会指向<code>fun</code>函数的入口地址，这样下一条指令执行的就是<code>fun</code>函数中的逻辑了。<br>
等<code>fun</code>函数执行完后会执行<code>retq</code>指令。<br>
这时会将栈中的返回地址弹出来存入<code>rip</code>，于是下一条指令的就会接着从<code>main</code>函数调用之后继续执行。当然<code>rsp</code>的值也会跟着修改。</p>
<p>函数的执行也可以通过下面指令来模拟：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#50fa7b">push</span>  <span style="color:#8be9fd;font-style:italic">%rip</span>         <span style="color:#6272a4">#将下一条待执行的地址保存起来
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>jmp   &lt;fun&gt;        <span style="color:#6272a4">#跳转到 fun 函数入口
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>。。。
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">pop</span>   <span style="color:#8be9fd;font-style:italic">%rip</span>         <span style="color:#6272a4">#将mian的下一条待执行的地址取出
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>jmp   <span style="color:#8be9fd;font-style:italic">%rip</span>         <span style="color:#6272a4">#跳转到下一条指定继续执行
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="指向函数的指针">指向函数的指针</h4>
<p>程序如下：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;stdio.h&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">fun</span>(<span style="color:#8be9fd">int</span> x, <span style="color:#8be9fd">int</span> <span style="color:#ff79c6">*</span>p) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> x <span style="color:#ff79c6">+</span> <span style="color:#ff79c6">*</span>p;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">foo</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> (<span style="color:#ff79c6">*</span>fp)(<span style="color:#8be9fd">int</span>, <span style="color:#8be9fd">int</span><span style="color:#ff79c6">*</span>);
</span></span><span style="display:flex;"><span>    fp <span style="color:#ff79c6">=</span> fun;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> y <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> res <span style="color:#ff79c6">=</span> fp(<span style="color:#bd93f9">3</span>, <span style="color:#ff79c6">&amp;</span>y);
</span></span><span style="display:flex;"><span>    printf(<span style="color:#f1fa8c">&#34;res -&gt; %d</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>,res);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>反编译后的结果如下：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>000000000040052<span style="color:#50fa7b">d</span> &lt;fun&gt;:
</span></span><span style="display:flex;"><span>  40052<span style="color:#8be9fd;font-style:italic">d:</span>       <span style="color:#50fa7b">push</span>   <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  40052<span style="color:#8be9fd;font-style:italic">e:</span>       <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%rsp</span>,<span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  400531:       <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%edi</span>,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  400534:       <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%rsi</span>,-<span style="color:#bd93f9">0x10</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  400538:       <span style="color:#50fa7b">mov</span>    -<span style="color:#bd93f9">0x10</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%rax</span>
</span></span><span style="display:flex;"><span>  40053<span style="color:#8be9fd;font-style:italic">c:</span>       <span style="color:#50fa7b">mov</span>    (<span style="color:#8be9fd;font-style:italic">%rax</span>),<span style="color:#8be9fd;font-style:italic">%edx</span>
</span></span><span style="display:flex;"><span>  40053<span style="color:#8be9fd;font-style:italic">e:</span>       <span style="color:#50fa7b">mov</span>    -<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  400541:       <span style="color:#50fa7b">add</span>    <span style="color:#8be9fd;font-style:italic">%edx</span>,<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  400543:       <span style="color:#50fa7b">pop</span>    <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  400544:       <span style="color:#50fa7b">retq</span>   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">0000000000400545</span> &lt;foo&gt;:
</span></span><span style="display:flex;"><span>  400545:       <span style="color:#50fa7b">push</span>   <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  400546:       <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%rsp</span>,<span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  400549:       <span style="color:#50fa7b">sub</span>    $0x10,<span style="color:#8be9fd;font-style:italic">%rsp</span>
</span></span><span style="display:flex;"><span>  40054<span style="color:#8be9fd;font-style:italic">d:</span>       <span style="color:#50fa7b">movq</span>   $0x40052d,-<span style="color:#bd93f9">0x8</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  400554:       00 
</span></span><span style="display:flex;"><span>  400555:       <span style="color:#50fa7b">movl</span>   $0x1,-<span style="color:#bd93f9">0x10</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  40055<span style="color:#8be9fd;font-style:italic">c:</span>       <span style="color:#50fa7b">lea</span>    -<span style="color:#bd93f9">0x10</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%rdx</span>
</span></span><span style="display:flex;"><span>  400560:       <span style="color:#50fa7b">mov</span>    -<span style="color:#bd93f9">0x8</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%rax</span>
</span></span><span style="display:flex;"><span>  400564:       <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%rdx</span>,<span style="color:#8be9fd;font-style:italic">%rsi</span>
</span></span><span style="display:flex;"><span>  400567:       <span style="color:#50fa7b">mov</span>    $0x3,<span style="color:#8be9fd;font-style:italic">%edi</span>
</span></span><span style="display:flex;"><span>  40056<span style="color:#8be9fd;font-style:italic">c:</span>       <span style="color:#50fa7b">callq</span>  *<span style="color:#8be9fd;font-style:italic">%rax</span>
</span></span><span style="display:flex;"><span>  40056<span style="color:#8be9fd;font-style:italic">e:</span>       <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%eax</span>,-<span style="color:#bd93f9">0xc</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  400571:       <span style="color:#50fa7b">mov</span>    -<span style="color:#bd93f9">0xc</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  400574:       <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%eax</span>,<span style="color:#8be9fd;font-style:italic">%esi</span>
</span></span><span style="display:flex;"><span>  400576:       <span style="color:#50fa7b">mov</span>    $0x400630,<span style="color:#8be9fd;font-style:italic">%edi</span>
</span></span><span style="display:flex;"><span>  40057<span style="color:#8be9fd;font-style:italic">b:</span>       <span style="color:#50fa7b">mov</span>    $0x0,<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  400580:       <span style="color:#50fa7b">callq</span>  <span style="color:#bd93f9">400410</span> &lt;printf@plt&gt;
</span></span><span style="display:flex;"><span>  400585:       <span style="color:#50fa7b">leaveq</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#bd93f9">400586</span>:       retq  
</span></span></code></pre></td></tr></table>
</div>
</div><p>下面来分析下<code>foo</code>函数中的内容：</p>
<ul>
<li>首先栈往下增长 16个字节</li>
<li><code>movq   $0x40052d,-0x8(%rbp)</code> 这句，是将<code>fun</code>的地址放到<code>(%rbp-8)</code>的位置</li>
<li><code>movl   $0x1,-0x10(%rbp)</code>，再将 <code>1</code> 放到<code>(%rbp-16)</code>的位置</li>
<li><code>lea    -0x10(%rbp),%rdx</code>，把<code>(%rbp-16)</code>的地址赋给<code>rdx</code>，这句相当于指针，也就是<code>&amp;y</code></li>
<li><code>mov    -0x8(%rbp),%rax</code>，把<code>fun</code>的地址赋给<code>rax</code></li>
<li><code>mov %rdx,%rsi</code>和<code>move %$0x3,%edi</code>是在调用<code>fun</code>之前准备的参数，也就是参数二、参数一</li>
<li><code>callq  *%rax</code>，注意<code>rax</code>前面有一个星号，这里先拿到了<code>rax</code>的值，也就是<code>fun</code>函数的地址，再调用这个函数</li>
</ul>
<p>栈的布局，和寄存器内容如下：<br>

        <a data-fancybox="gallery" href="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/5.png">
            <img class="mx-auto" alt="" src="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/5.png" />
        </a>
    </p>
<h4 id="传递多个参数">传递多个参数</h4>
<p>如果被调用的函数参数超过<strong>6</strong>个，就需要用栈中的内存来传递参数。<br>
调用者将将参数1 - 参数6保存到对应的寄存器，再将参数7 - 参数n 放到栈中。<br>
之后被调用的函数，可以通过寄存器获取到参数1 - 参数6，通过获取栈内存拿到 参数7 - 参数n。<br>
超过6个参数传递的例子，代码如下：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#ff79c6">#include</span><span style="color:#ff79c6">&lt;stdio.h&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">foo_2</span>(<span style="color:#8be9fd">int</span> a, <span style="color:#8be9fd">int</span> b, <span style="color:#8be9fd">int</span> c, <span style="color:#8be9fd">int</span> d, <span style="color:#8be9fd">int</span> e, <span style="color:#8be9fd">int</span> f, <span style="color:#8be9fd">int</span> i, <span style="color:#8be9fd">int</span> j, <span style="color:#8be9fd">int</span> k) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> a <span style="color:#ff79c6">+</span> b <span style="color:#ff79c6">+</span> c <span style="color:#ff79c6">+</span> d <span style="color:#ff79c6">+</span> e <span style="color:#ff79c6">+</span> f <span style="color:#ff79c6">+</span> i <span style="color:#ff79c6">+</span> j <span style="color:#ff79c6">+</span> k;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">foo_1</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> res <span style="color:#ff79c6">=</span> foo_2(<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">4</span>, <span style="color:#bd93f9">5</span>, <span style="color:#bd93f9">6</span>, <span style="color:#bd93f9">7</span>, <span style="color:#bd93f9">8</span>, <span style="color:#bd93f9">9</span>);
</span></span><span style="display:flex;"><span>    printf(<span style="color:#f1fa8c">&#34;f -&gt; %d</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>,res);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>反汇编后的结果如下：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>000000000040052<span style="color:#50fa7b">d</span> &lt;foo_2&gt;:
</span></span><span style="display:flex;"><span>  40052<span style="color:#8be9fd;font-style:italic">d:</span>       <span style="color:#50fa7b">push</span>   <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  40052<span style="color:#8be9fd;font-style:italic">e:</span>       <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%rsp</span>,<span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  400531:       <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%edi</span>,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  400534:       <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%esi</span>,-<span style="color:#bd93f9">0x8</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  400537:       <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%edx</span>,-<span style="color:#bd93f9">0xc</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  40053<span style="color:#8be9fd;font-style:italic">a:</span>       <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%ecx</span>,-<span style="color:#bd93f9">0x10</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  40053<span style="color:#8be9fd;font-style:italic">d:</span>       <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%r8d</span>,-<span style="color:#bd93f9">0x14</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  400541:       <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%r9d</span>,-<span style="color:#bd93f9">0x18</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  400545:       <span style="color:#50fa7b">mov</span>    -<span style="color:#bd93f9">0x8</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  400548:       <span style="color:#50fa7b">mov</span>    -<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%edx</span>
</span></span><span style="display:flex;"><span>  40054<span style="color:#8be9fd;font-style:italic">b:</span>       <span style="color:#50fa7b">add</span>    <span style="color:#8be9fd;font-style:italic">%eax</span>,<span style="color:#8be9fd;font-style:italic">%edx</span>
</span></span><span style="display:flex;"><span>  40054<span style="color:#8be9fd;font-style:italic">d:</span>       <span style="color:#50fa7b">mov</span>    -<span style="color:#bd93f9">0xc</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  400550:       <span style="color:#50fa7b">add</span>    <span style="color:#8be9fd;font-style:italic">%eax</span>,<span style="color:#8be9fd;font-style:italic">%edx</span>
</span></span><span style="display:flex;"><span>  400552:       <span style="color:#50fa7b">mov</span>    -<span style="color:#bd93f9">0x10</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  400555:       <span style="color:#50fa7b">add</span>    <span style="color:#8be9fd;font-style:italic">%eax</span>,<span style="color:#8be9fd;font-style:italic">%edx</span>
</span></span><span style="display:flex;"><span>  400557:       <span style="color:#50fa7b">mov</span>    -<span style="color:#bd93f9">0x14</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  40055<span style="color:#8be9fd;font-style:italic">a:</span>       <span style="color:#50fa7b">add</span>    <span style="color:#8be9fd;font-style:italic">%eax</span>,<span style="color:#8be9fd;font-style:italic">%edx</span>
</span></span><span style="display:flex;"><span>  40055<span style="color:#8be9fd;font-style:italic">c:</span>       <span style="color:#50fa7b">mov</span>    -<span style="color:#bd93f9">0x18</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  40055<span style="color:#8be9fd;font-style:italic">f:</span>       <span style="color:#50fa7b">add</span>    <span style="color:#8be9fd;font-style:italic">%eax</span>,<span style="color:#8be9fd;font-style:italic">%edx</span>
</span></span><span style="display:flex;"><span>  400561:       <span style="color:#50fa7b">mov</span>    <span style="color:#bd93f9">0x10</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  400564:       <span style="color:#50fa7b">add</span>    <span style="color:#8be9fd;font-style:italic">%eax</span>,<span style="color:#8be9fd;font-style:italic">%edx</span>
</span></span><span style="display:flex;"><span>  400566:       <span style="color:#50fa7b">mov</span>    <span style="color:#bd93f9">0x18</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  400569:       <span style="color:#50fa7b">add</span>    <span style="color:#8be9fd;font-style:italic">%eax</span>,<span style="color:#8be9fd;font-style:italic">%edx</span>
</span></span><span style="display:flex;"><span>  40056<span style="color:#8be9fd;font-style:italic">b:</span>       <span style="color:#50fa7b">mov</span>    <span style="color:#bd93f9">0x20</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  40056<span style="color:#8be9fd;font-style:italic">e:</span>       <span style="color:#50fa7b">add</span>    <span style="color:#8be9fd;font-style:italic">%edx</span>,<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  400570:       <span style="color:#50fa7b">pop</span>    <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  400571:       <span style="color:#50fa7b">retq</span>   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">0000000000400572</span> &lt;foo_1&gt;:
</span></span><span style="display:flex;"><span>  400572:       <span style="color:#50fa7b">push</span>   <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  400573:       <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%rsp</span>,<span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  400576:       <span style="color:#50fa7b">sub</span>    $0x30,<span style="color:#8be9fd;font-style:italic">%rsp</span>
</span></span><span style="display:flex;"><span>  40057<span style="color:#8be9fd;font-style:italic">a:</span>       <span style="color:#50fa7b">movl</span>   $0x9,<span style="color:#bd93f9">0x10</span>(<span style="color:#8be9fd;font-style:italic">%rsp</span>)
</span></span><span style="display:flex;"><span>  400581:       00 
</span></span><span style="display:flex;"><span>  400582:       <span style="color:#50fa7b">movl</span>   $0x8,<span style="color:#bd93f9">0x8</span>(<span style="color:#8be9fd;font-style:italic">%rsp</span>)
</span></span><span style="display:flex;"><span>  400589:       00 
</span></span><span style="display:flex;"><span>  40058<span style="color:#8be9fd;font-style:italic">a:</span>       <span style="color:#50fa7b">movl</span>   $0x7,(<span style="color:#8be9fd;font-style:italic">%rsp</span>)
</span></span><span style="display:flex;"><span>  400591:       <span style="color:#50fa7b">mov</span>    $0x6,<span style="color:#8be9fd;font-style:italic">%r9d</span>
</span></span><span style="display:flex;"><span>  400597:       <span style="color:#50fa7b">mov</span>    $0x5,<span style="color:#8be9fd;font-style:italic">%r8d</span>
</span></span><span style="display:flex;"><span>  40059<span style="color:#8be9fd;font-style:italic">d:</span>       <span style="color:#50fa7b">mov</span>    $0x4,<span style="color:#8be9fd;font-style:italic">%ecx</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">a2:</span>       <span style="color:#50fa7b">mov</span>    $0x3,<span style="color:#8be9fd;font-style:italic">%edx</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">a7:</span>       <span style="color:#50fa7b">mov</span>    $0x2,<span style="color:#8be9fd;font-style:italic">%esi</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">ac:</span>       <span style="color:#50fa7b">mov</span>    $0x1,<span style="color:#8be9fd;font-style:italic">%edi</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">b1:</span>       <span style="color:#50fa7b">callq</span>  <span style="color:#bd93f9">40052d</span> &lt;foo_2&gt;
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">b6:</span>       <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%eax</span>,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">b9:</span>       <span style="color:#50fa7b">mov</span>    -<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">bc:</span>       <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%eax</span>,<span style="color:#8be9fd;font-style:italic">%esi</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">be:</span>       <span style="color:#50fa7b">mov</span>    $0x4006c0,<span style="color:#8be9fd;font-style:italic">%edi</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">c3:</span>       <span style="color:#50fa7b">mov</span>    $0x0,<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">c8:</span>       <span style="color:#50fa7b">callq</span>  <span style="color:#bd93f9">400410</span> &lt;printf@plt&gt;
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">cd:</span>       <span style="color:#50fa7b">leaveq</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#bd93f9">4005</span>ce:       retq   
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>foo_1</code>函数在调用<code>foo_2</code>之前，栈的布局和寄存器内容如下：<br>

        <a data-fancybox="gallery" href="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/6.png">
            <img class="mx-auto" alt="" src="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/6.png" />
        </a>
    
由此可见，当参数超过了<code>6</code>个之后，就需要使用栈上的内存来传递参数了。<br>
上图中，将参数7(地址<code>(%rsp)</code>)、参数8(地址<code>0x08(%rsp)</code>)、参数9(地址<code>0x10(%rsp)</code>)保存在了栈中，分别对应</p>
<p>再来看下<code>foo_2</code>的栈和寄存器，下面蓝色部分是<code>foo_1</code>的栈，橙色部分是<code>foo_2</code>的栈</p>
<p>
        <a data-fancybox="gallery" href="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/7.png">
            <img class="mx-auto" alt="" src="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/7.png" />
        </a>
    
在<code>foo_2</code>中，首先将参数1 &ndash; 参数6保存在了栈中，当然这其实没必要，参数都放到寄存器中了，直接用寄存器中的值就可以了，不需要来回倒塌，主要是<code>gcc</code>编译时没做优化。<br>
参数7 - 参数8 保存在了<code>foo_1</code>的栈空间里，所以用<code>0x10(%rbp)</code>来获取参数7。<br>
因为栈的地址是由高向低增长的，<code>rbp</code>加上一个值就是往上查找，减去一个值就是往下查找。</p>
<h2 id="循环和跳转">循环和跳转</h2>
<h4 id="跳转相关的指令">跳转相关的指令</h4>
<p>程序是如何实现跳转的呢？<br>
关键在于<code>cmp</code>和<code>test</code>两个指令。</p>
<p><code>cmp</code>用来做比较(减法操作)操作，<code>cmp 1, rax</code><br>
如果<code>rax</code>为<strong>0</strong>，就设置零标志位为<strong>1</strong>，之后跳转指令<code>jz</code>判断会判断<code>eflag</code>寄存器的零标志位是否为<strong>1</strong>，如果是则跳转到指定的地址处。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#50fa7b">cmp</span> <span style="color:#bd93f9">1</span>, rax  <span style="color:#6272a4"># rax - 1 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>jz <span style="color:#bd93f9">0x12345</span>  <span style="color:#6272a4"># 如果为0，则跳转到0x12345处
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>而<code>test</code>用的是与操作：</p>
<pre tabindex="0"><code>test %rax, %rbx  # rax &amp; rbx
je   0x123456    # 如果相等则跳转到 0x12345处
</code></pre><p>上面说的的<code>eflags</code>是一个特殊的寄存器，当执行了<code>test</code>或<code>cmp</code>之，<code>eflags</code>的某些位会变化，比如有进位、或者溢出、结果为0等等。 

        <a data-fancybox="gallery" href="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/8.png">
            <img class="mx-auto" alt="" src="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/8.png" />
        </a>
    </p>
<ul>
<li>OF(Overflow Flag)溢出标志,溢出时为1，否则置0.标明一个溢出了的计算,如:结构和目标不匹配。</li>
<li>SF(Sign Flag)符号标志,结果为负时置1，否则置0。</li>
<li>ZF(Zero Flag)零标志,运算结果为0时置1，否则置0。</li>
<li>CF(Carry Flag)进位标志,进位时置1，否则置0.注意:Carry标志中存放计算后最右的位。</li>
<li>AF(Auxiliary carry Flag)辅助进位标志，记录运算时第3位(半个字节)产生的进位置。
有进位时1,否则置0。</li>
<li>PF(Parity Flag)奇偶标志.结果操作数中1的个数为偶数时置1，否则置0。</li>
</ul>
<p>控制标志位：</p>
<ul>
<li>DF(Direction Flag)方向标志，在串处理指令中控制信息的方向。</li>
<li>IF(Interrupt Flag)中断标志。</li>
<li>TF(Trap Flag)陷井标志。</li>
</ul>
<p>相关的跳转指令：   </p>
<table>
<thead>
<tr>
<th>指令</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>je或jz</td>
<td>如果相等则跳转(等于0)</td>
</tr>
<tr>
<td>jne或jnz</td>
<td>如果不等则跳转(不等于0)</td>
</tr>
<tr>
<td>js</td>
<td>如果为负则跳转</td>
</tr>
<tr>
<td>jns</td>
<td>如果不为负则跳转</td>
</tr>
<tr>
<td>jg或jnle</td>
<td>如果大于，且是有符号数则跳转</td>
</tr>
<tr>
<td>jge或jnl</td>
<td>如果大于等于，且是有符号数则跳转</td>
</tr>
<tr>
<td>jl或jnge</td>
<td>如果小于，且是有符号数则跳转</td>
</tr>
<tr>
<td>jle或jng</td>
<td>如果小于等于，且是有符号数则跳转</td>
</tr>
</tbody>
</table>
<h4 id="if判断">if判断</h4>
<p>代码如下：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">loop_if</span>(<span style="color:#8be9fd">int</span> i) {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span>(<span style="color:#bd93f9">1</span> <span style="color:#ff79c6">==</span> i) {
</span></span><span style="display:flex;"><span>        res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">if</span>(<span style="color:#bd93f9">2</span> <span style="color:#ff79c6">==</span> i) {
</span></span><span style="display:flex;"><span>        res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">2</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">else</span> {
</span></span><span style="display:flex;"><span>        res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">10</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> res;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>jmp</code>跳转后面跟的是<code>loop_if</code>的起始地址+迁移量组成的标签，比如:<code>jne    4005de &lt;loop_if+0x1d&gt;</code>，<code>jne</code>后面跟的就是跳转到哪条地址，尖括号中对应的是<code>loop_if</code>起始地址的偏移量，这里跳转的是<code>4005de</code>。<br>
对应的就是这句：<code>4005de:       cmpl   $0x2,-0x14(%rbp)</code>，我在这句后面加了注释， <strong>#</strong> 后面跟的就是标签 <code>&lt;loop_if+0x1d&gt;</code>。<br>
反汇编的结果如下(省略了机器编码)：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>00000000004005<span style="color:#50fa7b">c1</span> &lt;loop_if&gt;:
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">c1:</span>       <span style="color:#50fa7b">push</span>   <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">c2:</span>       <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%rsp</span>,<span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">c5:</span>       <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%edi</span>,-<span style="color:#bd93f9">0x14</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">c8:</span>       <span style="color:#50fa7b">movl</span>   $0x0,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">cf:</span>       <span style="color:#50fa7b">cmpl</span>   $0x1,-<span style="color:#bd93f9">0x14</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">d3:</span>       <span style="color:#50fa7b">jne</span>    <span style="color:#bd93f9">4005de</span> &lt;loop_if+<span style="color:#bd93f9">0x1d</span>&gt;
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">d5:</span>       <span style="color:#50fa7b">movl</span>   $0x1,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">dc:</span>       <span style="color:#50fa7b">jmp</span>    <span style="color:#bd93f9">4005f4</span> &lt;loop_if+<span style="color:#bd93f9">0x33</span>&gt;
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">de:</span>       <span style="color:#50fa7b">cmpl</span>   $0x2,-<span style="color:#bd93f9">0x14</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4">#&lt;loop_if+0x1d&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>e2:       jne    <span style="color:#bd93f9">4005ed</span> &lt;loop_if+<span style="color:#bd93f9">0x2c</span>&gt;
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">e4:</span>       <span style="color:#50fa7b">movl</span>   $0x2,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">eb:</span>       <span style="color:#50fa7b">jmp</span>    <span style="color:#bd93f9">4005f4</span> &lt;loop_if+<span style="color:#bd93f9">0x33</span>&gt;
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">ed:</span>       <span style="color:#50fa7b">movl</span>   $0xa,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)    <span style="color:#6272a4">#&lt;loop_if+0x2c&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>f4:       mov    -<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>    <span style="color:#6272a4">#&lt;loop_if+0x33&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>f7:       pop    <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">f8:</span>       <span style="color:#50fa7b">retq</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>汇编代码的跳转逻辑如下：</p>
<p>
        <a data-fancybox="gallery" href="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/9.png">
            <img class="mx-auto" alt="" src="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/9.png" />
        </a>
    </p>
<h4 id="do-while">do-while</h4>
<p>代码如下:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">loop_1</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> a <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">do</span> {
</span></span><span style="display:flex;"><span>        res <span style="color:#ff79c6">=</span> a <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">10</span>;
</span></span><span style="display:flex;"><span>        a<span style="color:#ff79c6">++</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#ff79c6">while</span>(a <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">10</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> res;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>等价的<code>goto</code>版本如下，一上来先执行<code>loop</code>标签里面的代码，然后执行<code>if</code>判断，如果满足条件则<code>goto</code>到<code>loop</code>标签处，继续执行。后面的汇编代码其实就是翻译这个<code>goto</code>版本。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">loop_1</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> a <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">loop</span>:
</span></span><span style="display:flex;"><span>        res <span style="color:#ff79c6">=</span> a <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">10</span>;
</span></span><span style="display:flex;"><span>        a<span style="color:#ff79c6">++</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span>(a <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">10</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">goto</span> loop;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> res;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>反汇编后的结果：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>000000000040052<span style="color:#50fa7b">d</span> &lt;loop_1&gt;:
</span></span><span style="display:flex;"><span>  40052<span style="color:#8be9fd;font-style:italic">d:</span>        <span style="color:#50fa7b">push</span>   <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  40052<span style="color:#8be9fd;font-style:italic">e:</span>        <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%rsp</span>,<span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  400531:        <span style="color:#50fa7b">movl</span>   $0x1,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4"># a = 1
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400538</span>:        movl   $0x0,-<span style="color:#bd93f9">0x8</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4"># res = 0
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40053</span>f:        mov    -<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%edx</span>   <span style="color:#6272a4"># res -&gt; %edx
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400542</span>:        mov    <span style="color:#8be9fd;font-style:italic">%edx</span>,<span style="color:#8be9fd;font-style:italic">%eax</span>         
</span></span><span style="display:flex;"><span>  <span style="color:#bd93f9">400544</span>:        shl    $0x2,<span style="color:#8be9fd;font-style:italic">%eax</span>         <span style="color:#6272a4"># 逻辑左移，等于eax * 2
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400547</span>:        add    <span style="color:#8be9fd;font-style:italic">%edx</span>,<span style="color:#8be9fd;font-style:italic">%eax</span>         <span style="color:#6272a4"># eax + 1
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400549</span>:        add    <span style="color:#8be9fd;font-style:italic">%eax</span>,<span style="color:#8be9fd;font-style:italic">%eax</span>         <span style="color:#6272a4"># eax * 2，这三条指令类似 ((eax*4)+1)*2
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40054</span>b:        mov    <span style="color:#8be9fd;font-style:italic">%eax</span>,-<span style="color:#bd93f9">0x8</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4"># eax -&gt; res
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40054</span>e:        addl   $0x1,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4"># a++
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400552</span>:        cmpl   $0x9,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4"># a和9比较
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400556</span>:        jle    <span style="color:#bd93f9">40053f</span> &lt;loop_1+<span style="color:#bd93f9">0x12</span>&gt;  <span style="color:#6272a4"># 若小于跳转到 40053f
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400558</span>:        mov    -<span style="color:#bd93f9">0x8</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>   <span style="color:#6272a4"># 保存结果-&gt;eax，待返回用
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40055</span>b:        pop    <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  40055<span style="color:#8be9fd;font-style:italic">c:</span>        <span style="color:#50fa7b">retq</span>   
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="while循环">while循环</h4>
<p>代码如下：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">loop_2</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> a <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">while</span>(a <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">10</span>) {
</span></span><span style="display:flex;"><span>        res <span style="color:#ff79c6">=</span> a <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">10</span>;
</span></span><span style="display:flex;"><span>        a<span style="color:#ff79c6">++</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> res;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>等价的<code>goto</code>版本，一上来先<code>goto</code>到<code>test</code>标签，执行<code>if</code>判断，如果满足跳转到<code>loop</code>标签处继续执行，不满足则往下执行，相当于跳出了<code>while</code>循环，汇编代码就是翻译了这段等价的<code>goto</code>代码。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">loop_2</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> a <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">goto</span> <span style="color:#8be9fd;font-style:italic">test</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">loop</span>:
</span></span><span style="display:flex;"><span>        res <span style="color:#ff79c6">=</span> a <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">10</span>;
</span></span><span style="display:flex;"><span>        a<span style="color:#ff79c6">++</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">test</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span>(a <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">10</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">goto</span> loop;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> res;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>反汇编后的结果：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>000000000040055<span style="color:#50fa7b">d</span> &lt;loop_2&gt;:
</span></span><span style="display:flex;"><span>  40055<span style="color:#8be9fd;font-style:italic">d:</span>        <span style="color:#50fa7b">push</span>   <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  40055<span style="color:#8be9fd;font-style:italic">e:</span>        <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%rsp</span>,<span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  400561:        <span style="color:#50fa7b">movl</span>   $0x1,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)     <span style="color:#6272a4"># a = 1
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400568</span>:        movl   $0x0,-<span style="color:#bd93f9">0x8</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)     <span style="color:#6272a4"># res = 0
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40056</span>f:        jmp    <span style="color:#bd93f9">400584</span> &lt;loop_2+<span style="color:#bd93f9">0x27</span>&gt; <span style="color:#6272a4">#跳转到 400584
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400571</span>:        mov    -<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%edx</span>     <span style="color:#6272a4"># res -&gt; edx
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400574</span>:        mov    <span style="color:#8be9fd;font-style:italic">%edx</span>,<span style="color:#8be9fd;font-style:italic">%eax</span>           <span style="color:#6272a4"># exd -&gt; eax
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400576</span>:        shl    $0x2,<span style="color:#8be9fd;font-style:italic">%eax</span>           <span style="color:#6272a4"># 逻辑左移，等于eax * 2
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400579</span>:        add    <span style="color:#8be9fd;font-style:italic">%edx</span>,<span style="color:#8be9fd;font-style:italic">%eax</span>           <span style="color:#6272a4"># eax + 1
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40057</span>b:        add    <span style="color:#8be9fd;font-style:italic">%eax</span>,<span style="color:#8be9fd;font-style:italic">%eax</span>           <span style="color:#6272a4"># eax * 2，这三条指令类似 ((eax*4)+1)*2
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40057</span>d:        mov    <span style="color:#8be9fd;font-style:italic">%eax</span>,-<span style="color:#bd93f9">0x8</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)     <span style="color:#6272a4"># eax -&gt; res
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400580</span>:        addl   $0x1,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)     <span style="color:#6272a4"># a++
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400584</span>:        cmpl   $0x9,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)     <span style="color:#6272a4"># a和9比较
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400588</span>:        jle    <span style="color:#bd93f9">400571</span> &lt;loop_2+<span style="color:#bd93f9">0x14</span>&gt; <span style="color:#6272a4"># 若小于跳转到 400571
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40058</span>a:        mov    -<span style="color:#bd93f9">0x8</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>     <span style="color:#6272a4"># 保存结果-&gt;eax，待返回用
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40058</span>d:        pop    <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  40058<span style="color:#8be9fd;font-style:italic">e:</span>        <span style="color:#50fa7b">retq</span>   
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="for循环">for循环</h4>
<p>代码如下：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">loop_3</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">for</span>(<span style="color:#8be9fd">int</span> a <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>; a <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">10</span>; <span style="color:#ff79c6">++</span>a) {
</span></span><span style="display:flex;"><span>        res <span style="color:#ff79c6">=</span> a <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">10</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> res;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>等价的<code>goto</code>版本，跟<code>while</code>的<code>goto</code>版本有些类似，一上来先判断下是否满足条件，不满足的话就不会执行这个循环了，循环主体和<code>a++</code>都放在了<code>loop</code>块内，在<code>loop</code>块内还有一个判断，如果满足条件则跳转到<code>loop</code>继续执行。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">loop_3</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> a <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span>(n <span style="color:#ff79c6">&gt;=</span> <span style="color:#bd93f9">10</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">goto</span> done
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">loop</span>:
</span></span><span style="display:flex;"><span>        res <span style="color:#ff79c6">=</span> a <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">10</span>;
</span></span><span style="display:flex;"><span>        a<span style="color:#ff79c6">++</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span>(a <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">10</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">goto</span> loop;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">done</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> res;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>反汇编结果如下：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>000000000040058<span style="color:#50fa7b">f</span> &lt;loop_3&gt;:
</span></span><span style="display:flex;"><span>  40058<span style="color:#8be9fd;font-style:italic">f:</span>        <span style="color:#50fa7b">push</span>   <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  400590:        <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%rsp</span>,<span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  400593:        <span style="color:#50fa7b">movl</span>   $0x0,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4"># 0 -&gt; res
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40059</span>a:        movl   $0x1,-<span style="color:#bd93f9">0x8</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4"># 1 -&gt; a
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>a1:        jmp    <span style="color:#bd93f9">4005b6</span> &lt;loop_3+<span style="color:#bd93f9">0x27</span>&gt; <span style="color:#6272a4"># 强制跳转，准备比较
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>a3:        mov    -<span style="color:#bd93f9">0x8</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%edx</span>   <span style="color:#6272a4"># a(1) -&gt; edx
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>a6:        mov    <span style="color:#8be9fd;font-style:italic">%edx</span>,<span style="color:#8be9fd;font-style:italic">%eax</span>         <span style="color:#6272a4"># edx -&gt; eax
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>a8:        shl    $0x2,<span style="color:#8be9fd;font-style:italic">%eax</span>         <span style="color:#6272a4"># 逻辑左移，等于eax * 2
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>ab:        add    <span style="color:#8be9fd;font-style:italic">%edx</span>,<span style="color:#8be9fd;font-style:italic">%eax</span>         <span style="color:#6272a4"># eax + 1
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>ad:        add    <span style="color:#8be9fd;font-style:italic">%eax</span>,<span style="color:#8be9fd;font-style:italic">%eax</span>         <span style="color:#6272a4"># eax * 2，这三条指令类似 ((eax*4)+1)*2
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>af:        mov    <span style="color:#8be9fd;font-style:italic">%eax</span>,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4"># eax -&gt; res
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>b2:        addl   $0x1,-<span style="color:#bd93f9">0x8</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4"># a++
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>b6:        cmpl   $0x9,-<span style="color:#bd93f9">0x8</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4">#9和a比较
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>ba:        jle    <span style="color:#bd93f9">4005a3</span> &lt;loop_3+<span style="color:#bd93f9">0x14</span>&gt; <span style="color:#6272a4"># 若小于则跳转
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>bc:        mov    -<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span> <span style="color:#6272a4"># 否则将结果-&gt;eax，待返回使用
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>bf:        pop    <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">c0:</span>        <span style="color:#50fa7b">retq</span>   
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="switch语句">switch语句</h4>
<p>代码如下：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">loop_switch</span>(<span style="color:#8be9fd">int</span> i ) {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">switch</span>(i) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">case</span> <span style="color:#bd93f9">1</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>            res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">break</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">case</span> <span style="color:#bd93f9">2</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>            res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">2</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">break</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">case</span> <span style="color:#bd93f9">3</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>            res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">3</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">break</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">case</span> <span style="color:#bd93f9">4</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>            res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">4</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">break</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">case</span> <span style="color:#bd93f9">5</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>            res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">5</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">break</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">default</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>            res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">10</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">break</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> res;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>switch</code>语句是用跳转表实现的，根据传入参数值，然后去跳转表中查找匹配的地址，之后直接做一个跳转，这样的好处是省去了大量的比较了，即便条件分支很多，也不会对性能有影响，加上了跳转表后的逻辑如下，后面汇编代码就是根据这个逻辑翻译的。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#ff79c6">static</span> <span style="color:#8be9fd">void</span> <span style="color:#ff79c6">*</span>jmp[<span style="color:#bd93f9">6</span>] <span style="color:#ff79c6">=</span> {<span style="color:#ff79c6">&amp;&amp;</span>case_1, 
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">&amp;&amp;</span>case_2, 
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">&amp;&amp;</span>case_3, 
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">&amp;&amp;</span>case_4,
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">&amp;&amp;</span>case_5,
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">&amp;&amp;</span>case_default};
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">if</span>(i <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">6</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">goto</span> <span style="color:#ff79c6">*</span>jmp[<span style="color:#bd93f9">6</span>]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">case_1</span>:
</span></span><span style="display:flex;"><span>    res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">goto</span> done;
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">case_2</span>:
</span></span><span style="display:flex;"><span>    res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">2</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">goto</span> done;
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">case_3</span>:
</span></span><span style="display:flex;"><span>    res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">3</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">goto</span> done;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">case</span> <span style="color:#8be9fd;font-style:italic">_4</span>:
</span></span><span style="display:flex;"><span>    res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">4</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">goto</span> done;
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">case_5</span>:
</span></span><span style="display:flex;"><span>    res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">5</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">goto</span> done;
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">case_default</span>:
</span></span><span style="display:flex;"><span>    res <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">10</span>;
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">done</span>:
</span></span><span style="display:flex;"><span>    res <span style="color:#ff79c6">-&gt;</span> <span style="color:#ff79c6">%</span>rax
</span></span></code></pre></td></tr></table>
</div>
</div><p>反汇编结果如下：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>00000000004006<span style="color:#50fa7b">e6</span> &lt;loop_switch&gt;:
</span></span><span style="display:flex;"><span>  4006<span style="color:#8be9fd;font-style:italic">e6:</span>        <span style="color:#50fa7b">push</span>   <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  4006<span style="color:#8be9fd;font-style:italic">e7:</span>        <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%rsp</span>,<span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  4006<span style="color:#8be9fd;font-style:italic">ea:</span>        <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%edi</span>,-<span style="color:#bd93f9">0x14</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)  <span style="color:#6272a4"># 保存参数i
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4006</span>ed:        movl   $0x0,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4"># res &lt;- 0
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4006</span>f4:        cmpl   $0x5,-<span style="color:#bd93f9">0x14</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)  <span style="color:#6272a4"># 比较i和5
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4006</span>f8:        ja     <span style="color:#bd93f9">400734</span> &lt;loop_switch+<span style="color:#bd93f9">0x4e</span>&gt; <span style="color:#6272a4"># 若大于5，则执行defualt分支
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4006</span>fa:        mov    -<span style="color:#bd93f9">0x14</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>  <span style="color:#6272a4"># i -&gt; eax
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4006</span>fd:        mov    <span style="color:#bd93f9">0x4008f0</span>(,<span style="color:#8be9fd;font-style:italic">%rax</span>,<span style="color:#bd93f9">8</span>),<span style="color:#8be9fd;font-style:italic">%rax</span> <span style="color:#6272a4"># 跳转表
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400704</span>:        <span style="color:#bd93f9">00</span>
</span></span><span style="display:flex;"><span>  400705:        <span style="color:#50fa7b">jmpq</span>   *<span style="color:#8be9fd;font-style:italic">%rax</span>             <span style="color:#6272a4"># 执行跳转表
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400707</span>:        movl   $0x1,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4"># res &lt;- 1
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40070</span>e:        jmp    <span style="color:#bd93f9">40073c</span> &lt;loop_switch+<span style="color:#bd93f9">0x56</span>&gt; <span style="color:#6272a4"># 跳转到switch结束后的位置
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400710</span>:        movl   $0x2,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4"># res &lt; - 2
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400717</span>:        jmp    <span style="color:#bd93f9">40073c</span> &lt;loop_switch+<span style="color:#bd93f9">0x56</span>&gt; <span style="color:#6272a4"># 跳转到switch结束后的位置
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400719</span>:        movl   $0x3,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4"># res &lt;- 3
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400720</span>:        jmp    <span style="color:#bd93f9">40073c</span> &lt;loop_switch+<span style="color:#bd93f9">0x56</span>&gt; <span style="color:#6272a4"># 跳转到switch结束后的位置
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400722</span>:        movl   $0x4,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4"># res &lt;- 4
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400729</span>:        jmp    <span style="color:#bd93f9">40073c</span> &lt;loop_switch+<span style="color:#bd93f9">0x56</span>&gt; <span style="color:#6272a4"># 跳转到switch结束后的位置
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40072</span>b:        movl   $0x5,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4"># res &lt;- 5
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400732</span>:        jmp    <span style="color:#bd93f9">40073c</span> &lt;loop_switch+<span style="color:#bd93f9">0x56</span>&gt; <span style="color:#6272a4"># 跳转到switch结束后的位置
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400734</span>:        movl   $0xa,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4"># res &lt;- 10
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40073</span>b:        nop
</span></span><span style="display:flex;"><span>  40073<span style="color:#8be9fd;font-style:italic">c:</span>        <span style="color:#50fa7b">mov</span>    -<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>   <span style="color:#6272a4"># switch结束后的位置， res-&gt;%rax，待函数返回使用
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40073</span>f:        pop    <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  400740:        <span style="color:#50fa7b">retq</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>switch</code>执行的跳转逻辑如下图：<br>

        <a data-fancybox="gallery" href="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/10.png">
            <img class="mx-auto" alt="" src="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/10.png" />
        </a>
    </p>
<h2 id="组合和结构体">组合和结构体</h2>
<p>这里展示了数组、结构体对应的汇编代码，从下面的反汇编代码能看到，汇编里面并没有数组、结构体这些东西，对于汇编来说，只有读写内存、读写寄存器而已。</p>
<h4 id="数组">数组</h4>
<p>代码如下：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#8be9fd">void</span> <span style="color:#50fa7b">arr_1</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> n[<span style="color:#bd93f9">5</span>] <span style="color:#ff79c6">=</span> {<span style="color:#bd93f9">1</span>,<span style="color:#bd93f9">2</span>,<span style="color:#bd93f9">3</span>,<span style="color:#bd93f9">4</span>,<span style="color:#bd93f9">5</span>};
</span></span><span style="display:flex;"><span>    n[<span style="color:#bd93f9">3</span>] <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">99</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>反汇编后的结果如下：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>000000000040057<span style="color:#50fa7b">d</span> &lt;arr_1&gt;:
</span></span><span style="display:flex;"><span>  40057<span style="color:#8be9fd;font-style:italic">d:</span>        <span style="color:#50fa7b">push</span>   <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  40057<span style="color:#8be9fd;font-style:italic">e:</span>        <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%rsp</span>,<span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  400581:        <span style="color:#50fa7b">movl</span>   $0x1,-<span style="color:#bd93f9">0x20</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  400588:        <span style="color:#50fa7b">movl</span>   $0x2,-<span style="color:#bd93f9">0x1c</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  40058<span style="color:#8be9fd;font-style:italic">f:</span>        <span style="color:#50fa7b">movl</span>   $0x3,-<span style="color:#bd93f9">0x18</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  400596:        <span style="color:#50fa7b">movl</span>   $0x4,-<span style="color:#bd93f9">0x14</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  40059<span style="color:#8be9fd;font-style:italic">d:</span>        <span style="color:#50fa7b">movl</span>   $0x5,-<span style="color:#bd93f9">0x10</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">a4:</span>        <span style="color:#50fa7b">movl</span>   $0x63,-<span style="color:#bd93f9">0x14</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">ab:</span>        <span style="color:#50fa7b">pop</span>    <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">ac:</span>        <span style="color:#50fa7b">retq</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>上面汇编操作对应如下图：<br>

        <a data-fancybox="gallery" href="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/11.png">
            <img class="mx-auto" alt="" src="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/11.png" />
        </a>
    
从汇编角度看，其实是没有数组这个东西的，因为操作的都是内存。所以对于同样一个内存地址，可以写<strong>4</strong>字节，也可以写<strong>8字节</strong>，甚至超过数组范围写数据也是可以的，汇编也没有越界、类型不匹配这种检查。</p>
<h4 id="结构体">结构体</h4>
<p>代码如下：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#ff79c6">struct</span> person {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> a;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">char</span> b;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">char</span> <span style="color:#ff79c6">*</span>c;
</span></span><span style="display:flex;"><span>} p;
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">void</span> <span style="color:#50fa7b">arr_2</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">struct</span> person t;
</span></span><span style="display:flex;"><span>    t.a <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">10</span>;
</span></span><span style="display:flex;"><span>    t.b <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;a&#39;</span>;
</span></span><span style="display:flex;"><span>    t.c <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;abcde&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>反汇编结果如下：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>00000000004005<span style="color:#50fa7b">ad</span> &lt;arr_2&gt;:
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">ad:</span>        <span style="color:#50fa7b">push</span>   <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">ae:</span>        <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%rsp</span>,<span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">b1:</span>        <span style="color:#50fa7b">movl</span>   $0xa,-<span style="color:#bd93f9">0x10</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4"># t.a = 10
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>b8:        movb   $0x61,-<span style="color:#bd93f9">0xc</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4"># t.b = &#39;a&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>bc:        movq   $0x4008c0,-<span style="color:#bd93f9">0x8</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>) <span style="color:#6272a4"># t.c = &#34;abcde&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>c3:        <span style="color:#bd93f9">00</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">c4:</span>        <span style="color:#50fa7b">pop</span>    <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">c5:</span>        <span style="color:#50fa7b">retq</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>从反汇编的结果看，结构体的逻辑很简单，就是往栈中赋几个值。而且从汇编的角度也体现不出来结构体，对于汇编来说就是普通的<code>mov</code>指令而已。</p>
<h4 id="联合体">联合体</h4>
<p>代码如下：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#ff79c6">union</span> student {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> a;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">short</span> b;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">long</span> c;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">char</span> <span style="color:#ff79c6">*</span>d;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">void</span> <span style="color:#50fa7b">arr_3</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">union</span> student s;
</span></span><span style="display:flex;"><span>    s.a <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>    s.b <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">2</span>;
</span></span><span style="display:flex;"><span>    s.c <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">3</span>;
</span></span><span style="display:flex;"><span>    s.d <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;abcdefg&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>反汇编结果如下：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>00000000004005<span style="color:#50fa7b">c6</span> &lt;arr_3&gt;:
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">c6:</span>        <span style="color:#50fa7b">push</span>   <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">c7:</span>        <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%rsp</span>,<span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">ca:</span>        <span style="color:#50fa7b">movl</span>   $0x1,-<span style="color:#bd93f9">0x10</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)  <span style="color:#6272a4"># s.a = 1
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>d1:        movw   $0x2,-<span style="color:#bd93f9">0x10</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)  <span style="color:#6272a4"># s.b = 2
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>d7:        movq   $0x3,-<span style="color:#bd93f9">0x10</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)  <span style="color:#6272a4"># s.c = 3
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>de:        <span style="color:#bd93f9">00</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">df:</span>        <span style="color:#50fa7b">movq</span>   $0x4008c6,-<span style="color:#bd93f9">0x10</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>) <span style="color:#6272a4"># s.d = &#34;abcdefg&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>e6:        <span style="color:#bd93f9">00</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">e7:</span>        <span style="color:#50fa7b">pop</span>    <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  4005<span style="color:#8be9fd;font-style:italic">e8:</span>        <span style="color:#50fa7b">retq</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>联合体跟结构体差不多，从汇编角度看，都是普通的<code>mov</code>操作，也就是对于汇编来说，没有什么对象、结构体，都是往内存地址中赋值。<br>
当然联合体和结构体还是有些不同，结构体给变量赋值的时候，是<strong>往不同的内存地址赋值</strong>；而联合体赋值的时候，每个变量的<strong>内存起始位置</strong>都是一样的。<br>
赋值的地址都是<code>-0x10(%rbp)</code>，所以联合体的大小，是由长度最长的那个变量决定的。</p>
<h4 id="动态申请内存">动态申请内存</h4>
<p>代码如下：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#8be9fd">void</span> <span style="color:#50fa7b">arr_1</span>(<span style="color:#8be9fd">int</span> a) {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">char</span> <span style="color:#ff79c6">*</span>m <span style="color:#ff79c6">=</span> malloc( <span style="color:#bd93f9">200</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">sizeof</span>(<span style="color:#8be9fd">char</span>) );
</span></span><span style="display:flex;"><span>    printf(<span style="color:#f1fa8c">&#34;malloc -&gt; %x</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>,m);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>反汇编结果如下:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>000000000040057<span style="color:#50fa7b">d</span> &lt;arr_1&gt;:
</span></span><span style="display:flex;"><span>  40057<span style="color:#8be9fd;font-style:italic">d:</span>        <span style="color:#50fa7b">push</span>   <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  40057<span style="color:#8be9fd;font-style:italic">e:</span>        <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%rsp</span>,<span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  400581:        <span style="color:#50fa7b">sub</span>    $0x20,<span style="color:#8be9fd;font-style:italic">%rsp</span>        <span style="color:#6272a4"># 栈增长32个字节
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400585</span>:        mov    <span style="color:#8be9fd;font-style:italic">%edi</span>,-<span style="color:#bd93f9">0x14</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)  <span style="color:#6272a4"># 保存edi(参数a)
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400588</span>:        mov    $0xc8,<span style="color:#8be9fd;font-style:italic">%edi</span>        <span style="color:#6272a4"># 将200赋给edi
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40058</span>d:        callq  <span style="color:#bd93f9">400480</span> &lt;malloc@plt&gt; <span style="color:#6272a4"># 调用malloc函数
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400592</span>:        mov    <span style="color:#8be9fd;font-style:italic">%rax</span>,-<span style="color:#bd93f9">0x8</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4"># 动态创建的内存 -&gt; *m
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400596</span>:        mov    -<span style="color:#bd93f9">0x8</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%rax</span>   <span style="color:#6272a4"># *m -&gt; rax
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40059</span>a:        mov    <span style="color:#8be9fd;font-style:italic">%rax</span>,<span style="color:#8be9fd;font-style:italic">%rsi</span>         <span style="color:#6272a4"># rax -&gt; rsi(参数2)
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40059</span>d:        mov    $0x400860,<span style="color:#8be9fd;font-style:italic">%edi</span>    <span style="color:#6272a4"># 字符串地址-&gt;edi(参数1)
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>a2:        mov    $0x0,<span style="color:#8be9fd;font-style:italic">%eax</span>         <span style="color:#6272a4"># 0 -&gt; rax
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>a7:        callq  <span style="color:#bd93f9">400450</span> &lt;printf@plt&gt; <span style="color:#6272a4"># 调用printf函数
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4005</span>ac:        leaveq 
</span></span><span style="display:flex;"><span>  <span style="color:#bd93f9">4005</span>ad:        retq  
</span></span></code></pre></td></tr></table>
</div>
</div><p>从汇编结果看，动态申请的内存，是调用了<code>malloc</code>申请一块内存，然后返回内存地址，它的生命周期不受栈的控制，即便<code>arr_1</code>函数销毁了，新申请的内存仍然在，这里由于没有手动调用<code>free</code>，在函数返回后，这段内存就没法被访问了，导致了内存泄露。 <br>
从使用上来看，动态申请内存只是调用一个函数而已，跟普通的指针引用、函数返回没什么区别。只是这段空间不在<strong>栈</strong>上了，使用就要更小心了。</p>
<h2 id="浮点数">浮点数</h2>
<p>浮点数的计算，用的是另外一套寄存器，一共<code>16</code>个通用浮点寄存器。浮点数和整数之间的转换也有对应的指令，另外还有操作浮点数的运算操作指令。<br>
<code>16</code>个通用浮点寄存器如下：<br>

        <a data-fancybox="gallery" href="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/12_%E6%B5%AE%E7%82%B9%E5%AF%84%E5%AD%98%E5%99%A8.jpg">
            <img class="mx-auto" alt="" src="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/12_%E6%B5%AE%E7%82%B9%E5%AF%84%E5%AD%98%E5%99%A8.jpg" />
        </a>
    </p>
<p>浮点数相关的指令，复制相关指令：</p>
<ul>
<li><code>vmovss</code>、<code>vmossd</code>: 传送单精度数、双精度数</li>
<li><code>vmovaps</code>、<code>vmovapd</code>: 传送对齐的封装好的单精度数、双精度数</li>
</ul>
<p>浮点数转整数相关指令：</p>
<ul>
<li><code>vcvttss2si</code>、<code>vcvttsd2si</code>: 用截断的方式把单精度数转为整数、用截断的方式把双精度数转为整数</li>
<li><code>vcvttss2siq</code>、<code>vcvttsd2siq</code>: 用截断的方式把单精度数转为四字节整数、用截断的方式把双精度数转为四字节整数</li>
</ul>
<p>整数转浮点数相关指令：</p>
<ul>
<li><code>vcvtsi2ss</code>、<code>vcvtsi2sd</code>: 把整数转换成单精度数、双精度数</li>
<li><code>vcvtsi2ssq</code>、<code>vcvtsi2sdq</code>: 把四字节整数转换成单精度数、双精度数</li>
</ul>
<p>浮点数的运算操作指令：</p>
<ul>
<li><code>vaddss</code>、<code>vaddsd</code>: 浮点数加法，单精度和双精度</li>
<li><code>vsubss</code>、<code>vsubsd</code>: 浮点数减法，单精度和双精度</li>
<li><code>vmulss</code>、<code>vmulsd</code>: 浮点数乘法，单精度和双精度</li>
<li><code>vdivss</code>、<code>vdivsd</code>: 浮点数除法，单精度和双的精度</li>
<li><code>vmaxss</code>、<code>vmaxsd</code>: 浮点数最大值，单精度和双精度，D &lt;- max(s2,s1)</li>
<li><code>vminss</code>、<code>vminsd</code>: 浮点数最小值，单精度和双精度</li>
<li><code>sqrtss</code>、<code>sqrtsd</code>: 浮点数平方根，单精度和双精度</li>
</ul>
<p>浮点数的位运算指令：</p>
<ul>
<li><code>vxorps</code>: 位级异或，单精度</li>
<li><code>vorpd</code>: 位级异或，双精度</li>
<li><code>vandps</code>: 位级与，单精度</li>
<li><code>vandpd</code>: 位级与，双精度</li>
</ul>
<p>比较操作：</p>
<ul>
<li><code>ucomiss</code>: 比较单精度</li>
<li><code>ucomisd</code>: 比较双精度</li>
</ul>
<p><code>vunpcklps</code>指令：<code>%xmm0, %xmm0, %xmm0</code><br>
用来交叉放置来自两个 XMM 寄存器的值，把它们存储到第三个寄存器中。（如果一个源寄存器的内容为字 <code>[ s1, s2, s3, s4 ]</code>，另一个源寄存器为 <code>[ d1, d2, d3, d4 ]</code>，那么目的寄存器的值会是 <code>[ s1, d1, s0, d0 ]</code>。</p>
<p>下面来看一个具体的例子，一段<code>c</code>程序操作浮点数：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#8be9fd">float</span> <span style="color:#50fa7b">foo_1</span>(<span style="color:#8be9fd">int</span> a, <span style="color:#8be9fd">int</span> b, <span style="color:#8be9fd">float</span> c, <span style="color:#8be9fd">float</span> d, <span style="color:#8be9fd">double</span> e) {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> x <span style="color:#ff79c6">=</span> (<span style="color:#8be9fd">int</span>)c;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> y <span style="color:#ff79c6">=</span> (<span style="color:#8be9fd">int</span>)d;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">long</span> z <span style="color:#ff79c6">=</span> (<span style="color:#8be9fd">long</span>)e;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">float</span> res <span style="color:#ff79c6">=</span> (<span style="color:#8be9fd">float</span>)(x <span style="color:#ff79c6">+</span> y <span style="color:#ff79c6">+</span> z);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> res;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>反汇编结果如下：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>00000000004004<span style="color:#50fa7b">ed</span> &lt;foo_1&gt;:
</span></span><span style="display:flex;"><span>  4004<span style="color:#8be9fd;font-style:italic">ed:</span>        <span style="color:#50fa7b">push</span>   <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  4004<span style="color:#8be9fd;font-style:italic">ee:</span>        <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%rsp</span>,<span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  4004<span style="color:#8be9fd;font-style:italic">f1:</span>        <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%edi</span>,-<span style="color:#bd93f9">0x24</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)  <span style="color:#6272a4"># 保存参数1
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4004</span>f4:        mov    <span style="color:#8be9fd;font-style:italic">%esi</span>,-<span style="color:#bd93f9">0x28</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)  <span style="color:#6272a4"># 保存参数2
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4004</span>f7:        movss  <span style="color:#8be9fd;font-style:italic">%xmm0</span>,-<span style="color:#bd93f9">0x2c</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>) <span style="color:#6272a4"># 保存参数3
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">4004</span>fc:        movss  <span style="color:#8be9fd;font-style:italic">%xmm1</span>,-<span style="color:#bd93f9">0x30</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>) <span style="color:#6272a4"># 保存参数4
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400501</span>:        movsd  <span style="color:#8be9fd;font-style:italic">%xmm2</span>,-<span style="color:#bd93f9">0x38</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>) <span style="color:#6272a4"># 保存参数5
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400506</span>:        movss  -<span style="color:#bd93f9">0x2c</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%xmm0</span>
</span></span><span style="display:flex;"><span>  40050<span style="color:#8be9fd;font-style:italic">b:</span>        <span style="color:#50fa7b">cvttss2si</span> <span style="color:#8be9fd;font-style:italic">%xmm0</span>,<span style="color:#8be9fd;font-style:italic">%eax</span>     <span style="color:#6272a4"># int x = (int)c
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40050</span>f:        mov    <span style="color:#8be9fd;font-style:italic">%eax</span>,-<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4"># 保存x的值到内存中
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400512</span>:        movss  -<span style="color:#bd93f9">0x30</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%xmm0</span>
</span></span><span style="display:flex;"><span>  400517:        <span style="color:#50fa7b">cvttss2si</span> <span style="color:#8be9fd;font-style:italic">%xmm0</span>,<span style="color:#8be9fd;font-style:italic">%eax</span>     <span style="color:#6272a4"># int y = (int)d
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40051</span>b:        mov    <span style="color:#8be9fd;font-style:italic">%eax</span>,-<span style="color:#bd93f9">0x8</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)   <span style="color:#6272a4"># 保存y的值到内存中
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40051</span>e:        movsd  -<span style="color:#bd93f9">0x38</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%xmm0</span>
</span></span><span style="display:flex;"><span>  400523:        <span style="color:#50fa7b">cvttsd2si</span> <span style="color:#8be9fd;font-style:italic">%xmm0</span>,<span style="color:#8be9fd;font-style:italic">%rax</span>     <span style="color:#6272a4"># long z = (long)e
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400528</span>:        mov    <span style="color:#8be9fd;font-style:italic">%rax</span>,-<span style="color:#bd93f9">0x10</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)  <span style="color:#6272a4"># 保存z的值到内存中
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40052</span>c:        mov    -<span style="color:#bd93f9">0x8</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>   <span style="color:#6272a4"># y -&gt; eax
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40052</span>f:        mov    -<span style="color:#bd93f9">0x4</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%edx</span>   <span style="color:#6272a4"># x -&gt; edx
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400532</span>:        add    <span style="color:#8be9fd;font-style:italic">%edx</span>,<span style="color:#8be9fd;font-style:italic">%eax</span>         <span style="color:#6272a4"># x+y -&gt; eax
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400534</span>:        movslq <span style="color:#8be9fd;font-style:italic">%eax</span>,<span style="color:#8be9fd;font-style:italic">%rdx</span>
</span></span><span style="display:flex;"><span>  400537:        <span style="color:#50fa7b">mov</span>    -<span style="color:#bd93f9">0x10</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%rax</span>  <span style="color:#6272a4"># z -&gt; rax
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40053</span>b:        add    <span style="color:#8be9fd;font-style:italic">%rdx</span>,<span style="color:#8be9fd;font-style:italic">%rax</span>         <span style="color:#6272a4"># x+y+z-&gt;rax
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">40053</span>e:        cvtsi2ss <span style="color:#8be9fd;font-style:italic">%rax</span>,<span style="color:#8be9fd;font-style:italic">%xmm0</span>      <span style="color:#6272a4"># (x+y+z) -&gt; float
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400543</span>:        movss  <span style="color:#8be9fd;font-style:italic">%xmm0</span>,-<span style="color:#bd93f9">0x14</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>) <span style="color:#6272a4"># 后面几句将xmm0 -&gt; rax，待函数返回使用
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#bd93f9">400548</span>:        mov    -<span style="color:#bd93f9">0x14</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%eax</span>
</span></span><span style="display:flex;"><span>  40054<span style="color:#8be9fd;font-style:italic">b:</span>        <span style="color:#50fa7b">mov</span>    <span style="color:#8be9fd;font-style:italic">%eax</span>,-<span style="color:#bd93f9">0x3c</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>)
</span></span><span style="display:flex;"><span>  40054<span style="color:#8be9fd;font-style:italic">e:</span>        <span style="color:#50fa7b">movss</span>  -<span style="color:#bd93f9">0x3c</span>(<span style="color:#8be9fd;font-style:italic">%rbp</span>),<span style="color:#8be9fd;font-style:italic">%xmm0</span>
</span></span><span style="display:flex;"><span>  400553:        <span style="color:#50fa7b">pop</span>    <span style="color:#8be9fd;font-style:italic">%rbp</span>
</span></span><span style="display:flex;"><span>  400554:        <span style="color:#50fa7b">retq</span>   
</span></span></code></pre></td></tr></table>
</div>
</div><p>首先将 5 个参数保存至内存中，内存栈地址如下：<br>

        <a data-fancybox="gallery" href="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/13.png">
            <img class="mx-auto" alt="" src="https://woquhaha.gitee.io/pic_tech_1/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/13.png" />
        </a>
    </p>
<p>下面看下几个强制转换语句</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> x <span style="color:#ff79c6">=</span> (<span style="color:#8be9fd">int</span>)c;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> y <span style="color:#ff79c6">=</span> (<span style="color:#8be9fd">int</span>)d;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">long</span> z <span style="color:#ff79c6">=</span> (<span style="color:#8be9fd">long</span>)e;
</span></span></code></pre></td></tr></table>
</div>
</div><p>分析下对应的指令：</p>
<ul>
<li><code>cvttss2si %xmm0,%eax</code>，等价于<code>int x = (int)c</code></li>
<li><code>mov    %eax,-0x4(%rbp)</code>，保存<code>x</code>的值到内存中</li>
<li><code>movss  -0x30(%rbp),%xmm0</code>,把内存中的float d拷贝到<code>xmm0</code></li>
<li><code>cvttss2si %xmm0,%eax</code>，等价于<code>int y = (int)d</code></li>
<li><code> mov    %eax,-0x8(%rbp)</code>，保存<code>y</code>的值到内存中</li>
<li><code>movsd  -0x38(%rbp),%xmm0</code>，把内存中double e拷贝到<code>xmm0</code></li>
<li><code>cvttsd2si %xmm0,%rax</code>，等价于<code>long z = (long)e</code></li>
<li><code>mov    %rax,-0x10(%rbp)</code>，保存<code>z</code>的值到内存中</li>
</ul>
<p>后面的操作是执行<code>float res = (float)(x + y + z)</code>这句，并将结果保存到<code>xmm0</code>寄存器，待函数返回使用。</p>
<ul>
<li><code>mov -0x8(%rbp),%eax</code>，y -&gt; eax</li>
<li><code>mov -0x4(%rbp),%edx</code>，x -&gt; edx</li>
<li><code>add %edx,%eax</code>，x+y -&gt; eax</li>
<li><code>movslq %eax,%rdx</code>， eax -&gt; rdx</li>
<li><code>mov -0x10(%rbp),%rax</code>，z -&gt; rax</li>
<li><code>add %rdx,%rax</code>，x+y+z-&gt;rax</li>
<li><code>cvtsi2ss %rax,%xmm0</code>，(x+y+z) -&gt; float</li>
<li><code>movss %xmm0,-0x14(%rbp)</code>，后面几句将xmm0 -&gt; rax，待函数返回使用</li>
<li><code>mov -0x14(%rbp),%eax</code></li>
<li><code>mov %eax,-0x3c(%rbp)</code></li>
<li><code>movss -0x3c(%rbp),%xmm0</code>，拷贝至<code>xmm0</code></li>
</ul>
<h2 id="参考">参考</h2>
<ul>
<li>《深入理解计算机系统》</li>
<li>Intel公司开发者手册： <a href="https://software.intel.com/content/www/us/en/develop/download/intel-64-and-ia-32-architectures-sdm-combined-volumes-1-2a-2b-2c-2d-3a-3b-3c-3d-and-4.html">https://software.intel.com/content/www/us/en/develop/download/intel-64-and-ia-32-architectures-sdm-combined-volumes-1-2a-2b-2c-2d-3a-3b-3c-3d-and-4.html</a></li>
</ul>

			<script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>
        </div>

        


        


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/%E6%B1%87%E7%BC%96'>汇编</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
</div>


                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://code0xff.org/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://code0xff.org/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://code0xff.org/post/2023/01/monetdbx100-hyper-pipelining-query-execution/" title="MonetDB/X100: Hyper-Pipelining Query Execution">MonetDB/X100: Hyper-Pipelining Query Execution</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2023/01/access-path-selection-in-main-memory-optimized-data-systems-should-i-scan-or-should-i-probe/" title="Access Path Selection in Main-Memory Optimized Data Systems Should I Scan or Should I Probe">Access Path Selection in Main-Memory Optimized Data Systems Should I Scan or Should I Probe</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2023/01/photon-a-fast-query-engine-for-lakehouse-systems/" title="Photon A Fast Query Engine for Lakehouse Systems">Photon A Fast Query Engine for Lakehouse Systems</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2023/01/mysql%E7%9A%84%E5%B9%B6%E5%8F%91/" title="MySQL的并发">MySQL的并发</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2022/12/mysql%E7%9A%84%E6%81%A2%E5%A4%8D/" title="MySQL的恢复">MySQL的恢复</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2022/12/mysql%E7%9A%84%E7%BC%93%E5%AD%98/" title="MySQL的缓存">MySQL的缓存</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2022/12/mysql%E6%9F%A5%E8%AF%A2%E5%88%86%E6%9E%90/" title="MySQL查询分析">MySQL查询分析</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2022/12/%E7%94%A8%E5%B7%A5%E5%85%B7%E5%88%86%E6%9E%90mysql%E5%AD%98%E5%82%A8%E6%96%87%E4%BB%B6/" title="用工具分析MySQL存储文件">用工具分析MySQL存储文件</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2022/12/mysql%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84/" title="MySQL文件存储结构">MySQL文件存储结构</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2022/11/%E8%B0%83%E8%AF%95mysql/" title="调试MySQL">调试MySQL</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://code0xff.org/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式 (6)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/">原理分析 (6)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E5%95%86%E4%B8%9A/">商业 (3)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据 (22)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库 (11)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%97%85%E8%A1%8C/">旅行 (10)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%9E%B6%E6%9E%84/">架构 (1)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E7%AE%97%E6%B3%95/">算法 (8)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E7%B3%BB%E7%BB%9F/">系统 (5)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言 (2)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记 (9)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E9%9A%8F%E4%BE%BF%E5%86%99%E5%86%99/">随便写写 (4)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">归档</a></h3>
<ul class="widget-list">
    
    <li><a href="https://code0xff.org/years/2021%E5%B9%B4/">2021年 (30)</a></li>
    
    <li><a href="https://code0xff.org/years/2022%E5%B9%B4/">2022年 (54)</a></li>
    
    <li><a href="https://code0xff.org/years/2023%E5%B9%B4/">2023年 (3)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://code0xff.org/tags/b%E6%A0%91/">B树 </a>
    
    <a href="https://code0xff.org/tags/flink/">flink </a>
    
    <a href="https://code0xff.org/tags/hive/">Hive </a>
    
    <a href="https://code0xff.org/tags/k8s/">k8s </a>
    
    <a href="https://code0xff.org/tags/kudu/">kudu </a>
    
    <a href="https://code0xff.org/tags/manacher/">Manacher </a>
    
    <a href="https://code0xff.org/tags/mapreduce/">MapReduce </a>
    
    <a href="https://code0xff.org/tags/mysql/">MySQL </a>
    
    <a href="https://code0xff.org/tags/paxos/">paxos </a>
    
    <a href="https://code0xff.org/tags/raft/">raft </a>
    
    <a href="https://code0xff.org/tags/scala/">scala </a>
    
    <a href="https://code0xff.org/tags/snowflake/">snowflake </a>
    
    <a href="https://code0xff.org/tags/spark/">spark </a>
    
    <a href="https://code0xff.org/tags/unix/">unix </a>
    
    <a href="https://code0xff.org/tags/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/">二分查找 </a>
    
    <a href="https://code0xff.org/tags/%E4%BA%8C%E5%8F%89%E6%A0%91%E9%81%8D%E5%8E%86/">二叉树遍历 </a>
    
    <a href="https://code0xff.org/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式 </a>
    
    <a href="https://code0xff.org/tags/%E5%8A%A8%E6%80%81%E6%B3%A8%E5%85%A5/">动态注入 </a>
    
    <a href="https://code0xff.org/tags/%E5%8E%86%E5%8F%B2/">历史 </a>
    
    <a href="https://code0xff.org/tags/%E5%9B%9E%E6%BA%AF/">回溯 </a>
    
    <a href="https://code0xff.org/tags/%E5%9B%BD%E5%86%85%E6%97%85%E8%A1%8C/">国内旅行 </a>
    
    <a href="https://code0xff.org/tags/%E5%9B%BD%E5%A4%96%E6%97%85%E8%A1%8C/">国外旅行 </a>
    
    <a href="https://code0xff.org/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据 </a>
    
    <a href="https://code0xff.org/tags/%E5%AD%98%E5%82%A8/">存储 </a>
    
    <a href="https://code0xff.org/tags/%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/">工作记录 </a>
    
    <a href="https://code0xff.org/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务 </a>
    
    <a href="https://code0xff.org/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库 </a>
    
    <a href="https://code0xff.org/tags/%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/">查询优化 </a>
    
    <a href="https://code0xff.org/tags/%E6%B1%87%E7%BC%96/">汇编 </a>
    
    <a href="https://code0xff.org/tags/%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/">湖仓一体 </a>
    
    <a href="https://code0xff.org/tags/%E7%94%9F%E6%B4%BB/">生活 </a>
    
    <a href="https://code0xff.org/tags/%E7%94%B5%E5%BD%B1/">电影 </a>
    
    <a href="https://code0xff.org/tags/%E7%AE%97%E6%B3%95/">算法 </a>
    
    <a href="https://code0xff.org/tags/%E7%BB%8F%E6%B5%8E/">经济 </a>
    
    <a href="https://code0xff.org/tags/%E7%BC%93%E5%AD%98/">缓存 </a>
    
    <a href="https://code0xff.org/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/">编译原理 </a>
    
    <a href="https://code0xff.org/tags/%E7%BD%91%E7%BB%9C/">网络 </a>
    
    <a href="https://code0xff.org/tags/%E8%AE%A1%E7%AE%97%E6%A1%86%E6%9E%B6/">计算框架 </a>
    
    <a href="https://code0xff.org/tags/%E8%AE%BA%E6%96%87/">论文 </a>
    
    <a href="https://code0xff.org/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记 </a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">RSS</h3>
        <ul class="widget-list">
            <li><a href="https://code0xff.org/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
    <footer id="footer">
    <div>
        &copy; 2023 <a href="https://code0xff.org/">记录每个瞬间 By 老王</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
    <div>
        网站备案编号：<a href="https://beian.miit.gov.cn">京ICP备19014975号-1</a>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script src="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'GA ID', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




</body>

</html>