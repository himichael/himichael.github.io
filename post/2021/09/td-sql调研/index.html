<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>TD-SQL调研 | 记录每个瞬间</title>
    <meta property="og:title" content="TD-SQL调研 - 记录每个瞬间">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2021-09-22T14:09:03&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2021-09-22T14:09:03&#43;08:00'>
        
    <meta name="Keywords" content="">
    <meta name="description" content="调研TD-SQL">
        <meta name="author" content="隔壁老王">
        
    <meta property="og:url" content="https://code0xff.cn/post/2021/09/td-sql%E8%B0%83%E7%A0%94/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
        <link href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://code0xff.cn/">
                        记录每个瞬间
                    </a>
                
                
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://code0xff.cn/">首页</a>
                    
                    <a  href="https://code0xff.cn/linked/" title="链接">链接</a>
                    
                    <a  href="https://code0xff.cn/archives/" title="归档">归档</a>
                    
                    <a  href="https://code0xff.cn/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">TD-SQL调研</h1>
        </header>
        <date class="post-meta meta-date">
            2021年9月22日
        </date>
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#mysql版">MySQL版</a>
          <ul>
            <li>
              <ul>
                <li><a href="#总体概览">总体概览</a></li>
                <li><a href="#计费">计费</a></li>
                <li><a href="#具体操作">具体操作</a></li>
                <li><a href="#api">API</a></li>
                <li><a href="#总结">总结</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#postgresql版">PostgreSQL版</a>
          <ul>
            <li>
              <ul>
                <li><a href="#总体概览-1">总体概览</a></li>
                <li><a href="#计费-1">计费</a></li>
                <li><a href="#具体操作-1">具体操作</a></li>
                <li><a href="#总结-1">总结</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
        
        <div class="post-meta">
            
            <span class="post-meta meta-tags">
                <ul class="clearfix">
                    <a href='/categories/%E5%88%86%E5%B8%83%E5%BC%8F'>分布式</a>
                </ul>
            </span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <p>[toc]</p>
<p>本文根据腾讯云数据库官方文档，总结了</p>
<ul>
<li>MySQL版</li>
<li>PostgreSQL版</li>
</ul>
<p>两个数据库的总体架构、具体操作、计费等情况<br>
由于数据库没有试用版，本文主要是通过阅读官方文档做出的总结</p>
<p>MySQL官方文档 -&gt; 【<a href="https://cloud.tencent.com/document/product/557">链接</a>】<br>
PostgreSQL官方文档 -&gt; 【<a href="https://cloud.tencent.com/document/product/1129">链接</a>】</p>
<h2 id="mysql版">MySQL版</h2>
<h4 id="总体概览">总体概览</h4>
<p>看展示的图片(控制台操作界面)，貌似是 MySQL8.x 改造的 <br>
单机分片最大量6T，最大QPS 24W</p>
<p>其原理是基于 shard-key做分片，这是目前已有的实现方案，这里的TProxy没找到介绍，可能是腾讯自己研发的，或者基于开源实现改造的 <br>

        <a data-fancybox="gallery" href="https://woquhaha.gitee.io/post/2021/09/%e6%b5%8b%e8%af%95%e4%b8%80%e4%b8%8b/1.jpg">
            <img class="mx-auto" alt="image" src="https://woquhaha.gitee.io/post/2021/09/%e6%b5%8b%e8%af%95%e4%b8%80%e4%b8%8b/1.jpg" />
        </a>
    </p>
<hr>
<p>对原生MySQL新增的功能：<br>
1、自动数据平衡</p>
<ul>
<li>新增节时候，自动平衡数据，但会有几秒-几十秒的不可写</li>
<li>升级节点时，将旧节点数据-&gt;新节点，然后proxy指向新节点<br>

        <a data-fancybox="gallery" href="https://woquhaha.gitee.io/post/2021/09/%e6%b5%8b%e8%af%95%e4%b8%80%e4%b8%8b/1.jpg">
            <img class="mx-auto" alt="image" src="https://woquhaha.gitee.io/post/2021/09/%e6%b5%8b%e8%af%95%e4%b8%80%e4%b8%8b/1.jpg" />
        </a>
    </li>
</ul>
<p>2、复制方式 <br>
在 MySQL自己的强同步之上，增加了异步特性<br>
比如 5个行程，处理10个事务，看性能测试 写和混合读写时候，比原生MySQL快 20-30%左右 <br>

        <a data-fancybox="gallery" href="https://woquhaha.gitee.io/post/2021/09/%e6%b5%8b%e8%af%95%e4%b8%80%e4%b8%8b/2.jpg">
            <img class="mx-auto" alt="image" src="https://woquhaha.gitee.io/post/2021/09/%e6%b5%8b%e8%af%95%e4%b8%80%e4%b8%8b/2.jpg" />
        </a>
    </p>
<p>3、shard-key，修改了MySQL语法，在创建表的时候指定了按哪个字段做分片<br>
在写入的时候，必须指定分片字段，否则报错</p>
<blockquote>
<p>SLA，99.95%</p>
</blockquote>
<h4 id="计费">计费</h4>
<p>计费方式：包年包月、按需计费    <br>
梯度计费<br>
1、0 - 96 小时<br>
2、96 - 360 小时 <br>
3、&gt; 360小时<br>
使用时间越长，价格越低</p>
<p>总费用 = 实例费用 + 备份空间费用（目前免费）+ 流量费用（目前免费）<br>
实例费用 = 节点价格 × 节点数量 × 分片数量 = (节点内存 × 内存价格 + 节点硬盘 × 硬盘价格) × 节点数量 × 分片数量</p>
<p>价格列表，北上广最便宜</p>
<table>
<thead>
<tr>
<th>地区</th>
<th>内存价格(1元，一个月)</th>
<th>磁盘价格(1元，一个月)</th>
</tr>
</thead>
<tbody>
<tr>
<td>广州、 北京、上海</td>
<td>45.90</td>
<td>0.324</td>
</tr>
<tr>
<td>成都、重庆</td>
<td>35.70</td>
<td>0.252</td>
</tr>
<tr>
<td>北京金融、深圳金融、上海金融</td>
<td>113.6</td>
<td>0.640</td>
</tr>
<tr>
<td>中国香港</td>
<td>68.85</td>
<td>0.540</td>
</tr>
<tr>
<td>弗吉尼亚、法兰克福</td>
<td>89.00</td>
<td>0.400</td>
</tr>
<tr>
<td>多伦多</td>
<td>91.50</td>
<td>0.600</td>
</tr>
<tr>
<td>孟买、新加坡</td>
<td>87.50</td>
<td>0.600</td>
</tr>
<tr>
<td>首尔、东京</td>
<td>66.00</td>
<td>0.750</td>
</tr>
</tbody>
</table>
<h4 id="具体操作">具体操作</h4>
<p>主要功能：</p>
<ul>
<li>支持内网、外网访问</li>
<li>灾备/只读实例</li>
<li>安全管理</li>
<li>性能检测</li>
<li>慢查询分析</li>
<li>配置读写分离</li>
<li>备份</li>
</ul>
<p>支持 单机 &lt;-&gt; 分布式环境互导入</p>
<p>分布式实例主要功能：</p>
<ul>
<li>提供了灵活的读写分离模式</li>
<li>支持全局的 order by、group by、limit 操作</li>
<li>聚合函数支持 sum、count、avg、min、max 等</li>
<li>支持跨节点（set）的 join、子查询</li>
<li>支持预处理协议</li>
<li>支持全局唯一字段，支持 sequence</li>
<li>支持分布式事务</li>
<li>支持两级分区</li>
<li>提供特定的 SQL 查询整个集群的配置和状态</li>
</ul>
<p>不支持的操作：</p>
<ul>
<li>不支持自定义函数、事件、表空间</li>
<li>不支持视图、存储过程、触发器、游标</li>
<li>不支持外键、自建分区</li>
<li>不支持复合语句，如 BEGIN END、LOOP</li>
<li>不支持主备同步相关的 SQL</li>
</ul>
<p>这里有完整的不支持的操作列表 -&gt; <a href="https://cloud.tencent.com/document/product/557/47511">链接</a></p>
<p>连接，直接用mysql方式连接：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">mysql -hxxx.xxx.xxx.xxx -Pxxxx -uxxx -pxxx -c
</code></pre></td></tr></table>
</div>
</div><p>支持 php，JDBC</p>
<p>TDSQL MySQL版 实例会对 SQL 进行语法解析，有一定的限制，如果用户想在某个节点（set）中执行 MySQL 支持，但分布式实例不支持的 SQL 时，可以使用透传 SQL 的功能。</p>
<p>分布式表类型：</p>
<ul>
<li>分表</li>
<li>单表(普通表)</li>
<li>广播表</li>
</ul>
<p>建分表，多了一个 <code>shardkey</code> 语法</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> test1 ( a <span style="color:#8be9fd;font-style:italic">int</span>, b <span style="color:#8be9fd;font-style:italic">int</span>, <span style="color:#ff79c6">c</span> <span style="color:#8be9fd;font-style:italic">char</span>(<span style="color:#bd93f9">20</span>),<span style="color:#ff79c6">primary</span> <span style="color:#ff79c6">key</span> (a,b),<span style="color:#ff79c6">unique</span> <span style="color:#ff79c6">key</span> u_1(a,<span style="color:#ff79c6">c</span>) ) shardkey<span style="color:#ff79c6">=</span>a;
Query OK, <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">rows</span> affected (<span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">07</span> sec)
</code></pre></td></tr></table>
</div>
</div><p>广播表:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> global_table ( a <span style="color:#8be9fd;font-style:italic">int</span>, b <span style="color:#8be9fd;font-style:italic">int</span> <span style="color:#ff79c6">key</span>) shardkey<span style="color:#ff79c6">=</span>noshardkey_allset;
Query OK, <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">rows</span> affected (<span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">06</span> sec)
</code></pre></td></tr></table>
</div>
</div><p>单表：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> noshard_table ( a <span style="color:#8be9fd;font-style:italic">int</span>, b <span style="color:#8be9fd;font-style:italic">int</span> <span style="color:#ff79c6">key</span>);
Query OK, <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">rows</span> affected (<span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">02</span> sec)
</code></pre></td></tr></table>
</div>
</div><h4 id="api">API</h4>
<p>安全组相关</p>
<ul>
<li>查询实例安全组信息</li>
<li>查询项目安全组信息</li>
<li>安全组批量解绑云资源</li>
<li>修改云数据库安全组</li>
</ul>
<p>分布式数据库相关操作</p>
<ul>
<li>取消DCN同步</li>
<li>克隆实例账户</li>
<li>关闭外网访问</li>
<li>复制账号权限</li>
<li>创建账号</li>
<li>创建DCDB分布式实例</li>
<li>创建独享集群DCDB实例</li>
<li>删除账号</li>
<li>查询账号权限</li>
<li>查询账号列表</li>
<li>获取日志列表</li>
<li>查看数据库参数</li>
<li>查询同步模式</li>
<li>获取实例节点信息</li>
<li>查询实例列表</li>
<li>新购分布式数据库实例询价</li>
<li>续费实例询价</li>
<li>查询分布式数据库可售卖地域和可用区信息</li>
<li>查询分片信息</li>
<li>查询变配分布式数据库实例价格</li>
<li>查询数据库对象列表</li>
<li>查询数据库表信息</li>
<li>查询数据库列表</li>
<li>获取实例灾备详情</li>
<li>查询流程状态</li>
<li>查询订单信息</li>
<li>查询项目列表</li>
<li>查询分布式数据库可售卖分片规格</li>
<li>获取SQL日志</li>
<li>拉取用户任务列表</li>
<li>销毁已隔离的包年包月实例</li>
<li>销毁按量计费实例</li>
<li>切分Binlog</li>
<li>设置账号权限</li>
<li>初始化实例</li>
<li>修改数据库账号备注</li>
<li>修改实例所属项目</li>
<li>修改数据库参数</li>
<li>修改同步模式</li>
<li>修改RS的访问策略</li>
<li>开通外网访问</li>
<li>续费分布式数据库实例</li>
<li>重置账号密码</li>
<li>升级分布式数据库</li>
</ul>
<h4 id="总结">总结</h4>
<p>总结</p>
<ul>
<li>从官方文档看，对原生MySQL改动不多，基本上可以认为就是原生MySQL的简单增强</li>
<li>原生MySQL也有集群、主备、主从等高可用方案从，从文档上看基本上都是业界通用的方案</li>
<li>对MySQL的语法有一些修改，主要是配合分布式方面做的改动，基本上还是兼容MySQL语法，可以用JDBC直连</li>
<li>分布式数据库的底层运维不知道是怎么做的，只是从SLA(99.95%)看基础运维应该还可以</li>
<li>API比较偏运维层面，运营的API基本没有</li>
<li>使用需要付费，目前没有免费试用的</li>
</ul>
<h2 id="postgresql版">PostgreSQL版</h2>
<h4 id="总体概览-1">总体概览</h4>
<p>PostgreSQL版本同时支持OLAP、OLTP两种方式 <br>
支持地理位置、NoSQL等，这些应该都是用原生PostgreSQL的方式实现</p>
<p>主要功能：</p>
<ul>
<li>分布式JOIN计算，这个可能是基于GreenPlum实现</li>
<li>审计、脱敏、数据加密</li>
<li>冷热分离</li>
<li>多级容灾
<ul>
<li>强同步复制</li>
<li>主从高可用</li>
<li>基于时间点的恢复功能</li>
</ul>
</li>
<li>分布式事务</li>
<li>兼容PostgreSQL语法</li>
</ul>
<p>TDSQL PostgreSQL版 采用无共享 share nothing 架构。数据库实例分为三种节点：</p>
<ul>
<li>协调节点（ Coordinator，CN）：是数据库服务的对外入口，负责数据的分发和查询规划，多个节点位置对等。</li>
<li>数据节点（Datanode，DN） ：负责执行协调节点分发的执行请求，实际存储业务数据。</li>
<li>全局事务管理器（GlobalTransactionManager，GTM）：负责全局事务管理。</li>
</ul>
<p>
        <a data-fancybox="gallery" href="https://woquhaha.gitee.io/post/2021/09/%e6%b5%8b%e8%af%95%e4%b8%80%e4%b8%8b/3.jpg">
            <img class="mx-auto" alt="image" src="https://woquhaha.gitee.io/post/2021/09/%e6%b5%8b%e8%af%95%e4%b8%80%e4%b8%8b/3.jpg" />
        </a>
    </p>
<p>PostgreSQL版，采用了主从模式，写主，读从 <br>
OLTP运行在主节点，OLAP运行在从节点，二者之间通过流复制的方式实现同步</p>
<blockquote>
<p>PostgreSQL 官方文档上面没有找到<strong>服务协议</strong>相关的说明</p>
</blockquote>
<h4 id="计费-1">计费</h4>
<p>内存价格：</p>
<table>
<thead>
<tr>
<th>内存规格（GB）</th>
<th>广州（元/GB/月）</th>
<th>上海（元/GB/月）</th>
<th>北京（元/GB/月）</th>
<th>香港（元/GB/月）</th>
</tr>
</thead>
<tbody>
<tr>
<td>0GB - 24 GB （不含24GB）</td>
<td>51</td>
<td>51</td>
<td>51</td>
<td>86</td>
</tr>
<tr>
<td>24GB - 96 GB （不含96GB）</td>
<td>46</td>
<td>46</td>
<td>46</td>
<td>85</td>
</tr>
<tr>
<td>96GB及以上</td>
<td>45</td>
<td>45</td>
<td>45</td>
<td>72</td>
</tr>
</tbody>
</table>
<p>磁盘价格：</p>
<table>
<thead>
<tr>
<th>地域</th>
<th>单价（元/GB/月）</th>
</tr>
</thead>
<tbody>
<tr>
<td>广州、上海、北京</td>
<td>0.36</td>
</tr>
<tr>
<td>香港</td>
<td>0.60</td>
</tr>
</tbody>
</table>
<p>跟MySQL类似，PostgreSQL也有梯度计费的方式 <br>
计费公式：</p>
<blockquote>
<p>总费用 = 实例费用 + 备份空间费用（目前免费）+ 流量费用（目前免费）<br>
其中，实例费用 = (节点总内存数 × 内存价格 + 节点总磁盘数 × 磁盘价格) × 时长</p>
</blockquote>
<h4 id="具体操作-1">具体操作</h4>
<p>优化SQL，可以通过命令行方式，explain给出调优建议，<a href="https://cloud.tencent.com/document/product/1129/39825">链接</a></p>
<ul>
<li>查看是否为分布式键查询</li>
<li>是否使用索引</li>
<li>是否为分布式key join</li>
<li>查看join发生节点</li>
<li>查看并行的worker数</li>
<li>查看各节点的执行计划是否一致</li>
</ul>
<p>建表
不支持shard-key，会默认分配一个shard-key</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> t_first_col_share(id <span style="color:#8be9fd;font-style:italic">serial</span> <span style="color:#ff79c6">not</span> <span style="color:#ff79c6">null</span>,nickname <span style="color:#8be9fd;font-style:italic">text</span>);
</code></pre></td></tr></table>
</div>
</div><p>指定shard-key</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> t_appoint_col(id <span style="color:#8be9fd;font-style:italic">serial</span> <span style="color:#ff79c6">not</span> <span style="color:#ff79c6">null</span>,nickname <span style="color:#8be9fd;font-style:italic">text</span>) distribute <span style="color:#ff79c6">by</span> shard(nickname);
<span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span>
</code></pre></td></tr></table>
</div>
</div><p>创建范围分区表</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> t_range (f1 <span style="color:#8be9fd;font-style:italic">bigint</span>,f2 <span style="color:#ff79c6">timestamp</span> <span style="color:#ff79c6">default</span> now(), f3 <span style="color:#8be9fd;font-style:italic">integer</span>) partition <span style="color:#ff79c6">by</span> range (f3) <span style="color:#ff79c6">begin</span> (<span style="color:#bd93f9">1</span>) step (<span style="color:#bd93f9">50</span>) partitions (<span style="color:#bd93f9">3</span>) distribute <span style="color:#ff79c6">by</span> shard(f1) <span style="color:#ff79c6">to</span> <span style="color:#ff79c6">group</span> default_group;
<span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span>
</code></pre></td></tr></table>
</div>
</div><p>冷热分区表</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> t_cold_hot_table(f1 <span style="color:#8be9fd;font-style:italic">bigint</span>, f2 <span style="color:#ff79c6">timestamp</span> ,f3 <span style="color:#8be9fd;font-style:italic">bigint</span>) partition <span style="color:#ff79c6">by</span> range (f2) <span style="color:#ff79c6">begin</span> (<span style="color:#ff79c6">timestamp</span> <span style="color:#ff79c6">without</span> time <span style="color:#ff79c6">zone</span> <span style="color:#f1fa8c">&#39;2017-09-01 0:0:0&#39;</span>) step (<span style="color:#8be9fd;font-style:italic">interval</span> <span style="color:#f1fa8c">&#39;1 month&#39;</span>) partitions (<span style="color:#bd93f9">12</span>) distribute <span style="color:#ff79c6">by</span> shard(f1,f2) <span style="color:#ff79c6">to</span> <span style="color:#ff79c6">group</span> default_group ext_group;
<span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span>
</code></pre></td></tr></table>
</div>
</div><p>分布式表和视图类型：</p>
<ul>
<li>分区表</li>
<li>范围分区，range，list，时间</li>
<li>冷热分区</li>
<li>逻辑分区</li>
<li>多级分区</li>
<li>物化视图</li>
</ul>
<h4 id="总结-1">总结</h4>
<p>PostgreSQL版本跟MySQL版差别比较大</p>
<ul>
<li>文档上没有介绍专门定制开发的功能，看起来所有的功能基本上都是原生PostgreSQL或者插件的</li>
<li>计费方式基本上跟MySQL差不多</li>
<li>SQL的优化，分区设置什么的比MySQL版的强，但主要依赖于PostgreSQL</li>
<li>没有API，管理运营都比较弱</li>
<li>目前看就是原生PostgreSQL+插件，比较难的底层存储运维不知道是怎么实现的</li>
</ul>

        </div>

        


        


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/%E5%88%86%E5%B8%83%E5%BC%8F'>分布式</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
</div>


                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://code0xff.cn/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://code0xff.cn/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://code0xff.cn/post/2021/10/%E6%8E%A8%E8%8D%90%E4%B8%80%E4%BA%9B%E4%B8%8D%E9%94%99%E7%9A%84%E9%9F%A9%E5%9B%BD%E7%94%B5%E5%BD%B1/" title="推荐一些不错的韩国电影">推荐一些不错的韩国电影</a>
    </li>
    
    <li>
        <a href="https://code0xff.cn/post/2021/10/%E9%A9%AC%E6%8B%89%E8%BD%A6%E7%AE%97%E6%B3%95/" title="马拉车算法">马拉车算法</a>
    </li>
    
    <li>
        <a href="https://code0xff.cn/post/2021/10/td-sql-pg%E7%89%88%E6%80%BB%E7%BB%93/" title="TD-SQL-PG版总结">TD-SQL-PG版总结</a>
    </li>
    
    <li>
        <a href="https://code0xff.cn/post/2021/10/%E5%A4%9A%E5%BD%A9%E7%9A%84%E9%BB%94%E4%B8%9C%E5%8D%97/" title="多彩的黔东南">多彩的黔东南</a>
    </li>
    
    <li>
        <a href="https://code0xff.cn/post/2021/10/%E4%BB%8E%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C/" title="从汇编角度看程序的执行">从汇编角度看程序的执行</a>
    </li>
    
    <li>
        <a href="https://code0xff.cn/post/2021/10/td-sql%E6%80%BB%E7%BB%93/" title="TD-SQL总结">TD-SQL总结</a>
    </li>
    
    <li>
        <a href="https://code0xff.cn/post/2021/10/%E8%8E%AB%E9%87%8C%E6%96%AF%E9%81%8D%E5%8E%86/" title="莫里斯遍历">莫里斯遍历</a>
    </li>
    
    <li>
        <a href="https://code0xff.cn/post/2021/10/%E6%9C%9D%E9%B2%9C%E4%B9%8B%E8%A1%8C/" title="朝鲜之行">朝鲜之行</a>
    </li>
    
    <li>
        <a href="https://code0xff.cn/post/2021/10/%E6%97%A5%E6%9C%AC%E4%B9%8B%E8%A1%8C/" title="日本之行">日本之行</a>
    </li>
    
    <li>
        <a href="https://code0xff.cn/post/2021/10/%E4%B8%BD%E6%B1%9F%E4%B9%8B%E8%A1%8C/" title="丽江之行">丽江之行</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://code0xff.cn/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式 (3)</a></li>
    
    <li><a href="https://code0xff.cn/categories/%E6%97%85%E8%A1%8C/">旅行 (7)</a></li>
    
    <li><a href="https://code0xff.cn/categories/%E7%94%9F%E6%B4%BB/">生活 (3)</a></li>
    
    <li><a href="https://code0xff.cn/categories/%E7%AE%97%E6%B3%95/">算法 (2)</a></li>
    
    <li><a href="https://code0xff.cn/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86/">计算机原理 (1)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://code0xff.cn/tags/manacher/">Manacher</a>
    
    <a href="https://code0xff.cn/tags/%E4%B8%9C%E4%BA%AC/">东京</a>
    
    <a href="https://code0xff.cn/tags/%E4%B8%BD%E6%B1%9F/">丽江</a>
    
    <a href="https://code0xff.cn/tags/%E4%BA%8C%E5%8F%89%E6%A0%91%E9%81%8D%E5%8E%86/">二叉树遍历</a>
    
    <a href="https://code0xff.cn/tags/%E4%BA%9A%E5%BA%87/">亚庇</a>
    
    <a href="https://code0xff.cn/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a>
    
    <a href="https://code0xff.cn/tags/%E5%A4%A7%E7%90%86/">大理</a>
    
    <a href="https://code0xff.cn/tags/%E5%A4%A7%E9%98%AA/">大阪</a>
    
    <a href="https://code0xff.cn/tags/%E5%A8%81%E5%B0%BC%E6%96%AF/">威尼斯</a>
    
    <a href="https://code0xff.cn/tags/%E6%84%8F%E5%A4%A7%E5%88%A9/">意大利</a>
    
    <a href="https://code0xff.cn/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
    
    <a href="https://code0xff.cn/tags/%E6%9C%9D%E9%B2%9C/">朝鲜</a>
    
    <a href="https://code0xff.cn/tags/%E6%B1%87%E7%BC%96/">汇编</a>
    
    <a href="https://code0xff.cn/tags/%E7%94%9F%E6%B4%BB/">生活</a>
    
    <a href="https://code0xff.cn/tags/%E7%94%B5%E5%BD%B1/">电影</a>
    
    <a href="https://code0xff.cn/tags/%E8%B4%B5%E5%B7%9E/">贵州</a>
    
    <a href="https://code0xff.cn/tags/%E9%A9%AC%E6%9D%A5%E8%A5%BF%E4%BA%9A/">马来西亚</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">RSS</h3>
        <ul class="widget-list">
            <li><a href="https://code0xff.cn/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
    <footer id="footer">
    <div>
        &copy; 2021 <a href="https://code0xff.cn/">记录每个瞬间 By 老王</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
    <div>
        <a href="http://www.beian.miit.gov.cn/">京ICP备19014975号</a>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script src="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'GA ID', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




</body>

</html>