<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>Spark原理-窗口函数和多维分析 | 记录每个瞬间</title>
    <meta property="og:title" content="Spark原理-窗口函数和多维分析 - 记录每个瞬间">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2024-04-27T09:08:07&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2024-04-27T09:08:07&#43;08:00'>
        
    <meta name="Keywords" content="">
    <meta name="description" content="Spark原理-窗口函数和多维分析">
        <meta name="author" content="隔壁老王">
        
    <meta property="og:url" content="https://code0xff.org/post/2024/05/spark_windows_cube/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
        <link href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://code0xff.org/">
                        记录每个瞬间
                    </a>
                
                
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://code0xff.org/">首页</a>
                    
                    <a  href="https://code0xff.org/linked/" title="链接">链接</a>
                    
                    <a  href="https://code0xff.org/archives/" title="归档">归档</a>
                    
                    <a  href="https://code0xff.org/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">Spark原理-窗口函数和多维分析</h1>
        </header>
        <date class="post-meta meta-date">
            2024年4月27日
        </date>
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#多维分析">多维分析</a>
          <ul>
            <li><a href="#cube">cube</a></li>
            <li><a href="#rollup">rollup</a></li>
            <li><a href="#grouping-sets">grouping sets</a></li>
            <li><a href="#原理分析">原理分析</a></li>
          </ul>
        </li>
        <li><a href="#窗口函数">窗口函数</a></li>
        <li><a href="#lateral">lateral</a></li>
        <li><a href="#pivot">pivot</a></li>
        <li><a href="#unpivot">unpivot</a></li>
        <li><a href="#with-cube-代码生成">with cube 代码生成</a></li>
        <li><a href="#参考">参考</a></li>
      </ul>
    </li>
  </ul>
</nav>
        
        <div class="post-meta">
            
            <span class="post-meta meta-tags">
                <ul class="clearfix">
                    <a href='/categories/%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90'>原理分析</a>
                </ul>
            </span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <h2 id="多维分析">多维分析</h2>
<h3 id="cube">cube</h3>
<p>测试代码</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> jsonData <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">Seq</span><span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;gradeID&#34;: 1, &#34;classID&#34;: 1, &#34;studentID&#34;: &#34;2017101&#34;, &#34;score&#34;: 80}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;gradeID&#34;: 1, &#34;classID&#34;: 1, &#34;studentID&#34;: &#34;2017104&#34;, &#34;score&#34;: 91}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;gradeID&#34;: 1, &#34;classID&#34;: 2, &#34;studentID&#34;: &#34;2017122&#34;, &#34;score&#34;: 75}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;gradeID&#34;: 1, &#34;classID&#34;: 2, &#34;studentID&#34;: &#34;2017811&#34;, &#34;score&#34;: 67}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;gradeID&#34;: 2, &#34;classID&#34;: 2, &#34;studentID&#34;: &#34;2017066&#34;, &#34;score&#34;: 81}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;gradeID&#34;: 2, &#34;classID&#34;: 1, &#34;studentID&#34;: &#34;2017057&#34;, &#34;score&#34;: 99}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;gradeID&#34;: 1, &#34;classID&#34;: 1, &#34;studentID&#34;: &#34;2017089&#34;, &#34;score&#34;: 85}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;gradeID&#34;: 1, &#34;classID&#34;: 2, &#34;studentID&#34;: &#34;2017044&#34;, &#34;score&#34;: 76}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;gradeID&#34;: 2, &#34;classID&#34;: 1, &#34;studentID&#34;: &#34;2017037&#34;, &#34;score&#34;: 69}&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> df<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">DataFrame</span> <span style="color:#ff79c6">=</span> spark<span style="color:#ff79c6">.</span>read<span style="color:#ff79c6">.</span>json<span style="color:#ff79c6">(</span>spark<span style="color:#ff79c6">.</span>sparkContext<span style="color:#ff79c6">.</span>parallelize<span style="color:#ff79c6">(</span>jsonData<span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>    df<span style="color:#ff79c6">.</span>createTempView<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;exam&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> df2 <span style="color:#ff79c6">=</span> spark<span style="color:#ff79c6">.</span>sql<span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        | SELECT gradeID, classID, max(score)  FROM  exam
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        | GROUP BY gradeID, classID WITH CUBE
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |&#34;&#34;&#34;</span><span style="color:#ff79c6">.</span>stripMargin<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    df2<span style="color:#ff79c6">.</span>show<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>    df2<span style="color:#ff79c6">.</span>explain<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;extended&#34;</span><span style="color:#ff79c6">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>结果：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>+-------+-------+----------+
</span></span><span style="display:flex;"><span>|gradeID|classID|max<span style="color:#ff79c6">(</span>score<span style="color:#ff79c6">)</span>|
</span></span><span style="display:flex;"><span>+-------+-------+----------+
</span></span><span style="display:flex;"><span>|      1|      1|        91|
</span></span><span style="display:flex;"><span>|      1|   NULL|        91|
</span></span><span style="display:flex;"><span>|   NULL|      1|        99|
</span></span><span style="display:flex;"><span>|   NULL|   NULL|        99|
</span></span><span style="display:flex;"><span>|      1|      2|        76|
</span></span><span style="display:flex;"><span>|   NULL|      2|        81|
</span></span><span style="display:flex;"><span>|      2|      2|        81|
</span></span><span style="display:flex;"><span>|      2|   NULL|        99|
</span></span><span style="display:flex;"><span>|      2|      1|        99|
</span></span><span style="display:flex;"><span>+-------+-------+----------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>with cube查询</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> gradeID, classID, <span style="color:#ff79c6">max</span>(score)  <span style="color:#ff79c6">FROM</span>  exam
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> gradeID, classID <span style="color:#ff79c6">WITH</span> <span style="color:#ff79c6">CUBE</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>等价于</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> gradeID, classID, <span style="color:#ff79c6">max</span>(score)  <span style="color:#ff79c6">FROM</span>  exam  <span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> gradeID, classID
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">UNION</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> gradeID, classID, <span style="color:#ff79c6">max</span>(score)  <span style="color:#ff79c6">FROM</span>  exam  <span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> gradeID, <span style="color:#ff79c6">null</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">UNION</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> gradeID, classID, <span style="color:#ff79c6">max</span>(score)  <span style="color:#ff79c6">FROM</span>  exam  <span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> <span style="color:#ff79c6">null</span>, classID
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">UNION</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> gradeID, classID, <span style="color:#ff79c6">max</span>(score)  <span style="color:#ff79c6">FROM</span>  exam  <span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> <span style="color:#ff79c6">null</span>, <span style="color:#ff79c6">null</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>相当于一份数据被当了<code>N</code>倍，$O(2^N)$，当维度增大时，放大的数据量急剧增大</p>
<p>生成的物理计划：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#ff79c6">==</span> Physical <span style="color:#8be9fd;font-style:italic">Plan</span> <span style="color:#ff79c6">==</span>
</span></span><span style="display:flex;"><span>AdaptiveSparkPlan <span style="color:#8be9fd;font-style:italic">isFinalPlan</span><span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">false</span>
</span></span><span style="display:flex;"><span>+- HashAggregate<span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">keys</span><span style="color:#ff79c6">=[</span>gradeID#19L, classID#20L, spark_grouping_id#18L<span style="color:#ff79c6">]</span>, 
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">functions</span><span style="color:#ff79c6">=[</span>max<span style="color:#ff79c6">(</span>score#8L<span style="color:#ff79c6">)]</span>, <span style="color:#8be9fd;font-style:italic">output</span><span style="color:#ff79c6">=[</span>gradeID#19L, classID#20L, max<span style="color:#ff79c6">(</span>score<span style="color:#ff79c6">)</span><span style="color:#6272a4">#15L])</span>
</span></span><span style="display:flex;"><span>   +- Exchange hashpartitioning<span style="color:#ff79c6">(</span>gradeID#19L, classID#20L, spark_grouping_id#18L, 1<span style="color:#ff79c6">)</span>, 
</span></span><span style="display:flex;"><span>	  ENSURE_REQUIREMENTS, <span style="color:#ff79c6">[</span><span style="color:#8be9fd;font-style:italic">plan_id</span><span style="color:#ff79c6">=</span>84<span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>      +- HashAggregate<span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">keys</span><span style="color:#ff79c6">=[</span>gradeID#19L, classID#20L, spark_grouping_id#18L<span style="color:#ff79c6">]</span>,
</span></span><span style="display:flex;"><span>	     <span style="color:#8be9fd;font-style:italic">functions</span><span style="color:#ff79c6">=[</span>partial_max<span style="color:#ff79c6">(</span>score#8L<span style="color:#ff79c6">)]</span>, <span style="color:#8be9fd;font-style:italic">output</span><span style="color:#ff79c6">=[</span>gradeID#19L, classID#20L, spark_grouping_id#18L, max#34L<span style="color:#ff79c6">])</span>
</span></span><span style="display:flex;"><span>         +- Expand <span style="color:#ff79c6">[[</span>score#8L, gradeID#7L, classID#6L, 0<span style="color:#ff79c6">]</span>, <span style="color:#ff79c6">[</span>score#8L, gradeID#7L, null, 1<span style="color:#ff79c6">]</span>, 
</span></span><span style="display:flex;"><span>		    <span style="color:#ff79c6">[</span>score#8L, null, classID#6L, 2<span style="color:#ff79c6">]</span>, <span style="color:#ff79c6">[</span>score#8L, null, null, 3<span style="color:#ff79c6">]]</span>, <span style="color:#ff79c6">[</span>score#8L, gradeID#19L, 
</span></span><span style="display:flex;"><span>			classID#20L, spark_grouping_id#18L<span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>            +- Project <span style="color:#ff79c6">[</span>score#8L, gradeID#7L, classID#6L<span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>               +- Scan ExistingRDD<span style="color:#ff79c6">[</span>classID#6L,gradeID#7L,score#8L,studentID#9<span style="color:#ff79c6">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行原理<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/20/7gla74.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/05/20/7gla74.png" />
        </a>
    </p>
<p>多维分析在执行过程中一般都会产生空值（null）。</p>
<ul>
<li>常用的方法是使用grouping函数来区分，如果是由多维分析产生的null值，则grouping函数返回 1</li>
<li>如果是数据本身的null值，则grouping函数返回 0</li>
</ul>
<h3 id="rollup">rollup</h3>
<p>测试代码 桶 with cube<br>
with rollup 查询</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> gradeID, classID, <span style="color:#ff79c6">max</span>(score)  <span style="color:#ff79c6">FROM</span>  exam
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> gradeID, classID <span style="color:#ff79c6">WITH</span> <span style="color:#ff79c6">ROLLUP</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>结果：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>+-------+-------+----------+
</span></span><span style="display:flex;"><span>|gradeID|classID|max<span style="color:#ff79c6">(</span>score<span style="color:#ff79c6">)</span>|
</span></span><span style="display:flex;"><span>+-------+-------+----------+
</span></span><span style="display:flex;"><span>|      1|      1|        91|
</span></span><span style="display:flex;"><span>|      1|   NULL|        91|
</span></span><span style="display:flex;"><span>|   NULL|   NULL|        99|
</span></span><span style="display:flex;"><span>|      1|      2|        76|
</span></span><span style="display:flex;"><span>|      2|      2|        81|
</span></span><span style="display:flex;"><span>|      2|   NULL|        99|
</span></span><span style="display:flex;"><span>|      2|      1|        99|
</span></span><span style="display:flex;"><span>+-------+-------+----------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>等价于：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> gradeID, classID, <span style="color:#ff79c6">max</span>(score)  <span style="color:#ff79c6">FROM</span>  exam <span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> gradeID, classID
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">UNION</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> gradeID, classID, <span style="color:#ff79c6">max</span>(score)  <span style="color:#ff79c6">FROM</span>  exam <span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> gradeID, <span style="color:#ff79c6">null</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">UNION</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> gradeID, classID, <span style="color:#ff79c6">max</span>(score)  <span style="color:#ff79c6">FROM</span>  exam <span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> <span style="color:#ff79c6">null</span>, <span style="color:#ff79c6">null</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>物理计划：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#ff79c6">==</span> Physical <span style="color:#8be9fd;font-style:italic">Plan</span> <span style="color:#ff79c6">==</span>
</span></span><span style="display:flex;"><span>AdaptiveSparkPlan <span style="color:#8be9fd;font-style:italic">isFinalPlan</span><span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">false</span>
</span></span><span style="display:flex;"><span>+- HashAggregate<span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">keys</span><span style="color:#ff79c6">=[</span>gradeID#19L, classID#20L, spark_grouping_id#18L<span style="color:#ff79c6">]</span>, 
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">functions</span><span style="color:#ff79c6">=[</span>max<span style="color:#ff79c6">(</span>score#8L<span style="color:#ff79c6">)]</span>, <span style="color:#8be9fd;font-style:italic">output</span><span style="color:#ff79c6">=[</span>gradeID#19L, classID#20L, max<span style="color:#ff79c6">(</span>score<span style="color:#ff79c6">)</span><span style="color:#6272a4">#15L])</span>
</span></span><span style="display:flex;"><span>   +- Exchange hashpartitioning<span style="color:#ff79c6">(</span>gradeID#19L, classID#20L, spark_grouping_id#18L, 1<span style="color:#ff79c6">)</span>, 
</span></span><span style="display:flex;"><span>      ENSURE_REQUIREMENTS, <span style="color:#ff79c6">[</span><span style="color:#8be9fd;font-style:italic">plan_id</span><span style="color:#ff79c6">=</span>84<span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>      +- HashAggregate<span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">keys</span><span style="color:#ff79c6">=[</span>gradeID#19L, classID#20L, spark_grouping_id#18L<span style="color:#ff79c6">]</span>, 
</span></span><span style="display:flex;"><span>	     <span style="color:#8be9fd;font-style:italic">functions</span><span style="color:#ff79c6">=[</span>partial_max<span style="color:#ff79c6">(</span>score#8L<span style="color:#ff79c6">)]</span>, <span style="color:#8be9fd;font-style:italic">output</span><span style="color:#ff79c6">=[</span>gradeID#19L, classID#20L, spark_grouping_id#18L, max#34L<span style="color:#ff79c6">])</span>
</span></span><span style="display:flex;"><span>         +- Expand <span style="color:#ff79c6">[[</span>score#8L, gradeID#7L, classID#6L, 0<span style="color:#ff79c6">]</span>, <span style="color:#ff79c6">[</span>score#8L, gradeID#7L, null, 1<span style="color:#ff79c6">]</span>, 
</span></span><span style="display:flex;"><span>		    <span style="color:#ff79c6">[</span>score#8L, null, null, 3<span style="color:#ff79c6">]]</span>, <span style="color:#ff79c6">[</span>score#8L, gradeID#19L, classID#20L, spark_grouping_id#18L<span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>            +- Project <span style="color:#ff79c6">[</span>score#8L, gradeID#7L, classID#6L<span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>               +- Scan ExistingRDD<span style="color:#ff79c6">[</span>classID#6L,gradeID#7L,score#8L,studentID#9<span style="color:#ff79c6">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="grouping-sets">grouping sets</h3>
<p>测试代码同 with cube <br>
查询 SQL</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> gradeID, classID, <span style="color:#ff79c6">max</span>(score)  <span style="color:#ff79c6">FROM</span>  exam
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> gradeID, classID <span style="color:#ff79c6">GROUPING</span> <span style="color:#ff79c6">SETS</span>((gradeID, classID), gradeID)
</span></span></code></pre></td></tr></table>
</div>
</div><p>等价于：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> gradeID, classID, <span style="color:#ff79c6">max</span>(score)  <span style="color:#ff79c6">FROM</span>  exam  <span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> gradeID, <span style="color:#ff79c6">null</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">UNION</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> gradeID, classID, <span style="color:#ff79c6">max</span>(score)  <span style="color:#ff79c6">FROM</span>  exam  <span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> <span style="color:#ff79c6">null</span>, classID
</span></span></code></pre></td></tr></table>
</div>
</div><p>结果：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>+-------+-------+----------+
</span></span><span style="display:flex;"><span>|gradeID|classID|max<span style="color:#ff79c6">(</span>score<span style="color:#ff79c6">)</span>|
</span></span><span style="display:flex;"><span>+-------+-------+----------+
</span></span><span style="display:flex;"><span>|      1|      1|        91|
</span></span><span style="display:flex;"><span>|      1|   NULL|        91|
</span></span><span style="display:flex;"><span>|      1|      2|        76|
</span></span><span style="display:flex;"><span>|      2|      2|        81|
</span></span><span style="display:flex;"><span>|      2|   NULL|        99|
</span></span><span style="display:flex;"><span>|      2|      1|        99|
</span></span><span style="display:flex;"><span>+-------+-------+----------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>物理计划：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#ff79c6">==</span> Physical <span style="color:#8be9fd;font-style:italic">Plan</span> <span style="color:#ff79c6">==</span>
</span></span><span style="display:flex;"><span>AdaptiveSparkPlan <span style="color:#8be9fd;font-style:italic">isFinalPlan</span><span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">false</span>
</span></span><span style="display:flex;"><span>+- HashAggregate<span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">keys</span><span style="color:#ff79c6">=[</span>gradeID#19L, classID#20L, spark_grouping_id#18L<span style="color:#ff79c6">]</span>, 
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">functions</span><span style="color:#ff79c6">=[</span>max<span style="color:#ff79c6">(</span>score#8L<span style="color:#ff79c6">)]</span>, <span style="color:#8be9fd;font-style:italic">output</span><span style="color:#ff79c6">=[</span>gradeID#19L, classID#20L, max<span style="color:#ff79c6">(</span>score<span style="color:#ff79c6">)</span><span style="color:#6272a4">#15L])</span>
</span></span><span style="display:flex;"><span>   +- Exchange hashpartitioning<span style="color:#ff79c6">(</span>gradeID#19L, classID#20L, spark_grouping_id#18L, 1<span style="color:#ff79c6">)</span>, 
</span></span><span style="display:flex;"><span>      ENSURE_REQUIREMENTS, <span style="color:#ff79c6">[</span><span style="color:#8be9fd;font-style:italic">plan_id</span><span style="color:#ff79c6">=</span>81<span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>      +- HashAggregate<span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">keys</span><span style="color:#ff79c6">=[</span>gradeID#19L, classID#20L, spark_grouping_id#18L<span style="color:#ff79c6">]</span>, 
</span></span><span style="display:flex;"><span>	     <span style="color:#8be9fd;font-style:italic">functions</span><span style="color:#ff79c6">=[</span>partial_max<span style="color:#ff79c6">(</span>score#8L<span style="color:#ff79c6">)]</span>, <span style="color:#8be9fd;font-style:italic">output</span><span style="color:#ff79c6">=[</span>gradeID#19L, classID#20L, spark_grouping_id#18L, max#34L<span style="color:#ff79c6">])</span>
</span></span><span style="display:flex;"><span>         +- Expand <span style="color:#ff79c6">[[</span>score#8L, gradeID#7L, classID#6L, 0<span style="color:#ff79c6">]</span>, <span style="color:#ff79c6">[</span>score#8L, gradeID#7L, null, 1<span style="color:#ff79c6">]]</span>, 
</span></span><span style="display:flex;"><span>		    <span style="color:#ff79c6">[</span>score#8L, gradeID#19L, classID#20L, spark_grouping_id#18L<span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>            +- Project <span style="color:#ff79c6">[</span>score#8L, gradeID#7L, classID#6L<span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>               +- Scan ExistingRDD<span style="color:#ff79c6">[</span>classID#6L,gradeID#7L,score#8L,studentID#9<span style="color:#ff79c6">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="原理分析">原理分析</h3>
<p>逻辑计划 &ndash;&gt; 物理计划<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/20/7glDWh.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/05/20/7glDWh.png" />
        </a>
    </p>
<p>类图：<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/20/7glOj9.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/05/20/7glOj9.png" />
        </a>
    </p>
<p>其中 group by 后面的表达式，用 bitmap 来存储的<br>
生成Expand+Aggregate节点</p>
<p>ResolveGroupingAnalytics规则</p>
<ul>
<li>生成GroupingSets节点：针对Aggregate节点，如果其中group by语句对应的是cube或rollup表达式，计算相应的bitmasks，将Aggregate节点转换为GroupingSets节点</li>
<li>生成Expand+Aggregate节点：针对GroupingSets节点，生成Expand逻辑算子树节点加上Aggregate逻辑算子树节点</li>
<li>替换多维分析函数（grouping_id和grouping函数）：将逻辑算子树某些节点中（主要存在Filter或Sort节点）的表达式所包含的多维分析函数，替换为对应生成的列名（在Expand节点中生成）</li>
<li>由于还存在一些未解析的表达式，后面还需要继续 analysis</li>
<li>GroupingSets节点转换为Aggregate Expand + Project3个节点的组合+</li>
</ul>
<p>Expand表示“扩展”</p>
<ul>
<li>多维分析在本质上相当于执行多种组合的group by操作</li>
<li>因此Expand所起的作用就是将一条数据扩展为特定形式的多条数据</li>
</ul>
<p>
        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/20/7glUmY.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/05/20/7glUmY.png" />
        </a>
    </p>
<p>多维分析逻辑算子树</p>
<ul>
<li>在物理算子树中，ExpandExec节点对应Expand逻辑算子树节点，Aggregate节点生成两个HashAggregateExec物理算子树节点</li>
<li>两个HashAggregateExec节点之间需要进行分区方面的处理，因此在最后阶段的EnsureRequirements规则中，会添加ExExchange节点进行Shuffle操作</li>
<li>最终得到的物理执行计划包含6个节点</li>
<li>Spark SQL中的多维分析的执行没有特殊之处，本质上仍然是聚合查询的计算过程</li>
<li>Expand方式执行多维分析虽然能够达到只读一次数据表的效果，但是在某些场景下容易造成中间数据的膨胀</li>
<li>如：数据的维度太高，Expand会产生指数级别的数据量

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/20/7gl18H.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/05/20/7gl18H.png" />
        </a>
    </li>
</ul>
<p>ExpandExec</p>
<ul>
<li>代码中的注释说明</li>
<li>Apply all of the GroupExpressions to every input row, hence we will get multiple output rows for an input row.</li>
</ul>
<p>一大段注释：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>    <span style="color:#6272a4">/*
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * When the projections list looks like:
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *   expr1A, exprB, expr1C
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *   expr2A, exprB, expr2C
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *   ...
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *   expr(N-1)A, exprB, expr(N-1)C
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * i.e. column A and C have different values for each output row, but column B stays constant.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * The generated code looks something like (note that B is only computed once in declaration):
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * // part 1: declare all the columns
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * colA = ...
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * colB = ...
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * colC = ...
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * // part 2: code that computes the columns
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * for (row = 0; row &lt; N; row++) {
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *   switch (row) {
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *     case 0:
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *       colA = ...
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *       colC = ...
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *     case 1:
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *       colA = ...
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *       colC = ...
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *     ...
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *     case N - 1:
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *       colA = ...
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *       colC = ...
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *   }
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *   // increment metrics and consume output values
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * }
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     *
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * We use a for loop here so we only includes one copy of the consume code and avoid code
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * size explosion.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>将一份数据复制 N 份，然后加上 gid，再做聚合<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/20/7glPrZ.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/05/20/7glPrZ.png" />
        </a>
    </p>
<h2 id="窗口函数">窗口函数</h2>
<p>定义</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>window_function [ nulls_option ] OVER
</span></span><span style="display:flex;"><span>( [  { PARTITION <span style="color:#ff79c6">|</span> DISTRIBUTE } <span style="color:#ff79c6">BY</span> partition_col_name <span style="color:#ff79c6">=</span> partition_col_val ( [ , ... ] ) ]
</span></span><span style="display:flex;"><span>  { <span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">|</span> SORT } <span style="color:#ff79c6">BY</span> expression [ <span style="color:#ff79c6">ASC</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">DESC</span> ] [ NULLS { <span style="color:#ff79c6">FIRST</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">LAST</span> } ] [ , ... ]
</span></span><span style="display:flex;"><span>  [ window_frame ] )
</span></span></code></pre></td></tr></table>
</div>
</div><p>窗口函数涉及了3个核心元素</p>
<ul>
<li>分区（(PARTITION|DISTRIBUTE)BY）信息</li>
<li>排序（(ORDER|SORT)BY）信息</li>
<li>窗框定义（windowFrame）</li>
</ul>
<p>测试代码</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>  test<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;windows test&#34;</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> jsonData <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">Seq</span><span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;name&#34;: &#34;Lisa&#34;, &#34;dept&#34;: &#34;Sales&#34;, &#34;salary&#34;: 10000, &#34;age&#34;: 35}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;name&#34;: &#34;Evan&#34;, &#34;dept&#34;: &#34;Sales&#34;, &#34;salary&#34;: 32000, &#34;age&#34;: 38}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;name&#34;: &#34;Fred&#34;, &#34;dept&#34;: &#34;Engineering&#34;, &#34;salary&#34;: 21000, &#34;age&#34;: 28}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;name&#34;: &#34;Alex&#34;, &#34;dept&#34;: &#34;Sales&#34;, &#34;salary&#34;: 30000, &#34;age&#34;: 33}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;name&#34;: &#34;Tom&#34;, &#34;dept&#34;: &#34;Engineering&#34;, &#34;salary&#34;: 23000, &#34;age&#34;: 33}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;name&#34;: &#34;Jane&#34;, &#34;dept&#34;: &#34;Marketing&#34;, &#34;salary&#34;: 29000, &#34;age&#34;: 28}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;name&#34;: &#34;Jeff&#34;, &#34;dept&#34;: &#34;Marketing&#34;, &#34;salary&#34;: 35000, &#34;age&#34;: 38}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;name&#34;: &#34;Paul&#34;, &#34;dept&#34;: &#34;Engineering&#34;, &#34;salary&#34;: 29000, &#34;age&#34;: 23}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;name&#34;: &#34;Chloe&#34;, &#34;dept&#34;: &#34;Engineering&#34;, &#34;salary&#34;: 23000, &#34;age&#34;: 25}&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> df <span style="color:#ff79c6">=</span> spark<span style="color:#ff79c6">.</span>read<span style="color:#ff79c6">.</span>json<span style="color:#ff79c6">(</span>spark<span style="color:#ff79c6">.</span>sparkContext<span style="color:#ff79c6">.</span>parallelize<span style="color:#ff79c6">(</span>jsonData<span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>    df<span style="color:#ff79c6">.</span>createTempView<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;employees&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> df2 <span style="color:#ff79c6">=</span> spark<span style="color:#ff79c6">.</span>sql<span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |SELECT name, dept, salary, RANK() OVER (PARTITION BY dept
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |ORDER BY salary) AS rank FROM employees;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |&#34;&#34;&#34;</span><span style="color:#ff79c6">.</span>stripMargin<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    df2<span style="color:#ff79c6">.</span>show<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>    df2<span style="color:#ff79c6">.</span>explain<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;extended&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>结果：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>+-----+-----------+------+----+
</span></span><span style="display:flex;"><span>| name|       dept|salary|rank|
</span></span><span style="display:flex;"><span>+-----+-----------+------+----+
</span></span><span style="display:flex;"><span>| Fred|Engineering| 21000|   1|
</span></span><span style="display:flex;"><span>|  Tom|Engineering| 23000|   2|
</span></span><span style="display:flex;"><span>|Chloe|Engineering| 23000|   2|
</span></span><span style="display:flex;"><span>| Paul|Engineering| 29000|   4|
</span></span><span style="display:flex;"><span>| Jane|  Marketing| 29000|   1|
</span></span><span style="display:flex;"><span>| Jeff|  Marketing| 35000|   2|
</span></span><span style="display:flex;"><span>| Lisa|      Sales| 10000|   1|
</span></span><span style="display:flex;"><span>| Alex|      Sales| 30000|   2|
</span></span><span style="display:flex;"><span>| Evan|      Sales| 32000|   3|
</span></span><span style="display:flex;"><span>+-----+-----------+------+----+
</span></span></code></pre></td></tr></table>
</div>
</div><p>物理计划：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>AdaptiveSparkPlan isFinalPlan<span style="color:#ff79c6">=</span><span style="color:#ff79c6">false</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+-</span> Window [rank(salary<span style="color:#ff79c6">#</span><span style="color:#bd93f9">9</span>L) windowspecdefinition(dept<span style="color:#ff79c6">#</span><span style="color:#bd93f9">7</span>, salary<span style="color:#ff79c6">#</span><span style="color:#bd93f9">9</span>L <span style="color:#ff79c6">ASC</span> NULLS <span style="color:#ff79c6">FIRST</span>, 
</span></span><span style="display:flex;"><span>   specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) <span style="color:#ff79c6">AS</span> rank<span style="color:#ff79c6">#</span><span style="color:#bd93f9">14</span>], 
</span></span><span style="display:flex;"><span>   [dept<span style="color:#ff79c6">#</span><span style="color:#bd93f9">7</span>], [salary<span style="color:#ff79c6">#</span><span style="color:#bd93f9">9</span>L <span style="color:#ff79c6">ASC</span> NULLS <span style="color:#ff79c6">FIRST</span>]
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">+-</span> Sort [dept<span style="color:#ff79c6">#</span><span style="color:#bd93f9">7</span> <span style="color:#ff79c6">ASC</span> NULLS <span style="color:#ff79c6">FIRST</span>, salary<span style="color:#ff79c6">#</span><span style="color:#bd93f9">9</span>L <span style="color:#ff79c6">ASC</span> NULLS <span style="color:#ff79c6">FIRST</span>], <span style="color:#ff79c6">false</span>, <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">+-</span> Exchange hashpartitioning(dept<span style="color:#ff79c6">#</span><span style="color:#bd93f9">7</span>, <span style="color:#bd93f9">1</span>), ENSURE_REQUIREMENTS, [plan_id<span style="color:#ff79c6">=</span><span style="color:#bd93f9">84</span>]
</span></span><span style="display:flex;"><span>         <span style="color:#ff79c6">+-</span> Project [name<span style="color:#ff79c6">#</span><span style="color:#bd93f9">8</span>, dept<span style="color:#ff79c6">#</span><span style="color:#bd93f9">7</span>, salary<span style="color:#ff79c6">#</span><span style="color:#bd93f9">9</span>L]
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">+-</span> Scan ExistingRDD[age<span style="color:#ff79c6">#</span><span style="color:#bd93f9">6</span>L,dept<span style="color:#ff79c6">#</span><span style="color:#bd93f9">7</span>,name<span style="color:#ff79c6">#</span><span style="color:#bd93f9">8</span>,salary<span style="color:#ff79c6">#</span><span style="color:#bd93f9">9</span>L]
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行过程：

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/20/7glReU.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/05/20/7glReU.png" />
        </a>
    </p>
<p>窗口类型</p>
<ul>
<li>WindowExpression的窗口函数（WindowFunction）是Expression类型</li>
<li>分区信息类型为Seq[Expression]，在上述案例中表示按照gradeID和classID这两列进行分区</li>
<li>排序信息类型为Seq[SortOrder]，对应score列的降序</li>
<li>窗框（WindowFrame）定义比较重要，有UnspecifiedFrame和SpecifiedWindowFrame两个子类

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/20/7glryq.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/05/20/7glryq.png" />
        </a>
    </li>
</ul>
<p>SpecifiedW indowFrame表示一个完整的窗框定义，包含</p>
<ul>
<li>frameType、frameStart、frameEnd 3个元素</li>
<li>分别代表窗框类型（FrameType）</li>
<li>起始的窗口边界（FrameBoundary）</li>
<li>终止的窗口边界（FrameBoundary）</li>
</ul>
<p>FrameBoundary包含</p>
<ul>
<li>UnboundedPreceding</li>
<li>ValuePreceding（value:Int）</li>
<li>CurrentRow</li>
<li>ValueFollow ing（value:Int）</li>
<li>UnboundedFollowing

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/20/7gltSs.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/05/20/7gltSs.png" />
        </a>
    </li>
</ul>
<p>RowFrame针对窗口分区中的所有数据行</p>
<ul>
<li>当ValuePreceding和ValueFollowing作为窗口边界时，其中的value值代表物理偏移量</li>
<li>例如“ROW BETWEEN 1PRECEDING AND 2 FOLLOW ING”表示4行数据构成的窗框，即从当前行的前一行到后两行</li>
</ul>
<p>RangeFrame针对的是用于排序的列</p>
<ul>
<li>当ValuePreceding和ValueFollowing作为窗口边界时，其中的value值代表逻辑偏移量</li>
<li>例如假设当前行的score值为87，而窗框的边界定义为“RANGEBETWEEN 1PRECEDINGAND 1FOLLOW ING”</li>
<li>那么所对应的数据窗口为score在[86，88]范围内的数据行</li>
</ul>
<p>转换过程：

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/20/7glzsa.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/05/20/7glzsa.png" />
        </a>
    </p>
<p>窗口的聚合过程：

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/20/7glCE7.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/05/20/7glCE7.png" />
        </a>
    </p>
<p>有5种窗框类型</p>
<ul>
<li>全部数据分区（Entire Partition）：即UNBOUNDED PRECEDING AND UNBOUNDED FOLLOW ING。在这种情况下，对于每条数据，需要处理该数据所在数据分区中的所有数据，对应实现为UnboundedW indowFunctionFrame类</li>
<li>扩张框（Growing Frame）：即UNBOUNDED PRECEDING AND&hellip;&hellip;在这种情况下，每次都会移动到新的数据行进行处理，并添加一些数据行扩展该框架，在这种类型的窗框中数据不会被移除，只会不停地加入新数据，窗口范围不停地“扩张”，对应的实现为UnboundedPrecedingW indow FunctionFrame类，案例中的row_number()函数就属于这种类型</li>
<li>收缩框（Shrinking Frame）：该框架只会移除数据，即&hellip;&hellip;ANDUNBOUNDED FOLLOW ING。在这种情况下，每次都会移动到新的数据行进行处理，并从窗框中移除一些数据行，这种类型的窗框中不会添加数据，窗口不停地“收缩”，对应的实现为UnboundedFollowing-W indowFunctionFrame类</li>
<li>移动框（Moving Frame）：每次处理到新的数据行，都会添加一些数据，同时也会删除一些数据，例如（1 PRECEDING AND CURRENT ROW）或（1 FOLLOW ING AND 2 FOLLOW ING），对应的实现为SlidingW indow FunctionFrame类</li>
<li>偏移框（Offset Frame）：该窗框仅包含一行数据，即距离当前数据行特定偏移量的数据。这里需要注意的是，偏移框仅适用于Off setW indowFunction类型的窗口函数</li>
</ul>
<p>根据WindowExec类doExecute方法可知，整体的执行逻辑分为两步</p>
<ul>
<li>按分区读取数据（fetchNextPartition），并将其保存在ArrayBuffer中，在此过程中先构造一个ArrayRowBuffer存储数据，如果超过阈值（默认为4096），则切换为基于磁盘的UnsafeExternalSorter数据结构；当前分区数据读取结束后，根据UnsafeExternalSorter是否为空，判断分区数据保存在ArrayRowBuffer还是ExternalRowBuffer数据结构中</li>
<li>遍历RowBuffer中的数据，逐条执行write操作，最终调用AggregateProcessor（注：封装row_number()函数）中的update等方法完成计算</li>
</ul>
<h2 id="lateral">lateral</h2>
<p>测试代码</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>  test<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;lateral test&#34;</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> jsonData <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">Seq</span><span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;id&#34;: 100, &#34;name&#34;: &#34;John&#34;, &#34;age&#34;: 30, &#34;class&#34;: 1, &#34;address&#34;: &#34;Street 1&#34;}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;id&#34;: 200, &#34;name&#34;: &#34;Mary&#34;, &#34;age&#34;: null, &#34;class&#34;: 1, &#34;address&#34;: &#34;Street 2&#34;}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;id&#34;: 300, &#34;name&#34;: &#34;Mike&#34;, &#34;age&#34;: 80, &#34;class&#34;: 3, &#34;address&#34;: &#34;Street 3&#34;}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;id&#34;: 400, &#34;name&#34;: &#34;Dan&#34;, &#34;age&#34;: 50, &#34;class&#34;: 4, &#34;address&#34;: &#34;Street 4&#34;}&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> df <span style="color:#ff79c6">=</span> spark<span style="color:#ff79c6">.</span>read<span style="color:#ff79c6">.</span>json<span style="color:#ff79c6">(</span>spark<span style="color:#ff79c6">.</span>sparkContext<span style="color:#ff79c6">.</span>parallelize<span style="color:#ff79c6">(</span>jsonData<span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>    df<span style="color:#ff79c6">.</span>createTempView<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;person &#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> df2 <span style="color:#ff79c6">=</span> spark<span style="color:#ff79c6">.</span>sql<span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |SELECT * FROM person
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |    LATERAL VIEW EXPLODE(ARRAY(30, 60)) tableName AS c_age
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |    LATERAL VIEW EXPLODE(ARRAY(40, 80)) AS d_age
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |&#34;&#34;&#34;</span><span style="color:#ff79c6">.</span>stripMargin<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    df2<span style="color:#ff79c6">.</span>show<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>    df2<span style="color:#ff79c6">.</span>explain<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;extended&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    println<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;===========================&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    spark<span style="color:#ff79c6">.</span>sql<span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |SELECT c_age, COUNT(1) FROM person
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |    LATERAL VIEW EXPLODE(ARRAY(30, 60)) AS c_age
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |    LATERAL VIEW EXPLODE(ARRAY(40, 80)) AS d_age
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |GROUP BY c_age;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |&#34;&#34;&#34;</span><span style="color:#ff79c6">.</span>stripMargin<span style="color:#ff79c6">).</span>show<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    spark<span style="color:#ff79c6">.</span>sql<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;SELECT * FROM person\n    LATERAL VIEW EXPLODE(ARRAY()) tableName AS c_age;&#34;</span><span style="color:#ff79c6">).</span>show<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>    spark<span style="color:#ff79c6">.</span>sql<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;SELECT * FROM person\n    LATERAL VIEW OUTER EXPLODE(ARRAY()) tableName AS c_age;&#34;</span><span style="color:#ff79c6">).</span>show<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>第一个 sql 生成的物理计划:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">==</span> Physical Plan <span style="color:#ff79c6">==</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">*</span>(<span style="color:#bd93f9">1</span>) Generate explode([<span style="color:#bd93f9">40</span>,<span style="color:#bd93f9">80</span>]), [address<span style="color:#ff79c6">#</span><span style="color:#bd93f9">6</span>, age<span style="color:#ff79c6">#</span><span style="color:#bd93f9">7</span>L, <span style="color:#ff79c6">class</span><span style="color:#ff79c6">#</span><span style="color:#bd93f9">8</span>L, id<span style="color:#ff79c6">#</span><span style="color:#bd93f9">9</span>L, name<span style="color:#ff79c6">#</span><span style="color:#bd93f9">10</span>, c_age<span style="color:#ff79c6">#</span><span style="color:#bd93f9">16</span>], <span style="color:#ff79c6">false</span>, [d_age<span style="color:#ff79c6">#</span><span style="color:#bd93f9">17</span>]
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+-</span> <span style="color:#ff79c6">*</span>(<span style="color:#bd93f9">1</span>) Generate explode([<span style="color:#bd93f9">30</span>,<span style="color:#bd93f9">60</span>]), [address<span style="color:#ff79c6">#</span><span style="color:#bd93f9">6</span>, age<span style="color:#ff79c6">#</span><span style="color:#bd93f9">7</span>L, <span style="color:#ff79c6">class</span><span style="color:#ff79c6">#</span><span style="color:#bd93f9">8</span>L, id<span style="color:#ff79c6">#</span><span style="color:#bd93f9">9</span>L, name<span style="color:#ff79c6">#</span><span style="color:#bd93f9">10</span>], <span style="color:#ff79c6">false</span>, [c_age<span style="color:#ff79c6">#</span><span style="color:#bd93f9">16</span>]
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">+-</span> <span style="color:#ff79c6">*</span>(<span style="color:#bd93f9">1</span>) Scan ExistingRDD[address<span style="color:#ff79c6">#</span><span style="color:#bd93f9">6</span>,age<span style="color:#ff79c6">#</span><span style="color:#bd93f9">7</span>L,<span style="color:#ff79c6">class</span><span style="color:#ff79c6">#</span><span style="color:#bd93f9">8</span>L,id<span style="color:#ff79c6">#</span><span style="color:#bd93f9">9</span>L,name<span style="color:#ff79c6">#</span><span style="color:#bd93f9">10</span>]
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行结果：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>+--------+----+-----+---+----+-----+-----+
</span></span><span style="display:flex;"><span>| address| age|class| id|name|c_age|d_age|
</span></span><span style="display:flex;"><span>+--------+----+-----+---+----+-----+-----+
</span></span><span style="display:flex;"><span>|Street 1|  30|    1|100|John|   30|   40|
</span></span><span style="display:flex;"><span>|Street 1|  30|    1|100|John|   30|   80|
</span></span><span style="display:flex;"><span>|Street 1|  30|    1|100|John|   60|   40|
</span></span><span style="display:flex;"><span>|Street 1|  30|    1|100|John|   60|   80|
</span></span><span style="display:flex;"><span>|Street 2|NULL|    1|200|Mary|   30|   40|
</span></span><span style="display:flex;"><span>|Street 2|NULL|    1|200|Mary|   30|   80|
</span></span><span style="display:flex;"><span>|Street 2|NULL|    1|200|Mary|   60|   40|
</span></span><span style="display:flex;"><span>|Street 2|NULL|    1|200|Mary|   60|   80|
</span></span><span style="display:flex;"><span>|Street 3|  80|    3|300|Mike|   30|   40|
</span></span><span style="display:flex;"><span>|Street 3|  80|    3|300|Mike|   30|   80|
</span></span><span style="display:flex;"><span>|Street 3|  80|    3|300|Mike|   60|   40|
</span></span><span style="display:flex;"><span>|Street 3|  80|    3|300|Mike|   60|   80|
</span></span><span style="display:flex;"><span>|Street 4|  50|    4|400| Dan|   30|   40|
</span></span><span style="display:flex;"><span>|Street 4|  50|    4|400| Dan|   30|   80|
</span></span><span style="display:flex;"><span>|Street 4|  50|    4|400| Dan|   60|   40|
</span></span><span style="display:flex;"><span>|Street 4|  50|    4|400| Dan|   60|   80|
</span></span><span style="display:flex;"><span>+--------+----+-----+---+----+-----+-----+
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>+-----+--------+
</span></span><span style="display:flex;"><span>|c_age|count<span style="color:#ff79c6">(</span>1<span style="color:#ff79c6">)</span>|
</span></span><span style="display:flex;"><span>+-----+--------+
</span></span><span style="display:flex;"><span>|   30|       8|
</span></span><span style="display:flex;"><span>|   60|       8|
</span></span><span style="display:flex;"><span>+-----+--------+
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>+-------+---+-----+---+----+-----+
</span></span><span style="display:flex;"><span>|address|age|class| id|name|c_age|
</span></span><span style="display:flex;"><span>+-------+---+-----+---+----+-----+
</span></span><span style="display:flex;"><span>+-------+---+-----+---+----+-----+
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>+--------+----+-----+---+----+-----+
</span></span><span style="display:flex;"><span>| address| age|class| id|name|c_age|
</span></span><span style="display:flex;"><span>+--------+----+-----+---+----+-----+
</span></span><span style="display:flex;"><span>|Street 1|  30|    1|100|John| NULL|
</span></span><span style="display:flex;"><span>|Street 2|NULL|    1|200|Mary| NULL|
</span></span><span style="display:flex;"><span>|Street 3|  80|    3|300|Mike| NULL|
</span></span><span style="display:flex;"><span>|Street 4|  50|    4|400| Dan| NULL|
</span></span><span style="display:flex;"><span>+--------+----+-----+---+----+-----+
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="pivot">pivot</h2>
<p>一个简单的例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>  test<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;pivot test 1&#34;</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> jsonData <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">Seq</span><span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;d&#34;: &#34;2024-04-28&#34;, &#34;c&#34;: 20}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;d&#34;: &#34;2024-03-01&#34;, &#34;c&#34;: 14}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;d&#34;: &#34;2024-05-01&#34;, &#34;c&#34;: 24}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;d&#34;: &#34;2024-05-02&#34;, &#34;c&#34;: 25}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;d&#34;: &#34;2024-05-03&#34;, &#34;c&#34;: 26}&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> df <span style="color:#ff79c6">=</span> spark<span style="color:#ff79c6">.</span>read<span style="color:#ff79c6">.</span>json<span style="color:#ff79c6">(</span>spark<span style="color:#ff79c6">.</span>sparkContext<span style="color:#ff79c6">.</span>parallelize<span style="color:#ff79c6">(</span>jsonData<span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>    df<span style="color:#ff79c6">.</span>createTempView<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;temperature&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> sql <span style="color:#ff79c6">=</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |SELECT * FROM (
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |  SELECT year(d) AS year, month(d) month, c
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |  FROM temperature
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |)
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |PIVOT (
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |  cast(avg(c) AS decimal(4, 1))
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |  FOR month IN (
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |    1 JAN, 2 FEB, 3 MAR, 4 APR, 5 MAY, 6 JUN
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |  )
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |)
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |&#34;&#34;&#34;</span><span style="color:#ff79c6">.</span>stripMargin
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> df2 <span style="color:#ff79c6">=</span> spark<span style="color:#ff79c6">.</span>sql<span style="color:#ff79c6">(</span>sql<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    df2<span style="color:#ff79c6">.</span>show<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>    df2<span style="color:#ff79c6">.</span>explain<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;extended&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>结果：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff79c6">+----+----+----+----+----+----+----+</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>year<span style="color:#ff79c6">|</span> <span style="color:#50fa7b">JAN</span><span style="color:#ff79c6">|</span> <span style="color:#50fa7b">FEB</span><span style="color:#ff79c6">|</span> <span style="color:#50fa7b">MAR</span><span style="color:#ff79c6">|</span> <span style="color:#50fa7b">APR</span><span style="color:#ff79c6">|</span> <span style="color:#50fa7b">MAY</span><span style="color:#ff79c6">|</span> <span style="color:#50fa7b">JUN</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+----+----+----+----+----+----+----+</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2024</span><span style="color:#ff79c6">|</span><span style="color:#50fa7b">NULL</span><span style="color:#ff79c6">|</span><span style="color:#50fa7b">NULL</span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">14.0</span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">20.0</span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">25.0</span><span style="color:#ff79c6">|</span><span style="color:#50fa7b">NULL</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+----+----+----+----+----+----+----+</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>参考<a href="http://spark.coolplayer.net/?p=3419">这里</a></p>
<hr>
<p>两个聚合函数的测试代码</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>test<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;test pivot&#34;</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> jsonData <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">Seq</span><span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;id&#34;: 100, &#34;name&#34;: &#34;John&#34;, &#34;age&#34;: 30, &#34;class&#34;: 1, &#34;address&#34;: &#34;Street 1&#34;}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;id&#34;: 200, &#34;name&#34;: &#34;Mary&#34;, &#34;age&#34;: null, &#34;class&#34;: 1, &#34;address&#34;: &#34;Street 2&#34;}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;id&#34;: 300, &#34;name&#34;: &#34;Mike&#34;, &#34;age&#34;: 80, &#34;class&#34;: 3, &#34;address&#34;: &#34;Street 3&#34;}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;id&#34;: 400, &#34;name&#34;: &#34;Dan&#34;, &#34;age&#34;: 50, &#34;class&#34;: 4, &#34;address&#34;: &#34;Street 4&#34;}&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> df<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">DataFrame</span> <span style="color:#ff79c6">=</span> spark<span style="color:#ff79c6">.</span>read<span style="color:#ff79c6">.</span>json<span style="color:#ff79c6">(</span>spark<span style="color:#ff79c6">.</span>sparkContext<span style="color:#ff79c6">.</span>parallelize<span style="color:#ff79c6">(</span>jsonData<span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>    df<span style="color:#ff79c6">.</span>createTempView<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;person&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> sql <span style="color:#ff79c6">=</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |SELECT * FROM person
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |    PIVOT (
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |        SUM(age) AS a, AVG(class) AS c
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |        FOR name IN (&#39;John&#39; AS john, &#39;Mike&#39; AS mike)
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |    )
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |&#34;&#34;&#34;</span><span style="color:#ff79c6">.</span>stripMargin
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> df2 <span style="color:#ff79c6">=</span> spark<span style="color:#ff79c6">.</span>sql<span style="color:#ff79c6">(</span>sql<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    df2<span style="color:#ff79c6">.</span>show<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>    df2<span style="color:#ff79c6">.</span>explain<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;extended&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>结果：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>+--------+---+------+------+------+------+
</span></span><span style="display:flex;"><span>| address| id|john_a|john_c|mike_a|mike_c|
</span></span><span style="display:flex;"><span>+--------+---+------+------+------+------+
</span></span><span style="display:flex;"><span>|Street 1|100|    30|   1.0|  NULL|  NULL|
</span></span><span style="display:flex;"><span>|Street 2|200|  NULL|  NULL|  NULL|  NULL|
</span></span><span style="display:flex;"><span>|Street 3|300|  NULL|  NULL|    80|   3.0|
</span></span><span style="display:flex;"><span>|Street 4|400|  NULL|  NULL|  NULL|  NULL|
</span></span><span style="display:flex;"><span>+--------+---+------+------+------+------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>物理计划：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff79c6">==</span> <span style="color:#50fa7b">Physical</span> <span style="color:#50fa7b">Plan</span> <span style="color:#ff79c6">==</span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">AdaptiveSparkPlan</span> isFinalPlan<span style="color:#ff79c6">=</span><span style="color:#ff79c6">false</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+-</span> <span style="color:#50fa7b">Project</span> <span style="color:#ff79c6">[</span><span style="color:#8be9fd">address</span><span style="color:#ff79c6">#</span>6, <span style="color:#8be9fd">id</span><span style="color:#ff79c6">#</span>9<span style="color:#8be9fd">L</span>, <span style="color:#ff79c6">__</span><span style="color:#8be9fd">pivot_sum</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">person.age</span><span style="color:#ff79c6">)</span> <span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">a</span> <span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">`sum(person.age) 
</span></span></span><span style="display:flex;"><span><span style="color:#8be9fd">    AS a`</span><span style="color:#ff79c6">#</span>29<span style="color:#ff79c6">[</span>0<span style="color:#ff79c6">]</span> <span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">john_a</span><span style="color:#ff79c6">#</span>36<span style="color:#8be9fd">L</span>, <span style="color:#ff79c6">__</span><span style="color:#8be9fd">pivot_avg</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">person.class</span><span style="color:#ff79c6">)</span> <span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">c</span> <span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">`avg(person.class) AS c`</span><span style="color:#ff79c6">#</span>35<span style="color:#ff79c6">[</span>0<span style="color:#ff79c6">]</span> <span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">john_c</span><span style="color:#ff79c6">#</span>37,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">__</span><span style="color:#8be9fd">pivot_sum</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">person.age</span><span style="color:#ff79c6">)</span> <span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">a</span> <span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">`sum(person.age) AS a`</span><span style="color:#ff79c6">#</span>29<span style="color:#ff79c6">[</span>1<span style="color:#ff79c6">]</span> <span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">mike_a</span><span style="color:#ff79c6">#</span>38<span style="color:#8be9fd">L</span>, <span style="color:#ff79c6">__</span><span style="color:#8be9fd">pivot_avg</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">person.class</span><span style="color:#ff79c6">)</span> 
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">c</span> <span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">`avg(person.class) AS c`</span><span style="color:#ff79c6">#</span>35<span style="color:#ff79c6">[</span>1<span style="color:#ff79c6">]</span> <span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">mike_c</span><span style="color:#ff79c6">#</span>39<span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">+-</span> <span style="color:#50fa7b">HashAggregate</span><span style="color:#ff79c6">(</span>keys<span style="color:#ff79c6">=[</span><span style="color:#8be9fd">address</span><span style="color:#ff79c6">#</span>6, <span style="color:#8be9fd">id</span><span style="color:#ff79c6">#</span>9<span style="color:#8be9fd">L</span><span style="color:#ff79c6">],</span> functions<span style="color:#ff79c6">=[</span><span style="color:#8be9fd">pivotfirst</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">name</span><span style="color:#ff79c6">#</span>10, <span style="color:#8be9fd">sum</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">person.age</span><span style="color:#ff79c6">)</span> <span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">a</span><span style="color:#ff79c6">#</span>22<span style="color:#8be9fd">L</span>, 
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd">John</span>, <span style="color:#8be9fd">Mike</span>, 0, 0<span style="color:#ff79c6">)</span>, <span style="color:#8be9fd">pivotfirst</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">name</span><span style="color:#ff79c6">#</span>10, <span style="color:#8be9fd">avg</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">person.class</span><span style="color:#ff79c6">)</span> <span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">c</span><span style="color:#ff79c6">#</span>23, <span style="color:#8be9fd">John</span>, <span style="color:#8be9fd">Mike</span>, 0, 0<span style="color:#ff79c6">)],</span> output<span style="color:#ff79c6">=[</span><span style="color:#8be9fd">address</span><span style="color:#ff79c6">#</span>6, <span style="color:#8be9fd">id</span><span style="color:#ff79c6">#</span>9<span style="color:#8be9fd">L</span>, 
</span></span><span style="display:flex;"><span>	  <span style="color:#ff79c6">__</span><span style="color:#8be9fd">pivot_sum</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">person.age</span><span style="color:#ff79c6">)</span> <span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">a</span> <span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">`sum(person.age) AS a`</span><span style="color:#ff79c6">#</span>29, <span style="color:#ff79c6">__</span><span style="color:#8be9fd">pivot_avg</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">person.class</span><span style="color:#ff79c6">)</span> <span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">c</span> <span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">`avg(person.class) AS c`</span><span style="color:#ff79c6">#</span>35<span style="color:#ff79c6">])</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">+-</span> <span style="color:#50fa7b">Exchange</span> hashpartitioning<span style="color:#ff79c6">(</span>address<span style="color:#ff79c6">#</span><span style="color:#bd93f9">6</span><span style="color:#ff79c6">,</span> id<span style="color:#ff79c6">#</span><span style="color:#bd93f9">9L</span><span style="color:#ff79c6">,</span> <span style="color:#bd93f9">1</span><span style="color:#ff79c6">),</span> <span style="color:#50fa7b">ENSURE_REQUIREMENTS</span><span style="color:#ff79c6">,</span> <span style="color:#ff79c6">[</span><span style="color:#8be9fd">plan_id=</span>139<span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>         <span style="color:#ff79c6">+-</span> <span style="color:#50fa7b">HashAggregate</span><span style="color:#ff79c6">(</span>keys<span style="color:#ff79c6">=[</span><span style="color:#8be9fd">address</span><span style="color:#ff79c6">#</span>6, <span style="color:#8be9fd">id</span><span style="color:#ff79c6">#</span>9<span style="color:#8be9fd">L</span><span style="color:#ff79c6">],</span> functions<span style="color:#ff79c6">=[</span><span style="color:#8be9fd">partial_pivotfirst</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">name</span><span style="color:#ff79c6">#</span>10, <span style="color:#8be9fd">sum</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">person.age</span><span style="color:#ff79c6">)</span> 
</span></span><span style="display:flex;"><span>		    <span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">a</span><span style="color:#ff79c6">#</span>22<span style="color:#8be9fd">L</span>, <span style="color:#8be9fd">John</span>, <span style="color:#8be9fd">Mike</span>, 0, 0<span style="color:#ff79c6">)</span>, <span style="color:#8be9fd">partial_pivotfirst</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">name</span><span style="color:#ff79c6">#</span>10, <span style="color:#8be9fd">avg</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">person.class</span><span style="color:#ff79c6">)</span> <span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">c</span><span style="color:#ff79c6">#</span>23, <span style="color:#8be9fd">John</span>, <span style="color:#8be9fd">Mike</span>, 0, 0<span style="color:#ff79c6">)],</span> 
</span></span><span style="display:flex;"><span>			output<span style="color:#ff79c6">=[</span><span style="color:#8be9fd">address</span><span style="color:#ff79c6">#</span>6, <span style="color:#8be9fd">id</span><span style="color:#ff79c6">#</span>9<span style="color:#8be9fd">L</span>, <span style="color:#8be9fd">John</span><span style="color:#ff79c6">#</span>26<span style="color:#8be9fd">L</span>, <span style="color:#8be9fd">Mike</span><span style="color:#ff79c6">#</span>27<span style="color:#8be9fd">L</span>, <span style="color:#8be9fd">John</span><span style="color:#ff79c6">#</span>32, <span style="color:#8be9fd">Mike</span><span style="color:#ff79c6">#</span>33<span style="color:#ff79c6">])</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">+-</span> <span style="color:#50fa7b">HashAggregate</span><span style="color:#ff79c6">(</span>keys<span style="color:#ff79c6">=[</span><span style="color:#8be9fd">address</span><span style="color:#ff79c6">#</span>6, <span style="color:#8be9fd">id</span><span style="color:#ff79c6">#</span>9<span style="color:#8be9fd">L</span>, <span style="color:#8be9fd">name</span><span style="color:#ff79c6">#</span>10<span style="color:#ff79c6">],</span> functions<span style="color:#ff79c6">=[</span><span style="color:#8be9fd">sum</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">age</span><span style="color:#ff79c6">#</span>7<span style="color:#8be9fd">L</span><span style="color:#ff79c6">)</span>, <span style="color:#8be9fd">avg</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">class</span><span style="color:#ff79c6">#</span>8<span style="color:#8be9fd">L</span><span style="color:#ff79c6">)],</span> 
</span></span><span style="display:flex;"><span>			   output<span style="color:#ff79c6">=[</span><span style="color:#8be9fd">address</span><span style="color:#ff79c6">#</span>6, <span style="color:#8be9fd">id</span><span style="color:#ff79c6">#</span>9<span style="color:#8be9fd">L</span>, <span style="color:#8be9fd">name</span><span style="color:#ff79c6">#</span>10, <span style="color:#8be9fd">sum</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">person.age</span><span style="color:#ff79c6">)</span> <span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">a</span><span style="color:#ff79c6">#</span>22<span style="color:#8be9fd">L</span>, <span style="color:#8be9fd">avg</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">person.class</span><span style="color:#ff79c6">)</span> <span style="color:#8be9fd">AS</span> <span style="color:#8be9fd">c</span><span style="color:#ff79c6">#</span>23<span style="color:#ff79c6">])</span>
</span></span><span style="display:flex;"><span>               <span style="color:#ff79c6">+-</span> <span style="color:#50fa7b">Exchange</span> hashpartitioning<span style="color:#ff79c6">(</span>address<span style="color:#ff79c6">#</span><span style="color:#bd93f9">6</span><span style="color:#ff79c6">,</span> id<span style="color:#ff79c6">#</span><span style="color:#bd93f9">9L</span><span style="color:#ff79c6">,</span> name<span style="color:#ff79c6">#</span><span style="color:#bd93f9">10</span><span style="color:#ff79c6">,</span> <span style="color:#bd93f9">1</span><span style="color:#ff79c6">),</span> <span style="color:#50fa7b">ENSURE_REQUIREMENTS</span><span style="color:#ff79c6">,</span> <span style="color:#ff79c6">[</span><span style="color:#8be9fd">plan_id=</span>135<span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#ff79c6">+-</span> <span style="color:#50fa7b">HashAggregate</span><span style="color:#ff79c6">(</span>keys<span style="color:#ff79c6">=[</span><span style="color:#8be9fd">address</span><span style="color:#ff79c6">#</span>6, <span style="color:#8be9fd">id</span><span style="color:#ff79c6">#</span>9<span style="color:#8be9fd">L</span>, <span style="color:#8be9fd">name</span><span style="color:#ff79c6">#</span>10<span style="color:#ff79c6">],</span> functions<span style="color:#ff79c6">=[</span><span style="color:#8be9fd">partial_sum</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">age</span><span style="color:#ff79c6">#</span>7<span style="color:#8be9fd">L</span><span style="color:#ff79c6">)</span>, <span style="color:#8be9fd">partial_avg</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">class</span><span style="color:#ff79c6">#</span>8<span style="color:#8be9fd">L</span><span style="color:#ff79c6">)],</span> 
</span></span><span style="display:flex;"><span>				     output<span style="color:#ff79c6">=[</span><span style="color:#8be9fd">address</span><span style="color:#ff79c6">#</span>6, <span style="color:#8be9fd">id</span><span style="color:#ff79c6">#</span>9<span style="color:#8be9fd">L</span>, <span style="color:#8be9fd">name</span><span style="color:#ff79c6">#</span>10, <span style="color:#8be9fd">sum</span><span style="color:#ff79c6">#</span>75<span style="color:#8be9fd">L</span>, <span style="color:#8be9fd">sum</span><span style="color:#ff79c6">#</span>76, <span style="color:#8be9fd">count</span><span style="color:#ff79c6">#</span>77<span style="color:#8be9fd">L</span><span style="color:#ff79c6">])</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#ff79c6">+-</span> <span style="color:#50fa7b">Scan</span> <span style="color:#50fa7b">ExistingRDD</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">address</span><span style="color:#ff79c6">#</span>6,<span style="color:#8be9fd">age</span><span style="color:#ff79c6">#</span>7<span style="color:#8be9fd">L</span>,<span style="color:#8be9fd">class</span><span style="color:#ff79c6">#</span>8<span style="color:#8be9fd">L</span>,<span style="color:#8be9fd">id</span><span style="color:#ff79c6">#</span>9<span style="color:#8be9fd">L</span>,<span style="color:#8be9fd">name</span><span style="color:#ff79c6">#</span>10<span style="color:#ff79c6">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="unpivot">unpivot</h2>
<p>测试代码</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>  test<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;unpivot test&#34;</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> jsonData <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">Seq</span><span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;year&#34;: 2020, &#34;q1&#34;: null, &#34;q2&#34;: 1000, &#34;q3&#34;: 2000, &#34;q4&#34;: 2500}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;year&#34;: 2021, &#34;q1&#34;: 2250, &#34;q2&#34;: 3200, &#34;q3&#34;: 4200, &#34;q4&#34;: 5900}&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;{&#34;year&#34;: 2022, &#34;q1&#34;: 4200, &#34;q2&#34;: 3100, &#34;q3&#34;: null, &#34;q4&#34;: null}&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> df <span style="color:#ff79c6">=</span> spark<span style="color:#ff79c6">.</span>read<span style="color:#ff79c6">.</span>json<span style="color:#ff79c6">(</span>spark<span style="color:#ff79c6">.</span>sparkContext<span style="color:#ff79c6">.</span>parallelize<span style="color:#ff79c6">(</span>jsonData<span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>    df<span style="color:#ff79c6">.</span>createTempView<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;sales_quarterly  &#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> df2 <span style="color:#ff79c6">=</span> spark<span style="color:#ff79c6">.</span>sql<span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |SELECT * FROM sales_quarterly
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |    UNPIVOT (
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |        sales FOR quarter IN (q1, q2, q3, q4)
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |    );
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |&#34;&#34;&#34;</span><span style="color:#ff79c6">.</span>stripMargin<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    df2<span style="color:#ff79c6">.</span>explain<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;extended&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    println<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;=====================&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    df2<span style="color:#ff79c6">.</span>show<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>    spark<span style="color:#ff79c6">.</span>sql<span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |SELECT up.* FROM sales_quarterly
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |    UNPIVOT INCLUDE NULLS (
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |        sales FOR quarter IN (q1 AS Q1, q2 AS Q2, q3 AS Q3, q4 AS Q4)
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |    ) AS up;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |&#34;&#34;&#34;</span><span style="color:#ff79c6">.</span>stripMargin<span style="color:#ff79c6">).</span>show<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>    spark<span style="color:#ff79c6">.</span>sql<span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |SELECT * FROM sales_quarterly
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |    UNPIVOT EXCLUDE NULLS (
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |        (first_quarter, second_quarter)
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |        FOR half_of_the_year IN (
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |            (q1, q2) AS H1,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |            (q3, q4) AS H2
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |        )
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |    );
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |&#34;&#34;&#34;</span><span style="color:#ff79c6">.</span>stripMargin<span style="color:#ff79c6">).</span>show<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>第一个的物理计划</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">*</span>(<span style="color:#bd93f9">1</span>) Filter isnotnull(sales<span style="color:#ff79c6">#</span><span style="color:#bd93f9">17</span>L)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+-</span> <span style="color:#ff79c6">*</span>(<span style="color:#bd93f9">1</span>) Expand [[<span style="color:#ff79c6">year</span><span style="color:#ff79c6">#</span><span style="color:#bd93f9">10</span>L, q1, q1<span style="color:#ff79c6">#</span><span style="color:#bd93f9">6</span>L], [<span style="color:#ff79c6">year</span><span style="color:#ff79c6">#</span><span style="color:#bd93f9">10</span>L, q2, q2<span style="color:#ff79c6">#</span><span style="color:#bd93f9">7</span>L], [<span style="color:#ff79c6">year</span><span style="color:#ff79c6">#</span><span style="color:#bd93f9">10</span>L, q3, q3<span style="color:#ff79c6">#</span><span style="color:#bd93f9">8</span>L], [<span style="color:#ff79c6">year</span><span style="color:#ff79c6">#</span><span style="color:#bd93f9">10</span>L, q4, q4<span style="color:#ff79c6">#</span><span style="color:#bd93f9">9</span>L]], [<span style="color:#ff79c6">year</span><span style="color:#ff79c6">#</span><span style="color:#bd93f9">10</span>L, quarter<span style="color:#ff79c6">#</span><span style="color:#bd93f9">16</span>, sales<span style="color:#ff79c6">#</span><span style="color:#bd93f9">17</span>L]
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">+-</span> <span style="color:#ff79c6">*</span>(<span style="color:#bd93f9">1</span>) Scan ExistingRDD[q1<span style="color:#ff79c6">#</span><span style="color:#bd93f9">6</span>L,q2<span style="color:#ff79c6">#</span><span style="color:#bd93f9">7</span>L,q3<span style="color:#ff79c6">#</span><span style="color:#bd93f9">8</span>L,q4<span style="color:#ff79c6">#</span><span style="color:#bd93f9">9</span>L,<span style="color:#ff79c6">year</span><span style="color:#ff79c6">#</span><span style="color:#bd93f9">10</span>L]
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行结果：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----+-------+-----+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span><span style="color:#ff79c6">year</span><span style="color:#ff79c6">|</span>quarter<span style="color:#ff79c6">|</span>sales<span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----+-------+-----+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2020</span><span style="color:#ff79c6">|</span>     q2<span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1000</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2020</span><span style="color:#ff79c6">|</span>     q3<span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2000</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2020</span><span style="color:#ff79c6">|</span>     q4<span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2500</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2021</span><span style="color:#ff79c6">|</span>     q1<span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2250</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2021</span><span style="color:#ff79c6">|</span>     q2<span style="color:#ff79c6">|</span> <span style="color:#bd93f9">3200</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2021</span><span style="color:#ff79c6">|</span>     q3<span style="color:#ff79c6">|</span> <span style="color:#bd93f9">4200</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2021</span><span style="color:#ff79c6">|</span>     q4<span style="color:#ff79c6">|</span> <span style="color:#bd93f9">5900</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2022</span><span style="color:#ff79c6">|</span>     q1<span style="color:#ff79c6">|</span> <span style="color:#bd93f9">4200</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2022</span><span style="color:#ff79c6">|</span>     q2<span style="color:#ff79c6">|</span> <span style="color:#bd93f9">3100</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----+-------+-----+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----+-------+-----+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span><span style="color:#ff79c6">year</span><span style="color:#ff79c6">|</span>quarter<span style="color:#ff79c6">|</span>sales<span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----+-------+-----+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2020</span><span style="color:#ff79c6">|</span>     Q1<span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2020</span><span style="color:#ff79c6">|</span>     Q2<span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1000</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2020</span><span style="color:#ff79c6">|</span>     Q3<span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2000</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2020</span><span style="color:#ff79c6">|</span>     Q4<span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2500</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2021</span><span style="color:#ff79c6">|</span>     Q1<span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2250</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2021</span><span style="color:#ff79c6">|</span>     Q2<span style="color:#ff79c6">|</span> <span style="color:#bd93f9">3200</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2021</span><span style="color:#ff79c6">|</span>     Q3<span style="color:#ff79c6">|</span> <span style="color:#bd93f9">4200</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2021</span><span style="color:#ff79c6">|</span>     Q4<span style="color:#ff79c6">|</span> <span style="color:#bd93f9">5900</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2022</span><span style="color:#ff79c6">|</span>     Q1<span style="color:#ff79c6">|</span> <span style="color:#bd93f9">4200</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2022</span><span style="color:#ff79c6">|</span>     Q2<span style="color:#ff79c6">|</span> <span style="color:#bd93f9">3100</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2022</span><span style="color:#ff79c6">|</span>     Q3<span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2022</span><span style="color:#ff79c6">|</span>     Q4<span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----+-------+-----+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----+----------------+-------------+--------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span><span style="color:#ff79c6">year</span><span style="color:#ff79c6">|</span>half_of_the_year<span style="color:#ff79c6">|</span>first_quarter<span style="color:#ff79c6">|</span>second_quarter<span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----+----------------+-------------+--------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2020</span><span style="color:#ff79c6">|</span>              H1<span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">NULL</span><span style="color:#ff79c6">|</span>          <span style="color:#bd93f9">1000</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2020</span><span style="color:#ff79c6">|</span>              H2<span style="color:#ff79c6">|</span>         <span style="color:#bd93f9">2000</span><span style="color:#ff79c6">|</span>          <span style="color:#bd93f9">2500</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2021</span><span style="color:#ff79c6">|</span>              H1<span style="color:#ff79c6">|</span>         <span style="color:#bd93f9">2250</span><span style="color:#ff79c6">|</span>          <span style="color:#bd93f9">3200</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2021</span><span style="color:#ff79c6">|</span>              H2<span style="color:#ff79c6">|</span>         <span style="color:#bd93f9">4200</span><span style="color:#ff79c6">|</span>          <span style="color:#bd93f9">5900</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2022</span><span style="color:#ff79c6">|</span>              H1<span style="color:#ff79c6">|</span>         <span style="color:#bd93f9">4200</span><span style="color:#ff79c6">|</span>          <span style="color:#bd93f9">3100</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----+----------------+-------------+--------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="with-cube-代码生成">with cube 代码生成</h2>
<p>代码生成</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">208
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">209
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">210
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">211
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">212
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">213
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">214
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">215
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">216
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">217
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">218
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">219
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">220
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">221
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">222
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">223
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">224
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">225
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">226
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">227
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">228
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">229
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">230
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">231
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">232
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">233
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">234
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">235
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">236
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">237
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">238
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">239
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">240
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">241
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">242
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">243
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">244
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">245
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">246
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">247
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">248
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">249
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">250
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">251
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">252
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">253
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">254
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">255
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">256
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">257
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">258
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">259
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">260
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">261
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">262
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">263
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">264
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">265
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">266
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">267
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">268
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">269
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">270
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">271
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">272
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">273
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">274
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">275
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">276
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">277
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">278
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">279
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">280
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">281
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">282
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">283
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">284
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">285
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">286
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">287
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">288
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">289
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">290
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">291
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">292
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">293
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">294
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">295
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">296
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">297
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">298
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">299
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">300
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">301
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">302
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">303
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">304
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">305
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">306
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">307
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">308
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">309
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">310
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">311
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">312
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">313
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">314
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">315
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">316
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">317
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">318
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">319
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">320
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">321
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">322
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">323
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">324
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">325
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">326
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">327
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">328
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">329
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">330
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">331
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">332
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">333
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">334
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">335
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">336
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">337
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">338
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">339
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">340
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">341
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">342
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">343
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">344
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">345
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">346
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">347
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">348
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">349
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">350
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">351
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">352
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">353
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">354
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">355
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">356
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">357
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">358
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">359
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">360
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">361
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">362
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">363
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">364
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">365
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">366
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">367
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">368
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">369
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">370
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">371
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">372
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">373
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">374
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">375
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">376
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">377
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">378
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">379
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">380
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">381
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">382
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">383
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">384
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">385
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">386
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">387
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">388
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">389
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">390
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">391
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">392
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">393
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">394
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">395
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">396
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">397
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">398
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">399
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">400
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">401
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">402
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">403
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">404
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">405
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">406
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">407
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">408
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">409
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">410
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">411
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">412
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">413
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">414
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">415
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">416
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">417
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">418
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">419
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6272a4">/* 001 */</span> <span style="color:#8be9fd;font-style:italic">public</span> Object <span style="color:#50fa7b">generate</span><span style="color:#ff79c6">(</span>Object<span style="color:#ff79c6">[]</span> references<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 002 */</span>   <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">new</span> GeneratedIteratorForCodegenStage1<span style="color:#ff79c6">(</span>references<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 003 */</span> <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 004 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 005 */</span> <span style="color:#6272a4">// codegenStageId=1
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#6272a4">/* 006 */</span> <span style="color:#8be9fd;font-style:italic">final</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">GeneratedIteratorForCodegenStage1</span> <span style="color:#8be9fd;font-style:italic">extends</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execution</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">BufferedRowIterator</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 007 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> Object<span style="color:#ff79c6">[]</span> references<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 008 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> scala<span style="color:#ff79c6">.</span><span style="color:#50fa7b">collection</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Iterator</span><span style="color:#ff79c6">[]</span> inputs<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 009 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">boolean</span> hashAgg_initAgg_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 010 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">boolean</span> hashAgg_bufIsNull_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 011 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">long</span> hashAgg_bufValue_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 012 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> hashAgg_FastHashMap_0 hashAgg_fastHashMap_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 013 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">unsafe</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">KVIterator</span><span style="color:#ff79c6">&lt;</span>UnsafeRow<span style="color:#ff79c6">,</span> UnsafeRow<span style="color:#ff79c6">&gt;</span> hashAgg_fastHashMapIter_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 014 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">unsafe</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">KVIterator</span> hashAgg_mapIter_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 015 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execution</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">UnsafeFixedWidthAggregationMap</span> hashAgg_hashMap_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 016 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execution</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">UnsafeKVExternalSorter</span> hashAgg_sorter_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 017 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> scala<span style="color:#ff79c6">.</span><span style="color:#50fa7b">collection</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Iterator</span> rdd_input_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 018 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">boolean</span> expand_resultIsNull_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 019 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">long</span> expand_resultValue_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 020 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">boolean</span> expand_resultIsNull_1<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 021 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">long</span> expand_resultValue_1<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 022 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">boolean</span> expand_resultIsNull_2<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 023 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">long</span> expand_resultValue_2<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 024 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">boolean</span> hashAgg_hashAgg_isNull_11_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 025 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalyst</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">expressions</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">codegen</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">UnsafeRowWriter</span><span style="color:#ff79c6">[]</span> rdd_mutableStateArray_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalyst</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">expressions</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">codegen</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">UnsafeRowWriter</span><span style="color:#ff79c6">[</span>7<span style="color:#ff79c6">];</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 026 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 027 */</span>   <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#50fa7b">GeneratedIteratorForCodegenStage1</span><span style="color:#ff79c6">(</span>Object<span style="color:#ff79c6">[]</span> references<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 028 */</span>     <span style="color:#ff79c6">this</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">references</span> <span style="color:#ff79c6">=</span> references<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 029 */</span>   <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 030 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 031 */</span>   <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">init</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span> index<span style="color:#ff79c6">,</span> scala<span style="color:#ff79c6">.</span><span style="color:#50fa7b">collection</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Iterator</span><span style="color:#ff79c6">[]</span> inputs<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 032 */</span>     partitionIndex <span style="color:#ff79c6">=</span> index<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 033 */</span>     <span style="color:#ff79c6">this</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">inputs</span> <span style="color:#ff79c6">=</span> inputs<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 034 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 035 */</span>     rdd_input_0 <span style="color:#ff79c6">=</span> inputs<span style="color:#ff79c6">[</span>0<span style="color:#ff79c6">];</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 036 */</span>     rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>0<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalyst</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">expressions</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">codegen</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">UnsafeRowWriter</span><span style="color:#ff79c6">(</span>4<span style="color:#ff79c6">,</span> 32<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 037 */</span>     rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>1<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalyst</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">expressions</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">codegen</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">UnsafeRowWriter</span><span style="color:#ff79c6">(</span>3<span style="color:#ff79c6">,</span> 0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 038 */</span>     rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>2<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalyst</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">expressions</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">codegen</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">UnsafeRowWriter</span><span style="color:#ff79c6">(</span>3<span style="color:#ff79c6">,</span> 0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 039 */</span>     expand_resultIsNull_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 040 */</span>     expand_resultValue_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">-</span>1L<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 041 */</span>     expand_resultIsNull_1 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 042 */</span>     expand_resultValue_1 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">-</span>1L<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 043 */</span>     expand_resultIsNull_2 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 044 */</span>     expand_resultValue_2 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">-</span>1L<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 045 */</span>     rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>3<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalyst</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">expressions</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">codegen</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">UnsafeRowWriter</span><span style="color:#ff79c6">(</span>4<span style="color:#ff79c6">,</span> 0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 046 */</span>     rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>4<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalyst</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">expressions</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">codegen</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">UnsafeRowWriter</span><span style="color:#ff79c6">(</span>4<span style="color:#ff79c6">,</span> 0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 047 */</span>     rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>5<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalyst</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">expressions</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">codegen</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">UnsafeRowWriter</span><span style="color:#ff79c6">(</span>3<span style="color:#ff79c6">,</span> 0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 048 */</span>     rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>6<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalyst</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">expressions</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">codegen</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">UnsafeRowWriter</span><span style="color:#ff79c6">(</span>4<span style="color:#ff79c6">,</span> 0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 049 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 050 */</span>   <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 051 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 052 */</span>   <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">hashAgg_FastHashMap_0</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 053 */</span>     <span style="color:#8be9fd;font-style:italic">private</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalyst</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">expressions</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">RowBasedKeyValueBatch</span> batch<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 054 */</span>     <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">int</span><span style="color:#ff79c6">[]</span> buckets<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 055 */</span>     <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">int</span> capacity <span style="color:#ff79c6">=</span> 1 <span style="color:#ff79c6">&lt;&lt;</span> 16<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 056 */</span>     <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">double</span> loadFactor <span style="color:#ff79c6">=</span> 0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">5</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 057 */</span>     <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">int</span> numBuckets <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">(</span>capacity <span style="color:#ff79c6">/</span> loadFactor<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 058 */</span>     <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">int</span> maxSteps <span style="color:#ff79c6">=</span> 2<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 059 */</span>     <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">int</span> numRows <span style="color:#ff79c6">=</span> 0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 060 */</span>     <span style="color:#8be9fd;font-style:italic">private</span> Object emptyVBase<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 061 */</span>     <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">long</span> emptyVOff<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 062 */</span>     <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">int</span> emptyVLen<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 063 */</span>     <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">boolean</span> isBatchFull <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">false</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 064 */</span>     <span style="color:#8be9fd;font-style:italic">private</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalyst</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">expressions</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">codegen</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">UnsafeRowWriter</span> agg_rowWriter<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 065 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 066 */</span>     <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#50fa7b">hashAgg_FastHashMap_0</span><span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 067 */</span>       org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">memory</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">TaskMemoryManager</span> taskMemoryManager<span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 068 */</span>       InternalRow emptyAggregationBuffer<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 069 */</span>       batch <span style="color:#ff79c6">=</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalyst</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">expressions</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">RowBasedKeyValueBatch</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 070 */</span>       <span style="color:#ff79c6">.</span><span style="color:#50fa7b">allocate</span><span style="color:#ff79c6">(((</span>org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">types</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">StructType</span><span style="color:#ff79c6">)</span> references<span style="color:#ff79c6">[</span>1<span style="color:#ff79c6">]</span> <span style="color:#6272a4">/* keySchemaTerm */</span><span style="color:#ff79c6">),</span> <span style="color:#ff79c6">((</span>org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">types</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">StructType</span><span style="color:#ff79c6">)</span> references<span style="color:#ff79c6">[</span>2<span style="color:#ff79c6">]</span> <span style="color:#6272a4">/* valueSchemaTerm */</span><span style="color:#ff79c6">),</span> taskMemoryManager<span style="color:#ff79c6">,</span> capacity<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 071 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 072 */</span>       <span style="color:#8be9fd;font-style:italic">final</span> UnsafeProjection valueProjection <span style="color:#ff79c6">=</span> UnsafeProjection<span style="color:#ff79c6">.</span><span style="color:#50fa7b">create</span><span style="color:#ff79c6">(((</span>org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">types</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">StructType</span><span style="color:#ff79c6">)</span> references<span style="color:#ff79c6">[</span>2<span style="color:#ff79c6">]</span> <span style="color:#6272a4">/* valueSchemaTerm */</span><span style="color:#ff79c6">));</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 073 */</span>       <span style="color:#8be9fd;font-style:italic">final</span> <span style="color:#8be9fd">byte</span><span style="color:#ff79c6">[]</span> emptyBuffer <span style="color:#ff79c6">=</span> valueProjection<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apply</span><span style="color:#ff79c6">(</span>emptyAggregationBuffer<span style="color:#ff79c6">).</span><span style="color:#50fa7b">getBytes</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 074 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 075 */</span>       emptyVBase <span style="color:#ff79c6">=</span> emptyBuffer<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 076 */</span>       emptyVOff <span style="color:#ff79c6">=</span> Platform<span style="color:#ff79c6">.</span><span style="color:#50fa7b">BYTE_ARRAY_OFFSET</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 077 */</span>       emptyVLen <span style="color:#ff79c6">=</span> emptyBuffer<span style="color:#ff79c6">.</span><span style="color:#50fa7b">length</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 078 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 079 */</span>       agg_rowWriter <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalyst</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">expressions</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">codegen</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">UnsafeRowWriter</span><span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 080 */</span>         3<span style="color:#ff79c6">,</span> 0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 081 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 082 */</span>       buckets <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> <span style="color:#8be9fd">int</span><span style="color:#ff79c6">[</span>numBuckets<span style="color:#ff79c6">];</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 083 */</span>       java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">util</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Arrays</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">fill</span><span style="color:#ff79c6">(</span>buckets<span style="color:#ff79c6">,</span> <span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 084 */</span>     <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 085 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 086 */</span>     <span style="color:#8be9fd;font-style:italic">public</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalyst</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">expressions</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">UnsafeRow</span> <span style="color:#50fa7b">findOrInsert</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">long</span> hashAgg_key_0<span style="color:#ff79c6">,</span> <span style="color:#8be9fd">long</span> hashAgg_key_1<span style="color:#ff79c6">,</span> <span style="color:#8be9fd">long</span> hashAgg_key_2<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 087 */</span>       <span style="color:#8be9fd">long</span> h <span style="color:#ff79c6">=</span> hash<span style="color:#ff79c6">(</span>hashAgg_key_0<span style="color:#ff79c6">,</span> hashAgg_key_1<span style="color:#ff79c6">,</span> hashAgg_key_2<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 088 */</span>       <span style="color:#8be9fd">int</span> step <span style="color:#ff79c6">=</span> 0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 089 */</span>       <span style="color:#8be9fd">int</span> idx <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span> h <span style="color:#ff79c6">&amp;</span> <span style="color:#ff79c6">(</span>numBuckets <span style="color:#ff79c6">-</span> 1<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 090 */</span>       <span style="color:#ff79c6">while</span> <span style="color:#ff79c6">(</span>step <span style="color:#ff79c6">&lt;</span> maxSteps<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 091 */</span>         <span style="color:#6272a4">// Return bucket index if it&#39;s either an empty slot or already contains the key
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#6272a4">/* 092 */</span>         <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>buckets<span style="color:#ff79c6">[</span>idx<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 093 */</span>           <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>numRows <span style="color:#ff79c6">&lt;</span> capacity <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#ff79c6">!</span>isBatchFull<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 094 */</span>             agg_rowWriter<span style="color:#ff79c6">.</span><span style="color:#50fa7b">reset</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 095 */</span>             agg_rowWriter<span style="color:#ff79c6">.</span><span style="color:#50fa7b">zeroOutNullBytes</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 096 */</span>             agg_rowWriter<span style="color:#ff79c6">.</span><span style="color:#50fa7b">write</span><span style="color:#ff79c6">(</span>0<span style="color:#ff79c6">,</span> hashAgg_key_0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 097 */</span>             agg_rowWriter<span style="color:#ff79c6">.</span><span style="color:#50fa7b">write</span><span style="color:#ff79c6">(</span>1<span style="color:#ff79c6">,</span> hashAgg_key_1<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 098 */</span>             agg_rowWriter<span style="color:#ff79c6">.</span><span style="color:#50fa7b">write</span><span style="color:#ff79c6">(</span>2<span style="color:#ff79c6">,</span> hashAgg_key_2<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 099 */</span>             org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalyst</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">expressions</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">UnsafeRow</span> agg_result
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 100 */</span>             <span style="color:#ff79c6">=</span> agg_rowWriter<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getRow</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 101 */</span>             Object kbase <span style="color:#ff79c6">=</span> agg_result<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getBaseObject</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 102 */</span>             <span style="color:#8be9fd">long</span> koff <span style="color:#ff79c6">=</span> agg_result<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getBaseOffset</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 103 */</span>             <span style="color:#8be9fd">int</span> klen <span style="color:#ff79c6">=</span> agg_result<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getSizeInBytes</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 104 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 105 */</span>             UnsafeRow vRow
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 106 */</span>             <span style="color:#ff79c6">=</span> batch<span style="color:#ff79c6">.</span><span style="color:#50fa7b">appendRow</span><span style="color:#ff79c6">(</span>kbase<span style="color:#ff79c6">,</span> koff<span style="color:#ff79c6">,</span> klen<span style="color:#ff79c6">,</span> emptyVBase<span style="color:#ff79c6">,</span> emptyVOff<span style="color:#ff79c6">,</span> emptyVLen<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 107 */</span>             <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>vRow <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 108 */</span>               isBatchFull <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 109 */</span>             <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 110 */</span>               buckets<span style="color:#ff79c6">[</span>idx<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> numRows<span style="color:#ff79c6">++;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 111 */</span>             <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 112 */</span>             <span style="color:#ff79c6">return</span> vRow<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 113 */</span>           <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 114 */</span>             <span style="color:#6272a4">// No more space
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#6272a4">/* 115 */</span>             <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 116 */</span>           <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 117 */</span>         <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>equals<span style="color:#ff79c6">(</span>idx<span style="color:#ff79c6">,</span> hashAgg_key_0<span style="color:#ff79c6">,</span> hashAgg_key_1<span style="color:#ff79c6">,</span> hashAgg_key_2<span style="color:#ff79c6">))</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 118 */</span>           <span style="color:#ff79c6">return</span> batch<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getValueRow</span><span style="color:#ff79c6">(</span>buckets<span style="color:#ff79c6">[</span>idx<span style="color:#ff79c6">]);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 119 */</span>         <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 120 */</span>         idx <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span>idx <span style="color:#ff79c6">+</span> 1<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">&amp;</span> <span style="color:#ff79c6">(</span>numBuckets <span style="color:#ff79c6">-</span> 1<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 121 */</span>         step<span style="color:#ff79c6">++;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 122 */</span>       <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 123 */</span>       <span style="color:#6272a4">// Didn&#39;t find it
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#6272a4">/* 124 */</span>       <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 125 */</span>     <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 126 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 127 */</span>     <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">equals</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span> idx<span style="color:#ff79c6">,</span> <span style="color:#8be9fd">long</span> hashAgg_key_0<span style="color:#ff79c6">,</span> <span style="color:#8be9fd">long</span> hashAgg_key_1<span style="color:#ff79c6">,</span> <span style="color:#8be9fd">long</span> hashAgg_key_2<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 128 */</span>       UnsafeRow row <span style="color:#ff79c6">=</span> batch<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getKeyRow</span><span style="color:#ff79c6">(</span>buckets<span style="color:#ff79c6">[</span>idx<span style="color:#ff79c6">]);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 129 */</span>       <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">(</span>row<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getLong</span><span style="color:#ff79c6">(</span>0<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">==</span> hashAgg_key_0<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#ff79c6">(</span>row<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getLong</span><span style="color:#ff79c6">(</span>1<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">==</span> hashAgg_key_1<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#ff79c6">(</span>row<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getLong</span><span style="color:#ff79c6">(</span>2<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">==</span> hashAgg_key_2<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 130 */</span>     <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 131 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 132 */</span>     <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">long</span> <span style="color:#50fa7b">hash</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">long</span> hashAgg_key_0<span style="color:#ff79c6">,</span> <span style="color:#8be9fd">long</span> hashAgg_key_1<span style="color:#ff79c6">,</span> <span style="color:#8be9fd">long</span> hashAgg_key_2<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 133 */</span>       <span style="color:#8be9fd">long</span> hashAgg_hash_0 <span style="color:#ff79c6">=</span> 0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 134 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 135 */</span>       <span style="color:#8be9fd">long</span> hashAgg_result_0 <span style="color:#ff79c6">=</span> hashAgg_key_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 136 */</span>       hashAgg_hash_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span>hashAgg_hash_0 <span style="color:#ff79c6">^</span> <span style="color:#ff79c6">(</span>0x9e3779b9<span style="color:#ff79c6">))</span> <span style="color:#ff79c6">+</span> hashAgg_result_0 <span style="color:#ff79c6">+</span> <span style="color:#ff79c6">(</span>hashAgg_hash_0 <span style="color:#ff79c6">&lt;&lt;</span> 6<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">+</span> <span style="color:#ff79c6">(</span>hashAgg_hash_0 <span style="color:#ff79c6">&gt;&gt;&gt;</span> 2<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 137 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 138 */</span>       <span style="color:#8be9fd">long</span> hashAgg_result_1 <span style="color:#ff79c6">=</span> hashAgg_key_1<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 139 */</span>       hashAgg_hash_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span>hashAgg_hash_0 <span style="color:#ff79c6">^</span> <span style="color:#ff79c6">(</span>0x9e3779b9<span style="color:#ff79c6">))</span> <span style="color:#ff79c6">+</span> hashAgg_result_1 <span style="color:#ff79c6">+</span> <span style="color:#ff79c6">(</span>hashAgg_hash_0 <span style="color:#ff79c6">&lt;&lt;</span> 6<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">+</span> <span style="color:#ff79c6">(</span>hashAgg_hash_0 <span style="color:#ff79c6">&gt;&gt;&gt;</span> 2<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 140 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 141 */</span>       <span style="color:#8be9fd">long</span> hashAgg_result_2 <span style="color:#ff79c6">=</span> hashAgg_key_2<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 142 */</span>       hashAgg_hash_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span>hashAgg_hash_0 <span style="color:#ff79c6">^</span> <span style="color:#ff79c6">(</span>0x9e3779b9<span style="color:#ff79c6">))</span> <span style="color:#ff79c6">+</span> hashAgg_result_2 <span style="color:#ff79c6">+</span> <span style="color:#ff79c6">(</span>hashAgg_hash_0 <span style="color:#ff79c6">&lt;&lt;</span> 6<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">+</span> <span style="color:#ff79c6">(</span>hashAgg_hash_0 <span style="color:#ff79c6">&gt;&gt;&gt;</span> 2<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 143 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 144 */</span>       <span style="color:#ff79c6">return</span> hashAgg_hash_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 145 */</span>     <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 146 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 147 */</span>     <span style="color:#8be9fd;font-style:italic">public</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">unsafe</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">KVIterator</span><span style="color:#ff79c6">&lt;</span>UnsafeRow<span style="color:#ff79c6">,</span> UnsafeRow<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">rowIterator</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 148 */</span>       <span style="color:#ff79c6">return</span> batch<span style="color:#ff79c6">.</span><span style="color:#50fa7b">rowIterator</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 149 */</span>     <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 150 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 151 */</span>     <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">close</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 152 */</span>       batch<span style="color:#ff79c6">.</span><span style="color:#50fa7b">close</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 153 */</span>     <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 154 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 155 */</span>   <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 156 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 157 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">expand_doConsume_0</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">long</span> expand_expr_0_0<span style="color:#ff79c6">,</span> <span style="color:#8be9fd">boolean</span> expand_exprIsNull_0_0<span style="color:#ff79c6">,</span> <span style="color:#8be9fd">long</span> expand_expr_1_0<span style="color:#ff79c6">,</span> <span style="color:#8be9fd">boolean</span> expand_exprIsNull_1_0<span style="color:#ff79c6">,</span> <span style="color:#8be9fd">long</span> expand_expr_2_0<span style="color:#ff79c6">,</span> <span style="color:#8be9fd">boolean</span> expand_exprIsNull_2_0<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">throws</span> java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">io</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">IOException</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 158 */</span>     <span style="color:#ff79c6">for</span> <span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span> expand_i_0 <span style="color:#ff79c6">=</span> 0<span style="color:#ff79c6">;</span> expand_i_0 <span style="color:#ff79c6">&lt;</span> 4<span style="color:#ff79c6">;</span> expand_i_0 <span style="color:#ff79c6">++)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 159 */</span>       <span style="color:#ff79c6">switch</span> <span style="color:#ff79c6">(</span>expand_i_0<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 160 */</span>       <span style="color:#ff79c6">case</span> 0<span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 161 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 162 */</span>         expand_resultIsNull_0 <span style="color:#ff79c6">=</span> expand_exprIsNull_1_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 163 */</span>         expand_resultValue_0 <span style="color:#ff79c6">=</span> expand_expr_1_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 164 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 165 */</span>         expand_resultIsNull_1 <span style="color:#ff79c6">=</span> expand_exprIsNull_2_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 166 */</span>         expand_resultValue_1 <span style="color:#ff79c6">=</span> expand_expr_2_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 167 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 168 */</span>         expand_resultIsNull_2 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">false</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 169 */</span>         expand_resultValue_2 <span style="color:#ff79c6">=</span> 0L<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 170 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 171 */</span>         <span style="color:#ff79c6">break</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 172 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 173 */</span>       <span style="color:#ff79c6">case</span> 1<span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 174 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 175 */</span>         expand_resultIsNull_0 <span style="color:#ff79c6">=</span> expand_exprIsNull_1_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 176 */</span>         expand_resultValue_0 <span style="color:#ff79c6">=</span> expand_expr_1_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 177 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 178 */</span>         expand_resultIsNull_1 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 179 */</span>         expand_resultValue_1 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">-</span>1L<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 180 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 181 */</span>         expand_resultIsNull_2 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">false</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 182 */</span>         expand_resultValue_2 <span style="color:#ff79c6">=</span> 1L<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 183 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 184 */</span>         <span style="color:#ff79c6">break</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 185 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 186 */</span>       <span style="color:#ff79c6">case</span> 2<span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 187 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 188 */</span>         expand_resultIsNull_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 189 */</span>         expand_resultValue_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">-</span>1L<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 190 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 191 */</span>         expand_resultIsNull_1 <span style="color:#ff79c6">=</span> expand_exprIsNull_2_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 192 */</span>         expand_resultValue_1 <span style="color:#ff79c6">=</span> expand_expr_2_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 193 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 194 */</span>         expand_resultIsNull_2 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">false</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 195 */</span>         expand_resultValue_2 <span style="color:#ff79c6">=</span> 2L<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 196 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 197 */</span>         <span style="color:#ff79c6">break</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 198 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 199 */</span>       <span style="color:#ff79c6">case</span> 3<span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 200 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 201 */</span>         expand_resultIsNull_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 202 */</span>         expand_resultValue_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">-</span>1L<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 203 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 204 */</span>         expand_resultIsNull_1 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 205 */</span>         expand_resultValue_1 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">-</span>1L<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 206 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 207 */</span>         expand_resultIsNull_2 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">false</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 208 */</span>         expand_resultValue_2 <span style="color:#ff79c6">=</span> 3L<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 209 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 210 */</span>         <span style="color:#ff79c6">break</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 211 */</span>       <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 212 */</span>       <span style="color:#ff79c6">((</span>org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execution</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">metric</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">SQLMetric</span><span style="color:#ff79c6">)</span> references<span style="color:#ff79c6">[</span>8<span style="color:#ff79c6">]</span> <span style="color:#6272a4">/* numOutputRows */</span><span style="color:#ff79c6">).</span><span style="color:#50fa7b">add</span><span style="color:#ff79c6">(</span>1<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 213 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 214 */</span>       hashAgg_doConsume_0<span style="color:#ff79c6">(</span>expand_expr_0_0<span style="color:#ff79c6">,</span> expand_exprIsNull_0_0<span style="color:#ff79c6">,</span> expand_resultValue_0<span style="color:#ff79c6">,</span> expand_resultIsNull_0<span style="color:#ff79c6">,</span> expand_resultValue_1<span style="color:#ff79c6">,</span> expand_resultIsNull_1<span style="color:#ff79c6">,</span> expand_resultValue_2<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 215 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 216 */</span>     <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 217 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 218 */</span>   <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 219 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 220 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">hashAgg_doAggregateWithKeys_0</span><span style="color:#ff79c6">()</span> <span style="color:#8be9fd;font-style:italic">throws</span> java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">io</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">IOException</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 221 */</span>     <span style="color:#ff79c6">while</span> <span style="color:#ff79c6">(</span> rdd_input_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">hasNext</span><span style="color:#ff79c6">())</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 222 */</span>       InternalRow rdd_row_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span>InternalRow<span style="color:#ff79c6">)</span> rdd_input_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">next</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 223 */</span>       <span style="color:#ff79c6">((</span>org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execution</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">metric</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">SQLMetric</span><span style="color:#ff79c6">)</span> references<span style="color:#ff79c6">[</span>7<span style="color:#ff79c6">]</span> <span style="color:#6272a4">/* numOutputRows */</span><span style="color:#ff79c6">).</span><span style="color:#50fa7b">add</span><span style="color:#ff79c6">(</span>1<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 224 */</span>       <span style="color:#6272a4">// common sub-expressions
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#6272a4">/* 225 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 226 */</span>       <span style="color:#8be9fd">boolean</span> rdd_isNull_2 <span style="color:#ff79c6">=</span> rdd_row_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">isNullAt</span><span style="color:#ff79c6">(</span>2<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 227 */</span>       <span style="color:#8be9fd">long</span> rdd_value_2 <span style="color:#ff79c6">=</span> rdd_isNull_2 <span style="color:#ff79c6">?</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 228 */</span>       <span style="color:#ff79c6">-</span>1L <span style="color:#ff79c6">:</span> <span style="color:#ff79c6">(</span>rdd_row_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getLong</span><span style="color:#ff79c6">(</span>2<span style="color:#ff79c6">));</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 229 */</span>       <span style="color:#8be9fd">boolean</span> rdd_isNull_1 <span style="color:#ff79c6">=</span> rdd_row_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">isNullAt</span><span style="color:#ff79c6">(</span>1<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 230 */</span>       <span style="color:#8be9fd">long</span> rdd_value_1 <span style="color:#ff79c6">=</span> rdd_isNull_1 <span style="color:#ff79c6">?</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 231 */</span>       <span style="color:#ff79c6">-</span>1L <span style="color:#ff79c6">:</span> <span style="color:#ff79c6">(</span>rdd_row_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getLong</span><span style="color:#ff79c6">(</span>1<span style="color:#ff79c6">));</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 232 */</span>       <span style="color:#8be9fd">boolean</span> rdd_isNull_0 <span style="color:#ff79c6">=</span> rdd_row_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">isNullAt</span><span style="color:#ff79c6">(</span>0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 233 */</span>       <span style="color:#8be9fd">long</span> rdd_value_0 <span style="color:#ff79c6">=</span> rdd_isNull_0 <span style="color:#ff79c6">?</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 234 */</span>       <span style="color:#ff79c6">-</span>1L <span style="color:#ff79c6">:</span> <span style="color:#ff79c6">(</span>rdd_row_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getLong</span><span style="color:#ff79c6">(</span>0<span style="color:#ff79c6">));</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 235 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 236 */</span>       expand_doConsume_0<span style="color:#ff79c6">(</span>rdd_value_2<span style="color:#ff79c6">,</span> rdd_isNull_2<span style="color:#ff79c6">,</span> rdd_value_1<span style="color:#ff79c6">,</span> rdd_isNull_1<span style="color:#ff79c6">,</span> rdd_value_0<span style="color:#ff79c6">,</span> rdd_isNull_0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 237 */</span>       <span style="color:#6272a4">// shouldStop check is eliminated
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#6272a4">/* 238 */</span>     <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 239 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 240 */</span>     hashAgg_fastHashMapIter_0 <span style="color:#ff79c6">=</span> hashAgg_fastHashMap_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">rowIterator</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 241 */</span>     hashAgg_mapIter_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">((</span>org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execution</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">aggregate</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">HashAggregateExec</span><span style="color:#ff79c6">)</span> references<span style="color:#ff79c6">[</span>0<span style="color:#ff79c6">]</span> <span style="color:#6272a4">/* plan */</span><span style="color:#ff79c6">).</span><span style="color:#50fa7b">finishAggregate</span><span style="color:#ff79c6">(</span>hashAgg_hashMap_0<span style="color:#ff79c6">,</span> hashAgg_sorter_0<span style="color:#ff79c6">,</span> <span style="color:#ff79c6">((</span>org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execution</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">metric</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">SQLMetric</span><span style="color:#ff79c6">)</span> references<span style="color:#ff79c6">[</span>3<span style="color:#ff79c6">]</span> <span style="color:#6272a4">/* peakMemory */</span><span style="color:#ff79c6">),</span> <span style="color:#ff79c6">((</span>org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execution</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">metric</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">SQLMetric</span><span style="color:#ff79c6">)</span> references<span style="color:#ff79c6">[</span>4<span style="color:#ff79c6">]</span> <span style="color:#6272a4">/* spillSize */</span><span style="color:#ff79c6">),</span> <span style="color:#ff79c6">((</span>org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execution</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">metric</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">SQLMetric</span><span style="color:#ff79c6">)</span> references<span style="color:#ff79c6">[</span>5<span style="color:#ff79c6">]</span> <span style="color:#6272a4">/* avgHashProbe */</span><span style="color:#ff79c6">),</span> <span style="color:#ff79c6">((</span>org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execution</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">metric</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">SQLMetric</span><span style="color:#ff79c6">)</span> references<span style="color:#ff79c6">[</span>6<span style="color:#ff79c6">]</span> <span style="color:#6272a4">/* numTasksFallBacked */</span><span style="color:#ff79c6">));</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 242 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 243 */</span>   <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 244 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 245 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">hashAgg_doConsume_0</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">long</span> hashAgg_expr_0_0<span style="color:#ff79c6">,</span> <span style="color:#8be9fd">boolean</span> hashAgg_exprIsNull_0_0<span style="color:#ff79c6">,</span> <span style="color:#8be9fd">long</span> hashAgg_expr_1_0<span style="color:#ff79c6">,</span> <span style="color:#8be9fd">boolean</span> hashAgg_exprIsNull_1_0<span style="color:#ff79c6">,</span> <span style="color:#8be9fd">long</span> hashAgg_expr_2_0<span style="color:#ff79c6">,</span> <span style="color:#8be9fd">boolean</span> hashAgg_exprIsNull_2_0<span style="color:#ff79c6">,</span> <span style="color:#8be9fd">long</span> hashAgg_expr_3_0<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">throws</span> java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">io</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">IOException</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 246 */</span>     UnsafeRow hashAgg_unsafeRowAggBuffer_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 247 */</span>     UnsafeRow hashAgg_fastAggBuffer_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 248 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 249 */</span>     <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(!</span>hashAgg_exprIsNull_1_0 <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#ff79c6">!</span>hashAgg_exprIsNull_2_0 <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#ff79c6">!</span><span style="color:#ff79c6">false</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 250 */</span>       hashAgg_fastAggBuffer_0 <span style="color:#ff79c6">=</span> hashAgg_fastHashMap_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">findOrInsert</span><span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 251 */</span>         hashAgg_expr_1_0<span style="color:#ff79c6">,</span> hashAgg_expr_2_0<span style="color:#ff79c6">,</span> hashAgg_expr_3_0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 252 */</span>     <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 253 */</span>     <span style="color:#6272a4">// Cannot find the key in fast hash map, try regular hash map.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#6272a4">/* 254 */</span>     <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>hashAgg_fastAggBuffer_0 <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 255 */</span>       <span style="color:#6272a4">// generate grouping key
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#6272a4">/* 256 */</span>       rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>5<span style="color:#ff79c6">].</span><span style="color:#50fa7b">reset</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 257 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 258 */</span>       rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>5<span style="color:#ff79c6">].</span><span style="color:#50fa7b">zeroOutNullBytes</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 259 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 260 */</span>       <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>hashAgg_exprIsNull_1_0<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 261 */</span>         rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>5<span style="color:#ff79c6">].</span><span style="color:#50fa7b">setNullAt</span><span style="color:#ff79c6">(</span>0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 262 */</span>       <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 263 */</span>         rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>5<span style="color:#ff79c6">].</span><span style="color:#50fa7b">write</span><span style="color:#ff79c6">(</span>0<span style="color:#ff79c6">,</span> hashAgg_expr_1_0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 264 */</span>       <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 265 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 266 */</span>       <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>hashAgg_exprIsNull_2_0<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 267 */</span>         rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>5<span style="color:#ff79c6">].</span><span style="color:#50fa7b">setNullAt</span><span style="color:#ff79c6">(</span>1<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 268 */</span>       <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 269 */</span>         rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>5<span style="color:#ff79c6">].</span><span style="color:#50fa7b">write</span><span style="color:#ff79c6">(</span>1<span style="color:#ff79c6">,</span> hashAgg_expr_2_0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 270 */</span>       <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 271 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 272 */</span>       rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>5<span style="color:#ff79c6">].</span><span style="color:#50fa7b">write</span><span style="color:#ff79c6">(</span>2<span style="color:#ff79c6">,</span> hashAgg_expr_3_0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 273 */</span>       <span style="color:#8be9fd">int</span> hashAgg_unsafeRowKeyHash_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span>rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>5<span style="color:#ff79c6">].</span><span style="color:#50fa7b">getRow</span><span style="color:#ff79c6">()).</span><span style="color:#50fa7b">hashCode</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 274 */</span>       <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span><span style="color:#ff79c6">true</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 275 */</span>         <span style="color:#6272a4">// try to get the buffer from hash map
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#6272a4">/* 276 */</span>         hashAgg_unsafeRowAggBuffer_0 <span style="color:#ff79c6">=</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 277 */</span>         hashAgg_hashMap_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getAggregationBufferFromUnsafeRow</span><span style="color:#ff79c6">((</span>rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>5<span style="color:#ff79c6">].</span><span style="color:#50fa7b">getRow</span><span style="color:#ff79c6">()),</span> hashAgg_unsafeRowKeyHash_0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 278 */</span>       <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 279 */</span>       <span style="color:#6272a4">// Can&#39;t allocate buffer from the hash map. Spill the map and fallback to sort-based
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#6272a4">/* 280 */</span>       <span style="color:#6272a4">// aggregation after processing all input rows.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#6272a4">/* 281 */</span>       <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>hashAgg_unsafeRowAggBuffer_0 <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 282 */</span>         <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>hashAgg_sorter_0 <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 283 */</span>           hashAgg_sorter_0 <span style="color:#ff79c6">=</span> hashAgg_hashMap_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">destructAndCreateExternalSorter</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 284 */</span>         <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 285 */</span>           hashAgg_sorter_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">merge</span><span style="color:#ff79c6">(</span>hashAgg_hashMap_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">destructAndCreateExternalSorter</span><span style="color:#ff79c6">());</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 286 */</span>         <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 287 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 288 */</span>         <span style="color:#6272a4">// the hash map had be spilled, it should have enough memory now,
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#6272a4">/* 289 */</span>         <span style="color:#6272a4">// try to allocate buffer again.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#6272a4">/* 290 */</span>         hashAgg_unsafeRowAggBuffer_0 <span style="color:#ff79c6">=</span> hashAgg_hashMap_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getAggregationBufferFromUnsafeRow</span><span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 291 */</span>           <span style="color:#ff79c6">(</span>rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>5<span style="color:#ff79c6">].</span><span style="color:#50fa7b">getRow</span><span style="color:#ff79c6">()),</span> hashAgg_unsafeRowKeyHash_0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 292 */</span>         <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>hashAgg_unsafeRowAggBuffer_0 <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 293 */</span>           <span style="color:#6272a4">// failed to allocate the first page
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#6272a4">/* 294 */</span>           <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">memory</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">SparkOutOfMemoryError</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;No enough memory for aggregation&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 295 */</span>         <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 296 */</span>       <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 297 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 298 */</span>     <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 299 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 300 */</span>     <span style="color:#6272a4">// Updates the proper row buffer
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#6272a4">/* 301 */</span>     <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>hashAgg_fastAggBuffer_0 <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 302 */</span>       hashAgg_unsafeRowAggBuffer_0 <span style="color:#ff79c6">=</span> hashAgg_fastAggBuffer_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 303 */</span>     <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 304 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 305 */</span>     <span style="color:#6272a4">// common sub-expressions
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#6272a4">/* 306 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 307 */</span>     <span style="color:#6272a4">// evaluate aggregate functions and update aggregation buffers
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#6272a4">/* 308 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 309 */</span>     hashAgg_hashAgg_isNull_11_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 310 */</span>     <span style="color:#8be9fd">long</span> hashAgg_value_12 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">-</span>1L<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 311 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 312 */</span>     <span style="color:#8be9fd">boolean</span> hashAgg_isNull_12 <span style="color:#ff79c6">=</span> hashAgg_unsafeRowAggBuffer_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">isNullAt</span><span style="color:#ff79c6">(</span>0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 313 */</span>     <span style="color:#8be9fd">long</span> hashAgg_value_13 <span style="color:#ff79c6">=</span> hashAgg_isNull_12 <span style="color:#ff79c6">?</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 314 */</span>     <span style="color:#ff79c6">-</span>1L <span style="color:#ff79c6">:</span> <span style="color:#ff79c6">(</span>hashAgg_unsafeRowAggBuffer_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getLong</span><span style="color:#ff79c6">(</span>0<span style="color:#ff79c6">));</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 315 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 316 */</span>     <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(!</span>hashAgg_isNull_12 <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#ff79c6">(</span>hashAgg_hashAgg_isNull_11_0 <span style="color:#ff79c6">||</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 317 */</span>         hashAgg_value_13 <span style="color:#ff79c6">&gt;</span> hashAgg_value_12<span style="color:#ff79c6">))</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 318 */</span>       hashAgg_hashAgg_isNull_11_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">false</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 319 */</span>       hashAgg_value_12 <span style="color:#ff79c6">=</span> hashAgg_value_13<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 320 */</span>     <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 321 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 322 */</span>     <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(!</span>hashAgg_exprIsNull_0_0 <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#ff79c6">(</span>hashAgg_hashAgg_isNull_11_0 <span style="color:#ff79c6">||</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 323 */</span>         hashAgg_expr_0_0 <span style="color:#ff79c6">&gt;</span> hashAgg_value_12<span style="color:#ff79c6">))</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 324 */</span>       hashAgg_hashAgg_isNull_11_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">false</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 325 */</span>       hashAgg_value_12 <span style="color:#ff79c6">=</span> hashAgg_expr_0_0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 326 */</span>     <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 327 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 328 */</span>     <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(!</span>hashAgg_hashAgg_isNull_11_0<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 329 */</span>       hashAgg_unsafeRowAggBuffer_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">setLong</span><span style="color:#ff79c6">(</span>0<span style="color:#ff79c6">,</span> hashAgg_value_12<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 330 */</span>     <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 331 */</span>       hashAgg_unsafeRowAggBuffer_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">setNullAt</span><span style="color:#ff79c6">(</span>0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 332 */</span>     <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 333 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 334 */</span>   <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 335 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 336 */</span>   <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">hashAgg_doAggregateWithKeysOutput_0</span><span style="color:#ff79c6">(</span>UnsafeRow hashAgg_keyTerm_0<span style="color:#ff79c6">,</span> UnsafeRow hashAgg_bufferTerm_0<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 337 */</span>   <span style="color:#8be9fd;font-style:italic">throws</span> java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">io</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">IOException</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 338 */</span>     <span style="color:#ff79c6">((</span>org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execution</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">metric</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">SQLMetric</span><span style="color:#ff79c6">)</span> references<span style="color:#ff79c6">[</span>9<span style="color:#ff79c6">]</span> <span style="color:#6272a4">/* numOutputRows */</span><span style="color:#ff79c6">).</span><span style="color:#50fa7b">add</span><span style="color:#ff79c6">(</span>1<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 339 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 340 */</span>     <span style="color:#8be9fd">boolean</span> hashAgg_isNull_14 <span style="color:#ff79c6">=</span> hashAgg_keyTerm_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">isNullAt</span><span style="color:#ff79c6">(</span>0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 341 */</span>     <span style="color:#8be9fd">long</span> hashAgg_value_15 <span style="color:#ff79c6">=</span> hashAgg_isNull_14 <span style="color:#ff79c6">?</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 342 */</span>     <span style="color:#ff79c6">-</span>1L <span style="color:#ff79c6">:</span> <span style="color:#ff79c6">(</span>hashAgg_keyTerm_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getLong</span><span style="color:#ff79c6">(</span>0<span style="color:#ff79c6">));</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 343 */</span>     <span style="color:#8be9fd">boolean</span> hashAgg_isNull_15 <span style="color:#ff79c6">=</span> hashAgg_keyTerm_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">isNullAt</span><span style="color:#ff79c6">(</span>1<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 344 */</span>     <span style="color:#8be9fd">long</span> hashAgg_value_16 <span style="color:#ff79c6">=</span> hashAgg_isNull_15 <span style="color:#ff79c6">?</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 345 */</span>     <span style="color:#ff79c6">-</span>1L <span style="color:#ff79c6">:</span> <span style="color:#ff79c6">(</span>hashAgg_keyTerm_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getLong</span><span style="color:#ff79c6">(</span>1<span style="color:#ff79c6">));</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 346 */</span>     <span style="color:#8be9fd">long</span> hashAgg_value_17 <span style="color:#ff79c6">=</span> hashAgg_keyTerm_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getLong</span><span style="color:#ff79c6">(</span>2<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 347 */</span>     <span style="color:#8be9fd">boolean</span> hashAgg_isNull_17 <span style="color:#ff79c6">=</span> hashAgg_bufferTerm_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">isNullAt</span><span style="color:#ff79c6">(</span>0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 348 */</span>     <span style="color:#8be9fd">long</span> hashAgg_value_18 <span style="color:#ff79c6">=</span> hashAgg_isNull_17 <span style="color:#ff79c6">?</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 349 */</span>     <span style="color:#ff79c6">-</span>1L <span style="color:#ff79c6">:</span> <span style="color:#ff79c6">(</span>hashAgg_bufferTerm_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getLong</span><span style="color:#ff79c6">(</span>0<span style="color:#ff79c6">));</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 350 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 351 */</span>     rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>6<span style="color:#ff79c6">].</span><span style="color:#50fa7b">reset</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 352 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 353 */</span>     rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>6<span style="color:#ff79c6">].</span><span style="color:#50fa7b">zeroOutNullBytes</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 354 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 355 */</span>     <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>hashAgg_isNull_14<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 356 */</span>       rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>6<span style="color:#ff79c6">].</span><span style="color:#50fa7b">setNullAt</span><span style="color:#ff79c6">(</span>0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 357 */</span>     <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 358 */</span>       rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>6<span style="color:#ff79c6">].</span><span style="color:#50fa7b">write</span><span style="color:#ff79c6">(</span>0<span style="color:#ff79c6">,</span> hashAgg_value_15<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 359 */</span>     <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 360 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 361 */</span>     <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>hashAgg_isNull_15<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 362 */</span>       rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>6<span style="color:#ff79c6">].</span><span style="color:#50fa7b">setNullAt</span><span style="color:#ff79c6">(</span>1<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 363 */</span>     <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 364 */</span>       rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>6<span style="color:#ff79c6">].</span><span style="color:#50fa7b">write</span><span style="color:#ff79c6">(</span>1<span style="color:#ff79c6">,</span> hashAgg_value_16<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 365 */</span>     <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 366 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 367 */</span>     rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>6<span style="color:#ff79c6">].</span><span style="color:#50fa7b">write</span><span style="color:#ff79c6">(</span>2<span style="color:#ff79c6">,</span> hashAgg_value_17<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 368 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 369 */</span>     <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>hashAgg_isNull_17<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 370 */</span>       rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>6<span style="color:#ff79c6">].</span><span style="color:#50fa7b">setNullAt</span><span style="color:#ff79c6">(</span>3<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 371 */</span>     <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 372 */</span>       rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>6<span style="color:#ff79c6">].</span><span style="color:#50fa7b">write</span><span style="color:#ff79c6">(</span>3<span style="color:#ff79c6">,</span> hashAgg_value_18<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 373 */</span>     <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 374 */</span>     append<span style="color:#ff79c6">((</span>rdd_mutableStateArray_0<span style="color:#ff79c6">[</span>6<span style="color:#ff79c6">].</span><span style="color:#50fa7b">getRow</span><span style="color:#ff79c6">()));</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 375 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 376 */</span>   <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 377 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 378 */</span>   <span style="color:#8be9fd;font-style:italic">protected</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">processNext</span><span style="color:#ff79c6">()</span> <span style="color:#8be9fd;font-style:italic">throws</span> java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">io</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">IOException</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 379 */</span>     <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(!</span>hashAgg_initAgg_0<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 380 */</span>       hashAgg_initAgg_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 381 */</span>       hashAgg_fastHashMap_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> hashAgg_FastHashMap_0<span style="color:#ff79c6">(((</span>org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execution</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">aggregate</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">HashAggregateExec</span><span style="color:#ff79c6">)</span> references<span style="color:#ff79c6">[</span>0<span style="color:#ff79c6">]</span> <span style="color:#6272a4">/* plan */</span><span style="color:#ff79c6">).</span><span style="color:#50fa7b">getTaskContext</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">taskMemoryManager</span><span style="color:#ff79c6">(),</span> <span style="color:#ff79c6">((</span>org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execution</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">aggregate</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">HashAggregateExec</span><span style="color:#ff79c6">)</span> references<span style="color:#ff79c6">[</span>0<span style="color:#ff79c6">]</span> <span style="color:#6272a4">/* plan */</span><span style="color:#ff79c6">).</span><span style="color:#50fa7b">getEmptyAggregationBuffer</span><span style="color:#ff79c6">());</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 382 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 383 */</span>       <span style="color:#ff79c6">((</span>org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execution</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">aggregate</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">HashAggregateExec</span><span style="color:#ff79c6">)</span> references<span style="color:#ff79c6">[</span>0<span style="color:#ff79c6">]</span> <span style="color:#6272a4">/* plan */</span><span style="color:#ff79c6">).</span><span style="color:#50fa7b">getTaskContext</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">addTaskCompletionListener</span><span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 384 */</span>         <span style="color:#ff79c6">new</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">util</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">TaskCompletionListener</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 385 */</span>           @Override
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 386 */</span>           <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">onTaskCompletion</span><span style="color:#ff79c6">(</span>org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">TaskContext</span> context<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 387 */</span>             hashAgg_fastHashMap_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">close</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 388 */</span>           <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 389 */</span>         <span style="color:#ff79c6">});</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 390 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 391 */</span>       hashAgg_hashMap_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">((</span>org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execution</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">aggregate</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">HashAggregateExec</span><span style="color:#ff79c6">)</span> references<span style="color:#ff79c6">[</span>0<span style="color:#ff79c6">]</span> <span style="color:#6272a4">/* plan */</span><span style="color:#ff79c6">).</span><span style="color:#50fa7b">createHashMap</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 392 */</span>       <span style="color:#8be9fd">long</span> wholestagecodegen_beforeAgg_0 <span style="color:#ff79c6">=</span> System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">nanoTime</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 393 */</span>       hashAgg_doAggregateWithKeys_0<span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 394 */</span>       <span style="color:#ff79c6">((</span>org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">execution</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">metric</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">SQLMetric</span><span style="color:#ff79c6">)</span> references<span style="color:#ff79c6">[</span>10<span style="color:#ff79c6">]</span> <span style="color:#6272a4">/* aggTime */</span><span style="color:#ff79c6">).</span><span style="color:#50fa7b">add</span><span style="color:#ff79c6">((</span>System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">nanoTime</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">-</span> wholestagecodegen_beforeAgg_0<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">/</span> 1000000<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 395 */</span>     <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 396 */</span>     <span style="color:#6272a4">// output the result
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#6272a4">/* 397 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 398 */</span>     <span style="color:#ff79c6">while</span> <span style="color:#ff79c6">(</span> hashAgg_fastHashMapIter_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">next</span><span style="color:#ff79c6">())</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 399 */</span>       UnsafeRow hashAgg_aggKey_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span>UnsafeRow<span style="color:#ff79c6">)</span> hashAgg_fastHashMapIter_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getKey</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 400 */</span>       UnsafeRow hashAgg_aggBuffer_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span>UnsafeRow<span style="color:#ff79c6">)</span> hashAgg_fastHashMapIter_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getValue</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 401 */</span>       hashAgg_doAggregateWithKeysOutput_0<span style="color:#ff79c6">(</span>hashAgg_aggKey_0<span style="color:#ff79c6">,</span> hashAgg_aggBuffer_0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 402 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 403 */</span>       <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>shouldStop<span style="color:#ff79c6">())</span> <span style="color:#ff79c6">return</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 404 */</span>     <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 405 */</span>     hashAgg_fastHashMap_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">close</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 406 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 407 */</span>     <span style="color:#ff79c6">while</span> <span style="color:#ff79c6">(</span> hashAgg_mapIter_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">next</span><span style="color:#ff79c6">())</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 408 */</span>       UnsafeRow hashAgg_aggKey_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span>UnsafeRow<span style="color:#ff79c6">)</span> hashAgg_mapIter_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getKey</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 409 */</span>       UnsafeRow hashAgg_aggBuffer_0 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span>UnsafeRow<span style="color:#ff79c6">)</span> hashAgg_mapIter_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getValue</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 410 */</span>       hashAgg_doAggregateWithKeysOutput_0<span style="color:#ff79c6">(</span>hashAgg_aggKey_0<span style="color:#ff79c6">,</span> hashAgg_aggBuffer_0<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 411 */</span>       <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>shouldStop<span style="color:#ff79c6">())</span> <span style="color:#ff79c6">return</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 412 */</span>     <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 413 */</span>     hashAgg_mapIter_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">close</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 414 */</span>     <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>hashAgg_sorter_0 <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 415 */</span>       hashAgg_hashMap_0<span style="color:#ff79c6">.</span><span style="color:#50fa7b">free</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 416 */</span>     <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 417 */</span>   <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 418 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 419 */</span> <span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="参考">参考</h2>
<ul>
<li><a href="https://spark.apache.org/docs/latest/sql-ref-syntax-qry-select-pivot.html">PIVOT Clause</a></li>
<li><a href="https://imgse.com/">免费图床 imgse</a></li>
<li><a href="https://imgtp.com/">图床 imgtp</a></li>
<li><a href="https://www.cnblogs.com/huaweiyun/p/16446619.html">详解SQL中Groupings Sets 语句的功能和底层实现逻辑</a></li>
<li><a href="https://www.cnblogs.com/sh425/p/7596420.html">Spark SQL 源码分析之Physical Plan 到 RDD的具体实现 </a></li>
<li><a href="https://spark.apache.org/docs/latest/sql-ref-syntax-qry-select-unpivot.html">UNPIVOT Clause</a></li>
<li><a href="https://spark.apache.org/docs/latest/sql-ref-syntax-qry-select-lateral-view.html">LATERAL VIEW Clause</a></li>
<li><a href="http://spark.coolplayer.net/?p=3419">案例|使用 spark Pivot 处理复杂的数据统计需求</a></li>
<li><a href="https://spark.apache.org/docs/latest/sql-ref-syntax-qry-select-window.html">Window Functions</a></li>
<li><a href="http://spark.coolplayer.net/?p=3419">使用 spark Pivot 处理复杂的数据统计需求</a></li>
</ul>

			<script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>
        </div>

        


        

<div class="post-archive">
    <h2>相关文章</h2>
    <ul class="listing">
        
        <li><a href="/post/2024/05/spark_join/">Spark原理-JOIN</a></li>
        
        <li><a href="/post/2024/04/spark_agg/">Spark原理-聚合</a></li>
        
        <li><a href="/post/2024/03/spark_plan_agg/">Spark原理-物理计划&amp;聚合</a></li>
        
        <li><a href="/post/2024/03/spark_optimized/">Spark原理-优化规则</a></li>
        
        <li><a href="/post/2024/03/spark_internal/">Spark原理-解析过程和Catalog</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/spark'>Spark</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "himichael/hugoblogtalks"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>


                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://code0xff.org/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://code0xff.org/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://code0xff.org/post/2025/01/logs_collection_based_cloud/" title="云环境中的日志收集和处理方案">云环境中的日志收集和处理方案</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2025/01/btrace/" title="BTrace">BTrace</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2025/01/yarn/" title="YARN原理分析">YARN原理分析</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2025/01/spark_register_source/" title="Spark 注册数据源">Spark 注册数据源</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2025/01/spark_core_2/" title="Spark Core相关-2">Spark Core相关-2</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/12/llamafactory/" title="Llama Factory">Llama Factory</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/11/spark_core/" title="Spark Core相关-1">Spark Core相关-1</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/11/sae_tunnel/" title="sea tunnel">sea tunnel</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/11/k8s_networks/" title="k8s 网络">k8s 网络</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/11/ozone/" title="ozone">ozone</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://code0xff.org/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式 (6)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/">原理分析 (26)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E5%95%86%E4%B8%9A/">商业 (3)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据 (56)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库 (41)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%96%87%E5%AD%A6%E5%92%8C%E8%89%BA%E6%9C%AF/">文学和艺术 (3)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%97%85%E8%A1%8C/">旅行 (12)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%9E%B6%E6%9E%84/">架构 (14)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E7%AE%97%E6%B3%95/">算法 (8)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E7%B3%BB%E7%BB%9F/">系统 (7)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言 (7)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E8%A1%8C%E4%B8%9A%E8%A7%82%E5%AF%9F/">行业观察 (3)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记 (14)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E9%9A%8F%E4%BE%BF%E5%86%99%E5%86%99/">随便写写 (3)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">归档</a></h3>
<ul class="widget-list">
    
    <li><a href="https://code0xff.org/years/2021%E5%B9%B4/">2021年 (41)</a></li>
    
    <li><a href="https://code0xff.org/years/2022%E5%B9%B4/">2022年 (55)</a></li>
    
    <li><a href="https://code0xff.org/years/2023%E5%B9%B4/">2023年 (54)</a></li>
    
    <li><a href="https://code0xff.org/years/2024%E5%B9%B4/">2024年 (48)</a></li>
    
    <li><a href="https://code0xff.org/years/2025%E5%B9%B4/">2025年 (5)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://code0xff.org/tags/ai/">AI </a>
    
    <a href="https://code0xff.org/tags/ambari/">Ambari </a>
    
    <a href="https://code0xff.org/tags/architecture/">architecture </a>
    
    <a href="https://code0xff.org/tags/bigdata/">bigdata </a>
    
    <a href="https://code0xff.org/tags/btrace/">BTrace </a>
    
    <a href="https://code0xff.org/tags/b%E6%A0%91/">B树 </a>
    
    <a href="https://code0xff.org/tags/c&#43;&#43;/">C&#43;&#43; </a>
    
    <a href="https://code0xff.org/tags/calcite/">calcite </a>
    
    <a href="https://code0xff.org/tags/cmu-database/">CMU-Database </a>
    
    <a href="https://code0xff.org/tags/data_ingestion/">Data_Ingestion </a>
    
    <a href="https://code0xff.org/tags/deltalake/">DeltaLake </a>
    
    <a href="https://code0xff.org/tags/doris/">Doris </a>
    
    <a href="https://code0xff.org/tags/english/">English </a>
    
    <a href="https://code0xff.org/tags/es/">ES </a>
    
    <a href="https://code0xff.org/tags/facebook/">Facebook </a>
    
    <a href="https://code0xff.org/tags/flink/">flink </a>
    
    <a href="https://code0xff.org/tags/flume/">flume </a>
    
    <a href="https://code0xff.org/tags/gc/">GC </a>
    
    <a href="https://code0xff.org/tags/gluten/">Gluten </a>
    
    <a href="https://code0xff.org/tags/hana/">HANA </a>
    
    <a href="https://code0xff.org/tags/hive/">Hive </a>
    
    <a href="https://code0xff.org/tags/iceberg/">iceberg </a>
    
    <a href="https://code0xff.org/tags/impala/">Impala </a>
    
    <a href="https://code0xff.org/tags/janino/">janino </a>
    
    <a href="https://code0xff.org/tags/k8s/">k8s </a>
    
    <a href="https://code0xff.org/tags/kafka/">Kafka </a>
    
    <a href="https://code0xff.org/tags/kudu/">kudu </a>
    
    <a href="https://code0xff.org/tags/kyuubi/">Kyuubi </a>
    
    <a href="https://code0xff.org/tags/lakehouse/">Lakehouse </a>
    
    <a href="https://code0xff.org/tags/leveldb/">LevelDB </a>
    
    <a href="https://code0xff.org/tags/llamafactory/">LlamaFactory </a>
    
    <a href="https://code0xff.org/tags/llvm/">LLVM </a>
    
    <a href="https://code0xff.org/tags/log4j/">log4j </a>
    
    <a href="https://code0xff.org/tags/manacher/">Manacher </a>
    
    <a href="https://code0xff.org/tags/mapreduce/">MapReduce </a>
    
    <a href="https://code0xff.org/tags/micro-service/">micro-service </a>
    
    <a href="https://code0xff.org/tags/mysql/">MySQL </a>
    
    <a href="https://code0xff.org/tags/newsql/">NewSQL </a>
    
    <a href="https://code0xff.org/tags/oceanbase/">OceanBase </a>
    
    <a href="https://code0xff.org/tags/openlogreplicator/">OpenLogReplicator </a>
    
    <a href="https://code0xff.org/tags/parquet/">parquet </a>
    
    <a href="https://code0xff.org/tags/paxos/">paxos </a>
    
    <a href="https://code0xff.org/tags/presto/">Presto </a>
    
    <a href="https://code0xff.org/tags/quick-sql/">quick-sql </a>
    
    <a href="https://code0xff.org/tags/raft/">raft </a>
    
    <a href="https://code0xff.org/tags/scala/">scala </a>
    
    <a href="https://code0xff.org/tags/simd/">SIMD </a>
    
    <a href="https://code0xff.org/tags/snowflake/">snowflake </a>
    
    <a href="https://code0xff.org/tags/spark/">spark </a>
    
    <a href="https://code0xff.org/tags/sre/">SRE </a>
    
    <a href="https://code0xff.org/tags/teradata/">TeraData </a>
    
    <a href="https://code0xff.org/tags/tpcx-hs/">TPCx-HS </a>
    
    <a href="https://code0xff.org/tags/trino/">Trino </a>
    
    <a href="https://code0xff.org/tags/tuning/">Tuning </a>
    
    <a href="https://code0xff.org/tags/unix/">unix </a>
    
    <a href="https://code0xff.org/tags/yarn/">YARN </a>
    
    <a href="https://code0xff.org/tags/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/">二分查找 </a>
    
    <a href="https://code0xff.org/tags/%E4%BA%8C%E5%8F%89%E6%A0%91%E9%81%8D%E5%8E%86/">二叉树遍历 </a>
    
    <a href="https://code0xff.org/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式 </a>
    
    <a href="https://code0xff.org/tags/%E5%88%97%E5%AD%98/">列存 </a>
    
    <a href="https://code0xff.org/tags/%E5%8A%A8%E6%80%81%E6%B3%A8%E5%85%A5/">动态注入 </a>
    
    <a href="https://code0xff.org/tags/%E5%8E%86%E5%8F%B2/">历史 </a>
    
    <a href="https://code0xff.org/tags/%E5%90%91%E9%87%8F%E5%8C%96/">向量化 </a>
    
    <a href="https://code0xff.org/tags/%E5%9B%9E%E6%BA%AF/">回溯 </a>
    
    <a href="https://code0xff.org/tags/%E5%9B%BD%E5%86%85%E6%97%85%E8%A1%8C/">国内旅行 </a>
    
    <a href="https://code0xff.org/tags/%E5%9B%BD%E5%A4%96%E6%97%85%E8%A1%8C/">国外旅行 </a>
    
    <a href="https://code0xff.org/tags/%E5%A4%9A%E7%A7%9F%E6%88%B7/">多租户 </a>
    
    <a href="https://code0xff.org/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据 </a>
    
    <a href="https://code0xff.org/tags/%E5%AD%98%E5%82%A8/">存储 </a>
    
    <a href="https://code0xff.org/tags/%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/">工作记录 </a>
    
    <a href="https://code0xff.org/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务 </a>
    
    <a href="https://code0xff.org/tags/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0/">数据中台 </a>
    
    <a href="https://code0xff.org/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库 </a>
    
    <a href="https://code0xff.org/tags/%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B/">数据模型 </a>
    
    <a href="https://code0xff.org/tags/%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB/">数据迁移 </a>
    
    <a href="https://code0xff.org/tags/%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/">查询优化 </a>
    
    <a href="https://code0xff.org/tags/%E6%9F%A5%E8%AF%A2%E7%BC%96%E8%AF%91/">查询编译 </a>
    
    <a href="https://code0xff.org/tags/%E6%A6%82%E7%8E%87/">概率 </a>
    
    <a href="https://code0xff.org/tags/%E6%B1%87%E7%BC%96/">汇编 </a>
    
    <a href="https://code0xff.org/tags/%E6%B5%8B%E8%AF%95/">测试 </a>
    
    <a href="https://code0xff.org/tags/%E7%94%9F%E6%B4%BB/">生活 </a>
    
    <a href="https://code0xff.org/tags/%E7%94%B5%E5%BD%B1/">电影 </a>
    
    <a href="https://code0xff.org/tags/%E7%AE%97%E6%B3%95/">算法 </a>
    
    <a href="https://code0xff.org/tags/%E7%B4%A2%E5%BC%95/">索引 </a>
    
    <a href="https://code0xff.org/tags/%E7%BB%8F%E6%B5%8E/">经济 </a>
    
    <a href="https://code0xff.org/tags/%E7%BC%93%E5%AD%98/">缓存 </a>
    
    <a href="https://code0xff.org/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/">编译原理 </a>
    
    <a href="https://code0xff.org/tags/%E7%BD%91%E7%BB%9C/">网络 </a>
    
    <a href="https://code0xff.org/tags/%E8%AE%A1%E7%AE%97%E6%A1%86%E6%9E%B6/">计算框架 </a>
    
    <a href="https://code0xff.org/tags/%E8%AE%BA%E6%96%87/">论文 </a>
    
    <a href="https://code0xff.org/tags/%E8%AF%BB%E4%B9%A6/">读书 </a>
    
    <a href="https://code0xff.org/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记 </a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">RSS</h3>
        <ul class="widget-list">
            <li><a href="https://code0xff.org/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
    <footer id="footer">
    <div>
        &copy; 2025 <a href="https://code0xff.org/">记录每个瞬间 By 老王</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script src="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'GA ID', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




</body>

</html>