<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>Doris Basic | 记录每个瞬间</title>
    <meta property="og:title" content="Doris Basic - 记录每个瞬间">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2024-01-05T09:08:07&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2024-01-05T09:08:07&#43;08:00'>
        
    <meta name="Keywords" content="">
    <meta name="description" content="Doris Basic">
        <meta name="author" content="隔壁老王">
        
    <meta property="og:url" content="https://code0xff.org/post/2024/01/doris/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
        <link href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://code0xff.org/">
                        记录每个瞬间
                    </a>
                
                
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://code0xff.org/">首页</a>
                    
                    <a  href="https://code0xff.org/linked/" title="链接">链接</a>
                    
                    <a  href="https://code0xff.org/archives/" title="归档">归档</a>
                    
                    <a  href="https://code0xff.org/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">Doris Basic</h1>
        </header>
        <date class="post-meta meta-date">
            2024年1月5日
        </date>
<nav id="TableOfContents">
  <ul>
    <li><a href="#table-design">Table Design</a>
      <ul>
        <li><a href="#data-model">Data Model</a>
          <ul>
            <li><a href="#aggregate-model">Aggregate Model</a></li>
            <li><a href="#unique-model">Unique Model</a></li>
            <li><a href="#duplicate-model">Duplicate Model</a></li>
          </ul>
        </li>
        <li><a href="#data-partition">Data Partition</a>
          <ul>
            <li><a href="#rollup">Rollup</a></li>
          </ul>
        </li>
        <li><a href="#index">Index</a>
          <ul>
            <li><a href="#inverted-index">Inverted Index</a></li>
            <li><a href="#bloomfilter-index">BloomFilter Index</a></li>
            <li><a href="#ngram-bloomfilter-index">NGram BloomFilter Index</a></li>
            <li><a href="#bitmap-index">Bitmap Index</a></li>
          </ul>
        </li>
        <li><a href="#basic-use">Basic Use</a></li>
      </ul>
    </li>
    <li><a href="#data-operation">Data Operation</a>
      <ul>
        <li><a href="#import">Import</a>
          <ul>
            <li><a href="#import-scenes">Import Scenes</a></li>
            <li><a href="#import-way">Import Way</a>
              <ul>
                <li><a href="#broker-load">Broker Load</a></li>
                <li><a href="#routine-load">Routine Load</a></li>
                <li><a href="#spark-load">Spark Load</a></li>
                <li><a href="#stream-load">Stream Load</a></li>
                <li><a href="#mysql-load">MySql Load</a></li>
                <li><a href="#s3-load">S3 Load</a></li>
                <li><a href="#insert-into">Insert Into</a></li>
                <li><a href="#importing-data-in-json-format">Importing Data in JSON Format</a></li>
              </ul>
            </li>
            <li><a href="#import-advanced">Import Advanced</a></li>
          </ul>
        </li>
        <li><a href="#export">Export</a></li>
        <li><a href="#update-and-delete">Update and Delete</a></li>
      </ul>
    </li>
    <li><a href="#advanced-usage">Advanced Usage</a>
      <ul>
        <li><a href="#alter-table">Alter Table</a></li>
        <li><a href="#doris-partition">Doris Partition</a></li>
        <li><a href="#data-cache">Data Cache</a></li>
        <li><a href="#autobucket">AutoBucket</a></li>
        <li><a href="#broker">Broker</a></li>
        <li><a href="#resource-management">Resource Management</a></li>
        <li><a href="#orthogonal-bitmap-calculation">Orthogonal BITMAP Calculation</a></li>
        <li><a href="#approximate-deduplication-using-hll">Approximate Deduplication Using HLL</a></li>
        <li><a href="#variable">Variable</a></li>
        <li><a href="#file-manager">File Manager</a></li>
        <li><a href="#cold-hot-separation">Cold Hot Separation</a></li>
        <li><a href="#compute-node">Compute Node</a></li>
        <li><a href="#row-to-column">Row to Column</a></li>
        <li><a href="#best-practice">Best Practice</a></li>
      </ul>
    </li>
  </ul>
</nav>
        
        <div class="post-meta">
            
            <span class="post-meta meta-tags">
                <ul class="clearfix">
                    <a href='/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE'>大数据</a>
                </ul>
            </span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <h1 id="table-design">Table Design</h1>
<h2 id="data-model">Data Model</h2>
<ul>
<li>Aggregate</li>
<li>Unique</li>
<li>Duplicate</li>
</ul>
<h3 id="aggregate-model">Aggregate Model</h3>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">DATABASE</span> <span style="color:#ff79c6">IF</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">EXISTS</span> example_db;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">IF</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">EXISTS</span> example_db.example_tbl_agg1
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>user_id<span style="color:#ff79c6">`</span> LARGEINT <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;user id&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span><span style="color:#8be9fd;font-style:italic">date</span><span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">DATE</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;data import time&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>city<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">20</span>) <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;city&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>age<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">SMALLINT</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;age&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>sex<span style="color:#ff79c6">`</span> TINYINT <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;gender&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>last_visit_date<span style="color:#ff79c6">`</span> DATETIME <span style="color:#ff79c6">REPLACE</span> <span style="color:#ff79c6">DEFAULT</span> <span style="color:#f1fa8c">&#34;1970-01-01 00:00:00&#34;</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;last visit date time&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>cost<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">SUM</span> <span style="color:#ff79c6">DEFAULT</span> <span style="color:#f1fa8c">&#34;0&#34;</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;user total cost&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>max_dwell_time<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">INT</span> <span style="color:#ff79c6">MAX</span> <span style="color:#ff79c6">DEFAULT</span> <span style="color:#f1fa8c">&#34;0&#34;</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;user max dwell time&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>min_dwell_time<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">INT</span> <span style="color:#ff79c6">MIN</span> <span style="color:#ff79c6">DEFAULT</span> <span style="color:#f1fa8c">&#34;99999&#34;</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;user min dwell time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">AGGREGATE</span> <span style="color:#ff79c6">KEY</span>(<span style="color:#ff79c6">`</span>user_id<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span><span style="color:#8be9fd;font-style:italic">date</span><span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>city<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>age<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>sex<span style="color:#ff79c6">`</span>)
</span></span><span style="display:flex;"><span>DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH(<span style="color:#ff79c6">`</span>user_id<span style="color:#ff79c6">`</span>) BUCKETS <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>PROPERTIES (
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;replication_allocation&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;tag.location.default: 1&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>插入数据</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">insert</span> <span style="color:#ff79c6">into</span> example_db.example_tbl_agg1 <span style="color:#ff79c6">values</span>
</span></span><span style="display:flex;"><span>(<span style="color:#bd93f9">10000</span>,<span style="color:#f1fa8c">&#34;2017-10-01&#34;</span>,<span style="color:#f1fa8c">&#34;Beijing&#34;</span>,<span style="color:#bd93f9">20</span>,<span style="color:#bd93f9">0</span>,<span style="color:#f1fa8c">&#34;2017-10-01 06:00:00&#34;</span>,<span style="color:#bd93f9">20</span>,<span style="color:#bd93f9">10</span>,<span style="color:#bd93f9">10</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#bd93f9">10000</span>,<span style="color:#f1fa8c">&#34;2017-10-01&#34;</span>,<span style="color:#f1fa8c">&#34;Beijing&#34;</span>,<span style="color:#bd93f9">20</span>,<span style="color:#bd93f9">0</span>,<span style="color:#f1fa8c">&#34;2017-10-01 07:00:00&#34;</span>,<span style="color:#bd93f9">15</span>,<span style="color:#bd93f9">2</span>,<span style="color:#bd93f9">2</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#bd93f9">10001</span>,<span style="color:#f1fa8c">&#34;2017-10-01&#34;</span>,<span style="color:#f1fa8c">&#34;Beijing&#34;</span>,<span style="color:#bd93f9">30</span>,<span style="color:#bd93f9">1</span>,<span style="color:#f1fa8c">&#34;2017-10-01 17:05:45&#34;</span>,<span style="color:#bd93f9">2</span>,<span style="color:#bd93f9">22</span>,<span style="color:#bd93f9">22</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#bd93f9">10002</span>,<span style="color:#f1fa8c">&#34;2017-10-02&#34;</span>,<span style="color:#f1fa8c">&#34;Shanghai&#34;</span>,<span style="color:#bd93f9">20</span>,<span style="color:#bd93f9">1</span>,<span style="color:#f1fa8c">&#34;2017-10-02 12:59:12&#34;</span>,<span style="color:#bd93f9">200</span>,<span style="color:#bd93f9">5</span>,<span style="color:#bd93f9">5</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#bd93f9">10003</span>,<span style="color:#f1fa8c">&#34;2017-10-02&#34;</span>,<span style="color:#f1fa8c">&#34;Guangzhou&#34;</span>,<span style="color:#bd93f9">32</span>,<span style="color:#bd93f9">0</span>,<span style="color:#f1fa8c">&#34;2017-10-02 11:20:00&#34;</span>,<span style="color:#bd93f9">30</span>,<span style="color:#bd93f9">11</span>,<span style="color:#bd93f9">11</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#bd93f9">10004</span>,<span style="color:#f1fa8c">&#34;2017-10-01&#34;</span>,<span style="color:#f1fa8c">&#34;Shenzhen&#34;</span>,<span style="color:#bd93f9">35</span>,<span style="color:#bd93f9">0</span>,<span style="color:#f1fa8c">&#34;2017-10-01 10:00:15&#34;</span>,<span style="color:#bd93f9">100</span>,<span style="color:#bd93f9">3</span>,<span style="color:#bd93f9">3</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#bd93f9">10004</span>,<span style="color:#f1fa8c">&#34;2017-10-03&#34;</span>,<span style="color:#f1fa8c">&#34;Shenzhen&#34;</span>,<span style="color:#bd93f9">35</span>,<span style="color:#bd93f9">0</span>,<span style="color:#f1fa8c">&#34;2017-10-03 10:20:22&#34;</span>,<span style="color:#bd93f9">11</span>,<span style="color:#bd93f9">6</span>,<span style="color:#bd93f9">6</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>10000</code>的那两条数据，user_id, date, city, age, sex 这几个值都一样，所以被聚合了</p>
<ul>
<li>last_visit_date，被最新的替换了</li>
<li>cost，将两条数据值做了 sum</li>
<li>max_dwell_time，取两条记录最大</li>
<li>min_dwell_time，取两条记录最小</li>
</ul>
<p><code>10004</code> 没有被聚合，因为两条记录有些值不完全一样<br>
这种聚合适合 <strong>多维分析</strong>场景，可以预聚合</p>
<p>主要的聚合类型</p>
<ul>
<li>SUM: Accumulate the values in multiple rows.</li>
<li>REPLACE: The newly imported value will replace the previous value.</li>
<li>MAX: Keep the maximum value.</li>
<li>MIN: Keep the minimum value.</li>
<li>REPLACE_IF_NOT_NULL: Non-null value replacement. Unlike REPLACE, it does not replace null values.</li>
<li>HLL_UNION: Aggregation method for columns of HLL type, using the HyperLogLog algorithm for aggregation.</li>
<li>BITMAP_UNION: Aggregation method for columns of BITMAP type, performing a union aggregation of bitmaps.</li>
</ul>
<p>agg_state</p>
<ul>
<li>具体的类型根据 申明的聚合函数来确定</li>
<li>更像是一个中间结果</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">set</span> enable_agg_state<span style="color:#ff79c6">=</span><span style="color:#ff79c6">true</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> aggstate(
</span></span><span style="display:flex;"><span>    k1 <span style="color:#8be9fd;font-style:italic">int</span> <span style="color:#ff79c6">null</span>,
</span></span><span style="display:flex;"><span>    k2 agg_state <span style="color:#ff79c6">sum</span>(<span style="color:#8be9fd;font-style:italic">int</span>),
</span></span><span style="display:flex;"><span>    k3 agg_state group_concat(string)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">aggregate</span> <span style="color:#ff79c6">key</span> (k1)
</span></span><span style="display:flex;"><span>distributed <span style="color:#ff79c6">BY</span> hash(k1) buckets <span style="color:#bd93f9">3</span>
</span></span><span style="display:flex;"><span>properties(<span style="color:#f1fa8c">&#34;replication_num&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;1&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">insert</span> <span style="color:#ff79c6">into</span> aggstate <span style="color:#ff79c6">values</span>(<span style="color:#bd93f9">1</span>,sum_state(<span style="color:#bd93f9">1</span>),group_concat_state(<span style="color:#f1fa8c">&#39;a&#39;</span>));
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">insert</span> <span style="color:#ff79c6">into</span> aggstate <span style="color:#ff79c6">values</span>(<span style="color:#bd93f9">1</span>,sum_state(<span style="color:#bd93f9">2</span>),group_concat_state(<span style="color:#f1fa8c">&#39;b&#39;</span>));
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">insert</span> <span style="color:#ff79c6">into</span> aggstate <span style="color:#ff79c6">values</span>(<span style="color:#bd93f9">1</span>,sum_state(<span style="color:#bd93f9">3</span>),group_concat_state(<span style="color:#f1fa8c">&#39;c&#39;</span>));
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">insert</span> <span style="color:#ff79c6">into</span> aggstate <span style="color:#ff79c6">values</span>(<span style="color:#bd93f9">2</span>,sum_state(<span style="color:#bd93f9">4</span>),group_concat_state(<span style="color:#f1fa8c">&#39;d&#39;</span>));
</span></span></code></pre></td></tr></table>
</div>
</div><p>此时表的结构</p>
<table>
<thead>
<tr>
<th>k1</th>
<th>k2</th>
<th>k3</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>sum(1,2,3)</td>
<td>group_concat_state(a,b,c)</td>
</tr>
<tr>
<td>2</td>
<td>sum(4)</td>
<td>group_concat_state(d)</td>
</tr>
</tbody>
</table>
<p>查询</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">select</span> sum_merge(k2) <span style="color:#ff79c6">from</span> aggstate;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> sum_merge(k2) <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>            <span style="color:#bd93f9">10</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">select</span> group_concat_merge(k3) <span style="color:#ff79c6">from</span> aggstate;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> group_concat_merge(k3) <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> <span style="color:#ff79c6">c</span>,b,a,d                <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="unique-model">Unique Model</h3>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">IF</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">EXISTS</span> example_db.example_tbl_unique
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">`</span>user_id<span style="color:#ff79c6">`</span> LARGEINT <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;User ID&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">`</span>username<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">VARCHAR</span> (<span style="color:#bd93f9">50</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Username&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">`</span>city<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">VARCHAR</span> (<span style="color:#bd93f9">20</span>) <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;User location city&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">`</span>age<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">SMALLINT</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;User age&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">`</span>sex<span style="color:#ff79c6">`</span> TINYINT <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;User sex&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">`</span>phone<span style="color:#ff79c6">`</span> LARGEINT <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;User phone number&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">`</span>address<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">VARCHAR</span> (<span style="color:#bd93f9">500</span>) <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;User address&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">`</span>register_time<span style="color:#ff79c6">`</span> DATETIME <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;User registration time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">UNIQUE</span> <span style="color:#ff79c6">KEY</span> (<span style="color:#ff79c6">`</span>user_id<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>username<span style="color:#ff79c6">`</span>)
</span></span><span style="display:flex;"><span>DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH(<span style="color:#ff79c6">`</span>user_id<span style="color:#ff79c6">`</span>) BUCKETS <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>PROPERTIES (
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;replication_allocation&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;tag.location.default: 1&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>相当于定义 primary key，多列组成复合主键，重复了就是 替换 <br>
类似于聚合模式的 replace<br>
1.2 之后新增了<strong>Merge on Write</strong>，大概是 LSM 的写墓碑操作，可以优化读性能<br>
比 聚合模式的 <strong>Merge on Read</strong>性能更好</p>
<h3 id="duplicate-model">Duplicate Model</h3>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">IF</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">EXISTS</span> example_db.example_tbl_duplicate
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span><span style="color:#ff79c6">timestamp</span><span style="color:#ff79c6">`</span> DATETIME <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Log time&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span><span style="color:#ff79c6">type</span><span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">INT</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Log type&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>error_code<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">INT</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Error code&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>error_msg<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">1024</span>) <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Error details&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>op_id<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Operator ID&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>op_time<span style="color:#ff79c6">`</span> DATETIME <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Operation time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>DUPLICATE <span style="color:#ff79c6">KEY</span>(<span style="color:#ff79c6">`</span><span style="color:#ff79c6">timestamp</span><span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span><span style="color:#ff79c6">type</span><span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>error_code<span style="color:#ff79c6">`</span>)
</span></span><span style="display:flex;"><span>DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH(<span style="color:#ff79c6">`</span><span style="color:#ff79c6">type</span><span style="color:#ff79c6">`</span>) BUCKETS <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>PROPERTIES (
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;replication_allocation&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;tag.location.default: 1&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>多个 key 重复了不会覆盖，还是相当于多个 row</p>
<h2 id="data-partition">Data Partition</h2>
<p>分区维度划分</p>
<ul>
<li>表 -&gt; 分区 -&gt; tablet</li>
<li>tablet 是最小的物理单元，movement and replication 基于 tablet 操作</li>
<li>partition 是最小 逻辑单元，import, delete 等基于 分区来做</li>
<li>每个分区之间的数据也是不想交的</li>
</ul>
<p>range 分区</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">IF</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">EXISTS</span> example_db.example_range_tbl
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>user_id<span style="color:#ff79c6">`</span> LARGEINT <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;User ID&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span><span style="color:#8be9fd;font-style:italic">date</span><span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">DATE</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Date when the data are imported&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span><span style="color:#ff79c6">timestamp</span><span style="color:#ff79c6">`</span> DATETIME <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Timestamp when the data are imported&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>city<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">20</span>) <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;User location city&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>age<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">SMALLINT</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;User age&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>sex<span style="color:#ff79c6">`</span> TINYINT <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;User gender&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>last_visit_date<span style="color:#ff79c6">`</span> DATETIME <span style="color:#ff79c6">REPLACE</span> <span style="color:#ff79c6">DEFAULT</span> <span style="color:#f1fa8c">&#34;1970-01-01 00:00:00&#34;</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;User last visit time&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>cost<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">SUM</span> <span style="color:#ff79c6">DEFAULT</span> <span style="color:#f1fa8c">&#34;0&#34;</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Total user consumption&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>max_dwell_time<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">INT</span> <span style="color:#ff79c6">MAX</span> <span style="color:#ff79c6">DEFAULT</span> <span style="color:#f1fa8c">&#34;0&#34;</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Maximum user dwell time&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>min_dwell_time<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">INT</span> <span style="color:#ff79c6">MIN</span> <span style="color:#ff79c6">DEFAULT</span> <span style="color:#f1fa8c">&#34;99999&#34;</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Minimum user dwell time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>ENGINE<span style="color:#ff79c6">=</span>olap
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">AGGREGATE</span> <span style="color:#ff79c6">KEY</span>(<span style="color:#ff79c6">`</span>user_id<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span><span style="color:#8be9fd;font-style:italic">date</span><span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span><span style="color:#ff79c6">timestamp</span><span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>city<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>age<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>sex<span style="color:#ff79c6">`</span>)
</span></span><span style="display:flex;"><span>PARTITION <span style="color:#ff79c6">BY</span> RANGE(<span style="color:#ff79c6">`</span><span style="color:#8be9fd;font-style:italic">date</span><span style="color:#ff79c6">`</span>)
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    PARTITION <span style="color:#ff79c6">`</span>p201701<span style="color:#ff79c6">`</span> <span style="color:#ff79c6">VALUES</span> <span style="color:#ff79c6">LESS</span> <span style="color:#ff79c6">THAN</span> (<span style="color:#f1fa8c">&#34;2017-02-01&#34;</span>),
</span></span><span style="display:flex;"><span>    PARTITION <span style="color:#ff79c6">`</span>p201702<span style="color:#ff79c6">`</span> <span style="color:#ff79c6">VALUES</span> <span style="color:#ff79c6">LESS</span> <span style="color:#ff79c6">THAN</span> (<span style="color:#f1fa8c">&#34;2017-03-01&#34;</span>),
</span></span><span style="display:flex;"><span>    PARTITION <span style="color:#ff79c6">`</span>p201703<span style="color:#ff79c6">`</span> <span style="color:#ff79c6">VALUES</span> <span style="color:#ff79c6">LESS</span> <span style="color:#ff79c6">THAN</span> (<span style="color:#f1fa8c">&#34;2017-04-01&#34;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH(<span style="color:#ff79c6">`</span>user_id<span style="color:#ff79c6">`</span>) BUCKETS <span style="color:#bd93f9">16</span>
</span></span><span style="display:flex;"><span>PROPERTIES
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;replication_num&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;3&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;storage_medium&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;SSD&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;storage_cooldown_time&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;2018-01-01 12:00:00&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>list 分区</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">IF</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">EXISTS</span> example_db.example_list_tbl
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>user_id<span style="color:#ff79c6">`</span> LARGEINT <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;User ID&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span><span style="color:#8be9fd;font-style:italic">date</span><span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">DATE</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Date when the data are imported&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span><span style="color:#ff79c6">timestamp</span><span style="color:#ff79c6">`</span> DATETIME <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Timestamp when the data are imported&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>city<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">20</span>) <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;User location city&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>age<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">SMALLINT</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;User Age&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>sex<span style="color:#ff79c6">`</span> TINYINT <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;User gender&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>last_visit_date<span style="color:#ff79c6">`</span> DATETIME <span style="color:#ff79c6">REPLACE</span> <span style="color:#ff79c6">DEFAULT</span> <span style="color:#f1fa8c">&#34;1970-01-01 00:00:00&#34;</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;User last visit time&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>cost<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">SUM</span> <span style="color:#ff79c6">DEFAULT</span> <span style="color:#f1fa8c">&#34;0&#34;</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Total user consumption&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>max_dwell_time<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">INT</span> <span style="color:#ff79c6">MAX</span> <span style="color:#ff79c6">DEFAULT</span> <span style="color:#f1fa8c">&#34;0&#34;</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Maximum user dwell time&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>min_dwell_time<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">INT</span> <span style="color:#ff79c6">MIN</span> <span style="color:#ff79c6">DEFAULT</span> <span style="color:#f1fa8c">&#34;99999&#34;</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Minimum user dwell time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>ENGINE<span style="color:#ff79c6">=</span>olap
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">AGGREGATE</span> <span style="color:#ff79c6">KEY</span>(<span style="color:#ff79c6">`</span>user_id<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span><span style="color:#8be9fd;font-style:italic">date</span><span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span><span style="color:#ff79c6">timestamp</span><span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>city<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>age<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>sex<span style="color:#ff79c6">`</span>)
</span></span><span style="display:flex;"><span>PARTITION <span style="color:#ff79c6">BY</span> LIST(<span style="color:#ff79c6">`</span>city<span style="color:#ff79c6">`</span>)
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    PARTITION <span style="color:#ff79c6">`</span>p_cn<span style="color:#ff79c6">`</span> <span style="color:#ff79c6">VALUES</span> <span style="color:#ff79c6">IN</span> (<span style="color:#f1fa8c">&#34;Beijing&#34;</span>, <span style="color:#f1fa8c">&#34;Shanghai&#34;</span>, <span style="color:#f1fa8c">&#34;Hong Kong&#34;</span>),
</span></span><span style="display:flex;"><span>    PARTITION <span style="color:#ff79c6">`</span>p_usa<span style="color:#ff79c6">`</span> <span style="color:#ff79c6">VALUES</span> <span style="color:#ff79c6">IN</span> (<span style="color:#f1fa8c">&#34;New York&#34;</span>, <span style="color:#f1fa8c">&#34;San Francisco&#34;</span>),
</span></span><span style="display:flex;"><span>    PARTITION <span style="color:#ff79c6">`</span>p_jp<span style="color:#ff79c6">`</span> <span style="color:#ff79c6">VALUES</span> <span style="color:#ff79c6">IN</span> (<span style="color:#f1fa8c">&#34;Tokyo&#34;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH(<span style="color:#ff79c6">`</span>user_id<span style="color:#ff79c6">`</span>) BUCKETS <span style="color:#bd93f9">16</span>
</span></span><span style="display:flex;"><span>PROPERTIES
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;replication_num&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;3&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;storage_medium&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;SSD&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;storage_cooldown_time&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;2018-01-01 12:00:00&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>Bucketing</p>
<ul>
<li>类似于 hive 和 impala 的分桶</li>
<li>基于 hash、或者随机</li>
<li>桶多了适合写，尤其是随机的可以消除数据倾斜；桶少了适合读取</li>
<li>tablet 大小推荐 <code>1G - 10G</code></li>
<li>双层分区就是 分区 + 分桶，单层分区只有一个桶</li>
</ul>
<h3 id="rollup">Rollup</h3>
<p>Rollup</p>
<ul>
<li>Rollup can be seen as a materialized index structure for a Table</li>
<li>materialized in the sense that its data is physically independent in storage</li>
<li>and indexed in the sense that Rollup can reorder columns to increase the hit rate of prefix indexes as well as reduce Key columns to increase the aggregation level of data.</li>
</ul>
<p>概念</p>
<ul>
<li>rollup，相当于 物化索引</li>
<li>查询的时候由 Doris 自动决定，用户无法操作</li>
<li>rollup 是在基表上创建的，对基表的操作也会影响到 rollup</li>
<li>rollup的存储跟 基本是独立的，大量的rollup对 import 有影响，但对查询无影响</li>
<li>查询中的所有列，包括 select 和 where 中的列都必须在 rollup 中出现，否则智能访问基表</li>
<li>对基表的更新会 自动同步更新到 rollup</li>
</ul>
<p>操作</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> table1 <span style="color:#ff79c6">ADD</span> <span style="color:#ff79c6">ROLLUP</span> rollup_city(citycode, pv);
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> <span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">ROLLUP</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">DESC</span> tbl_name <span style="color:#ff79c6">ALL</span>;
</span></span><span style="display:flex;"><span>CANCEL <span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">ROLLUP</span> <span style="color:#ff79c6">FROM</span> table1;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="index">Index</h2>
<p>内置索引，不可选择</p>
<ul>
<li>prefix indexes</li>
<li>ZoneMap indexes</li>
</ul>
<p>prefix index 例子</p>
<table>
<thead>
<tr>
<th>ColumnName</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_id</td>
<td>BIGINT</td>
</tr>
<tr>
<td>age</td>
<td>INT</td>
</tr>
<tr>
<td>message</td>
<td>VARCHAR(100)</td>
</tr>
<tr>
<td>max_dwell_time</td>
<td>DATETIME</td>
</tr>
<tr>
<td>min_dwell_time</td>
<td>DATETIME</td>
</tr>
</tbody>
</table>
<p>使用 36个字节作为 prefix index，user_id(8 Bytes) + age(4 Bytes) + message(prefix 20 Bytes)<br>
message会被截断</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- 有有效
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> <span style="color:#ff79c6">table</span> <span style="color:#ff79c6">WHERE</span> user_id<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1829239</span> <span style="color:#ff79c6">and</span> age<span style="color:#ff79c6">=</span><span style="color:#bd93f9">20</span>；
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- 较差
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> <span style="color:#ff79c6">table</span> <span style="color:#ff79c6">WHERE</span> age<span style="color:#ff79c6">=</span><span style="color:#bd93f9">20</span>；
</span></span></code></pre></td></tr></table>
</div>
</div><p>用户自定义的索引</p>
<ul>
<li>inverted index</li>
<li>bloomfilter index</li>
<li>ngram bloomfilter index</li>
<li>bitmap index</li>
</ul>
<h3 id="inverted-index">Inverted Index</h3>
<p>基本语法</p>
<ul>
<li>parser，包含english、chinese、unicode 等解析方式</li>
<li>parser_mode，fine_grained 细节度解析，会生成更多的 token，coarse_grained</li>
<li>support_phrase，索引是否需要支持短语模式查询MATCH_PHRAS</li>
<li>char_filter，用于预处理阶段</li>
</ul>
<p>一些例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> TOKENIZE(<span style="color:#f1fa8c">&#39;武汉长江大桥&#39;</span>,<span style="color:#f1fa8c">&#39;&#34;parser&#34;=&#34;chinese&#34;,&#34;parser_mode&#34;=&#34;fine_grained&#34;&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------------------------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> tokenize(<span style="color:#f1fa8c">&#39;武汉长江大桥&#39;</span>, <span style="color:#f1fa8c">&#39;&#34;parser&#34;=&#34;chinese&#34;,&#34;parser_mode&#34;=&#34;fine_grained&#34;&#39;</span>)       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------------------------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> [<span style="color:#f1fa8c">&#34;武汉&#34;</span>, <span style="color:#f1fa8c">&#34;武汉长江大桥&#34;</span>, <span style="color:#f1fa8c">&#34;长江&#34;</span>, <span style="color:#f1fa8c">&#34;长江大桥&#34;</span>, <span style="color:#f1fa8c">&#34;大桥&#34;</span>]                              <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------------------------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> TOKENIZE(<span style="color:#f1fa8c">&#39;武汉市长江大桥&#39;</span>,<span style="color:#f1fa8c">&#39;&#34;parser&#34;=&#34;chinese&#34;,&#34;parser_mode&#34;=&#34;coarse_grained&#34;&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----------------------------------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> tokenize(<span style="color:#f1fa8c">&#39;武汉市长江大桥&#39;</span>, <span style="color:#f1fa8c">&#39;&#34;parser&#34;=&#34;chinese&#34;,&#34;parser_mode&#34;=&#34;coarse_grained&#34;&#39;</span>)        <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----------------------------------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> [<span style="color:#f1fa8c">&#34;武汉市&#34;</span>, <span style="color:#f1fa8c">&#34;长江大桥&#34;</span>]                                                                 <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----------------------------------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> TOKENIZE(<span style="color:#f1fa8c">&#39;I love CHINA&#39;</span>,<span style="color:#f1fa8c">&#39;&#34;parser&#34;=&#34;english&#34;&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> tokenize(<span style="color:#f1fa8c">&#39;I love CHINA&#39;</span>, <span style="color:#f1fa8c">&#39;&#34;parser&#34;=&#34;english&#34;&#39;</span>) <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> [<span style="color:#f1fa8c">&#34;i&#34;</span>, <span style="color:#f1fa8c">&#34;love&#34;</span>, <span style="color:#f1fa8c">&#34;china&#34;</span>]                         <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------------------------------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>一个例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">DATABASE</span> test_inverted_index;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>USE test_inverted_index;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- define inverted index idx_comment for comment column on table creation
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">--   USING INVERTED specify using inverted index
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">--   PROPERTIES(&#34;parser&#34; = &#34;english&#34;) specify english word parser
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> hackernews_1m
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>id<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">BIGINT</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>deleted<span style="color:#ff79c6">`</span> TINYINT,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span><span style="color:#ff79c6">type</span><span style="color:#ff79c6">`</span> String,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>author<span style="color:#ff79c6">`</span> String,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span><span style="color:#ff79c6">timestamp</span><span style="color:#ff79c6">`</span> DateTimeV2,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span><span style="color:#ff79c6">comment</span><span style="color:#ff79c6">`</span> String,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>dead<span style="color:#ff79c6">`</span> TINYINT,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>parent<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">BIGINT</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>poll<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">BIGINT</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>children<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">Array</span><span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd;font-style:italic">BIGINT</span><span style="color:#ff79c6">&gt;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>url<span style="color:#ff79c6">`</span> String,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>score<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">INT</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>title<span style="color:#ff79c6">`</span> String,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>parts<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">Array</span><span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd;font-style:italic">INT</span><span style="color:#ff79c6">&gt;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>descendants<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">INT</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">INDEX</span> idx_comment (<span style="color:#ff79c6">`</span><span style="color:#ff79c6">comment</span><span style="color:#ff79c6">`</span>) <span style="color:#ff79c6">USING</span> INVERTED PROPERTIES(<span style="color:#f1fa8c">&#34;parser&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;english&#34;</span>) <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#39;inverted index for comment&#39;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>DUPLICATE <span style="color:#ff79c6">KEY</span>(<span style="color:#ff79c6">`</span>id<span style="color:#ff79c6">`</span>)
</span></span><span style="display:flex;"><span>DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH(<span style="color:#ff79c6">`</span>id<span style="color:#ff79c6">`</span>) BUCKETS <span style="color:#bd93f9">10</span>
</span></span><span style="display:flex;"><span>PROPERTIES (<span style="color:#f1fa8c">&#34;replication_num&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;1&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>查询</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- 普通模糊查询
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">count</span>() <span style="color:#ff79c6">FROM</span> hackernews_1m <span style="color:#ff79c6">WHERE</span> <span style="color:#ff79c6">comment</span> <span style="color:#ff79c6">LIKE</span> <span style="color:#f1fa8c">&#39;%OLAP%&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">count</span>() <span style="color:#ff79c6">FROM</span> hackernews_1m <span style="color:#ff79c6">WHERE</span> <span style="color:#ff79c6">comment</span> <span style="color:#ff79c6">LIKE</span> <span style="color:#f1fa8c">&#39;%OLAP%&#39;</span> <span style="color:#ff79c6">AND</span> <span style="color:#ff79c6">comment</span> <span style="color:#ff79c6">LIKE</span> <span style="color:#f1fa8c">&#39;%OLTP%&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- 使用索引
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">count</span>() <span style="color:#ff79c6">FROM</span> hackernews_1m <span style="color:#ff79c6">WHERE</span> <span style="color:#ff79c6">comment</span> MATCH_ANY <span style="color:#f1fa8c">&#39;OLAP&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">count</span>() <span style="color:#ff79c6">FROM</span> hackernews_1m <span style="color:#ff79c6">WHERE</span> <span style="color:#ff79c6">comment</span> MATCH_ALL <span style="color:#f1fa8c">&#39;OLAP OLTP&#39;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>增加一索引</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">INDEX</span> idx_timestamp <span style="color:#ff79c6">ON</span> hackernews_1m(<span style="color:#ff79c6">timestamp</span>) <span style="color:#ff79c6">USING</span> INVERTED;
</span></span><span style="display:flex;"><span>BUILD <span style="color:#ff79c6">INDEX</span> idx_timestamp <span style="color:#ff79c6">ON</span> hackernews_1m;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> <span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">COLUMN</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> BUILD <span style="color:#ff79c6">INDEX</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">count</span>() <span style="color:#ff79c6">FROM</span> hackernews_1m <span style="color:#ff79c6">WHERE</span> <span style="color:#ff79c6">timestamp</span> <span style="color:#ff79c6">&gt;</span> <span style="color:#f1fa8c">&#39;2007-08-23 04:17:00&#39;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看状态</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> <span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">COLUMN</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> BUILD <span style="color:#ff79c6">INDEX</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="bloomfilter-index">BloomFilter Index</h3>
<p>创建</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">IF</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">EXISTS</span> sale_detail_bloom (
</span></span><span style="display:flex;"><span>    sale_date <span style="color:#8be9fd;font-style:italic">date</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Sales time&#34;</span>,
</span></span><span style="display:flex;"><span>    customer_id <span style="color:#8be9fd;font-style:italic">int</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Customer ID&#34;</span>,
</span></span><span style="display:flex;"><span>    saler_id <span style="color:#8be9fd;font-style:italic">int</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Salesperson&#34;</span>,
</span></span><span style="display:flex;"><span>    sku_id <span style="color:#8be9fd;font-style:italic">int</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Product ID&#34;</span>,
</span></span><span style="display:flex;"><span>    category_id <span style="color:#8be9fd;font-style:italic">int</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Product Category&#34;</span>,
</span></span><span style="display:flex;"><span>    sale_count <span style="color:#8be9fd;font-style:italic">int</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Sales Quantity&#34;</span>,
</span></span><span style="display:flex;"><span>    sale_price <span style="color:#8be9fd;font-style:italic">DECIMAL</span>(<span style="color:#bd93f9">12</span>,<span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;unit price&#34;</span>,
</span></span><span style="display:flex;"><span>    sale_amt <span style="color:#8be9fd;font-style:italic">DECIMAL</span>(<span style="color:#bd93f9">20</span>,<span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;Total sales amount&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>Duplicate <span style="color:#ff79c6">KEY</span>(sale_date, customer_id,saler_id,sku_id,category_id)
</span></span><span style="display:flex;"><span>PARTITION <span style="color:#ff79c6">BY</span> RANGE(sale_date)
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>PARTITION P_202111 <span style="color:#ff79c6">VALUES</span> [(<span style="color:#f1fa8c">&#39;2021-11-01&#39;</span>), (<span style="color:#f1fa8c">&#39;2021-12-01&#39;</span>))
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH(saler_id) BUCKETS <span style="color:#bd93f9">10</span>
</span></span><span style="display:flex;"><span>PROPERTIES (
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;replication_num&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;bloom_filter_columns&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;saler_id,category_id&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;dynamic_partition.enable&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;true&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;dynamic_partition.time_unit&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;MONTH&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;dynamic_partition.time_zone&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;Asia/Shanghai&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;dynamic_partition.start&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;-2147483648&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;dynamic_partition.end&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;2&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;dynamic_partition.prefix&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;P_&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;dynamic_partition.replication_num&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;dynamic_partition.buckets&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;3&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>检查</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- 查看表结构，是否存在
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SHOW</span> <span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">&lt;</span><span style="color:#ff79c6">table_name</span><span style="color:#ff79c6">&gt;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- 删除
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">&lt;</span>db.<span style="color:#ff79c6">table_name</span><span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">SET</span> (<span style="color:#f1fa8c">&#34;bloom_filter_columns&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- 修改
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">&lt;</span>db.<span style="color:#ff79c6">table_name</span><span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">SET</span> (<span style="color:#f1fa8c">&#34;bloom_filter_columns&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;k1,k3&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用场景</p>
<ul>
<li>适合 non-prefix filtering</li>
<li>根据最高频率进行过滤，大多条件都是 <code>=</code> 过滤</li>
<li>bitmap 适合 low-cardinality 的列，如 gender，bloom filter 适合 high cardinality 列，如 UserID</li>
</ul>
<h3 id="ngram-bloomfilter-index">NGram BloomFilter Index</h3>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">`</span>table3<span style="color:#ff79c6">`</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">`</span>siteid<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">int</span>(<span style="color:#bd93f9">11</span>) <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">DEFAULT</span> <span style="color:#f1fa8c">&#34;10&#34;</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">`</span>citycode<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">smallint</span>(<span style="color:#bd93f9">6</span>) <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">`</span>username<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">varchar</span>(<span style="color:#bd93f9">100</span>) <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">DEFAULT</span> <span style="color:#f1fa8c">&#34;&#34;</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">INDEX</span> idx_ngrambf (<span style="color:#ff79c6">`</span>username<span style="color:#ff79c6">`</span>) <span style="color:#ff79c6">USING</span> NGRAM_BF PROPERTIES(<span style="color:#f1fa8c">&#34;gram_size&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;3&#34;</span>, <span style="color:#f1fa8c">&#34;bf_size&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;256&#34;</span>) <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#39;username ngram_bf index&#39;</span>
</span></span><span style="display:flex;"><span>) ENGINE<span style="color:#ff79c6">=</span>OLAP
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">AGGREGATE</span> <span style="color:#ff79c6">KEY</span>(<span style="color:#ff79c6">`</span>siteid<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>citycode<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>username<span style="color:#ff79c6">`</span>) <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;OLAP&#34;</span>
</span></span><span style="display:flex;"><span>DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH(<span style="color:#ff79c6">`</span>siteid<span style="color:#ff79c6">`</span>) BUCKETS <span style="color:#bd93f9">10</span>
</span></span><span style="display:flex;"><span>PROPERTIES (
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;replication_num&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- PROPERTIES(&#34;gram_size&#34;=&#34;3&#34;, &#34;bf_size&#34;=&#34;1024&#34;)，indicate the number of gram and bytes of bloom filter respectively.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">-- the gram size set to same as the like query pattern string length. 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">-- and the suitable bytes of bloom filter can be get by test, more larger more better, 256 maybe is a good start.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Usually, if the data&#39;s cardinality is small, you can increase the bytes of bloom filter to improve the efficiency.
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>检查</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">show</span> <span style="color:#ff79c6">index</span> <span style="color:#ff79c6">from</span> example_db.table3;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">alter</span> <span style="color:#ff79c6">table</span> example_db.table3 <span style="color:#ff79c6">drop</span> <span style="color:#ff79c6">index</span> idx_ngrambf;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">alter</span> <span style="color:#ff79c6">table</span> example_db.table3 <span style="color:#ff79c6">add</span> <span style="color:#ff79c6">index</span> idx_ngrambf(username)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">using</span> NGRAM_BF PROPERTIES(<span style="color:#f1fa8c">&#34;gram_size&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;3&#34;</span>, <span style="color:#f1fa8c">&#34;bf_size&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;512&#34;</span>)<span style="color:#ff79c6">comment</span> <span style="color:#f1fa8c">&#39;username ngram_bf index&#39;</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>NGrams</p>
<ul>
<li>NGram is a contiguous sequence of n items from a given sample of text or speech.</li>
<li>An NGram of size 1 is referred to as a &ldquo;unigram&rdquo;; size 2 is a &ldquo;bigram&rdquo;;</li>
<li>size 3 is a &ldquo;trigram&rdquo;. For example, the word &ldquo;hello&rdquo; can be broken down into the following bigrams: he, el, ll, lo.</li>
</ul>
<p>NGram Bloom Filter Index</p>
<ul>
<li>This is a combination of the two concepts, typically used to index text data.</li>
<li>It uses NGrams to break down the text into searchable parts and then applies a Bloom filter to these NGrams to quickly check for the presence or absence of these NGrams in the index.</li>
</ul>
<h3 id="bitmap-index">Bitmap Index</h3>
<p>操作</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">INDEX</span> <span style="color:#ff79c6">IF</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">EXISTS</span> bitmap_index <span style="color:#ff79c6">ON</span> table3 (siteid) <span style="color:#ff79c6">USING</span> BITMAP <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#39;balabala&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> <span style="color:#ff79c6">INDEX</span> <span style="color:#ff79c6">FROM</span> example_db.<span style="color:#ff79c6">table_name</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">DROP</span> <span style="color:#ff79c6">INDEX</span> [<span style="color:#ff79c6">IF</span> <span style="color:#ff79c6">EXISTS</span>] index_name <span style="color:#ff79c6">ON</span> [db_name.]<span style="color:#ff79c6">table_name</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看状态</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> <span style="color:#ff79c6">INDEX</span> <span style="color:#ff79c6">FROM</span> table3\<span style="color:#ff79c6">G</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">***************************</span> <span style="color:#bd93f9">1</span>. <span style="color:#ff79c6">row</span> <span style="color:#ff79c6">***************************</span>
</span></span><span style="display:flex;"><span>       <span style="color:#ff79c6">Table</span>: default_cluster:test_index.table3
</span></span><span style="display:flex;"><span>  Non_unique: 
</span></span><span style="display:flex;"><span>    Key_name: idx_ngrambf
</span></span><span style="display:flex;"><span>Seq_in_index: 
</span></span><span style="display:flex;"><span> <span style="color:#ff79c6">Column_name</span>: username
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">Collation</span>: 
</span></span><span style="display:flex;"><span> <span style="color:#ff79c6">Cardinality</span>: 
</span></span><span style="display:flex;"><span>    Sub_part: 
</span></span><span style="display:flex;"><span>      Packed: 
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">Null</span>: 
</span></span><span style="display:flex;"><span>  Index_type: NGRAM_BF
</span></span><span style="display:flex;"><span>     <span style="color:#ff79c6">Comment</span>: username ngram_bf <span style="color:#ff79c6">index</span>
</span></span><span style="display:flex;"><span>  Properties: (<span style="color:#f1fa8c">&#34;gram_size&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;3&#34;</span>, <span style="color:#f1fa8c">&#34;bf_size&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;256&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">***************************</span> <span style="color:#bd93f9">2</span>. <span style="color:#ff79c6">row</span> <span style="color:#ff79c6">***************************</span>
</span></span><span style="display:flex;"><span>       <span style="color:#ff79c6">Table</span>: default_cluster:test_index.table3
</span></span><span style="display:flex;"><span>  Non_unique: 
</span></span><span style="display:flex;"><span>    Key_name: bitmap_index
</span></span><span style="display:flex;"><span>Seq_in_index: 
</span></span><span style="display:flex;"><span> <span style="color:#ff79c6">Column_name</span>: siteid
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">Collation</span>: 
</span></span><span style="display:flex;"><span> <span style="color:#ff79c6">Cardinality</span>: 
</span></span><span style="display:flex;"><span>    Sub_part: 
</span></span><span style="display:flex;"><span>      Packed: 
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">Null</span>: 
</span></span><span style="display:flex;"><span>  Index_type: BITMAP
</span></span><span style="display:flex;"><span>     <span style="color:#ff79c6">Comment</span>: balabala
</span></span><span style="display:flex;"><span>  Properties: 
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="basic-use">Basic Use</h2>
<p>冷热数据</p>
<pre tabindex="0"><code>-- 打了:HDD 标签的是冷数据
-- SSD 标签的是热数据
storage_root_path=/home/disk1/doris,medium:HDD;/home/disk2/doris,medium:SSD
</code></pre><p>Broker</p>
<ul>
<li>Broker is deployed as a plug-in, which is independent of Doris.</li>
<li>If you need to import data from a third-party storage system, you need to deploy the corresponding Broker.</li>
<li>By default, Doris provides fs_broker for HDFS reading and object storage (supporting S3 protocol).</li>
<li>fs_broker is stateless and we recommend that you deploy a Broker for each FE and BE node.</li>
</ul>
<p>一些管理操作</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SET</span> PASSWORD <span style="color:#ff79c6">FOR</span> <span style="color:#f1fa8c">&#39;root&#39;</span> <span style="color:#ff79c6">=</span> PASSWORD(<span style="color:#f1fa8c">&#39;your_password&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">USER</span> <span style="color:#f1fa8c">&#39;test&#39;</span> IDENTIFIED <span style="color:#ff79c6">BY</span> <span style="color:#f1fa8c">&#39;test_passwd&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">GRANT</span> <span style="color:#ff79c6">ALL</span> <span style="color:#ff79c6">ON</span> example_db <span style="color:#ff79c6">TO</span> test;
</span></span></code></pre></td></tr></table>
</div>
</div><p>load data</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>curl --location-trusted -u test:test_passwd -H <span style="color:#f1fa8c">&#34;label:table1_20170707&#34;</span> -H <span style="color:#f1fa8c">&#34;column_separator:,&#34;</span> 
</span></span><span style="display:flex;"><span>-T table1_data http://FE_HOST:8030/api/example_db/table1/_stream_load
</span></span></code></pre></td></tr></table>
</div>
</div><p>Broker Load</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">LOAD</span> LABEL table1_20170708
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">DATA</span> INFILE(<span style="color:#f1fa8c">&#34;hdfs://your.namenode.host:port/dir/table1_data&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">INTO</span> <span style="color:#ff79c6">TABLE</span> table1
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WITH</span> BROKER hdfs 
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;username&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;hdfs_user&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;password&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;hdfs_password&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>PROPERTIES
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;timeout&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;3600&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;max_filter_ratio&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.1&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> <span style="color:#ff79c6">LOAD</span> <span style="color:#ff79c6">WHERE</span> LABEL <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;table1_20170708&#34;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>查询变量</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> VARIABLES;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> VARIABLES <span style="color:#ff79c6">LIKE</span> <span style="color:#f1fa8c">&#34;%mem_limit%&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SET</span> exec_mem_limit <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">8589934592</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> VARIABLES <span style="color:#ff79c6">LIKE</span> <span style="color:#f1fa8c">&#34;%query_timeout%&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SET</span> query_timeout <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">60</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="data-operation">Data Operation</h1>
<h2 id="import">Import</h2>
<p>By Scene</p>
<table>
<thead>
<tr>
<th>Data Source</th>
<th>Import Method</th>
</tr>
</thead>
<tbody>
<tr>
<td>Object Storage (s3), HDFS</td>
<td>Import data using Broker</td>
</tr>
<tr>
<td>Local file</td>
<td>Import local data</td>
</tr>
<tr>
<td>Kafka</td>
<td>Subscribe to Kafka data</td>
</tr>
<tr>
<td>Mysql, PostgreSQL, Oracle, SQLServer</td>
<td>Sync data via external table</td>
</tr>
<tr>
<td>Import via JDBC</td>
<td>Sync data using JDBC</td>
</tr>
<tr>
<td>Import JSON format data</td>
<td>JSON format data import</td>
</tr>
</tbody>
</table>
<p>Divided by Import Method</p>
<table>
<thead>
<tr>
<th>Import method name</th>
<th>Use method</th>
</tr>
</thead>
<tbody>
<tr>
<td>Spark Load</td>
<td>Import external data via Spark</td>
</tr>
<tr>
<td>Broker Load</td>
<td>Import external storage data via Broker</td>
</tr>
<tr>
<td>Stream Load</td>
<td>Stream import data (local file and memory data)</td>
</tr>
<tr>
<td>Routine Load</td>
<td>Import Kafka data</td>
</tr>
<tr>
<td>Insert Into</td>
<td>External table imports data through INSERT</td>
</tr>
<tr>
<td>S3 Load</td>
<td>Object storage data import of S3 protocol</td>
</tr>
<tr>
<td>MySql Load</td>
<td>Local data import of MySql protocol</td>
</tr>
</tbody>
</table>
<p>Supported Data Formats</p>
<table>
<thead>
<tr>
<th>Import Methods</th>
<th>Supported Formats</th>
</tr>
</thead>
<tbody>
<tr>
<td>Broker Load</td>
<td>parquet, orc, csv, gzip</td>
</tr>
<tr>
<td>Stream Load</td>
<td>csv, json, parquet, orc</td>
</tr>
<tr>
<td>Routine Load</td>
<td>csv, json</td>
</tr>
<tr>
<td>MySql Load</td>
<td>csv</td>
</tr>
</tbody>
</table>
<p>INSERT 自动有原子保证<br>
通过 <code>Label</code>再配合上游，可以实现精确一致<br>
同步导入，异步导入</p>
<p>导入数组形式，支持向量化</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">LOAD</span> LABEL label_03_14_49_34_898986_19090452100 ( 
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">DATA</span> INFILE(<span style="color:#f1fa8c">&#34;hdfs://test.hdfs.com:9000/user/test/data/sys/load/array_test.data&#34;</span>) 
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">INTO</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">`</span>test_array_table<span style="color:#ff79c6">`</span> 
</span></span><span style="display:flex;"><span>  COLUMNS TERMINATED <span style="color:#ff79c6">BY</span> <span style="color:#f1fa8c">&#34;|&#34;</span> (<span style="color:#ff79c6">`</span>k1<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>a1<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>a2<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>a3<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>a4<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>a5<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>a6<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>a7<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>a8<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>a9<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>a10<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>a11<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>a12<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>a13<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>b14<span style="color:#ff79c6">`</span>) 
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">SET</span>(a14<span style="color:#ff79c6">=</span>array_union(<span style="color:#ff79c6">cast</span>(b14 <span style="color:#ff79c6">as</span> <span style="color:#8be9fd;font-style:italic">array</span><span style="color:#ff79c6">&lt;</span>string<span style="color:#ff79c6">&gt;</span>), <span style="color:#ff79c6">cast</span>(a13 <span style="color:#ff79c6">as</span> <span style="color:#8be9fd;font-style:italic">array</span><span style="color:#ff79c6">&lt;</span>string<span style="color:#ff79c6">&gt;</span>))) <span style="color:#ff79c6">WHERE</span> <span style="color:#ff79c6">size</span>(a2) <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">270</span>) 
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">WITH</span> BROKER <span style="color:#f1fa8c">&#34;hdfs&#34;</span> (<span style="color:#f1fa8c">&#34;username&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;test_array&#34;</span>, <span style="color:#f1fa8c">&#34;password&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;&#34;</span>) 
</span></span><span style="display:flex;"><span>  PROPERTIES( <span style="color:#f1fa8c">&#34;max_filter_ratio&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.8&#34;</span> );
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="import-scenes">Import Scenes</h3>
<p>Stream Load</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>PUT /api/<span style="color:#ff79c6">{</span>db<span style="color:#ff79c6">}</span>/<span style="color:#ff79c6">{</span>table<span style="color:#ff79c6">}</span>/_stream_load
</span></span></code></pre></td></tr></table>
</div>
</div><p>最大不要超过 1G - 2G，超过可以并发批次导入</p>
<p>MySQL load</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">LOAD</span> <span style="color:#ff79c6">DATA</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">LOCAL</span>
</span></span><span style="display:flex;"><span>INFILE <span style="color:#f1fa8c">&#39;/path/to/local/demo.txt&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INTO</span> <span style="color:#ff79c6">TABLE</span> demo.load_local_file_test
</span></span></code></pre></td></tr></table>
</div>
</div><p>从 hdfs 导入</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">LOAD</span> LABEL demo.label_20231212_1
</span></span><span style="display:flex;"><span>    (
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">DATA</span> INFILE(<span style="color:#f1fa8c">&#34;hdfs://1.2.3.4:8020/user/root/haha.txt&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">INTO</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">`</span>load_hdfs_file_test<span style="color:#ff79c6">`</span>
</span></span><span style="display:flex;"><span>    COLUMNS TERMINATED <span style="color:#ff79c6">BY</span> <span style="color:#f1fa8c">&#34;\t&#34;</span>            
</span></span><span style="display:flex;"><span>    (id,age,name)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">with</span> HDFS (
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;fs.defaultFS&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;hdfs://1.2.3.4:8020&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;hdfs_user&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;root&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    PROPERTIES
</span></span><span style="display:flex;"><span>    (
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;timeout&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;1200&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;max_filter_ratio&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.1&#34;</span>
</span></span><span style="display:flex;"><span>    );
</span></span></code></pre></td></tr></table>
</div>
</div><p>检查结果</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">show</span> <span style="color:#ff79c6">load</span> <span style="color:#ff79c6">order</span> <span style="color:#ff79c6">by</span> createtime <span style="color:#ff79c6">desc</span> <span style="color:#ff79c6">limit</span> <span style="color:#bd93f9">1</span>\<span style="color:#ff79c6">G</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>支持 S3 导入</p>
<p>Kafka 导入</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">ROUTINE</span> <span style="color:#ff79c6">LOAD</span> demo.my_first_routine_load_job <span style="color:#ff79c6">ON</span> test_1
</span></span><span style="display:flex;"><span>COLUMNS TERMINATED <span style="color:#ff79c6">BY</span> <span style="color:#f1fa8c">&#34;,&#34;</span>
</span></span><span style="display:flex;"><span>PROPERTIES
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;max_batch_interval&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;20&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;max_batch_rows&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;300000&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;max_batch_size&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;209715200&#34;</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> KAFKA
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;kafka_broker_list&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;broker1:9092,broker2:9092,broker3:9092&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;kafka_topic&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;my_topic&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;property.group.id&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;xxx&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;property.client.id&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;xxx&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;property.kafka_default_offsets&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;OFFSET_BEGINNING&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>支持的外部数据源</p>
<ul>
<li>MySQL</li>
<li>Oracle</li>
<li>PostgreSQL</li>
<li>SQLServer</li>
<li>Hive</li>
<li>Iceberg</li>
<li>ElasticSearch</li>
</ul>
<p>导入</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> <span style="color:#ff79c6">table</span> <span style="color:#ff79c6">SELECT</span> ...
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> <span style="color:#ff79c6">table</span> <span style="color:#ff79c6">VALUES</span>(...)
</span></span></code></pre></td></tr></table>
</div>
</div><p>column conversion</p>
<ul>
<li>Pre-filtering</li>
<li>Mapping, souce (a1,a2,a3) -&gt; dest (a2, a3, a1 * 10)</li>
<li>Convert the column values in the source file and import them into the table</li>
<li>Through the case when function, column conversion is performed conditionally</li>
<li>Convert the null value in the source file to 0 and import it. At the same time, the region id conversion in Example 2 is also performed.</li>
</ul>
<p>Data Quality</p>
<ul>
<li>Filtered Rows，会碰到数据格式，类型不匹配，长度阶段等错误</li>
<li>Unselected Rows</li>
<li>Loaded Rows</li>
<li>Strict Mode</li>
</ul>
<p>import methods</p>
<ul>
<li>broker load</li>
<li>stream load</li>
<li>routine load</li>
<li>INSERT</li>
</ul>
<h3 id="import-way">Import Way</h3>
<h4 id="broker-load">Broker Load</h4>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>				 <span style="color:#ff79c6">+</span>
</span></span><span style="display:flex;"><span>                 <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1</span>. <span style="color:#ff79c6">user</span> <span style="color:#ff79c6">create</span> broker <span style="color:#ff79c6">load</span>
</span></span><span style="display:flex;"><span>                 v
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">+</span><span style="color:#6272a4">----+----+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>            <span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">|</span>   FE    <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">+</span><span style="color:#6272a4">----+----+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>                 <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>                 <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2</span>. BE etl <span style="color:#ff79c6">and</span> <span style="color:#ff79c6">load</span> the <span style="color:#ff79c6">data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">+</span><span style="color:#6272a4">--------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">|</span>            <span style="color:#ff79c6">|</span>             <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---v---+     +--v----+    +---v---+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>     <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>    <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>  BE   <span style="color:#ff79c6">|</span>     <span style="color:#ff79c6">|</span>  BE   <span style="color:#ff79c6">|</span>    <span style="color:#ff79c6">|</span>   BE  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>     <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>    <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---+-^-+     +---+-^-+    +--+-^--+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span>           <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span>           <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">3</span>. pull <span style="color:#ff79c6">data</span> <span style="color:#ff79c6">from</span> broker
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---v-+-+     +---v-+-+    +--v-+--+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>     <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>    <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>Broker <span style="color:#ff79c6">|</span>     <span style="color:#ff79c6">|</span>Broker <span style="color:#ff79c6">|</span>    <span style="color:#ff79c6">|</span>Broker <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>     <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>    <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---+-^-+     +---+-^-+    +---+-^-+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span>           <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span>          <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---v-+-----------v-+----------v-+-+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>       HDFS<span style="color:#ff79c6">/</span>BOS<span style="color:#ff79c6">/</span>AFS <span style="color:#ff79c6">cluster</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                                  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----------------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>load hive table, use ORC</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">LOAD</span> LABEL dish_2022_03_23
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">DATA</span> INFILE(<span style="color:#f1fa8c">&#34;hdfs://10.220.147.151:8020/user/hive/warehouse/ods.db/ods_demo_orc_detail/*/*&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">INTO</span> <span style="color:#ff79c6">TABLE</span> doris_ods_test_detail
</span></span><span style="display:flex;"><span>    COLUMNS TERMINATED <span style="color:#ff79c6">BY</span> <span style="color:#f1fa8c">&#34;,&#34;</span>
</span></span><span style="display:flex;"><span>    FORMAT <span style="color:#ff79c6">AS</span> <span style="color:#f1fa8c">&#34;orc&#34;</span>
</span></span><span style="display:flex;"><span>(id,store_id,company_id,tower_id,commodity_id,commodity_name,commodity_price,member_price,cost_price,unit,quantity,actual_price)
</span></span><span style="display:flex;"><span>    COLUMNS <span style="color:#ff79c6">FROM</span> PATH <span style="color:#ff79c6">AS</span> (<span style="color:#ff79c6">`</span><span style="color:#ff79c6">day</span><span style="color:#ff79c6">`</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">SET</span>
</span></span><span style="display:flex;"><span>   (rq <span style="color:#ff79c6">=</span> str_to_date(<span style="color:#ff79c6">`</span><span style="color:#ff79c6">day</span><span style="color:#ff79c6">`</span>,<span style="color:#f1fa8c">&#39;%Y-%m-%d&#39;</span>),id<span style="color:#ff79c6">=</span>id,store_id<span style="color:#ff79c6">=</span>store_id,company_id<span style="color:#ff79c6">=</span>company_id,tower_id<span style="color:#ff79c6">=</span>tower_id,commodity_id<span style="color:#ff79c6">=</span>commodity_id,
</span></span><span style="display:flex;"><span>   commodity_name<span style="color:#ff79c6">=</span>commodity_name,commodity_price<span style="color:#ff79c6">=</span>commodity_price,member_price <span style="color:#ff79c6">=</span>member_price,cost_price<span style="color:#ff79c6">=</span>cost_price,unit<span style="color:#ff79c6">=</span>unit,
</span></span><span style="display:flex;"><span>   quantity<span style="color:#ff79c6">=</span>quantity,actual_price<span style="color:#ff79c6">=</span>actual_price)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WITH</span> BROKER <span style="color:#f1fa8c">&#34;broker_name_1&#34;</span>
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;username&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;hdfs&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;password&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>PROPERTIES
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;timeout&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;1200&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;max_filter_ratio&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.1&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>检查</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">show</span> <span style="color:#ff79c6">load</span> <span style="color:#ff79c6">order</span> <span style="color:#ff79c6">by</span> createtime <span style="color:#ff79c6">desc</span> <span style="color:#ff79c6">limit</span> <span style="color:#bd93f9">1</span>\<span style="color:#ff79c6">G</span>;
</span></span><span style="display:flex;"><span>CANCEL <span style="color:#ff79c6">LOAD</span> <span style="color:#ff79c6">FROM</span> demo <span style="color:#ff79c6">WHERE</span> LABEL <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;broker_load_2022_03_23&#34;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>fe.conf</p>
<ul>
<li>min_bytes_per_broker_scanner</li>
<li>max_bytes_per_broker_scanner</li>
<li>max_broker_concurrency</li>
</ul>
<h4 id="routine-load">Routine Load</h4>
<p>FE 会将 JobScheduler 分解</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>         <span style="color:#ff79c6">+</span><span style="color:#6272a4">---------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>         <span style="color:#ff79c6">|</span>  Client <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>         <span style="color:#ff79c6">+</span><span style="color:#6272a4">----+----+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>              <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> FE          <span style="color:#ff79c6">|</span>               <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> <span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------v------------+  |
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span>                        <span style="color:#ff79c6">|</span>  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">Routine</span> <span style="color:#ff79c6">Load</span> Job     <span style="color:#ff79c6">|</span>  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span>                        <span style="color:#ff79c6">|</span>  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> <span style="color:#ff79c6">+</span><span style="color:#6272a4">---+--------+--------+--+  |
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>     <span style="color:#ff79c6">|</span>        <span style="color:#ff79c6">|</span>        <span style="color:#ff79c6">|</span>     <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> <span style="color:#ff79c6">+</span><span style="color:#6272a4">---v--+ +---v--+ +---v--+  |
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span> task <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span> task <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span> task <span style="color:#ff79c6">|</span>  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> <span style="color:#ff79c6">+</span><span style="color:#6272a4">--+---+ +---+--+ +---+--+  |
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>    <span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span>        <span style="color:#ff79c6">|</span>     <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>     <span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span>        <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>     v         v        v
</span></span><span style="display:flex;"><span> <span style="color:#ff79c6">+</span><span style="color:#6272a4">---+--+   +--+---+   ++-----+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span> <span style="color:#ff79c6">|</span>  BE  <span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>  BE  <span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>  BE  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff79c6">+</span><span style="color:#6272a4">------+   +------+   +------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>kafka 导入</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">ROUTINE</span> <span style="color:#ff79c6">LOAD</span> example_db.test1 <span style="color:#ff79c6">ON</span> example_tbl
</span></span><span style="display:flex;"><span>COLUMNS(k1, k2, k3, v1, v2, v3 <span style="color:#ff79c6">=</span> k1 <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">100</span>),
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> k1 <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">100</span> <span style="color:#ff79c6">and</span> k2 <span style="color:#ff79c6">like</span> <span style="color:#f1fa8c">&#34;%doris%&#34;</span>
</span></span><span style="display:flex;"><span>PROPERTIES
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;desired_concurrent_number&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;3&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;max_batch_interval&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;20&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;max_batch_rows&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;300000&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;max_batch_size&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;209715200&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;strict_mode&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> KAFKA
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;kafka_broker_list&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;broker1:9092,broker2:9092,broker3:9092&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;kafka_topic&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;my_topic&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;kafka_partitions&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;0,1,2,3&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;kafka_offsets&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;101,0,0,200&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>支持 SSL</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> FILE <span style="color:#f1fa8c">&#34;ca.pem&#34;</span> PROPERTIES(<span style="color:#f1fa8c">&#34;url&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;https://example_url/kafka-key/ca.pem&#34;</span>, <span style="color:#f1fa8c">&#34;catalog&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;kafka&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> FILE <span style="color:#f1fa8c">&#34;client.key&#34;</span> PROPERTIES(<span style="color:#f1fa8c">&#34;url&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;https://example_urlkafka-key/client.key&#34;</span>, <span style="color:#f1fa8c">&#34;catalog&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;kafka&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> FILE <span style="color:#f1fa8c">&#34;client.pem&#34;</span> PROPERTIES(<span style="color:#f1fa8c">&#34;url&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;https://example_url/kafka-key/client.pem&#34;</span>, <span style="color:#f1fa8c">&#34;catalog&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;kafka&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">ROUTINE</span> <span style="color:#ff79c6">LOAD</span> db1.job1 <span style="color:#ff79c6">on</span> tbl1
</span></span><span style="display:flex;"><span>PROPERTIES
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;desired_concurrent_number&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> KAFKA
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;kafka_broker_list&#34;</span><span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;broker1:9091,broker2:9091&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;kafka_topic&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;my_topic&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;property.security.protocol&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;ssl&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;property.ssl.ca.location&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;FILE:ca.pem&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;property.ssl.certificate.location&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;FILE:client.pem&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;property.ssl.key.location&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;FILE:client.key&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;property.ssl.key.password&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;abcdefg&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>支持 kerberos</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">ROUTINE</span> <span style="color:#ff79c6">LOAD</span> db1.job1 <span style="color:#ff79c6">on</span> tbl1
</span></span><span style="display:flex;"><span>PROPERTIES (
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;desired_concurrent_number&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> KAFKA
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;kafka_broker_list&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;broker1:9092,broker2:9092&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;kafka_topic&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;my_topic&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;property.security.protocol&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;SASL_PLAINTEXT&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;property.sasl.kerberos.service.name&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;kafka&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;property.sasl.kerberos.keytab&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;/etc/krb5.keytab&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;property.sasl.kerberos.principal&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;doris@YOUR.COM&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>一些配置</p>
<ul>
<li>max_routine_load_task_concurrent_num</li>
<li>max_routine_load_task_num_per_be</li>
<li>max_routine_load_job_num</li>
<li>max_consumer_num_per_group</li>
<li>max_tolerable_backend_down_num</li>
<li>period_of_auto_resume_min</li>
</ul>
<h4 id="spark-load">Spark Load</h4>
<p>用额外的集群来实现排序，聚会写入 
stream load, brokder load 更适合小量数据，这两个会影响到 doris集群资源，而spark load 使用的是spark集群资源 
spark load 更适合大数据量导入 
执行过程</p>
<ul>
<li>Fe schedules and submits ETL tasks to spark cluster for execution.</li>
<li>Spark cluster executes ETL to complete the preprocessing of load data. It includes global dictionary building (bitmap type), partitioning, sorting, aggregation, etc.</li>
<li>After the ETL task is completed, Fe obtains the data path of each partition that has been preprocessed, and schedules the related be to execute the push task.</li>
<li>Be reads data through broker and converts it into Doris underlying storage format.</li>
<li>Fe schedule the effective version and complete the load job.</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>                 <span style="color:#ff79c6">+</span>
</span></span><span style="display:flex;"><span>                 <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">0</span>. <span style="color:#ff79c6">User</span> <span style="color:#ff79c6">create</span> spark <span style="color:#ff79c6">load</span> job
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">+</span><span style="color:#6272a4">----v----+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>            <span style="color:#ff79c6">|</span>   FE    <span style="color:#ff79c6">|</span><span style="color:#6272a4">---------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>            <span style="color:#ff79c6">+</span><span style="color:#6272a4">----+----+                                 |
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>                 <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">3</span>. FE send push tasks                <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>                 <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">5</span>. FE publish <span style="color:#ff79c6">version</span>                <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">+</span><span style="color:#6272a4">------------+------------+                         |
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">|</span>            <span style="color:#ff79c6">|</span>            <span style="color:#ff79c6">|</span>                         <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---v---+    +---v---+    +---v---+                     |
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>  BE   <span style="color:#ff79c6">|</span>    <span style="color:#ff79c6">|</span>  BE   <span style="color:#ff79c6">|</span>    <span style="color:#ff79c6">|</span>  BE   <span style="color:#ff79c6">|</span>                     <span style="color:#ff79c6">|</span><span style="color:#bd93f9">1</span>. FE submit Spark ETL job
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---^---+    +---^---+    +---^---+                     |
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">|</span><span style="color:#bd93f9">4</span>. BE push <span style="color:#ff79c6">with</span> broker   <span style="color:#ff79c6">|</span>                         <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---+---+    +---+---+    +---+---+                     |
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>Broker <span style="color:#ff79c6">|</span>    <span style="color:#ff79c6">|</span>Broker <span style="color:#ff79c6">|</span>    <span style="color:#ff79c6">|</span>Broker <span style="color:#ff79c6">|</span>                     <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---^---+    +---^---+    +---^---+                     |
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">|</span>            <span style="color:#ff79c6">|</span>            <span style="color:#ff79c6">|</span>                         <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---+------------+------------+---+ 2.ETL +-------------v---------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>               HDFS              <span style="color:#ff79c6">+</span><span style="color:#6272a4">-------&gt;       Spark cluster         |
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>                                 <span style="color:#ff79c6">&lt;</span><span style="color:#6272a4">-------+                             |
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---------------------------------+       +-----------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>创建外部资源</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- yarn cluster mode
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">EXTERNAL</span> RESOURCE <span style="color:#f1fa8c">&#34;spark0&#34;</span>
</span></span><span style="display:flex;"><span>PROPERTIES
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;type&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;spark&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.master&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;yarn&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.submit.deployMode&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;cluster&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.jars&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;xxx.jar,yyy.jar&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.files&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;/tmp/aaa,/tmp/bbb&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.executor.memory&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;1g&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.yarn.queue&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;queue0&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.hadoop.yarn.resourcemanager.address&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;127.0.0.1:9999&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.hadoop.fs.defaultFS&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;hdfs://127.0.0.1:10000&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;working_dir&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;hdfs://127.0.0.1:10000/tmp/doris&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;broker&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;broker0&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;broker.username&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;user0&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;broker.password&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;password0&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- spark standalone client mode
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">EXTERNAL</span> RESOURCE <span style="color:#f1fa8c">&#34;spark1&#34;</span>
</span></span><span style="display:flex;"><span>PROPERTIES
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;type&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;spark&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.master&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;spark://127.0.0.1:7777&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.submit.deployMode&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;client&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;working_dir&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;hdfs://127.0.0.1:10000/tmp/doris&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;broker&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;broker1&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- yarn HA mode
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">EXTERNAL</span> RESOURCE sparkHA
</span></span><span style="display:flex;"><span>PROPERTIES
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;type&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;spark&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.master&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;yarn&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.submit.deployMode&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;cluster&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.executor.memory&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;1g&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.yarn.queue&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;default&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.hadoop.yarn.resourcemanager.ha.enabled&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;true&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.hadoop.yarn.resourcemanager.ha.rm-ids&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;rm1,rm2&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.hadoop.yarn.resourcemanager.address.rm1&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;xxxx:8032&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.hadoop.yarn.resourcemanager.address.rm2&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;xxxx:8032&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.hadoop.fs.defaultFS&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;hdfs://nameservices01&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.hadoop.dfs.nameservices&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;nameservices01&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.hadoop.dfs.ha.namenodes.nameservices01&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;mynamenode1,mynamenode2&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.hadoop.dfs.namenode.rpc-address.nameservices01.mynamenode1&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;xxxx:8020&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.hadoop.dfs.namenode.rpc-address.nameservices01.mynamenode2&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;xxxx:8020&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.hadoop.dfs.client.failover.proxy.provider&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;working_dir&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;hdfs://nameservices01/doris_prd_data/sinan/spark_load/&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;broker&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;broker_name&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;broker.username&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;username&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;broker.password&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;broker.dfs.nameservices&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;nameservices01&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;broker.dfs.ha.namenodes.nameservices01&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;mynamenode1, mynamenode2&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;broker.dfs.namenode.rpc-address.nameservices01.mynamenode1&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;xxxx:8020&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;broker.dfs.namenode.rpc-address.nameservices01.mynamenode2&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;xxxx:8020&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;broker.dfs.client.failover.proxy.provider&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>其他相关命令</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- drop spark resource
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">DROP</span> RESOURCE resource_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- show resources
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SHOW</span> RESOURCES
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> PROC <span style="color:#f1fa8c">&#34;/resources&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- privileges
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">GRANT</span> USAGE_PRIV <span style="color:#ff79c6">ON</span> RESOURCE resource_name <span style="color:#ff79c6">TO</span> user_identity
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">GRANT</span> USAGE_PRIV <span style="color:#ff79c6">ON</span> RESOURCE resource_name <span style="color:#ff79c6">TO</span> <span style="color:#ff79c6">ROLE</span> role_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">REVOKE</span> USAGE_PRIV <span style="color:#ff79c6">ON</span> RESOURCE resource_name <span style="color:#ff79c6">FROM</span> user_identity
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">REVOKE</span> USAGE_PRIV <span style="color:#ff79c6">ON</span> RESOURCE resource_name <span style="color:#ff79c6">FROM</span> <span style="color:#ff79c6">ROLE</span> role_name
</span></span></code></pre></td></tr></table>
</div>
</div><p>支持 kerberos</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">EXTERNAL</span> RESOURCE <span style="color:#f1fa8c">&#34;spark_on_kerberos&#34;</span>
</span></span><span style="display:flex;"><span>PROPERTIES
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;type&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;spark&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.master&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;yarn&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.submit.deployMode&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;cluster&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.jars&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;xxx.jar,yyy.jar&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.files&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;/tmp/aaa,/tmp/bbb&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.executor.memory&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;1g&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.yarn.queue&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;queue0&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.hadoop.yarn.resourcemanager.address&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;127.0.0.1:9999&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.hadoop.fs.defaultFS&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;hdfs://127.0.0.1:10000&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.hadoop.hadoop.security.authentication&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;kerberos&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.hadoop.yarn.resourcemanager.principal&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;doris@YOUR.YARN.COM&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;spark.hadoop.yarn.resourcemanager.keytab&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;/home/doris/yarn.keytab&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;working_dir&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;hdfs://127.0.0.1:10000/tmp/doris&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;broker&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;broker0&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;broker.hadoop.security.authentication&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;kerberos&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;broker.kerberos_principal&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;doris@YOUR.COM&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;broker.kerberos_keytab&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;/home/doris/my.keytab&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="stream-load">Stream Load</h4>
<p>处理过程，fe 会将 http请求转发给 be，客户端也可以直接访问 be</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>                         <span style="color:#ff79c6">^</span>      <span style="color:#ff79c6">+</span>
</span></span><span style="display:flex;"><span>                         <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>                         <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1</span>A. <span style="color:#ff79c6">User</span> submit <span style="color:#ff79c6">load</span> <span style="color:#ff79c6">to</span> FE
</span></span><span style="display:flex;"><span>                         <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>                         <span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">+</span><span style="color:#6272a4">--v-----------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>                         <span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span> FE           <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">5</span>. <span style="color:#ff79c6">Return</span> <span style="color:#ff79c6">result</span> <span style="color:#ff79c6">to</span> <span style="color:#ff79c6">user</span> <span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">+</span><span style="color:#6272a4">--+-----------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>                         <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>                         <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2</span>. Redirect <span style="color:#ff79c6">to</span> BE
</span></span><span style="display:flex;"><span>                         <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>                         <span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">+</span><span style="color:#6272a4">--v-----------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>                         <span style="color:#ff79c6">+</span><span style="color:#6272a4">---+Coordinator BE| 1B. User submit load to BE
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>                             <span style="color:#ff79c6">+-+</span><span style="color:#6272a4">-----+----+-+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>                               <span style="color:#ff79c6">|</span>     <span style="color:#ff79c6">|</span>    <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>                         <span style="color:#ff79c6">+</span><span style="color:#6272a4">-----+     |    +-----+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>                         <span style="color:#ff79c6">|</span>           <span style="color:#ff79c6">|</span>          <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">3</span>. Distrbute <span style="color:#ff79c6">data</span>
</span></span><span style="display:flex;"><span>                         <span style="color:#ff79c6">|</span>           <span style="color:#ff79c6">|</span>          <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>                       <span style="color:#ff79c6">+-</span>v<span style="color:#ff79c6">-+</span>       <span style="color:#ff79c6">+-</span>v<span style="color:#ff79c6">-+</span>      <span style="color:#ff79c6">+-</span>v<span style="color:#ff79c6">-+</span>
</span></span><span style="display:flex;"><span>                       <span style="color:#ff79c6">|</span>BE <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>BE <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span>BE <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>                       <span style="color:#ff79c6">+</span><span style="color:#6272a4">---+       +---+      +---+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>一个例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>curl --location-trusted -u root -T date -H <span style="color:#f1fa8c">&#34;label:123&#34;</span> http://abc.com:8030/api/test/date/_stream_load
</span></span></code></pre></td></tr></table>
</div>
</div><p>导入时的一些重要参数，这些参数放入到 http header 中</p>
<ul>
<li>label，唯一标识用的，防止重复导入</li>
<li>column_separator</li>
<li>line_delimiter</li>
<li>max_filter_ratio</li>
<li>where</li>
<li>partitions</li>
<li>columns</li>
<li>format，包括：csv, json</li>
<li>exec_mem_limit，默认为 2G</li>
<li>merge_type。类型：APPEND, DELETE, and MERGE. APPEND is the default</li>
<li>two_phase_commit</li>
<li>enclose</li>
<li>escape</li>
<li>enable_profile</li>
<li>memtable_on_sink_node</li>
<li>partial_columns</li>
</ul>
<p>一个例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>curl <span style="color:#6272a4">--location-trusted -u user:passwd -H &#34;two_phase_commit:true&#34; -T test.txt http://fe_host:http_port/api/{db}/{table}/_stream_load
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>{<span style="color:#f1fa8c">&#34;TxnId&#34;</span>: <span style="color:#bd93f9">18036</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;Label&#34;</span>: <span style="color:#f1fa8c">&#34;55c8ffc9-1c40-4d51-b75e-f2265b3602ef&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;TwoPhaseCommit&#34;</span>: <span style="color:#f1fa8c">&#34;true&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;Status&#34;</span>: <span style="color:#f1fa8c">&#34;Success&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;Message&#34;</span>: <span style="color:#f1fa8c">&#34;OK&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;NumberTotalRows&#34;</span>: <span style="color:#bd93f9">100</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;NumberLoadedRows&#34;</span>: <span style="color:#bd93f9">100</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;NumberFilteredRows&#34;</span>: <span style="color:#bd93f9">0</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;NumberUnselectedRows&#34;</span>: <span style="color:#bd93f9">0</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;LoadBytes&#34;</span>: <span style="color:#bd93f9">1031</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;LoadTimeMs&#34;</span>: <span style="color:#bd93f9">77</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;BeginTxnTimeMs&#34;</span>: <span style="color:#bd93f9">1</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;StreamLoadPutTimeMs&#34;</span>: <span style="color:#bd93f9">1</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;ReadDataTimeMs&#34;</span>: <span style="color:#bd93f9">0</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;WriteDataTimeMs&#34;</span>: <span style="color:#bd93f9">58</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;CommitAndPublishTimeMs&#34;</span>: <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>}<span style="color:#ff79c6">```</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>导入语句中可以加入 <span style="color:#ff79c6">SQL</span>，例子
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">```</span>shell
</span></span><span style="display:flex;"><span>curl <span style="color:#6272a4">--location-trusted -u root: -T test.csv 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">-</span>H <span style="color:#f1fa8c">&#34;sql:insert into demo.example_tbl_1(user_id, age, cost) select c1, c4, c7 * 2 from http_stream(&#34;</span>format<span style="color:#f1fa8c">&#34; = &#34;</span>CSV<span style="color:#f1fa8c">&#34;, 
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;</span>column_separator<span style="color:#f1fa8c">&#34; = &#34;</span>,<span style="color:#f1fa8c">&#34; ) where age &gt;= 30&#34;</span> http:<span style="color:#ff79c6">//</span><span style="color:#bd93f9">127</span>.<span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">1</span>:<span style="color:#bd93f9">28030</span><span style="color:#ff79c6">/</span>api<span style="color:#ff79c6">/</span>_http_stream
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="mysql-load">MySql Load</h4>
<p>使用原生的 MySQL语法 
执行步骤</p>
<ul>
<li>FE receives the MySQL Load request executed by the client and then analyse the SQL</li>
<li>FE build the MySql Load request as a StreamLoad request.</li>
<li>FE selects a BE node to send a StreamLoad request</li>
<li>When sending the request, FE will read the local file data from the MySQL client side streamingly, and send it to the HTTP request of StreamLoad asynchronously.</li>
<li>After the data transfer on the MySQL client side is completed, FE waits for the StreamLoad to complete, and displays the import success or failure information to the client side.</li>
</ul>
<p>例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- 建表
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> testdb.t1 (pk <span style="color:#8be9fd;font-style:italic">INT</span>, v1 <span style="color:#8be9fd;font-style:italic">INT</span> <span style="color:#ff79c6">SUM</span>) <span style="color:#ff79c6">AGGREGATE</span> <span style="color:#ff79c6">KEY</span> (pk) DISTRIBUTED <span style="color:#ff79c6">BY</span> hash (pk) PROPERTIES (<span style="color:#f1fa8c">&#39;replication_num&#39;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;1&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- import file from client node
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">LOAD</span> <span style="color:#ff79c6">DATA</span> <span style="color:#ff79c6">LOCAL</span>
</span></span><span style="display:flex;"><span>INFILE <span style="color:#f1fa8c">&#39;client_local.csv &#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INTO</span> <span style="color:#ff79c6">TABLE</span> testdb.t1
</span></span><span style="display:flex;"><span>PARTITION (partition_a, partition_b, partition_c, partition_d)
</span></span><span style="display:flex;"><span>COLUMNS TERMINATED <span style="color:#ff79c6">BY</span> <span style="color:#f1fa8c">&#39;\ t&#39;</span>
</span></span><span style="display:flex;"><span>LINES TERMINATED <span style="color:#ff79c6">BY</span> <span style="color:#f1fa8c">&#39;\ n&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">IGNORE</span> <span style="color:#bd93f9">1</span> LINES
</span></span><span style="display:flex;"><span>(K1, k2, v2, v10, v11)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SET</span> (c1 <span style="color:#ff79c6">=</span> k1, c2 <span style="color:#ff79c6">=</span> k2, c3 <span style="color:#ff79c6">=</span> v10, c4 <span style="color:#ff79c6">=</span> v11)
</span></span><span style="display:flex;"><span>PROPERTIES (<span style="color:#f1fa8c">&#34;strict_mode&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;true&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- import file from fe server node
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">LOAD</span> <span style="color:#ff79c6">DATA</span>
</span></span><span style="display:flex;"><span>INFILE <span style="color:#f1fa8c">&#39;/root/server_local.csv&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INTO</span> <span style="color:#ff79c6">TABLE</span> testdb.t1
</span></span><span style="display:flex;"><span>PARTITION (partition_a, partition_b, partition_c, partition_d)
</span></span><span style="display:flex;"><span>COLUMNS TERMINATED <span style="color:#ff79c6">BY</span> <span style="color:#f1fa8c">&#39;\ t&#39;</span>
</span></span><span style="display:flex;"><span>LINES TERMINATED <span style="color:#ff79c6">BY</span> <span style="color:#f1fa8c">&#39;\ n&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">IGNORE</span> <span style="color:#bd93f9">1</span> LINES
</span></span><span style="display:flex;"><span>(K1, k2, v2, v10, v11)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SET</span> (c1 <span style="color:#ff79c6">=</span> k1, c2 <span style="color:#ff79c6">=</span> k2, c3 <span style="color:#ff79c6">=</span> v10, c4 <span style="color:#ff79c6">=</span> v11)
</span></span><span style="display:flex;"><span>PROPERTIES (<span style="color:#f1fa8c">&#34;strict_mode&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;true&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>相关配置</p>
<ul>
<li>mysql_load_thread_pool</li>
<li>mysql_load_server_secure_path</li>
<li>mysql_load_in_memory_record</li>
</ul>
<h4 id="s3-load">S3 Load</h4>
<p>例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">LOAD</span> LABEL example_db.exmpale_label_1
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">DATA</span> INFILE(<span style="color:#f1fa8c">&#34;s3://your_bucket_name/your_file.txt&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INTO</span> <span style="color:#ff79c6">TABLE</span> load_test
</span></span><span style="display:flex;"><span>COLUMNS TERMINATED <span style="color:#ff79c6">BY</span> <span style="color:#f1fa8c">&#34;,&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WITH</span> S3
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;AWS_ENDPOINT&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;AWS_ENDPOINT&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;AWS_ACCESS_KEY&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;AWS_ACCESS_KEY&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;AWS_SECRET_KEY&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;AWS_SECRET_KEY&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;AWS_REGION&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;AWS_REGION&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>PROPERTIES
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;timeout&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;3600&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="insert-into">Insert Into</h4>
<p>两种形式</p>
<ul>
<li>INSERT INTO tbl SELECT &hellip;</li>
<li>INSERT INTO tbl (col1, col2, &hellip;) VALUES (1, 2, &hellip;), (1,3, &hellip;);</li>
</ul>
<p>例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> tbl2 <span style="color:#ff79c6">WITH</span> LABEL label1 <span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> tbl3;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> tbl1 <span style="color:#ff79c6">VALUES</span> (<span style="color:#f1fa8c">&#34;qweasdzxcqweasdzxc&#34;</span>), (<span style="color:#f1fa8c">&#34;a&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>insert select</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> tbl1 <span style="color:#ff79c6">WITH</span> LABEL label1
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WITH</span> cte1 <span style="color:#ff79c6">AS</span> (<span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> tbl1), cte2 <span style="color:#ff79c6">AS</span> (<span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> tbl2)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> k1 <span style="color:#ff79c6">FROM</span> cte1 <span style="color:#ff79c6">JOIN</span> cte2 <span style="color:#ff79c6">WHERE</span> cte1.k1 <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> tbl1 (k1)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WITH</span> cte1 <span style="color:#ff79c6">AS</span> (<span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> tbl1), cte2 <span style="color:#ff79c6">AS</span> (<span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> tbl2)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> k1 <span style="color:#ff79c6">FROM</span> cte1 <span style="color:#ff79c6">JOIN</span> cte2 <span style="color:#ff79c6">WHERE</span> cte1.k1 <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> tbl1 (k1)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">select</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> (
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WITH</span> cte1 <span style="color:#ff79c6">AS</span> (<span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> tbl1), cte2 <span style="color:#ff79c6">AS</span> (<span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> tbl2)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> k1 <span style="color:#ff79c6">FROM</span> cte1 <span style="color:#ff79c6">JOIN</span> cte2 <span style="color:#ff79c6">WHERE</span> cte1.k1 <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">as</span> ret
</span></span></code></pre></td></tr></table>
</div>
</div><p>查询</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">show</span> <span style="color:#ff79c6">last</span> <span style="color:#ff79c6">insert</span>\<span style="color:#ff79c6">G</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">***************************</span> <span style="color:#bd93f9">1</span>. <span style="color:#ff79c6">row</span> <span style="color:#ff79c6">***************************</span>
</span></span><span style="display:flex;"><span>TransactionId: <span style="color:#bd93f9">64067</span>
</span></span><span style="display:flex;"><span>Label: insert_ba8f33aea9544866<span style="color:#ff79c6">-</span><span style="color:#bd93f9">8</span>ed77e2844d0cc9b
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">Database</span>: default_cluster:db1
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">Table</span>: t1
</span></span><span style="display:flex;"><span>TransactionStatus: VISIBLE
</span></span><span style="display:flex;"><span>LoadedRows: <span style="color:#bd93f9">2</span>
</span></span><span style="display:flex;"><span>FilteredRows: <span style="color:#bd93f9">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="importing-data-in-json-format">Importing Data in JSON Format</h4>
<p>支持 json path<br>
其他没什么特别的</p>
<h3 id="import-advanced">Import Advanced</h3>
<p>默认是要 半数以上副本写入成功，才算 import 成功 
设置 min_load_replica_num 属性</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> test_table1
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>k1 <span style="color:#8be9fd;font-style:italic">INT</span>,
</span></span><span style="display:flex;"><span>k2 <span style="color:#8be9fd;font-style:italic">INT</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>DUPLICATE <span style="color:#ff79c6">KEY</span>(k1)
</span></span><span style="display:flex;"><span>DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH(k1) BUCKETS <span style="color:#bd93f9">5</span>
</span></span><span style="display:flex;"><span>PROPERTIES
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#39;replication_num&#39;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;2&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#39;min_load_replica_num&#39;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;1&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>修改已经存在的表</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> test_table1
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SET</span> ( <span style="color:#f1fa8c">&#39;min_load_replica_num&#39;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;1&#39;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>也可以设置 fe 级别的 min_load_replica_num</p>
<h2 id="export">Export</h2>
<p>执行过程</p>
<ul>
<li>The user submits an Export job to FE.</li>
<li>FE calculates all the tablets to be exported and groups them based on the parallelism parameter. Each group generates multiple SELECT INTO OUTFILE query plans based on the maximum_number_of_export_partitions parameter.</li>
<li>Based on the parallelism parameter, an equal number of ExportTaskExecutor are generated, and each ExportTaskExecutor is responsible for a thread, which is scheduled and executed by FE&rsquo;s Job scheduler framework.</li>
<li>FE&rsquo;s Job scheduler schedules and executes the ExportTaskExecutor, and each ExportTaskExecutor serially executes the multiple SELECT INTO OUTFILE query plans it is responsible for.</li>
</ul>
<p>导出到 HDFS</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>EXPORT <span style="color:#ff79c6">TABLE</span> db1.tbl1 
</span></span><span style="display:flex;"><span>PARTITION (p1,p2)
</span></span><span style="display:flex;"><span>[<span style="color:#ff79c6">WHERE</span> [expr]]
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">TO</span> <span style="color:#f1fa8c">&#34;hdfs://host/path/to/export/&#34;</span> 
</span></span><span style="display:flex;"><span>PROPERTIES
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;label&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;mylabel&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;column_separator&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;,&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;columns&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;col1,col2&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;parallelusm&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;3&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WITH</span> BROKER <span style="color:#f1fa8c">&#34;hdfs&#34;</span>
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;username&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;user&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;password&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;passwd&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>导出到 S3</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>EXPORT <span style="color:#ff79c6">TABLE</span> test <span style="color:#ff79c6">TO</span> <span style="color:#f1fa8c">&#34;s3://bucket/path/to/export/dir/&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WITH</span> S3 (
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;s3.endpoint&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;http://host&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;s3.access_key&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;AK&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;s3.secret_key&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;SK&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;s3.region&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;region&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>检查状态</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">show</span> EXPORT\<span style="color:#ff79c6">G</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">***************************</span> <span style="color:#bd93f9">1</span>. <span style="color:#ff79c6">row</span> <span style="color:#ff79c6">***************************</span>
</span></span><span style="display:flex;"><span>JobId: <span style="color:#bd93f9">14008</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">State</span>: FINISHED
</span></span><span style="display:flex;"><span>Progress: <span style="color:#bd93f9">100</span><span style="color:#ff79c6">%</span>
</span></span><span style="display:flex;"><span>TaskInfo: {<span style="color:#f1fa8c">&#34;partitions&#34;</span>:[],<span style="color:#f1fa8c">&#34;max_file_size&#34;</span>:<span style="color:#f1fa8c">&#34;&#34;</span>,<span style="color:#f1fa8c">&#34;delete_existing_files&#34;</span>:<span style="color:#f1fa8c">&#34;&#34;</span>,<span style="color:#f1fa8c">&#34;columns&#34;</span>:<span style="color:#f1fa8c">&#34;&#34;</span>,<span style="color:#f1fa8c">&#34;format&#34;</span>:<span style="color:#f1fa8c">&#34;csv&#34;</span>,<span style="color:#f1fa8c">&#34;column_separator&#34;</span>:<span style="color:#f1fa8c">&#34;\t&#34;</span>,<span style="color:#f1fa8c">&#34;line_delimiter&#34;</span>:<span style="color:#f1fa8c">&#34;\n&#34;</span>,<span style="color:#f1fa8c">&#34;db&#34;</span>:<span style="color:#f1fa8c">&#34;default_cluster:demo&#34;</span>,<span style="color:#f1fa8c">&#34;tbl&#34;</span>:<span style="color:#f1fa8c">&#34;student4&#34;</span>,<span style="color:#f1fa8c">&#34;tablet_num&#34;</span>:<span style="color:#bd93f9">30</span>}
</span></span><span style="display:flex;"><span>Path: hdfs:<span style="color:#ff79c6">//</span><span style="color:#ff79c6">host</span><span style="color:#ff79c6">/</span>path<span style="color:#ff79c6">/</span><span style="color:#ff79c6">to</span><span style="color:#ff79c6">/</span>export<span style="color:#ff79c6">/</span>
</span></span><span style="display:flex;"><span>CreateTime: <span style="color:#bd93f9">2019</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">06</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">25</span> <span style="color:#bd93f9">17</span>:<span style="color:#bd93f9">08</span>:<span style="color:#bd93f9">24</span>
</span></span><span style="display:flex;"><span>StartTime: <span style="color:#bd93f9">2019</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">06</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">25</span> <span style="color:#bd93f9">17</span>:<span style="color:#bd93f9">08</span>:<span style="color:#bd93f9">28</span>
</span></span><span style="display:flex;"><span>FinishTime: <span style="color:#bd93f9">2019</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">06</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">25</span> <span style="color:#bd93f9">17</span>:<span style="color:#bd93f9">08</span>:<span style="color:#bd93f9">34</span>
</span></span><span style="display:flex;"><span>Timeout: <span style="color:#bd93f9">3600</span>
</span></span><span style="display:flex;"><span>ErrorMsg: <span style="color:#ff79c6">NULL</span>
</span></span><span style="display:flex;"><span>OutfileInfo: [
</span></span><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>{<span style="color:#f1fa8c">&#34;fileNumber&#34;</span>: <span style="color:#f1fa8c">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;totalRows&#34;</span>: <span style="color:#f1fa8c">&#34;4&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;fileSize&#34;</span>: <span style="color:#f1fa8c">&#34;34bytes&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;url&#34;</span>: <span style="color:#f1fa8c">&#34;file:///127.0.0.1/Users/fangtiewei/tmp_data/export/f1ab7dcc31744152-bbb4cda2f5c88eac_&#34;</span>
</span></span><span style="display:flex;"><span>}]
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></td></tr></table>
</div>
</div><p>取消</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>CANCEL EXPORT
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> example_db
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> LABEL <span style="color:#ff79c6">like</span> <span style="color:#f1fa8c">&#34;%example%&#34;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>相关配置和建议</p>
<ul>
<li>Concurrent Export</li>
<li>exec_mem_limit</li>
<li>The Export job can export data from Doris Base tables, View, and External tables, but not from Rollup Index.</li>
<li>一次不要导出太大数据，可以导出分区</li>
</ul>
<p>SELECT INTO OUTFILE 例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> tbl
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INTO</span> OUTFILE <span style="color:#f1fa8c">&#34;hdfs://path/to/result_&#34;</span>
</span></span><span style="display:flex;"><span>FORMAT <span style="color:#ff79c6">AS</span> CSV
</span></span><span style="display:flex;"><span>PROPERTIES
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;broker.name&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;my_broker&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;column_separator&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;,&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;line_delimiter&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;\n&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">select</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> tbl1 <span style="color:#ff79c6">limit</span> <span style="color:#bd93f9">10</span> 
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INTO</span> OUTFILE <span style="color:#f1fa8c">&#34;file:///home/work/path/result_&#34;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>支持并发导出 
普通 导出，并发导出</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">select</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> tbl1 <span style="color:#ff79c6">limit</span> <span style="color:#bd93f9">10</span> <span style="color:#ff79c6">into</span> outfile <span style="color:#f1fa8c">&#34;file:///home/work/path/result_&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------------+-----------+----------+--------------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> FileNumber <span style="color:#ff79c6">|</span> TotalRows <span style="color:#ff79c6">|</span> FileSize <span style="color:#ff79c6">|</span> URL <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------------+-----------+----------+--------------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">8</span> <span style="color:#ff79c6">|</span> file:<span style="color:#ff79c6">///</span><span style="color:#bd93f9">192</span>.<span style="color:#bd93f9">168</span>.<span style="color:#bd93f9">1</span>.<span style="color:#bd93f9">10</span><span style="color:#ff79c6">/</span>home<span style="color:#ff79c6">/</span><span style="color:#ff79c6">work</span><span style="color:#ff79c6">/</span>path<span style="color:#ff79c6">/</span>result_{fragment_instance_id}_ <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------------+-----------+----------+--------------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------------+-----------+----------+--------------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> FileNumber <span style="color:#ff79c6">|</span> TotalRows <span style="color:#ff79c6">|</span> FileSize <span style="color:#ff79c6">|</span> URL <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------------+-----------+----------+--------------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">3</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">7</span> <span style="color:#ff79c6">|</span> file:<span style="color:#ff79c6">///</span><span style="color:#bd93f9">192</span>.<span style="color:#bd93f9">168</span>.<span style="color:#bd93f9">1</span>.<span style="color:#bd93f9">10</span><span style="color:#ff79c6">/</span>home<span style="color:#ff79c6">/</span><span style="color:#ff79c6">work</span><span style="color:#ff79c6">/</span>path<span style="color:#ff79c6">/</span>result_{fragment_instance_id}_ <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">4</span> <span style="color:#ff79c6">|</span> file:<span style="color:#ff79c6">///</span><span style="color:#bd93f9">192</span>.<span style="color:#bd93f9">168</span>.<span style="color:#bd93f9">1</span>.<span style="color:#bd93f9">11</span><span style="color:#ff79c6">/</span>home<span style="color:#ff79c6">/</span><span style="color:#ff79c6">work</span><span style="color:#ff79c6">/</span>path<span style="color:#ff79c6">/</span>result_{fragment_instance_id}_ <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------------+-----------+----------+--------------------------------------------------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>导出表结构</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysqldump <span style="color:#ff79c6">-</span>h127.<span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">1</span> <span style="color:#ff79c6">-</span>P9030 <span style="color:#ff79c6">-</span>uroot <span style="color:#6272a4">--no-tablespaces --databases test --tables table1 --no-data
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="update-and-delete">Update and Delete</h2>
<p>导入数据的方式有三种</p>
<ul>
<li>APPEND</li>
<li>DELETE</li>
<li>MERGE</li>
</ul>
<p>具体实现是，增加一个<code>__DORIS_DELETE_SIGN__ </code>隐藏列</p>
<ul>
<li>remove，设置 <strong>DORIS_DELETE_SIGN</strong> != true</li>
<li>import，按照 delete on 的条件来设置这一列</li>
<li>read，增加一个隐藏表达式，<strong>DORIS_DELETE_SIGN</strong> != true</li>
<li>compact，会将标记为 delete 的数据删除</li>
</ul>
<p>例子 
stream load</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">LOAD</span> LABEL db1.label1
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>[MERGE<span style="color:#ff79c6">|</span>APPEND<span style="color:#ff79c6">|</span><span style="color:#ff79c6">DELETE</span>] <span style="color:#ff79c6">DATA</span> INFILE(<span style="color:#f1fa8c">&#34;hdfs://abc.com:8888/user/palo/test/ml/file1&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INTO</span> <span style="color:#ff79c6">TABLE</span> tbl1
</span></span><span style="display:flex;"><span>COLUMNS TERMINATED <span style="color:#ff79c6">BY</span> <span style="color:#f1fa8c">&#34;,&#34;</span>
</span></span><span style="display:flex;"><span>(tmp_c1,tmp_c2, label_c3)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SET</span>
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>id<span style="color:#ff79c6">=</span>tmp_c2,
</span></span><span style="display:flex;"><span>name<span style="color:#ff79c6">=</span>tmp_c1,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>[<span style="color:#ff79c6">DELETE</span> <span style="color:#ff79c6">ON</span> label_c3<span style="color:#ff79c6">=</span><span style="color:#ff79c6">true</span>]
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WITH</span> BROKER<span style="color:#f1fa8c">&#39;broker&#39;</span>
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;username&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;user&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;password&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;pass&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>PROPERTIES
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;timeout&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;3600&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>routine load</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">ROUTINE</span> <span style="color:#ff79c6">LOAD</span> example_db.test1 <span style="color:#ff79c6">ON</span> example_tbl
</span></span><span style="display:flex;"><span>[<span style="color:#ff79c6">WITH</span> MERGE<span style="color:#ff79c6">|</span>APPEND<span style="color:#ff79c6">|</span><span style="color:#ff79c6">DELETE</span>]
</span></span><span style="display:flex;"><span>COLUMNS(k1, k2, k3, v1, v2, label),
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> k1<span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">100</span> <span style="color:#ff79c6">and</span> k2 <span style="color:#ff79c6">like</span> <span style="color:#f1fa8c">&#34;%doris%&#34;</span>
</span></span><span style="display:flex;"><span>[<span style="color:#ff79c6">DELETE</span> <span style="color:#ff79c6">ON</span> label<span style="color:#ff79c6">=</span><span style="color:#ff79c6">true</span>]
</span></span><span style="display:flex;"><span>PROPERTIES
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;desired_concurrent_number&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;3&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;max_batch_interval&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;20&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;max_batch_rows&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;300000&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;max_batch_size&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;209715200&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;strict_mode&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;false&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> KAFKA
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;kafka_broker_list&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;broker1:9092,broker2:9092,broker3:9092&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;kafka_topic&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;my_topic&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;kafka_partitions&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;0,1,2,3&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;kafka_offsets&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;101,0,0,200&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>显示隐藏列</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SET</span> show_hidden_columns<span style="color:#ff79c6">=</span><span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">desc</span> example_tbl_unique;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------------------+--------------+------+-------+---------+---------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> Field <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Type</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Null</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Key</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Default</span> <span style="color:#ff79c6">|</span> Extra <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------------------+--------------+------+-------+---------+---------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> user_id <span style="color:#ff79c6">|</span> LARGEINT <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> username <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">50</span>) <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> city <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">20</span>) <span style="color:#ff79c6">|</span> Yes <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">false</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">REPLACE</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> age <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">SMALLINT</span> <span style="color:#ff79c6">|</span> Yes <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">false</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">REPLACE</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> sex <span style="color:#ff79c6">|</span> TINYINT <span style="color:#ff79c6">|</span> Yes <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">false</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">REPLACE</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> phone <span style="color:#ff79c6">|</span> LARGEINT <span style="color:#ff79c6">|</span> Yes <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">false</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">REPLACE</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> address <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">500</span>) <span style="color:#ff79c6">|</span> Yes <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">false</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">REPLACE</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> register_time <span style="color:#ff79c6">|</span> DATETIME <span style="color:#ff79c6">|</span> Yes <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">false</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">REPLACE</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> __DORIS_DELETE_SIGN__ <span style="color:#ff79c6">|</span> TINYINT <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">false</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">REPLACE</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> __DORIS_VERSION_COL__ <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">false</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">REPLACE</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------------------+--------------+------+-------+---------+---------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>doris 在并发更新的时候，没有做特殊处理，毕竟是 OLAP 系统 
更新是基于 row 更新的，即使一行中的其他列没有变也会被更新 
两个并发操作同时更新一个 row，可能会导致脏数据 
更新的操作步骤</p>
<ul>
<li>Step 1: Read the rows that satisfy WHERE order id=1 (1, 100, &lsquo;pending payment&rsquo;)</li>
<li>Step 2: Change the order status of the row from &lsquo;Pending Payment&rsquo; to &lsquo;Pending Shipping&rsquo; (1, 100, &lsquo;Pending shipment&rsquo;)</li>
<li>Step 3: Insert the updated row back into the table to achieve the updated effect.</li>
</ul>
<p>为提高性能，支持 部分列 更新<br>
The Unique Key model currently supports column updates only in the Merge-on-Write implementation<br>
部分列更新机制：使用 MVCC 实现</p>
<p>Usage Recommendations</p>
<ul>
<li>high write performance,low query performance：Aggregate Key Model.</li>
<li>high query performance,lower write performance：Unique Key Merge-on-Write</li>
<li>读多写少场景，如果用反了，使用 Aggregate Key Model，有 5 - 10 倍性能差别</li>
</ul>
<p>开启</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">set</span> enable_unique_key_partial_update<span style="color:#ff79c6">=</span><span style="color:#ff79c6">true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>delete 操作</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">delete</span> <span style="color:#ff79c6">from</span> test_tbl PARTITION p1 <span style="color:#ff79c6">where</span> k1 <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">rows</span> affected (<span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">04</span> sec)
</span></span><span style="display:flex;"><span>{<span style="color:#f1fa8c">&#39;label&#39;</span>:<span style="color:#f1fa8c">&#39;delete_e7830c72-eb14-4cb9-bbb6-eebd4511d251&#39;</span>, <span style="color:#f1fa8c">&#39;status&#39;</span>:<span style="color:#f1fa8c">&#39;COMMITTED&#39;</span>, 
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#39;txnId&#39;</span>:<span style="color:#f1fa8c">&#39;4005&#39;</span>, <span style="color:#f1fa8c">&#39;err&#39;</span>:<span style="color:#f1fa8c">&#39;delete job is committed but may be taking effect later&#39;</span> }
</span></span></code></pre></td></tr></table>
</div>
</div><p>参数</p>
<ul>
<li>tablet_delete_timeout_second</li>
<li>load_straggler_wait_second</li>
<li>query_timeout</li>
<li>max_allowed_in_element_num_of_delete</li>
</ul>
<p>查询</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">show</span> <span style="color:#ff79c6">delete</span> <span style="color:#ff79c6">from</span> test_db;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------+---------------+---------------------+-----------------+----------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> TableName <span style="color:#ff79c6">|</span> PartitionName <span style="color:#ff79c6">|</span> CreateTime          <span style="color:#ff79c6">|</span> DeleteCondition <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">State</span>    <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------+---------------+---------------------+-----------------+----------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> empty_tbl <span style="color:#ff79c6">|</span> p3            <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">04</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">15</span> <span style="color:#bd93f9">23</span>:<span style="color:#bd93f9">09</span>:<span style="color:#bd93f9">35</span> <span style="color:#ff79c6">|</span> k1 EQ <span style="color:#f1fa8c">&#34;1&#34;</span>       <span style="color:#ff79c6">|</span> FINISHED <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> test_tbl  <span style="color:#ff79c6">|</span> p4            <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">04</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">15</span> <span style="color:#bd93f9">23</span>:<span style="color:#bd93f9">09</span>:<span style="color:#bd93f9">53</span> <span style="color:#ff79c6">|</span> k1 GT <span style="color:#f1fa8c">&#34;80&#34;</span>      <span style="color:#ff79c6">|</span> FINISHED <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------+---------------+---------------------+-----------------+----------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Sequence Column</p>
<ul>
<li>为了解决导入时的乱序问题</li>
<li>增加一个 <strong>DORIS_SEQUENCE_COL</strong> 隐藏列</li>
<li>比如将这个隐藏列 设置为指向表的 date类型，根据时间排序</li>
<li>import的时候，最大的时间会覆盖较小的</li>
<li>read，根据时间排序会覆盖之前的</li>
</ul>
<p>例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> test.test_table
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    user_id <span style="color:#8be9fd;font-style:italic">bigint</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">date</span> <span style="color:#8be9fd;font-style:italic">date</span>,
</span></span><span style="display:flex;"><span>    group_id <span style="color:#8be9fd;font-style:italic">bigint</span>,
</span></span><span style="display:flex;"><span>    modify_date <span style="color:#8be9fd;font-style:italic">date</span>,
</span></span><span style="display:flex;"><span>    keyword <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">128</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">UNIQUE</span> <span style="color:#ff79c6">KEY</span>(user_id, <span style="color:#8be9fd;font-style:italic">date</span>, group_id)
</span></span><span style="display:flex;"><span>DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH (user_id) BUCKETS <span style="color:#bd93f9">32</span>
</span></span><span style="display:flex;"><span>PROPERTIES(
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;function_column.sequence_col&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;modify_date&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;replication_num&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;in_memory&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;false&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看隐藏列</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SET</span> show_hidden_columns<span style="color:#ff79c6">=</span><span style="color:#ff79c6">true</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">desc</span> test_table;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------------------------+--------------+------+-------+---------+---------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> Field                  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Type</span>         <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Null</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Key</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Default</span> <span style="color:#ff79c6">|</span> Extra   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------------------------+--------------+------+-------+---------+---------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> user_id                <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">BIGINT</span>       <span style="color:#ff79c6">|</span> Yes  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span>    <span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">date</span>                   <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">DATE</span>         <span style="color:#ff79c6">|</span> Yes  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span>    <span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> group_id               <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">BIGINT</span>       <span style="color:#ff79c6">|</span> Yes  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span>    <span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> modify_date            <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">DATE</span>         <span style="color:#ff79c6">|</span> Yes  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">false</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span>    <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">REPLACE</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> keyword                <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">128</span>) <span style="color:#ff79c6">|</span> Yes  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">false</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span>    <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">REPLACE</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> __DORIS_DELETE_SIGN__  <span style="color:#ff79c6">|</span> TINYINT      <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">false</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">0</span>       <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">REPLACE</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> __DORIS_VERSION_COL__  <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">BIGINT</span>       <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">false</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">0</span>       <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">REPLACE</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> __DORIS_SEQUENCE_COL__ <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">DATE</span>         <span style="color:#ff79c6">|</span> Yes  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">false</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span>    <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">REPLACE</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------------------------+--------------+------+-------+---------+---------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>导入数据后查看</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#bd93f9">1</span>       <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">02</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">22</span>      <span style="color:#bd93f9">1</span>       <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">02</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">21</span>      a
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">1</span>       <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">02</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">22</span>      <span style="color:#bd93f9">1</span>       <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">02</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">22</span>      b
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">1</span>       <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">02</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">22</span>      <span style="color:#bd93f9">1</span>       <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">03</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">05</span>      <span style="color:#ff79c6">c</span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">1</span>       <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">02</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">22</span>      <span style="color:#bd93f9">1</span>       <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">02</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">26</span>      d
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">1</span>       <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">02</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">22</span>      <span style="color:#bd93f9">1</span>       <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">02</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">23</span>      e
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">1</span>       <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">02</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">22</span>      <span style="color:#bd93f9">1</span>       <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">02</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">24</span>      b
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff79c6">select</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> test_table;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---------+------------+----------+-------------+---------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> user_id <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">date</span>       <span style="color:#ff79c6">|</span> group_id <span style="color:#ff79c6">|</span> modify_date <span style="color:#ff79c6">|</span> keyword <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---------+------------+----------+-------------+---------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>       <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">02</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">22</span> <span style="color:#ff79c6">|</span>        <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">03</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">05</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">c</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---------+------------+----------+-------------+---------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>虽然<code>c</code>只是在中间，但是其 modify_date 值是最大的，所以最后被保留了</p>
<h1 id="advanced-usage">Advanced Usage</h1>
<h2 id="alter-table">Alter Table</h2>
<p>修改 schema 包括：</p>
<ul>
<li>Add and delete columns</li>
<li>Modify column type</li>
<li>Adjust column order</li>
<li>Add and modify Bloom Filter</li>
<li>Add and delete bitmap index</li>
</ul>
<p>基本概念</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Load</span> Job <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----+-----+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>     <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Load</span> job generates <span style="color:#ff79c6">both</span> origin <span style="color:#ff79c6">and</span> <span style="color:#ff79c6">new</span> <span style="color:#ff79c6">index</span> <span style="color:#ff79c6">data</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">+</span><span style="color:#6272a4">------------------+ +---------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>     <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span> Origin <span style="color:#ff79c6">Index</span>     <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span> Origin <span style="color:#ff79c6">Index</span>  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ff79c6">+</span><span style="color:#6272a4">------&gt; New Incoming Data| | History Data  |
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>     <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">+</span><span style="color:#6272a4">------------------+ +------+--------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>     <span style="color:#ff79c6">|</span>                                  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ff79c6">|</span>                                  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Convert</span> history <span style="color:#ff79c6">data</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ff79c6">|</span>                                  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">+</span><span style="color:#6272a4">------------------+ +------v--------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>     <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">New</span> <span style="color:#ff79c6">Index</span>        <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">New</span> <span style="color:#ff79c6">Index</span>     <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ff79c6">+</span><span style="color:#6272a4">------&gt; New Incoming Data| | History Data  |
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>            <span style="color:#ff79c6">+</span><span style="color:#6272a4">------------------+ +---------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>一个例子，原表</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------+-------+------+------+------+---------+-------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> IndexName <span style="color:#ff79c6">|</span> Field <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Type</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Null</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Key</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Default</span> <span style="color:#ff79c6">|</span> Extra <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------+-------+------+------+------+---------+-------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> tbl1      <span style="color:#ff79c6">|</span> k1    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A     <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>           <span style="color:#ff79c6">|</span> k2    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A     <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>           <span style="color:#ff79c6">|</span> k3    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A     <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>           <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> rollup2   <span style="color:#ff79c6">|</span> k2    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A     <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>           <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> rollup1   <span style="color:#ff79c6">|</span> k1    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A     <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>           <span style="color:#ff79c6">|</span> k2    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A     <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------+-------+------+------+------+---------+-------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>插入数据</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> tbl1
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ADD</span> <span style="color:#ff79c6">COLUMN</span> k4 <span style="color:#8be9fd;font-style:italic">INT</span> <span style="color:#ff79c6">default</span> <span style="color:#f1fa8c">&#34;1&#34;</span> <span style="color:#ff79c6">to</span> rollup1,
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ADD</span> <span style="color:#ff79c6">COLUMN</span> k4 <span style="color:#8be9fd;font-style:italic">INT</span> <span style="color:#ff79c6">default</span> <span style="color:#f1fa8c">&#34;1&#34;</span> <span style="color:#ff79c6">to</span> rollup2,
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ADD</span> <span style="color:#ff79c6">COLUMN</span> k5 <span style="color:#8be9fd;font-style:italic">INT</span> <span style="color:#ff79c6">default</span> <span style="color:#f1fa8c">&#34;1&#34;</span> <span style="color:#ff79c6">to</span> rollup2;
</span></span></code></pre></td></tr></table>
</div>
</div><p>结果</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------+-------+------+------+------+---------+-------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> IndexName <span style="color:#ff79c6">|</span> Field <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Type</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Null</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Key</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Default</span> <span style="color:#ff79c6">|</span> Extra <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------+-------+------+------+------+---------+-------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> tbl1      <span style="color:#ff79c6">|</span> k1    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A     <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>           <span style="color:#ff79c6">|</span> k2    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A     <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>           <span style="color:#ff79c6">|</span> k3    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A     <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>           <span style="color:#ff79c6">|</span> k4    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1</span>       <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>           <span style="color:#ff79c6">|</span> k5    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1</span>       <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>           <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> rollup2   <span style="color:#ff79c6">|</span> k2    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A     <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>           <span style="color:#ff79c6">|</span> k4    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1</span>       <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>           <span style="color:#ff79c6">|</span> k5    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1</span>       <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>           <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> rollup1   <span style="color:#ff79c6">|</span> k1    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A     <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>           <span style="color:#ff79c6">|</span> k2    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A     <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>           <span style="color:#ff79c6">|</span> k4    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">No</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1</span>       <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------+-------+------+------+------+---------+-------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>注意事项</p>
<ul>
<li>一次只能有一个变更</li>
<li>不能阻塞 import、query</li>
<li>The partition column and bucket column cannot be modified</li>
</ul>
<p>replace操作</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> [db.]tbl1 <span style="color:#ff79c6">REPLACE</span> <span style="color:#ff79c6">WITH</span> tbl2
</span></span><span style="display:flex;"><span>[PROPERTIES(<span style="color:#f1fa8c">&#39;swap&#39;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;true&#39;</span>)];
</span></span></code></pre></td></tr></table>
</div>
</div><p>解释</p>
<ul>
<li>如果 swap = true，则 Rename table B to table A, Rename table A to table B.</li>
<li>如果是 false，则 Drop table A. Rename table B to table A.</li>
</ul>
<h2 id="doris-partition">Doris Partition</h2>
<p>动态分区，根据指定的规则动态向前创建一些分区<br>
以及根据规则是否保留、删除历史分区</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> tbl1
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    k1 <span style="color:#8be9fd;font-style:italic">DATE</span>,
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>PARTITION <span style="color:#ff79c6">BY</span> RANGE(k1) ()
</span></span><span style="display:flex;"><span>DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH(k1)
</span></span><span style="display:flex;"><span>PROPERTIES
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;dynamic_partition.enable&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;true&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;dynamic_partition.time_unit&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;DAY&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;dynamic_partition.start&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;-7&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;dynamic_partition.end&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;3&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;dynamic_partition.prefix&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;p&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;dynamic_partition.buckets&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;32&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>解释</p>
<ul>
<li>time_unit，根据天创建分区</li>
<li>start，往后保留 7天，默认不设置就是全部保留</li>
<li>end，往前创建新的 3 天的分区</li>
</ul>
<p>查看</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> <span style="color:#ff79c6">DYNAMIC</span> PARTITION TABLES;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------+--------+----------+-------------+------+--------+---------+-----------+----------------+---------------------+--------+------------------------+----------------------+-------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> TableName <span style="color:#ff79c6">|</span> Enable <span style="color:#ff79c6">|</span> TimeUnit <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Start</span>       <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">End</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Prefix</span> <span style="color:#ff79c6">|</span> Buckets <span style="color:#ff79c6">|</span> StartOf   <span style="color:#ff79c6">|</span> LastUpdateTime <span style="color:#ff79c6">|</span> LastSchedulerTime   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">State</span>  <span style="color:#ff79c6">|</span> LastCreatePartitionMsg <span style="color:#ff79c6">|</span> LastDropPartitionMsg <span style="color:#ff79c6">|</span> ReservedHistoryPeriods  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------+--------+----------+-------------+------+--------+---------+-----------+----------------+---------------------+--------+------------------------+----------------------+-------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> d3        <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span>   <span style="color:#ff79c6">|</span> WEEK     <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">3</span>          <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">3</span>    <span style="color:#ff79c6">|</span> p      <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1</span>       <span style="color:#ff79c6">|</span> MONDAY    <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A            <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">05</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">25</span> <span style="color:#bd93f9">14</span>:<span style="color:#bd93f9">29</span>:<span style="color:#bd93f9">24</span> <span style="color:#ff79c6">|</span> NORMAL <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A                    <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A                  <span style="color:#ff79c6">|</span> [<span style="color:#bd93f9">2021</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">12</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">01</span>,<span style="color:#bd93f9">2021</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">12</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">31</span>] <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> d5        <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">DAY</span>      <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">7</span>          <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">3</span>    <span style="color:#ff79c6">|</span> p      <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">32</span>      <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A       <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A            <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">05</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">25</span> <span style="color:#bd93f9">14</span>:<span style="color:#bd93f9">29</span>:<span style="color:#bd93f9">24</span> <span style="color:#ff79c6">|</span> NORMAL <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A                    <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A                  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span>                    <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> d4        <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span>   <span style="color:#ff79c6">|</span> WEEK     <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">3</span>          <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">3</span>    <span style="color:#ff79c6">|</span> p      <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1</span>       <span style="color:#ff79c6">|</span> WEDNESDAY <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A            <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">05</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">25</span> <span style="color:#bd93f9">14</span>:<span style="color:#bd93f9">29</span>:<span style="color:#bd93f9">24</span> <span style="color:#ff79c6">|</span> NORMAL <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A                    <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A                  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span>                    <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> d6        <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">MONTH</span>    <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">2147483648</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2</span>    <span style="color:#ff79c6">|</span> p      <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">8</span>       <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">3</span>rd       <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A            <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">05</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">25</span> <span style="color:#bd93f9">14</span>:<span style="color:#bd93f9">29</span>:<span style="color:#bd93f9">24</span> <span style="color:#ff79c6">|</span> NORMAL <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A                    <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A                  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span>                    <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> d2        <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">DAY</span>      <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">3</span>          <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">3</span>    <span style="color:#ff79c6">|</span> p      <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">32</span>      <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A       <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A            <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">05</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">25</span> <span style="color:#bd93f9">14</span>:<span style="color:#bd93f9">29</span>:<span style="color:#bd93f9">24</span> <span style="color:#ff79c6">|</span> NORMAL <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A                    <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A                  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span>                    <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> d7        <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span>   <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">MONTH</span>    <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">2147483648</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">5</span>    <span style="color:#ff79c6">|</span> p      <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">8</span>       <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">24</span>th      <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A            <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2020</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">05</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">25</span> <span style="color:#bd93f9">14</span>:<span style="color:#bd93f9">29</span>:<span style="color:#bd93f9">24</span> <span style="color:#ff79c6">|</span> NORMAL <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A                    <span style="color:#ff79c6">|</span> N<span style="color:#ff79c6">/</span>A                  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span>                    <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------+--------+----------+-------------+------+--------+---------+-----------+----------------+---------------------+--------+------------------------+----------------------+-------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>临时分区</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> tbl1 <span style="color:#ff79c6">ADD</span> <span style="color:#ff79c6">TEMPORARY</span> PARTITION tp1 <span style="color:#ff79c6">VALUES</span> <span style="color:#ff79c6">LESS</span> <span style="color:#ff79c6">THAN</span> (<span style="color:#f1fa8c">&#34;2020-02-01&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> tbl2 <span style="color:#ff79c6">ADD</span> <span style="color:#ff79c6">TEMPORARY</span> PARTITION tp1 <span style="color:#ff79c6">VALUES</span> [(<span style="color:#f1fa8c">&#34;2020-01-01&#34;</span>), (<span style="color:#f1fa8c">&#34;2020-02-01&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> tbl1 <span style="color:#ff79c6">ADD</span> <span style="color:#ff79c6">TEMPORARY</span> PARTITION tp1 <span style="color:#ff79c6">VALUES</span> <span style="color:#ff79c6">LESS</span> <span style="color:#ff79c6">THAN</span> (<span style="color:#f1fa8c">&#34;2020-02-01&#34;</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#f1fa8c">&#34;replication_num&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;1&#34;</span>)
</span></span><span style="display:flex;"><span>DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH (k1) BUCKETS <span style="color:#bd93f9">5</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> tbl3 <span style="color:#ff79c6">ADD</span> <span style="color:#ff79c6">TEMPORARY</span> PARTITION tp1 <span style="color:#ff79c6">VALUES</span> <span style="color:#ff79c6">IN</span> (<span style="color:#f1fa8c">&#34;Beijing&#34;</span>, <span style="color:#f1fa8c">&#34;Shanghai&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> tbl4 <span style="color:#ff79c6">ADD</span> <span style="color:#ff79c6">TEMPORARY</span> PARTITION tp1 <span style="color:#ff79c6">VALUES</span> <span style="color:#ff79c6">IN</span> ((<span style="color:#bd93f9">1</span>, <span style="color:#f1fa8c">&#34;Beijing&#34;</span>), (<span style="color:#bd93f9">1</span>, <span style="color:#f1fa8c">&#34;Shanghai&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> tbl3 <span style="color:#ff79c6">ADD</span> <span style="color:#ff79c6">TEMPORARY</span> PARTITION tp1 <span style="color:#ff79c6">VALUES</span> <span style="color:#ff79c6">IN</span> (<span style="color:#f1fa8c">&#34;Beijing&#34;</span>, <span style="color:#f1fa8c">&#34;Shanghai&#34;</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#f1fa8c">&#34;replication_num&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;1&#34;</span>)
</span></span><span style="display:flex;"><span>DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH(k1) BUCKETS <span style="color:#bd93f9">5</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="data-cache">Data Cache</h2>
<p>分区缓存，开启</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>vim fe/conf/fe.conf
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">cache_enable_sql_mode</span><span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>MySQL [(<span style="color:#ff79c6">none</span>)]<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">set</span> [<span style="color:#ff79c6">global</span>] enable_sql_cache<span style="color:#ff79c6">=</span><span style="color:#ff79c6">true</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Enable Partition Cache</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>vim fe/conf/fe.conf
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">cache_enable_partition_mode</span><span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>MySQL [(<span style="color:#ff79c6">none</span>)]<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">set</span> [<span style="color:#ff79c6">global</span>] enable_partition_cache<span style="color:#ff79c6">=</span><span style="color:#ff79c6">true</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="autobucket">AutoBucket</h2>
<p>例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- old version of the creation syntax for specifying the number of buckets
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH(site) BUCKETS <span style="color:#bd93f9">20</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Newer versions use the creation syntax for automatic bucket imputation
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH(site) BUCKETS AUTO
</span></span><span style="display:flex;"><span>properties(<span style="color:#f1fa8c">&#34;estimate_partition_size&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;100G&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="broker">Broker</h2>
<p>只需要少量的内存，不参与计算，主要是 RPC 读写<br>
支持的系统</p>
<ul>
<li>Apache HDFS</li>
<li>Aliyun OSS</li>
<li>Baidu Cloud BOS</li>
<li>Tencent Cloud CHDFS</li>
<li>Tencent Cloud GFS (since 1.2.0)</li>
<li>Huawei Cloud OBS (since 1.2.0)</li>
<li>Amazon S3</li>
<li>JuiceFS (since 2.0.0)</li>
<li>GCS (since 2.0.0)</li>
</ul>
<p>整体设计</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----+   +----+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> FE <span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span> BE <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+-^</span><span style="color:#6272a4">--+   +--^-+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+-</span>v<span style="color:#6272a4">---------v-+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>   Broker    <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------^------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------v------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>HDFS<span style="color:#ff79c6">/</span>BOS<span style="color:#ff79c6">/</span>AFS <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="resource-management">Resource Management</h2>
<p>用来连接外部的计算资源、存储资源、ETL 等<br>
语法</p>
<ul>
<li>CREATE RESOURCE</li>
<li>DROP RESOURCE</li>
<li>SHOW RESOURCES</li>
</ul>
<p>支持的资源</p>
<ul>
<li>Spark resource: do ETL work</li>
<li>ODBC resource: query and import data from external tables</li>
</ul>
<p>spark的例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">EXTERNAL</span> RESOURCE <span style="color:#f1fa8c">&#34;spark0&#34;</span>
</span></span><span style="display:flex;"><span>PROPERTIES
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;type&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;spark&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;spark.master&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;yarn&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;spark.submit.deployMode&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;cluster&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;spark.jars&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;xxx.jar,yyy.jar&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;spark.files&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;/tmp/aaa,/tmp/bbb&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;spark.executor.memory&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;1g&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;spark.yarn.queue&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;queue0&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;spark.hadoop.yarn.resourcemanager.address&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;127.0.0.1:9999&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;spark.hadoop.fs.defaultFS&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;hdfs://127.0.0.1:10000&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;working_dir&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;hdfs://127.0.0.1:10000/tmp/doris&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;broker&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;broker0&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;broker.username&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;user0&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;broker.password&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;password0&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>ODBC 的例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">EXTERNAL</span> RESOURCE <span style="color:#ff79c6">`</span>oracle_odbc<span style="color:#ff79c6">`</span>
</span></span><span style="display:flex;"><span>PROPERTIES (
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;type&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;odbc_catalog&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;host&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;192.168.0.1&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;port&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;8086&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;user&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;test&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;password&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;test&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;database&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;test&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;odbc_type&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;oracle&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;driver&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;Oracle 19 ODBC driver&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="orthogonal-bitmap-calculation">Orthogonal BITMAP Calculation</h2>
<p>当数据量很大，超过 1 亿行，10G 的时候，bitmap计算也很慢<br>
将数据分为多个 bucket，然后分别计算<br>
这里需要做两次处理</p>
<ul>
<li>按照 id 范围 1 - 100的，100 - 200 等等分为一组</li>
<li>然后分别做聚合，聚合了之后上层算子，再做 merge 处理</li>
<li>这样总体计算时间就少了很多</li>
</ul>
<p>相关函数</p>
<ul>
<li>orthogonal_bitmap_intersect</li>
<li>orthogonal_bitmap_intersect_count</li>
<li>orthogonal_bitmap_union_count</li>
<li>orthogonal_bitmap_expr_calculate</li>
<li>orthogonal_bitmap_expr_calculate_count</li>
</ul>
<h2 id="approximate-deduplication-using-hll">Approximate Deduplication Using HLL</h2>
<p>这里使用的是 HyperLogLog 近似概率算法<br>
相关函数</p>
<ul>
<li>HLL_UNION_AGG(hll)</li>
<li>HLL_CARDINALITY</li>
<li>HLL_HASH</li>
</ul>
<p>例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> test_hll(
</span></span><span style="display:flex;"><span>    dt <span style="color:#8be9fd;font-style:italic">date</span>,
</span></span><span style="display:flex;"><span>    id <span style="color:#8be9fd;font-style:italic">int</span>,
</span></span><span style="display:flex;"><span>    name <span style="color:#8be9fd;font-style:italic">char</span>(<span style="color:#bd93f9">10</span>),
</span></span><span style="display:flex;"><span>    province <span style="color:#8be9fd;font-style:italic">char</span>(<span style="color:#bd93f9">10</span>),
</span></span><span style="display:flex;"><span>    os <span style="color:#8be9fd;font-style:italic">char</span>(<span style="color:#bd93f9">10</span>),
</span></span><span style="display:flex;"><span>    pv hll hll_union
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">Aggregate</span> <span style="color:#ff79c6">KEY</span> (dt,id,name,province,os)
</span></span><span style="display:flex;"><span>distributed <span style="color:#ff79c6">by</span> hash(id) buckets <span style="color:#bd93f9">10</span>
</span></span><span style="display:flex;"><span>PROPERTIES(
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;replication_num&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;in_memory&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;false&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>测试数据</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>2022-05-05,10001,测试01,北京,windows
</span></span><span style="display:flex;"><span>2022-05-05,10002,测试01,北京,linux
</span></span><span style="display:flex;"><span>2022-05-05,10003,测试01,北京,macos
</span></span><span style="display:flex;"><span>2022-05-05,10004,测试01,河北,windows
</span></span><span style="display:flex;"><span>2022-05-06,10001,测试01,上海,windows
</span></span><span style="display:flex;"><span>2022-05-06,10002,测试01,上海,linux
</span></span><span style="display:flex;"><span>2022-05-06,10003,测试01,江苏,macos
</span></span><span style="display:flex;"><span>2022-05-06,10004,测试01,陕西,windows
</span></span></code></pre></td></tr></table>
</div>
</div><p>加载</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>curl --location-trusted -u root: -H <span style="color:#f1fa8c">&#34;label:label_test_hll_load&#34;</span> <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>    -H <span style="color:#f1fa8c">&#34;column_separator:,&#34;</span> <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>    -H <span style="color:#f1fa8c">&#34;columns:dt,id,name,province,os, pv=hll_hash(id)&#34;</span> -T test_hll.csv  <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>	http://FE_HOST:8030/api/test/test_hll/_stream_load
</span></span></code></pre></td></tr></table>
</div>
</div><p>查询</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">select</span> HLL_UNION_AGG(pv) <span style="color:#ff79c6">from</span> test_hll;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> hll_union_agg(<span style="color:#ff79c6">`</span>pv<span style="color:#ff79c6">`</span>) <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>                   <span style="color:#bd93f9">4</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">COUNT</span>(<span style="color:#ff79c6">DISTINCT</span> pv) <span style="color:#ff79c6">FROM</span> test_hll;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> <span style="color:#ff79c6">count</span>(<span style="color:#ff79c6">DISTINCT</span> <span style="color:#ff79c6">`</span>pv<span style="color:#ff79c6">`</span>) <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>                    <span style="color:#bd93f9">4</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">select</span> HLL_UNION_AGG(pv) <span style="color:#ff79c6">from</span> test_hll <span style="color:#ff79c6">group</span> <span style="color:#ff79c6">by</span> dt;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> hll_union_agg(pv) <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>                 <span style="color:#bd93f9">4</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                 <span style="color:#bd93f9">4</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="variable">Variable</h2>
<p>使用</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> VARIABLES;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> VARIABLES <span style="color:#ff79c6">LIKE</span> <span style="color:#f1fa8c">&#39;%time_zone%&#39;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>设置session 级别的</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SET</span> exec_mem_limit <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">137438953472</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SET</span> forward_to_master <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SET</span> time_zone <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;Asia/Shanghai&#34;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>全局级别的</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SET</span> <span style="color:#ff79c6">GLOBAL</span> exec_mem_limit <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">137438953472</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>sql modes，比如 <code>||</code> 有的数据库是连接，有的是 or</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">select</span> <span style="color:#ff79c6">@@</span><span style="color:#ff79c6">global</span>.sql_mode
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">select</span> <span style="color:#ff79c6">@@</span><span style="color:#ff79c6">session</span>.sql_mode
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">show</span> <span style="color:#ff79c6">global</span> variables
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">show</span> <span style="color:#ff79c6">session</span> variables
</span></span></code></pre></td></tr></table>
</div>
</div><p>根据原表结构，创建目标表，有些属性，函数不需要一致</p>
<ul>
<li>属性如：storage_policy</li>
<li>colocate_with</li>
<li>函数如：auto bucket</li>
<li>dynamic partition</li>
</ul>
<h2 id="file-manager">File Manager</h2>
<p>将一些 ca 文件 download 下来，保存到本地<br>
使用了 BDBJE， Oracle Berkeley DB Java Edition. Distributed embedded database for persistent metadata in FE.<br>
例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>    <span style="color:#ff79c6">CREATE</span> FILE <span style="color:#f1fa8c">&#34;test_hll.csv&#34;</span>
</span></span><span style="display:flex;"><span>    PROPERTIES
</span></span><span style="display:flex;"><span>    (
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;url&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;http://192.168.12.71:9999/test_hll.csv&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;catalog&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;internal&#34;</span>
</span></span><span style="display:flex;"><span>    );
</span></span></code></pre></td></tr></table>
</div>
</div><p>查询</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> FILE <span style="color:#ff79c6">FROM</span> demo;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------+----------------------+----------+--------------+----------+-----------+----------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> Id    <span style="color:#ff79c6">|</span> DbName               <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Catalog</span>  <span style="color:#ff79c6">|</span> FileName     <span style="color:#ff79c6">|</span> FileSize <span style="color:#ff79c6">|</span> IsContent <span style="color:#ff79c6">|</span> MD5                              <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------+----------------------+----------+--------------+----------+-----------+----------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> <span style="color:#bd93f9">12097</span> <span style="color:#ff79c6">|</span> default_cluster:demo <span style="color:#ff79c6">|</span> internal <span style="color:#ff79c6">|</span> test_hll.csv <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">320</span>      <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span>      <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">0</span>b197c5ac2c2ad64a8640b3fb8d7d604 <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------+----------------------+----------+--------------+----------+-----------+----------------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>会将文件保存在内存，同时也会持久化存储<br>
相关配置</p>
<ul>
<li>Small_file_dir</li>
<li>max_small_file_size_bytes</li>
<li>max_small_file_number</li>
<li>be config: Small_file_dir</li>
</ul>
<h2 id="cold-hot-separation">Cold Hot Separation</h2>
<p>冷数据可以存储在 S3、或者 HDFS</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> RESOURCE <span style="color:#f1fa8c">&#34;remote_hdfs&#34;</span> PROPERTIES (
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;type&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;hdfs&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;fs.defaultFS&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;fs_host:default_fs_port&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;hadoop.username&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;hive&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;hadoop.password&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;hive&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;dfs.nameservices&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;my_ha&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;dfs.ha.namenodes.my_ha&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;my_namenode1, my_namenode2&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;dfs.namenode.rpc-address.my_ha.my_namenode1&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;nn1_host:rpc_port&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;dfs.namenode.rpc-address.my_ha.my_namenode2&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;nn2_host:rpc_prot&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;dfs.client.failover.proxy.provider&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&#34;</span>
</span></span><span style="display:flex;"><span>    );
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建存储策略</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>    <span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">STORAGE</span> POLICY test_policy PROPERTIES (
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;storage_resource&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;remote_hdfs&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;cooldown_ttl&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;300&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用存储策略</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>    <span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">IF</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">EXISTS</span> create_table_use_created_policy (
</span></span><span style="display:flex;"><span>    k1 <span style="color:#8be9fd;font-style:italic">BIGINT</span>,
</span></span><span style="display:flex;"><span>    k2 LARGEINT,
</span></span><span style="display:flex;"><span>    v1 <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">2048</span>)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">UNIQUE</span> <span style="color:#ff79c6">KEY</span>(k1)
</span></span><span style="display:flex;"><span>    DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH (k1) BUCKETS <span style="color:#bd93f9">3</span>
</span></span><span style="display:flex;"><span>    PROPERTIES(
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;storage_policy&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;test_policy&#34;</span>
</span></span><span style="display:flex;"><span>    );
</span></span></code></pre></td></tr></table>
</div>
</div><p>支持的 schema change</p>
<ul>
<li>Add and delete columns</li>
<li>Modify column type</li>
<li>Adjust column order</li>
<li>Add and modify Bloom Filter</li>
<li>Add and delete bitmap index</li>
</ul>
<h2 id="compute-node">Compute Node</h2>
<p>doris 默认的架构是<code>Share-Nothing</code>，计算和存储绑定了<br>
doris 也可以查询数据湖中的数据，但是 存储就有点浪费了 <br>
可以配置成 计算模式，这样就变成了<code> Share-Disk</code>架构了</p>
<p>BE 节点支持两种模式</p>
<ul>
<li>hybrid node，支持计算和存储能力，默认</li>
<li>computing node，只有计算能力</li>
</ul>
<p>如果是跨 catalog 查询，默认会交给 computing node 计算<br>
修改 be.conf</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">be_node_role</span> <span style="color:#ff79c6">=</span> computation 
</span></span></code></pre></td></tr></table>
</div>
</div><p>查询状态</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">show</span> backends\<span style="color:#ff79c6">G</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">***************************</span> <span style="color:#bd93f9">1</span>. <span style="color:#ff79c6">row</span> <span style="color:#ff79c6">***************************</span>
</span></span><span style="display:flex;"><span>              BackendId: <span style="color:#bd93f9">10010</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">Cluster</span>: default_cluster
</span></span><span style="display:flex;"><span>                     IP: <span style="color:#bd93f9">10</span>.<span style="color:#bd93f9">248</span>.<span style="color:#bd93f9">181</span>.<span style="color:#bd93f9">219</span>
</span></span><span style="display:flex;"><span>          HeartbeatPort: <span style="color:#bd93f9">9050</span>
</span></span><span style="display:flex;"><span>                 BePort: <span style="color:#bd93f9">9060</span>
</span></span><span style="display:flex;"><span>               HttpPort: <span style="color:#bd93f9">8040</span>
</span></span><span style="display:flex;"><span>               BrpcPort: <span style="color:#bd93f9">8060</span>
</span></span><span style="display:flex;"><span>          LastStartTime: <span style="color:#bd93f9">2022</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">11</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">30</span> <span style="color:#bd93f9">23</span>:<span style="color:#bd93f9">01</span>:<span style="color:#bd93f9">40</span>
</span></span><span style="display:flex;"><span>          LastHeartbeat: <span style="color:#bd93f9">2022</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">12</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">05</span> <span style="color:#bd93f9">15</span>:<span style="color:#bd93f9">01</span>:<span style="color:#bd93f9">18</span>
</span></span><span style="display:flex;"><span>                  Alive: <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>   SystemDecommissioned: <span style="color:#ff79c6">false</span>
</span></span><span style="display:flex;"><span>  ClusterDecommissioned: <span style="color:#ff79c6">false</span>
</span></span><span style="display:flex;"><span>              TabletNum: <span style="color:#bd93f9">753</span>
</span></span><span style="display:flex;"><span>       DataUsedCapacity: <span style="color:#bd93f9">1</span>.<span style="color:#bd93f9">955</span> GB
</span></span><span style="display:flex;"><span>          AvailCapacity: <span style="color:#bd93f9">202</span>.<span style="color:#bd93f9">987</span> GB
</span></span><span style="display:flex;"><span>          TotalCapacity: <span style="color:#bd93f9">491</span>.<span style="color:#bd93f9">153</span> GB
</span></span><span style="display:flex;"><span>                UsedPct: <span style="color:#bd93f9">58</span>.<span style="color:#bd93f9">67</span> <span style="color:#ff79c6">%</span>
</span></span><span style="display:flex;"><span>         MaxDiskUsedPct: <span style="color:#bd93f9">58</span>.<span style="color:#bd93f9">67</span> <span style="color:#ff79c6">%</span>
</span></span><span style="display:flex;"><span>     RemoteUsedCapacity: <span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">000</span>
</span></span><span style="display:flex;"><span>			。。。。。。
</span></span><span style="display:flex;"><span>HeartbeatFailureCounter: <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>               NodeRole: computation
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="row-to-column">Row to Column</h2>
<p>使用<code>EXPLODE</code> 函数生成一个虚拟表 
例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">`</span>person<span style="color:#ff79c6">`</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">`</span>id<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">int</span>(<span style="color:#bd93f9">11</span>) <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">`</span>name<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">text</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">`</span>age<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">int</span>(<span style="color:#bd93f9">11</span>) <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">`</span><span style="color:#ff79c6">class</span><span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">int</span>(<span style="color:#bd93f9">11</span>) <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">`</span>address<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">text</span> <span style="color:#ff79c6">NULL</span>
</span></span><span style="display:flex;"><span>) ENGINE<span style="color:#ff79c6">=</span>OLAP
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">UNIQUE</span> <span style="color:#ff79c6">KEY</span>(<span style="color:#ff79c6">`</span>id<span style="color:#ff79c6">`</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#39;OLAP&#39;</span>
</span></span><span style="display:flex;"><span>DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH(<span style="color:#ff79c6">`</span>id<span style="color:#ff79c6">`</span>) BUCKETS <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>PROPERTIES (
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;replication_allocation&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;tag.location.default: 1&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;in_memory&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;false&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;storage_format&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;V2&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;disable_auto_compaction&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;false&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>插入</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> person <span style="color:#ff79c6">VALUES</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">100</span>, <span style="color:#f1fa8c">&#39;John&#39;</span>, <span style="color:#bd93f9">30</span>, <span style="color:#bd93f9">1</span>, <span style="color:#f1fa8c">&#39;Street 1&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">200</span>, <span style="color:#f1fa8c">&#39;Mary&#39;</span>, <span style="color:#ff79c6">NULL</span>, <span style="color:#bd93f9">1</span>, <span style="color:#f1fa8c">&#39;Street 2&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">300</span>, <span style="color:#f1fa8c">&#39;Mike&#39;</span>, <span style="color:#bd93f9">80</span>, <span style="color:#bd93f9">3</span>, <span style="color:#f1fa8c">&#39;Street 3&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">400</span>, <span style="color:#f1fa8c">&#39;Dan&#39;</span>, <span style="color:#bd93f9">50</span>, <span style="color:#bd93f9">4</span>, <span style="color:#f1fa8c">&#39;Street 4&#39;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>查询</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> person
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">-&gt;</span>     <span style="color:#ff79c6">LATERAL</span> <span style="color:#ff79c6">VIEW</span> EXPLODE(<span style="color:#8be9fd;font-style:italic">ARRAY</span>(<span style="color:#bd93f9">30</span>, <span style="color:#bd93f9">60</span>)) tableName <span style="color:#ff79c6">AS</span> c_age;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------+------+------+-------+----------+-------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> id   <span style="color:#ff79c6">|</span> name <span style="color:#ff79c6">|</span> age  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">class</span> <span style="color:#ff79c6">|</span> address  <span style="color:#ff79c6">|</span> c_age <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------+------+------+-------+----------+-------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">100</span> <span style="color:#ff79c6">|</span> John <span style="color:#ff79c6">|</span>   <span style="color:#bd93f9">30</span> <span style="color:#ff79c6">|</span>     <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">|</span> Street <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">|</span>    <span style="color:#bd93f9">30</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">100</span> <span style="color:#ff79c6">|</span> John <span style="color:#ff79c6">|</span>   <span style="color:#bd93f9">30</span> <span style="color:#ff79c6">|</span>     <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">|</span> Street <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">|</span>    <span style="color:#bd93f9">60</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">200</span> <span style="color:#ff79c6">|</span> Mary <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">|</span>     <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">|</span> Street <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">|</span>    <span style="color:#bd93f9">30</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">200</span> <span style="color:#ff79c6">|</span> Mary <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">|</span>     <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">|</span> Street <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">|</span>    <span style="color:#bd93f9">60</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">300</span> <span style="color:#ff79c6">|</span> Mike <span style="color:#ff79c6">|</span>   <span style="color:#bd93f9">80</span> <span style="color:#ff79c6">|</span>     <span style="color:#bd93f9">3</span> <span style="color:#ff79c6">|</span> Street <span style="color:#bd93f9">3</span> <span style="color:#ff79c6">|</span>    <span style="color:#bd93f9">30</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">300</span> <span style="color:#ff79c6">|</span> Mike <span style="color:#ff79c6">|</span>   <span style="color:#bd93f9">80</span> <span style="color:#ff79c6">|</span>     <span style="color:#bd93f9">3</span> <span style="color:#ff79c6">|</span> Street <span style="color:#bd93f9">3</span> <span style="color:#ff79c6">|</span>    <span style="color:#bd93f9">60</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">400</span> <span style="color:#ff79c6">|</span> Dan  <span style="color:#ff79c6">|</span>   <span style="color:#bd93f9">50</span> <span style="color:#ff79c6">|</span>     <span style="color:#bd93f9">4</span> <span style="color:#ff79c6">|</span> Street <span style="color:#bd93f9">4</span> <span style="color:#ff79c6">|</span>    <span style="color:#bd93f9">30</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">400</span> <span style="color:#ff79c6">|</span> Dan  <span style="color:#ff79c6">|</span>   <span style="color:#bd93f9">50</span> <span style="color:#ff79c6">|</span>     <span style="color:#bd93f9">4</span> <span style="color:#ff79c6">|</span> Street <span style="color:#bd93f9">4</span> <span style="color:#ff79c6">|</span>    <span style="color:#bd93f9">60</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------+------+------+-------+----------+-------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="best-practice">Best Practice</h2>
<p>查询计划解析</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">EXPLAIN</span>  <span style="color:#ff79c6">select</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> test_hll <span style="color:#ff79c6">as</span> h <span style="color:#ff79c6">join</span> test_table <span style="color:#ff79c6">as</span> t <span style="color:#ff79c6">on</span> h.id <span style="color:#ff79c6">=</span> t.user_id <span style="color:#ff79c6">where</span> user_id <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">1</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>更详细的文本方式</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">EXPLAIN</span> <span style="color:#ff79c6">VERBOSE</span> <span style="color:#ff79c6">select</span> ...
</span></span></code></pre></td></tr></table>
</div>
</div><p>类似 Impala 的 图形查询计划</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">EXPLAIN</span> GRAPH <span style="color:#ff79c6">select</span> ...
</span></span></code></pre></td></tr></table>
</div>
</div><p>类似 Spark 那种toString 逻辑计划的方式打印出来</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">EXPLAIN</span> PARSED PLAN
</span></span></code></pre></td></tr></table>
</div>
</div><p>类似上面 Spark 的那种，这次的 查询 plan 是解析后的</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">EXPLAIN</span> ANALYZED PLAN <span style="color:#ff79c6">select</span> ...;
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行过查询重写后的</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">EXPLAIN</span> REWRITTEN PLAN <span style="color:#ff79c6">select</span> ...;
</span></span></code></pre></td></tr></table>
</div>
</div><p>显示优化有的逻辑计划</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">EXPLAIN</span> OPTIMIZED PLAN <span style="color:#ff79c6">select</span> ...;
</span></span></code></pre></td></tr></table>
</div>
</div><p>简化后的查询计划</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">EXPLAIN</span> SHAPE PLAN <span style="color:#ff79c6">select</span> ...;
</span></span></code></pre></td></tr></table>
</div>
</div><p>查询计划之间的转换，通过如下两个算子</p>
<ul>
<li>DataStreamSink</li>
<li>ExchangeNode</li>
</ul>
<p>查看 profile</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>SET <span style="color:#8be9fd;font-style:italic">is_report_success</span><span style="color:#ff79c6">=</span>true;
</span></span></code></pre></td></tr></table>
</div>
</div><p>debug log，FE 有三种方式</p>
<ul>
<li>修改配置文件，需要重启</li>
<li>通过 WebUI 修改，无需重启</li>
<li>或者通过 HTTP API 方式修改</li>
</ul>
<p>fe 的修改配置文件，修改 fe.conf 文件</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#6272a4"># Only enable Debug log for class org.apache.doris.catalog.Catalog</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">sys_log_verbose_modules</span><span style="color:#ff79c6">=</span>org.apache.doris.catalog.Catalog
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Open the Debug log of all classes under the package org.apache.doris.catalog</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">sys_log_verbose_modules</span><span style="color:#ff79c6">=</span>org.apache.doris.catalog
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Enable Debug logs for all classes under package org</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">sys_log_verbose_modules</span><span style="color:#ff79c6">=</span>org
</span></span></code></pre></td></tr></table>
</div>
</div><p>修改 be</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">sys_log_verbose_modules</span><span style="color:#ff79c6">=</span>plan_fragment_executor,olap_scan_node
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">sys_log_verbose_level</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">3</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>压缩</p>
<ul>
<li>Vertical Compaction</li>
<li>将多个列合并为一组做压缩，比传统的 row 压缩效果更好，内存消耗是 1/10，压缩比提高 15%</li>
<li>Segment Compaction</li>
<li>用于处理数据 load，这可能会引发很多小文件</li>
</ul>
<p>相关配置</p>
<ul>
<li>enable_vertical_compaction</li>
<li>vertical_compaction_num_columns_per_group</li>
<li>vertical_compaction_max_segment_size</li>
<li>enable_segcompaction</li>
<li>segcompaction_batch_size</li>
</ul>
<p>WEB UI</p>
<ul>
<li>FE，http://FE_HOST:8030/</li>
<li>BE，http://FE_HOST:8040/</li>
</ul>

			<script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>
        </div>

        


        

<div class="post-archive">
    <h2>相关文章</h2>
    <ul class="listing">
        
        <li><a href="/post/2024/01/doris_advanced/">Doris Advanced</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/doris'>Doris</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "himichael/hugoblogtalks"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>


                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://code0xff.org/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://code0xff.org/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://code0xff.org/post/2024/02/icer_berg/" title="Iceberg 简单总结">Iceberg 简单总结</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/02/data_ingestion_tool-selection-strategy/" title="Data Ingestion: Tool Selection Strategy">Data Ingestion: Tool Selection Strategy</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/02/data-engineering-at-meta/" title="Data engineering at Meta">Data engineering at Meta</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/01/data_ingestion_architectural_patterns/" title="Data Ingestion: Architectural Patterns">Data Ingestion: Architectural Patterns</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/01/hms/" title="Hive MetaStore的实现和优化">Hive MetaStore的实现和优化</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/01/lakehouse_storage_systems/" title="Analyzing and Comparing Lakehouse Storage Systems">Analyzing and Comparing Lakehouse Storage Systems</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/01/system_tuning/" title="系统调优">系统调优</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/01/doris_advanced/" title="Doris Advanced">Doris Advanced</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/01/doris/" title="Doris Basic">Doris Basic</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2023/12/%E9%9A%BE%E5%BF%98%E7%9A%84%E7%9E%AC%E9%97%B4/" title="难忘的时刻(2023年)">难忘的时刻(2023年)</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://code0xff.org/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式 (6)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/">原理分析 (13)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E5%95%86%E4%B8%9A/">商业 (3)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据 (44)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库 (38)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%96%87%E5%AD%A6%E5%92%8C%E8%89%BA%E6%9C%AF/">文学和艺术 (3)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%97%85%E8%A1%8C/">旅行 (12)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%9E%B6%E6%9E%84/">架构 (2)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E7%AE%97%E6%B3%95/">算法 (8)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E7%B3%BB%E7%BB%9F/">系统 (7)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言 (5)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E8%A1%8C%E4%B8%9A%E8%A7%82%E5%AF%9F/">行业观察 (3)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记 (12)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E9%9A%8F%E4%BE%BF%E5%86%99%E5%86%99/">随便写写 (3)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">归档</a></h3>
<ul class="widget-list">
    
    <li><a href="https://code0xff.org/years/2021%E5%B9%B4/">2021年 (41)</a></li>
    
    <li><a href="https://code0xff.org/years/2022%E5%B9%B4/">2022年 (55)</a></li>
    
    <li><a href="https://code0xff.org/years/2023%E5%B9%B4/">2023年 (54)</a></li>
    
    <li><a href="https://code0xff.org/years/2024%E5%B9%B4/">2024年 (9)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://code0xff.org/tags/ambari/">Ambari </a>
    
    <a href="https://code0xff.org/tags/b%E6%A0%91/">B树 </a>
    
    <a href="https://code0xff.org/tags/c&#43;&#43;/">C&#43;&#43; </a>
    
    <a href="https://code0xff.org/tags/calcite/">calcite </a>
    
    <a href="https://code0xff.org/tags/cmu-database/">CMU-Database </a>
    
    <a href="https://code0xff.org/tags/data_ingestion/">Data_Ingestion </a>
    
    <a href="https://code0xff.org/tags/deltalake/">DeltaLake </a>
    
    <a href="https://code0xff.org/tags/doris/">Doris </a>
    
    <a href="https://code0xff.org/tags/facebook/">Facebook </a>
    
    <a href="https://code0xff.org/tags/flink/">flink </a>
    
    <a href="https://code0xff.org/tags/flume/">flume </a>
    
    <a href="https://code0xff.org/tags/gc/">GC </a>
    
    <a href="https://code0xff.org/tags/gluten/">Gluten </a>
    
    <a href="https://code0xff.org/tags/hana/">HANA </a>
    
    <a href="https://code0xff.org/tags/hive/">Hive </a>
    
    <a href="https://code0xff.org/tags/iceberg/">iceberg </a>
    
    <a href="https://code0xff.org/tags/impala/">Impala </a>
    
    <a href="https://code0xff.org/tags/k8s/">k8s </a>
    
    <a href="https://code0xff.org/tags/kudu/">kudu </a>
    
    <a href="https://code0xff.org/tags/kyuubi/">Kyuubi </a>
    
    <a href="https://code0xff.org/tags/lakehouse/">Lakehouse </a>
    
    <a href="https://code0xff.org/tags/leveldb/">LevelDB </a>
    
    <a href="https://code0xff.org/tags/llvm/">LLVM </a>
    
    <a href="https://code0xff.org/tags/manacher/">Manacher </a>
    
    <a href="https://code0xff.org/tags/mapreduce/">MapReduce </a>
    
    <a href="https://code0xff.org/tags/mysql/">MySQL </a>
    
    <a href="https://code0xff.org/tags/newsql/">NewSQL </a>
    
    <a href="https://code0xff.org/tags/oceanbase/">OceanBase </a>
    
    <a href="https://code0xff.org/tags/paxos/">paxos </a>
    
    <a href="https://code0xff.org/tags/presto/">Presto </a>
    
    <a href="https://code0xff.org/tags/quick-sql/">quick-sql </a>
    
    <a href="https://code0xff.org/tags/raft/">raft </a>
    
    <a href="https://code0xff.org/tags/scala/">scala </a>
    
    <a href="https://code0xff.org/tags/simd/">SIMD </a>
    
    <a href="https://code0xff.org/tags/snowflake/">snowflake </a>
    
    <a href="https://code0xff.org/tags/spark/">spark </a>
    
    <a href="https://code0xff.org/tags/teradata/">TeraData </a>
    
    <a href="https://code0xff.org/tags/tpcx-hs/">TPCx-HS </a>
    
    <a href="https://code0xff.org/tags/tuning/">Tuning </a>
    
    <a href="https://code0xff.org/tags/unix/">unix </a>
    
    <a href="https://code0xff.org/tags/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/">二分查找 </a>
    
    <a href="https://code0xff.org/tags/%E4%BA%8C%E5%8F%89%E6%A0%91%E9%81%8D%E5%8E%86/">二叉树遍历 </a>
    
    <a href="https://code0xff.org/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式 </a>
    
    <a href="https://code0xff.org/tags/%E5%88%97%E5%AD%98/">列存 </a>
    
    <a href="https://code0xff.org/tags/%E5%8A%A8%E6%80%81%E6%B3%A8%E5%85%A5/">动态注入 </a>
    
    <a href="https://code0xff.org/tags/%E5%8E%86%E5%8F%B2/">历史 </a>
    
    <a href="https://code0xff.org/tags/%E5%90%91%E9%87%8F%E5%8C%96/">向量化 </a>
    
    <a href="https://code0xff.org/tags/%E5%9B%9E%E6%BA%AF/">回溯 </a>
    
    <a href="https://code0xff.org/tags/%E5%9B%BD%E5%86%85%E6%97%85%E8%A1%8C/">国内旅行 </a>
    
    <a href="https://code0xff.org/tags/%E5%9B%BD%E5%A4%96%E6%97%85%E8%A1%8C/">国外旅行 </a>
    
    <a href="https://code0xff.org/tags/%E5%A4%9A%E7%A7%9F%E6%88%B7/">多租户 </a>
    
    <a href="https://code0xff.org/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据 </a>
    
    <a href="https://code0xff.org/tags/%E5%AD%98%E5%82%A8/">存储 </a>
    
    <a href="https://code0xff.org/tags/%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/">工作记录 </a>
    
    <a href="https://code0xff.org/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务 </a>
    
    <a href="https://code0xff.org/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库 </a>
    
    <a href="https://code0xff.org/tags/%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B/">数据模型 </a>
    
    <a href="https://code0xff.org/tags/%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB/">数据迁移 </a>
    
    <a href="https://code0xff.org/tags/%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/">查询优化 </a>
    
    <a href="https://code0xff.org/tags/%E6%9F%A5%E8%AF%A2%E7%BC%96%E8%AF%91/">查询编译 </a>
    
    <a href="https://code0xff.org/tags/%E6%B1%87%E7%BC%96/">汇编 </a>
    
    <a href="https://code0xff.org/tags/%E6%B5%8B%E8%AF%95/">测试 </a>
    
    <a href="https://code0xff.org/tags/%E7%94%9F%E6%B4%BB/">生活 </a>
    
    <a href="https://code0xff.org/tags/%E7%94%B5%E5%BD%B1/">电影 </a>
    
    <a href="https://code0xff.org/tags/%E7%AE%97%E6%B3%95/">算法 </a>
    
    <a href="https://code0xff.org/tags/%E7%B4%A2%E5%BC%95/">索引 </a>
    
    <a href="https://code0xff.org/tags/%E7%BB%8F%E6%B5%8E/">经济 </a>
    
    <a href="https://code0xff.org/tags/%E7%BC%93%E5%AD%98/">缓存 </a>
    
    <a href="https://code0xff.org/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/">编译原理 </a>
    
    <a href="https://code0xff.org/tags/%E7%BD%91%E7%BB%9C/">网络 </a>
    
    <a href="https://code0xff.org/tags/%E8%AE%A1%E7%AE%97%E6%A1%86%E6%9E%B6/">计算框架 </a>
    
    <a href="https://code0xff.org/tags/%E8%AE%BA%E6%96%87/">论文 </a>
    
    <a href="https://code0xff.org/tags/%E8%AF%BB%E4%B9%A6/">读书 </a>
    
    <a href="https://code0xff.org/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记 </a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">RSS</h3>
        <ul class="widget-list">
            <li><a href="https://code0xff.org/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
    <footer id="footer">
    <div>
        &copy; 2024 <a href="https://code0xff.org/">记录每个瞬间 By 老王</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script src="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'GA ID', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




</body>

</html>