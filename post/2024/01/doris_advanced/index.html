<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>Doris Advanced | 记录每个瞬间</title>
    <meta property="og:title" content="Doris Advanced - 记录每个瞬间">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2024-01-05T09:08:07&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2024-01-05T09:08:07&#43;08:00'>
        
    <meta name="Keywords" content="">
    <meta name="description" content="Doris Advanced">
        <meta name="author" content="隔壁老王">
        
    <meta property="og:url" content="https://code0xff.org/post/2024/01/doris_advanced/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
        <link href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://code0xff.org/">
                        记录每个瞬间
                    </a>
                
                
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://code0xff.org/">首页</a>
                    
                    <a  href="https://code0xff.org/linked/" title="链接">链接</a>
                    
                    <a  href="https://code0xff.org/archives/" title="归档">归档</a>
                    
                    <a  href="https://code0xff.org/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">Doris Advanced</h1>
        </header>
        <date class="post-meta meta-date">
            2024年1月5日
        </date>
<nav id="TableOfContents">
  <ul>
    <li><a href="#query-acceleratio">Query Acceleratio</a>
      <ul>
        <li><a href="#pipeline-execution-engine">Pipeline Execution Engine</a></li>
        <li><a href="#nereids-the-brand-new-planner">Nereids-the Brand New Planner</a></li>
        <li><a href="#high-concurrency-point-query">High-Concurrency Point Query</a></li>
        <li><a href="#materialized-view">Materialized View</a></li>
        <li><a href="#statistics">Statistics</a></li>
        <li><a href="#join-optimization">Join Optimization</a>
          <ul>
            <li><a href="#bucket-shuffle-join">Bucket Shuffle Join</a></li>
            <li><a href="#colocation-join">Colocation Join</a></li>
            <li><a href="#runtime-filter">Runtime Filter</a></li>
            <li><a href="#doris-join-optimization-principle">Doris Join Optimization Principle</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#lakehouse">Lakehouse</a>
      <ul>
        <li><a href="#multi-catalog">Multi-catalog</a>
          <ul>
            <li><a href="#multi-catalog-overview">Multi-catalog Overview</a></li>
            <li><a href="#hive">Hive</a></li>
            <li><a href="#jdbc">JDBC</a></li>
          </ul>
        </li>
        <li><a href="#file-analysis">File Analysis</a></li>
        <li><a href="#file-cache">File Cache</a></li>
        <li><a href="#external-table-statistics">External Table Statistics</a></li>
        <li><a href="#file-system-benchmark-tools">File System Benchmark Tools</a></li>
      </ul>
    </li>
    <li><a href="#ecosystem">Ecosystem</a>
      <ul>
        <li><a href="#spark-doris-connector">Spark Doris Connector</a></li>
        <li><a href="#other-connector">Other Connector</a></li>
        <li><a href="#plugin-development-manual">Plugin Development Manual</a></li>
        <li><a href="#cloudcanal-data-import">CloudCanal Data Import</a></li>
        <li><a href="#dbt-doris-adapter">DBT Doris Adapter</a></li>
        <li><a href="#udf">UDF</a></li>
      </ul>
    </li>
    <li><a href="#sql-manual">SQL Manual</a>
      <ul>
        <li><a href="#sql-functions">SQL Functions</a></li>
        <li><a href="#sql-reference">SQL Reference</a></li>
      </ul>
    </li>
    <li><a href="#admin-manual">Admin Manual</a>
      <ul>
        <li><a href="#cluster-management">cluster management</a></li>
        <li><a href="#data-admin">Data Admin</a></li>
        <li><a href="#other-manager">Other Manager</a></li>
        <li><a href="#maintenance-and-monitor">Maintenance and Monitor</a></li>
        <li><a href="#metadata-operations-and-maintenance">Metadata Operations and Maintenance</a></li>
      </ul>
    </li>
    <li><a href="#starrocks">StarRocks</a></li>
    <li><a href="#reference">Reference</a></li>
  </ul>
</nav>
        
        <div class="post-meta">
            
            <span class="post-meta meta-tags">
                <ul class="clearfix">
                    <a href='/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE'>大数据</a>
                </ul>
            </span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <h1 id="query-acceleratio">Query Acceleratio</h1>
<h2 id="pipeline-execution-engine">Pipeline Execution Engine</h2>
<p>对原先的 火山模型的增强，更合适现代 CPU<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/22/7gNEnP.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/05/22/7gNEnP.png" />
        </a>
    <br>
优点</p>
<ul>
<li>从pull 变成 push 数据</li>
<li>阻塞的算子变成异步的</li>
<li>执行的线程可控</li>
</ul>
<p>参数</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- 开启
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">set</span> enable_pipeline_engine <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- 设置并行度
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">set</span> parallel_pipeline_task_num <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="nereids-the-brand-new-planner">Nereids-the Brand New Planner</h2>
<p>新增了一套 优化算法</p>
<ul>
<li>RBO，这里可能类似 Spark 的模式匹配规则，可以适配更复杂的查询</li>
<li>CBO，使用了 cascades 框架</li>
</ul>
<p>新老优化器对比

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/22/7gNNLw.png">
            <img class="mx-auto" alt="https://cdnd.selectdb.com/assets/images/nereids-tpch-d31958316d7c0404806812d5b41f0286.png" src="https://v1.ax1x.com/2024/05/22/7gNNLw.png" />
        </a>
    </p>
<p>调整</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- 开启
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SET</span> enable_nereids_planner<span style="color:#ff79c6">=</span><span style="color:#ff79c6">true</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- fall back 到老的优化器
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SET</span> enable_fallback_to_original_planner<span style="color:#ff79c6">=</span><span style="color:#ff79c6">true</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="high-concurrency-point-query">High-Concurrency Point Query</h2>
<p>doris 默认是列存的，但是对于 点查询就不好了，尤其是列很多的情况下 <br>
doris 也支持行存，键表的时候可以指定</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;store_row_column&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;true&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>一个例子，这里使用了 Merge-On-Write 策略</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">`</span>tbl_point_query<span style="color:#ff79c6">`</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span><span style="color:#ff79c6">key</span><span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">int</span>(<span style="color:#bd93f9">11</span>) <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>v1<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">decimal</span>(<span style="color:#bd93f9">27</span>, <span style="color:#bd93f9">9</span>) <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>v2<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">varchar</span>(<span style="color:#bd93f9">30</span>) <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>v3<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">varchar</span>(<span style="color:#bd93f9">30</span>) <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>v4<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">date</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>v5<span style="color:#ff79c6">`</span> datetime <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>v6<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">float</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>v7<span style="color:#ff79c6">`</span> datev2 <span style="color:#ff79c6">NULL</span>
</span></span><span style="display:flex;"><span>) ENGINE<span style="color:#ff79c6">=</span>OLAP
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">UNIQUE</span> <span style="color:#ff79c6">KEY</span>(<span style="color:#ff79c6">`</span><span style="color:#ff79c6">key</span><span style="color:#ff79c6">`</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#39;OLAP&#39;</span>
</span></span><span style="display:flex;"><span>DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH(<span style="color:#ff79c6">`</span><span style="color:#ff79c6">key</span>)<span style="color:#ff79c6">`</span> BUCKETS <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>PROPERTIES (
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;replication_allocation&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;tag.location.default: 1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;enable_unique_key_merge_on_write&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;true&#34;</span>,
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用 PreparedStatement 加速查询，只支持单表等值 where 条件</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>url <span style="color:#ff79c6">=</span> jdbc<span style="color:#ff79c6">:</span>mysql<span style="color:#ff79c6">:</span><span style="color:#6272a4">//127.0.0.1:9030/ycsb?useServerPrepStmts=true
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">// use `?` for placement holders, readStatement should be reused
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>PreparedStatement readStatement <span style="color:#ff79c6">=</span> conn<span style="color:#ff79c6">.</span><span style="color:#50fa7b">prepareStatement</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;select * from tbl_point_query where key = ?&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">...</span>
</span></span><span style="display:flex;"><span>readStatement<span style="color:#ff79c6">.</span><span style="color:#50fa7b">setInt</span><span style="color:#ff79c6">(</span>1234<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>ResultSet resultSet <span style="color:#ff79c6">=</span> readStatement<span style="color:#ff79c6">.</span><span style="color:#50fa7b">executeQuery</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">...</span>
</span></span><span style="display:flex;"><span>readStatement<span style="color:#ff79c6">.</span><span style="color:#50fa7b">setInt</span><span style="color:#ff79c6">(</span>1235<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>resultSet <span style="color:#ff79c6">=</span> readStatement<span style="color:#ff79c6">.</span><span style="color:#50fa7b">executeQuery</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>默认的 cache 是针对 列的，也有另外的针对行的 cache</p>
<ul>
<li>disable_storage_row_cache</li>
<li>row_cache_mem_limit</li>
</ul>
<h2 id="materialized-view">Materialized View</h2>
<p>是 Rollup  的超集<br>
一个物化视图可以匹配多个查询，在一个表上创建多个物化视图不推荐<br>
支持的聚合函数</p>
<ul>
<li>SUM, MIN, MAX (Version 0.12)</li>
<li>COUNT, BITMAP_UNION, HLL_UNION (Version 0.13)</li>
</ul>
<p>doris 自动维护 基表，物化视图之间的一致性<br>
当 insert 到基表后，自动插入到 物化视图，这是一个同步操作，更新完物化视图后，才算 insert 成功</p>
<p>创建表和 物化视图</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> duplicate_table(
</span></span><span style="display:flex;"><span>	k1 <span style="color:#8be9fd;font-style:italic">int</span> <span style="color:#ff79c6">null</span>,
</span></span><span style="display:flex;"><span>	k2 <span style="color:#8be9fd;font-style:italic">int</span> <span style="color:#ff79c6">null</span>,
</span></span><span style="display:flex;"><span>	k3 <span style="color:#8be9fd;font-style:italic">bigint</span> <span style="color:#ff79c6">null</span>,
</span></span><span style="display:flex;"><span>	k4 <span style="color:#8be9fd;font-style:italic">bigint</span> <span style="color:#ff79c6">null</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>duplicate <span style="color:#ff79c6">key</span> (k1,k2,k3,k4)
</span></span><span style="display:flex;"><span>distributed <span style="color:#ff79c6">BY</span> hash(k4) buckets <span style="color:#bd93f9">3</span>
</span></span><span style="display:flex;"><span>properties(<span style="color:#f1fa8c">&#34;replication_num&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;1&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">create</span> materialized <span style="color:#ff79c6">view</span> k1_k2 <span style="color:#ff79c6">as</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">select</span> k2, k1 <span style="color:#ff79c6">from</span> duplicate_table;
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">desc</span> duplicate_table <span style="color:#ff79c6">all</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------------+---------------+-------+--------+--------------+------+------+---------+-------+---------+------------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> IndexName       <span style="color:#ff79c6">|</span> IndexKeysType <span style="color:#ff79c6">|</span> Field <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Type</span>   <span style="color:#ff79c6">|</span> InternalType <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Null</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Key</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Default</span> <span style="color:#ff79c6">|</span> Extra <span style="color:#ff79c6">|</span> Visible <span style="color:#ff79c6">|</span> DefineExpr <span style="color:#ff79c6">|</span> WhereClause <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------------+---------------+-------+--------+--------------+------+------+---------+-------+---------+------------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> duplicate_table <span style="color:#ff79c6">|</span> DUP_KEYS      <span style="color:#ff79c6">|</span> k1    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>          <span style="color:#ff79c6">|</span> Yes  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span>    <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span>    <span style="color:#ff79c6">|</span>            <span style="color:#ff79c6">|</span>             <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                 <span style="color:#ff79c6">|</span>               <span style="color:#ff79c6">|</span> k2    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>          <span style="color:#ff79c6">|</span> Yes  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span>    <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span>    <span style="color:#ff79c6">|</span>            <span style="color:#ff79c6">|</span>             <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                 <span style="color:#ff79c6">|</span>               <span style="color:#ff79c6">|</span> k3    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">BIGINT</span>       <span style="color:#ff79c6">|</span> Yes  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span>    <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span>    <span style="color:#ff79c6">|</span>            <span style="color:#ff79c6">|</span>             <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                 <span style="color:#ff79c6">|</span>               <span style="color:#ff79c6">|</span> k4    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">BIGINT</span>       <span style="color:#ff79c6">|</span> Yes  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span>    <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span>    <span style="color:#ff79c6">|</span>            <span style="color:#ff79c6">|</span>             <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                 <span style="color:#ff79c6">|</span>               <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>        <span style="color:#ff79c6">|</span>              <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span>            <span style="color:#ff79c6">|</span>             <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> k1_k2           <span style="color:#ff79c6">|</span> DUP_KEYS      <span style="color:#ff79c6">|</span> mv_k2 <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>          <span style="color:#ff79c6">|</span> Yes  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span>    <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span>    <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">`</span>k2<span style="color:#ff79c6">`</span>       <span style="color:#ff79c6">|</span>             <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                 <span style="color:#ff79c6">|</span>               <span style="color:#ff79c6">|</span> mv_k1 <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>    <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">INT</span>          <span style="color:#ff79c6">|</span> Yes  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span>    <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span>    <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">`</span>k1<span style="color:#ff79c6">`</span>       <span style="color:#ff79c6">|</span>             <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------------+---------------+-------+--------+--------------+------+------+---------+-------+---------+------------+-------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The use of materialized views is generally divided into the following steps:</p>
<ol>
<li>Create a materialized view</li>
<li>Asynchronously check whether the materialized view has been constructed</li>
<li>Query and automatically match materialized views</li>
</ol>
<p>限制</p>
<ul>
<li>delete 的列不在物化视图中，则需要手动维护</li>
<li>单个表不能有太多物化视图，如果有10个会严重影响 import 速度，相当于要导入 10个表</li>
<li>Unique Key model，只能更改列的顺序，不能执行聚合</li>
<li>有些查询重写，可能会导致 物化视图 命中失败</li>
</ul>
<h2 id="statistics">Statistics</h2>
<p>Currently, the following information is collected for each column:</p>
<table>
<thead>
<tr>
<th>Information</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>row_count</td>
<td>Total number of rows</td>
</tr>
<tr>
<td>data_size</td>
<td>Total data size</td>
</tr>
<tr>
<td>avg_size_byte</td>
<td>Average length of values</td>
</tr>
<tr>
<td>ndv</td>
<td>Number of distinct values</td>
</tr>
<tr>
<td>min</td>
<td>Minimum value</td>
</tr>
<tr>
<td>max</td>
<td>Maximum value</td>
</tr>
<tr>
<td>null_count</td>
<td>Number of null values</td>
</tr>
</tbody>
</table>
<p>手动收集</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">ANALYZE</span> <span style="color:#ff79c6">&lt;</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">DATABASE</span> <span style="color:#ff79c6">table_name</span> <span style="color:#ff79c6">|</span> db_name <span style="color:#ff79c6">&gt;</span> 
</span></span><span style="display:flex;"><span>    [ (<span style="color:#ff79c6">column_name</span> [, ...]) ]
</span></span><span style="display:flex;"><span>    [ [ <span style="color:#ff79c6">WITH</span> SYNC ] [ <span style="color:#ff79c6">WITH</span> SAMPLE PERCENT <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">ROWS</span> ] ];
</span></span></code></pre></td></tr></table>
</div>
</div><p>采样 10%</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">ANALYZE</span> <span style="color:#ff79c6">TABLE</span> lineitem <span style="color:#ff79c6">WITH</span> SAMPLE PERCENT <span style="color:#bd93f9">10</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>收集 100,000 rows</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">ANALYZE</span> <span style="color:#ff79c6">TABLE</span> lineitem <span style="color:#ff79c6">WITH</span> SAMPLE <span style="color:#ff79c6">ROWS</span> <span style="color:#bd93f9">100000</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>show语法</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> [AUTO] <span style="color:#ff79c6">ANALYZE</span> <span style="color:#ff79c6">&lt;</span> <span style="color:#ff79c6">table_name</span> <span style="color:#ff79c6">|</span> job_id <span style="color:#ff79c6">&gt;</span>
</span></span><span style="display:flex;"><span>    [ <span style="color:#ff79c6">WHERE</span> [ <span style="color:#ff79c6">STATE</span> <span style="color:#ff79c6">=</span> [ <span style="color:#f1fa8c">&#34;PENDING&#34;</span> <span style="color:#ff79c6">|</span> <span style="color:#f1fa8c">&#34;RUNNING&#34;</span> <span style="color:#ff79c6">|</span> <span style="color:#f1fa8c">&#34;FINISHED&#34;</span> <span style="color:#ff79c6">|</span> <span style="color:#f1fa8c">&#34;FAILED&#34;</span> ] ] ];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">show</span> <span style="color:#ff79c6">analyze</span> <span style="color:#bd93f9">245073</span>\<span style="color:#ff79c6">G</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">***************************</span> <span style="color:#bd93f9">1</span>. <span style="color:#ff79c6">row</span> <span style="color:#ff79c6">***************************</span>
</span></span><span style="display:flex;"><span>              job_id: <span style="color:#bd93f9">245073</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">catalog_name</span>: internal
</span></span><span style="display:flex;"><span>             db_name: default_cluster:tpch
</span></span><span style="display:flex;"><span>            tbl_name: lineitem
</span></span><span style="display:flex;"><span>            col_name: [l_returnflag,l_receiptdate,l_tax,l_shipmode,l_suppkey,l_shipdate,\
</span></span><span style="display:flex;"><span>			l_commitdate,l_partkey,l_orderkey,l_quantity,l_linestatus,l_comment,\
</span></span><span style="display:flex;"><span>			l_extendedprice,l_linenumber,l_discount,l_shipinstruct]
</span></span><span style="display:flex;"><span>            job_type: MANUAL
</span></span><span style="display:flex;"><span>       analysis_type: FUNDAMENTALS
</span></span><span style="display:flex;"><span>             message: 
</span></span><span style="display:flex;"><span>last_exec_time_in_ms: <span style="color:#bd93f9">2023</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">11</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">07</span> <span style="color:#bd93f9">11</span>:<span style="color:#bd93f9">00</span>:<span style="color:#bd93f9">52</span>
</span></span><span style="display:flex;"><span>               <span style="color:#ff79c6">state</span>: FINISHED
</span></span><span style="display:flex;"><span>            progress: <span style="color:#bd93f9">16</span> Finished  <span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">0</span> Failed  <span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">In</span> Progress  <span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">16</span> Total
</span></span><span style="display:flex;"><span>       schedule_type: ONCE
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看列</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> <span style="color:#ff79c6">COLUMN</span> [cached] STATS <span style="color:#ff79c6">table_name</span> [ (<span style="color:#ff79c6">column_name</span> [, ...]) ];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">show</span> <span style="color:#ff79c6">column</span> stats lineitem(l_tax)\<span style="color:#ff79c6">G</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">***************************</span> <span style="color:#bd93f9">1</span>. <span style="color:#ff79c6">row</span> <span style="color:#ff79c6">***************************</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">column_name</span>: l_tax
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">count</span>: <span style="color:#bd93f9">6001215</span>.<span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>          ndv: <span style="color:#bd93f9">9</span>.<span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>     num_null: <span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>    data_size: <span style="color:#bd93f9">4</span>.<span style="color:#bd93f9">800972</span>E7
</span></span><span style="display:flex;"><span>avg_size_byte: <span style="color:#bd93f9">8</span>.<span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>          <span style="color:#ff79c6">min</span>: <span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">00</span>
</span></span><span style="display:flex;"><span>          <span style="color:#ff79c6">max</span>: <span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">08</span>
</span></span><span style="display:flex;"><span>       <span style="color:#ff79c6">method</span>: <span style="color:#ff79c6">FULL</span>
</span></span><span style="display:flex;"><span>         <span style="color:#ff79c6">type</span>: FUNDAMENTALS
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">trigger</span>: MANUAL
</span></span><span style="display:flex;"><span>  query_times: <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span> updated_time: <span style="color:#bd93f9">2023</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">11</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">07</span> <span style="color:#bd93f9">11</span>:<span style="color:#bd93f9">00</span>:<span style="color:#bd93f9">46</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>session级别的配置</p>
<ul>
<li>auto_analyze_start_time</li>
<li>auto_analyze_end_time</li>
<li>enable_auto_analyze</li>
<li>huge_table_default_sample_rows</li>
<li>huge_table_lower_bound_size_in_bytes</li>
<li>huge_table_auto_analyze_interval_in_millis</li>
<li>table_stats_health_threshold</li>
<li>analyze_timeout</li>
<li>auto_analyze_table_width_threshold</li>
</ul>
<p>fe 配置</p>
<ul>
<li>analyze_record_limit</li>
<li>stats_cache_size</li>
<li>statistics_simultaneously_running_task_num</li>
<li>statistics_sql_mem_limit_in_bytes</li>
</ul>
<h2 id="join-optimization">Join Optimization</h2>
<h3 id="bucket-shuffle-join">Bucket Shuffle Join</h3>
<p>详细设计在 <a href="https://github.com/apache/doris/issues/4394">这个 issues</a><br>
现有的两个 join，执行 A join B：</p>
<ul>
<li>Broadcast Join，需要将 B 发送到 三个 A 的node 上，网络开销 3B，内存开销 3B</li>
<li>Shuffle Join，网络开销 A + B，内存开销 B</li>
</ul>
<p>Bucket Shuffle Join 原理<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/22/7gNqG6.png">
            <img class="mx-auto" alt="https://cdnd.selectdb.com/assets/images/bucket_shuffle_join-86cfc2fda814d3b3502d9afa5812e17b.png" src="https://v1.ax1x.com/2024/05/22/7gNqG6.png" />
        </a>
    
执行过程</p>
<ul>
<li>首先计算出 左表 A 的所有列分布，计算出 hash值</li>
<li>将 hash值和分布情况发送到 B节点</li>
<li>B 节点做拆分，将数据拆分后发送到 A 的三个 node 上</li>
<li>总发送的数据量就是 B，如果 node 节点多，则发送的数据量大幅降低</li>
</ul>
<p>例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- 开启
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">set</span> enable_bucket_shuffle_join <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">select</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> test <span style="color:#ff79c6">join</span> [shuffle] baseall <span style="color:#ff79c6">on</span> test.k1 <span style="color:#ff79c6">=</span> baseall.k1;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#bd93f9">2</span>:HASH <span style="color:#ff79c6">JOIN</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>  <span style="color:#ff79c6">join</span> op: <span style="color:#ff79c6">INNER</span> <span style="color:#ff79c6">JOIN</span> (BUCKET_SHUFFLE)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>  hash predicates:
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>  colocate: <span style="color:#ff79c6">false</span>, reason: <span style="color:#ff79c6">table</span> <span style="color:#ff79c6">not</span> <span style="color:#ff79c6">in</span> the same <span style="color:#ff79c6">group</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>  equal <span style="color:#ff79c6">join</span> conjunct: <span style="color:#ff79c6">`</span>test<span style="color:#ff79c6">`</span>.<span style="color:#ff79c6">`</span>k1<span style="color:#ff79c6">`</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">`</span>baseall<span style="color:#ff79c6">`</span>.<span style="color:#ff79c6">`</span>k1<span style="color:#ff79c6">`</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The join type indicates that the join method to be used is：<code>BUCKET_SHUFFLE</code> <br>
使用原则</p>
<ul>
<li>对用户透明</li>
<li>join 条件必须是 等值的</li>
<li>左表的 列类型，必须跟 右表的列类型一致，因为要计算 hash 用的</li>
<li>只能用于 doris 自己的表</li>
<li>分区表时，只能确保左表时单分区，所以要 where 条件尽可能做分区裁剪</li>
<li>如果左表是 colocate 表，数据分布规则是确定的，则 bucket shuffle join 效果会更好</li>
</ul>
<h3 id="colocation-join">Colocation Join</h3>
<p>详细设计在 <a href="https://github.com/apache/doris/issues/245">这个 issue</a></p>
<p>将 partition 再分成若干个 buckets，确保 buckets Mth 落在一个确定的 node上<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/22/7gNy9Q.png">
            <img class="mx-auto" alt="https://camo.githubusercontent.com/2d080a0693d5d0a1f30ac1e5acef603bef8c59d46cb13124c8534a60db999e55/687474703a2f2f7374617469632e7a7962756c756f2e636f6d2f6b616e676b616973656e2f786474707865636d6b70716d776c643237756537377879692f254535254231253846254535254239253935254535254246254142254537253835254137253230323031382d31302d3137253230254534254238253842254535253844253838342e31362e30342e706e67" src="https://v1.ax1x.com/2024/05/22/7gNy9Q.png" />
        </a>
    </p>
<p>然后按照一定的映射规则，将 distributed key 做 hash 计算，落到某个固定的 buckets seq 上<br>
这里实际是 mod bucket num 做的，然后再将 bucket seq 映射到某个固定的 node 上 <br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/22/7gNHHf.png">
            <img class="mx-auto" alt="https://camo.githubusercontent.com/24c4bd33f09e35b51a5847d721913eeb1f49fe29c837020e6baa4033b6c3f160/687474703a2f2f7374617469632e7a7962756c756f2e636f6d2f6b616e676b616973656e2f3570696838747268366c6966387971626734736431306a732f254535254231253846254535254239253935254535254246254142254537253835254137253230323031382d31302d3137253230254534254238253842254535253844253838342e33322e35352e706e67" src="https://v1.ax1x.com/2024/05/22/7gNHHf.png" />
        </a>
    </p>
<p>将 bucket seq 映射到 某个 固定 node，是根据 roudn robin 做的<br>
这里还有 parent table，child table，目前已经没有了，早起的设计跟最终实现有些些不同<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/22/7gNK1c.png">
            <img class="mx-auto" alt="https://camo.githubusercontent.com/fa80b3f9dc7e470db089daa64aa9b5aaf24414eba061bd308037e5983e0ed0f2/687474703a2f2f7374617469632e7a7962756c756f2e636f6d2f6b616e676b616973656e2f676970366b626272646564793376726871777274643133752f254535254231253846254535254239253935254535254246254142254537253835254137253230323031382d31302d3137253230254534254238253842254535253844253838342e34322e31372e706e67" src="https://v1.ax1x.com/2024/05/22/7gNK1c.png" />
        </a>
    </p>
<p>创建表</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> tbl (k1 <span style="color:#8be9fd;font-style:italic">int</span>, v1 <span style="color:#8be9fd;font-style:italic">int</span> <span style="color:#ff79c6">sum</span>)
</span></span><span style="display:flex;"><span>DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH(k1)
</span></span><span style="display:flex;"><span>BUCKETS <span style="color:#bd93f9">8</span>
</span></span><span style="display:flex;"><span>PROPERTIES(
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;colocate_with&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;group1&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;replication_num&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>查询</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> PROC <span style="color:#f1fa8c">&#39;/colocation_group&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------------+----------------+----------+------------+-------------------------+----------+----------+----------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> GroupId         <span style="color:#ff79c6">|</span> GroupName      <span style="color:#ff79c6">|</span> TableIds <span style="color:#ff79c6">|</span> BucketsNum <span style="color:#ff79c6">|</span> ReplicaAllocation       <span style="color:#ff79c6">|</span> DistCols <span style="color:#ff79c6">|</span> IsStable <span style="color:#ff79c6">|</span> ErrorMsg <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------------+----------------+----------+------------+-------------------------+----------+----------+----------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1345111</span>.<span style="color:#bd93f9">1346358</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1345111</span>_group1 <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1346340</span>  <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">8</span>          <span style="color:#ff79c6">|</span> tag.<span style="color:#ff79c6">location</span>.<span style="color:#ff79c6">default</span>: <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">int</span>(<span style="color:#bd93f9">11</span>)  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">true</span>     <span style="color:#ff79c6">|</span>          <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------------+----------------+----------+------------+-------------------------+----------+----------+----------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> PROC <span style="color:#f1fa8c">&#39;/colocation_group/1345111.1346358&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------------+--------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> BucketIndex <span style="color:#ff79c6">|</span> {<span style="color:#f1fa8c">&#34;location&#34;</span> : <span style="color:#f1fa8c">&#34;default&#34;</span>} <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------------+--------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> <span style="color:#bd93f9">0</span>           <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1346034</span>                  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1</span>           <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1346034</span>                  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2</span>           <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1346034</span>                  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> <span style="color:#bd93f9">3</span>           <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1346034</span>                  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> <span style="color:#bd93f9">4</span>           <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1346034</span>                  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> <span style="color:#bd93f9">5</span>           <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1346034</span>                  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> <span style="color:#bd93f9">6</span>           <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1346034</span>                  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> <span style="color:#bd93f9">7</span>           <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1346034</span>                  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------------+--------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>如果 colocate 节点发生变化，节点宕机等等，Stable 属性就变成 false，join 的时候会退化为 普通 join</p>
</blockquote>
<p>创建两个表</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">`</span>tbl1<span style="color:#ff79c6">`</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>k1<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">date</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>k2<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">int</span>(<span style="color:#bd93f9">11</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>v1<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">int</span>(<span style="color:#bd93f9">11</span>) <span style="color:#ff79c6">SUM</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>) ENGINE<span style="color:#ff79c6">=</span>OLAP
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">AGGREGATE</span> <span style="color:#ff79c6">KEY</span>(<span style="color:#ff79c6">`</span>k1<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>k2<span style="color:#ff79c6">`</span>)
</span></span><span style="display:flex;"><span>PARTITION <span style="color:#ff79c6">BY</span> RANGE(<span style="color:#ff79c6">`</span>k1<span style="color:#ff79c6">`</span>)
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    PARTITION p1 <span style="color:#ff79c6">VALUES</span> <span style="color:#ff79c6">LESS</span> <span style="color:#ff79c6">THAN</span> (<span style="color:#f1fa8c">&#39;2019-05-31&#39;</span>),
</span></span><span style="display:flex;"><span>    PARTITION p2 <span style="color:#ff79c6">VALUES</span> <span style="color:#ff79c6">LESS</span> <span style="color:#ff79c6">THAN</span> (<span style="color:#f1fa8c">&#39;2019-06-30&#39;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH(<span style="color:#ff79c6">`</span>k2<span style="color:#ff79c6">`</span>) BUCKETS <span style="color:#bd93f9">8</span>
</span></span><span style="display:flex;"><span>PROPERTIES (
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;colocate_with&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;group1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;replication_num&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">`</span>tbl2<span style="color:#ff79c6">`</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>k1<span style="color:#ff79c6">`</span> datetime <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>k2<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">int</span>(<span style="color:#bd93f9">11</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">`</span>v1<span style="color:#ff79c6">`</span> double <span style="color:#ff79c6">SUM</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>) ENGINE<span style="color:#ff79c6">=</span>OLAP
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">AGGREGATE</span> <span style="color:#ff79c6">KEY</span>(<span style="color:#ff79c6">`</span>k1<span style="color:#ff79c6">`</span>, <span style="color:#ff79c6">`</span>k2<span style="color:#ff79c6">`</span>)
</span></span><span style="display:flex;"><span>DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH(<span style="color:#ff79c6">`</span>k2<span style="color:#ff79c6">`</span>) BUCKETS <span style="color:#bd93f9">8</span>
</span></span><span style="display:flex;"><span>PROPERTIES (
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;colocate_with&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;group1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;replication_num&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>查询</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">DESC</span> <span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> tbl1 <span style="color:#ff79c6">INNER</span> <span style="color:#ff79c6">JOIN</span> tbl2 <span style="color:#ff79c6">ON</span> (tbl1.k2 <span style="color:#ff79c6">=</span> tbl2.k2);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------------------------------------------------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Explain</span> String                                                                                       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------------------------------------------------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> PLAN FRAGMENT <span style="color:#bd93f9">0</span>                                                                                      <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">OUTPUT</span> EXPRS:                                                                                      <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>     k1[<span style="color:#ff79c6">#</span><span style="color:#bd93f9">12</span>]                                                                                          <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>     k2[<span style="color:#ff79c6">#</span><span style="color:#bd93f9">13</span>]                                                                                          <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>     v1[<span style="color:#ff79c6">#</span><span style="color:#bd93f9">14</span>]                                                                                          <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>     k1[<span style="color:#ff79c6">#</span><span style="color:#bd93f9">15</span>]                                                                                          <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>     k2[<span style="color:#ff79c6">#</span><span style="color:#bd93f9">16</span>]                                                                                          <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>     v1[<span style="color:#ff79c6">#</span><span style="color:#bd93f9">17</span>]                                                                                          <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   PARTITION: UNPARTITIONED                                                                           <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                                                                                                      <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   VRESULT SINK                                                                                       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                                                                                                      <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#bd93f9">3</span>:VEXCHANGE                                                                                        <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">offset</span>: <span style="color:#bd93f9">0</span>                                                                                       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                                                                                                      <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> PLAN FRAGMENT <span style="color:#bd93f9">1</span>                                                                                      <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                                                                                                      <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   PARTITION: HASH_PARTITIONED: k2[<span style="color:#ff79c6">#</span><span style="color:#bd93f9">4</span>]                                                                <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                                                                                                      <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   STREAM <span style="color:#ff79c6">DATA</span> SINK                                                                                   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>     EXCHANGE ID: <span style="color:#bd93f9">03</span>                                                                                  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>     UNPARTITIONED                                                                                    <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                                                                                                      <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#bd93f9">2</span>:VHASH <span style="color:#ff79c6">JOIN</span>                                                                                       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>  <span style="color:#ff79c6">join</span> op: <span style="color:#ff79c6">INNER</span> <span style="color:#ff79c6">JOIN</span>(COLOCATE[])[]                                                               <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>  equal <span style="color:#ff79c6">join</span> conjunct: k2[<span style="color:#ff79c6">#</span><span style="color:#bd93f9">4</span>] <span style="color:#ff79c6">=</span> k2[<span style="color:#ff79c6">#</span><span style="color:#bd93f9">1</span>]                                                            <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>  runtime filters: RF000[in_or_bloom] <span style="color:#ff79c6">&lt;-</span> k2[<span style="color:#ff79c6">#</span><span style="color:#bd93f9">1</span>](<span style="color:#bd93f9">1</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1048576</span>)                                      <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>  <span style="color:#ff79c6">cardinality</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>                                                                                   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>  vec <span style="color:#ff79c6">output</span> tuple id: <span style="color:#bd93f9">3</span>                                                                          <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>  vIntermediate tuple ids: <span style="color:#bd93f9">2</span>                                                                      <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>  hash <span style="color:#ff79c6">output</span> slot ids: <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">1</span> <span style="color:#bd93f9">2</span> <span style="color:#bd93f9">3</span> <span style="color:#bd93f9">4</span> <span style="color:#bd93f9">5</span>                                                               <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>                                                                                                  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span><span style="color:#6272a4">----0:VOlapScanNode                                                                               |
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">TABLE</span>: default_cluster:demo.tbl2(tbl2), PREAGGREGATION: <span style="color:#ff79c6">OFF</span>. Reason: <span style="color:#ff79c6">No</span> <span style="color:#ff79c6">aggregate</span> <span style="color:#ff79c6">on</span> scan. <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>       partitions<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1</span>, tablets<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">0</span>, tabletList<span style="color:#ff79c6">=</span>                                                   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">cardinality</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>, avgRowSize<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">0</span>, numNodes<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>                                                  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>       pushAggOp<span style="color:#ff79c6">=</span><span style="color:#ff79c6">NONE</span>                                                                             <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>                                                                                                  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#bd93f9">1</span>:VOlapScanNode                                                                                    <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">TABLE</span>: default_cluster:demo.tbl1(tbl1), PREAGGREGATION: <span style="color:#ff79c6">OFF</span>. Reason: <span style="color:#ff79c6">No</span> <span style="color:#ff79c6">aggregate</span> <span style="color:#ff79c6">on</span> scan.      <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>      runtime filters: RF000[in_or_bloom] <span style="color:#ff79c6">-&gt;</span> k2[<span style="color:#ff79c6">#</span><span style="color:#bd93f9">4</span>]                                                   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>      partitions<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">2</span>, tablets<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">0</span>, tabletList<span style="color:#ff79c6">=</span>                                                        <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">cardinality</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>, avgRowSize<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">0</span>, numNodes<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>                                                       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>      pushAggOp<span style="color:#ff79c6">=</span><span style="color:#ff79c6">NONE</span>                                                                                  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------------------------------------------------------------------------------------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>join 部分显示：join op: INNER JOIN(COLOCATE[])[] <br>
使用到了 colocate join 了<br>
如果没有用到，则可能会显示 BROADCAST 等信息<br>
同时显示 colocate join 失败的原因，如：colocate: false, reason: group is not stable</p>
<p>一些 fe 参数</p>
<ul>
<li>disable_colocate_relocate</li>
<li>disable_colocate_balance</li>
<li>disable_colocate_join</li>
<li>use_new_tablet_scheduler</li>
</ul>
<p>还可以通过 API（需要认证），展示 colocate 配置，Stable、UnStable，等</p>
<h3 id="runtime-filter">Runtime Filter</h3>
<p>就是一种运行期的 filter，可以让 大表 扫描出更少的数据，这样 join 的效率更高</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">|</span>          <span style="color:#ff79c6">&gt;</span>      HashJoinNode     <span style="color:#ff79c6">&lt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span>                         <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">6000</span>                    <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2000</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span>                         <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   OlapScanNode              OlapScanNode
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">^</span>                         <span style="color:#ff79c6">^</span>   
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">100000</span>                  <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2000</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>        T1                        T2
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>甚至可以将 filter 下推到数据源层</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">|</span>          <span style="color:#ff79c6">&gt;</span>      HashJoinNode     <span style="color:#ff79c6">&lt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span>                         <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">6000</span>                    <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2000</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span>                         <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   OlapScanNode              OlapScanNode
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">^</span>                         <span style="color:#ff79c6">^</span>   
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">6000</span>                    <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2000</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>        T1                        T2
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> test (t1 <span style="color:#8be9fd;font-style:italic">INT</span>) DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH (t1) BUCKETS <span style="color:#bd93f9">2</span> PROPERTIES(<span style="color:#f1fa8c">&#34;replication_num&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;1&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> test <span style="color:#ff79c6">VALUES</span> (<span style="color:#bd93f9">1</span>), (<span style="color:#bd93f9">2</span>), (<span style="color:#bd93f9">3</span>), (<span style="color:#bd93f9">4</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> test2 (t2 <span style="color:#8be9fd;font-style:italic">INT</span>) DISTRIBUTED <span style="color:#ff79c6">BY</span> HASH (t2) BUCKETS <span style="color:#bd93f9">2</span> PROPERTIES(<span style="color:#f1fa8c">&#34;replication_num&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;1&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> test2 <span style="color:#ff79c6">VALUES</span> (<span style="color:#bd93f9">3</span>), (<span style="color:#bd93f9">4</span>), (<span style="color:#bd93f9">5</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>查询</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">EXPLAIN</span> <span style="color:#ff79c6">SELECT</span> t1 <span style="color:#ff79c6">FROM</span> test <span style="color:#ff79c6">JOIN</span> test2 <span style="color:#ff79c6">where</span> test.t1 <span style="color:#ff79c6">=</span> test2.t2;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Explain</span> String                                                    <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> PLAN FRAGMENT <span style="color:#bd93f9">0</span>                                                   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">OUTPUT</span> EXPRS:                                                   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>     t1[<span style="color:#ff79c6">#</span><span style="color:#bd93f9">4</span>]                                                        <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   PARTITION: UNPARTITIONED                                        <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                                                                   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   VRESULT SINK                                                    <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                                                                   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#bd93f9">4</span>:VEXCHANGE                                                     <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">offset</span>: <span style="color:#bd93f9">0</span>                                                    <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                                                                   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> PLAN FRAGMENT <span style="color:#bd93f9">1</span>                                                   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                                                                   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   PARTITION: HASH_PARTITIONED: t1[<span style="color:#ff79c6">#</span><span style="color:#bd93f9">1</span>]                             <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                                                                   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   STREAM <span style="color:#ff79c6">DATA</span> SINK                                                <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>     EXCHANGE ID: <span style="color:#bd93f9">04</span>                                               <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>     UNPARTITIONED                                                 <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                                                                   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#bd93f9">3</span>:VHASH <span style="color:#ff79c6">JOIN</span>                                                    <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>  <span style="color:#ff79c6">join</span> op: <span style="color:#ff79c6">INNER</span> <span style="color:#ff79c6">JOIN</span>(BUCKET_SHUFFLE)[]                        <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>  equal <span style="color:#ff79c6">join</span> conjunct: t1[<span style="color:#ff79c6">#</span><span style="color:#bd93f9">1</span>] <span style="color:#ff79c6">=</span> t2[<span style="color:#ff79c6">#</span><span style="color:#bd93f9">0</span>]                         <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>  runtime filters: RF000[in_or_bloom] <span style="color:#ff79c6">&lt;-</span> t2[<span style="color:#ff79c6">#</span><span style="color:#bd93f9">0</span>](<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">0</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">2097152</span>)  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>  <span style="color:#ff79c6">cardinality</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>                                                <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>  vec <span style="color:#ff79c6">output</span> tuple id: <span style="color:#bd93f9">3</span>                                       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>  vIntermediate tuple ids: <span style="color:#bd93f9">2</span>                                   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>  hash <span style="color:#ff79c6">output</span> slot ids: <span style="color:#bd93f9">1</span>                                      <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>                                                               <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span><span style="color:#6272a4">----1:VEXCHANGE                                                |
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>       <span style="color:#ff79c6">offset</span>: <span style="color:#bd93f9">0</span>                                               <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#ff79c6">|</span>                                                               <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#bd93f9">2</span>:VOlapScanNode                                                 <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">TABLE</span>: default_cluster:demo.test(test), PREAGGREGATION: <span style="color:#ff79c6">ON</span>   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>      runtime filters: RF000[in_or_bloom] <span style="color:#ff79c6">-&gt;</span> t1[<span style="color:#ff79c6">#</span><span style="color:#bd93f9">1</span>]                <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>      partitions<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1</span>, tablets<span style="color:#ff79c6">=</span><span style="color:#bd93f9">2</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">2</span>, tabletList<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1346417</span>,<span style="color:#bd93f9">1346419</span>      <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">cardinality</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>, avgRowSize<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">0</span>, numNodes<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>                    <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>      pushAggOp<span style="color:#ff79c6">=</span><span style="color:#ff79c6">NONE</span>                                               <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                                                                   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> PLAN FRAGMENT <span style="color:#bd93f9">2</span>                                                   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                                                                   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   PARTITION: HASH_PARTITIONED: t2[<span style="color:#ff79c6">#</span><span style="color:#bd93f9">0</span>]                             <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                                                                   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   STREAM <span style="color:#ff79c6">DATA</span> SINK                                                <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>     EXCHANGE ID: <span style="color:#bd93f9">01</span>                                               <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>     BUCKET_SHFFULE_HASH_PARTITIONED: t2[<span style="color:#ff79c6">#</span><span style="color:#bd93f9">0</span>]                       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>                                                                   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#bd93f9">0</span>:VOlapScanNode                                                 <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">TABLE</span>: default_cluster:demo.test2(test2), PREAGGREGATION: <span style="color:#ff79c6">ON</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>      partitions<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1</span>, tablets<span style="color:#ff79c6">=</span><span style="color:#bd93f9">2</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">2</span>, tabletList<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1346425</span>,<span style="color:#bd93f9">1346427</span>      <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>      <span style="color:#ff79c6">cardinality</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>, avgRowSize<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">0</span>, numNodes<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>                    <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>      pushAggOp<span style="color:#ff79c6">=</span><span style="color:#ff79c6">NONE</span>                                               <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------------------------------------------------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>限制</p>
<ul>
<li>支持 in，min，max，bloom filter</li>
<li>只支持等值条件</li>
</ul>
<h3 id="doris-join-optimization-principle">Doris Join Optimization Principle</h3>
<p>支持两种 hash</p>
<ul>
<li>Hash Join</li>
<li>Nest Loop Join.</li>
</ul>
<p>Shuffle way</p>
<ul>
<li>
<p>BroadCast Join，支持 hash 和 nest loop，类似于spark 的 BHJ，BNLP

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/22/7gNGIm.png">
            <img class="mx-auto" alt="https://cdnd.selectdb.com/assets/images/image-20220523152004731-75f68720dea2695d7041d74458cd9971.png" src="https://v1.ax1x.com/2024/05/22/7gNGIm.png" />
        </a>
    </p>
</li>
<li>
<p>Shuffle Join，只支持 hash，类似于 spark 的 SHJ

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/22/7gN8v5.png">
            <img class="mx-auto" alt="https://cdnd.selectdb.com/assets/images/image-20220523151902368-0d9eb00032651d13327e8f892c900d5d.png" src="https://v1.ax1x.com/2024/05/22/7gN8v5.png" />
        </a>
    </p>
</li>
<li>
<p>Bucket Shuffle Join，B 将数据拆分，将对应部分发送到不同节点上

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/22/7gNhQj.png">
            <img class="mx-auto" alt="https://cdnd.selectdb.com/assets/images/image-20220523151653562-fd271b904ccbcb92772d20859c4f911c.png" src="https://v1.ax1x.com/2024/05/22/7gNhQj.png" />
        </a>
    </p>
</li>
<li>
<p>Colocation，两个表的数据完全按照预定的分布，没有网络开销

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/22/7gNb63.png">
            <img class="mx-auto" alt="https://cdnd.selectdb.com/assets/images/image-20220523151619754-3bea8f49aed07cd8707f03d7aeccb57a.png" src="https://v1.ax1x.com/2024/05/22/7gNb63.png" />
        </a>
    </p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Shuffle Mode</th>
<th>Network Overhead</th>
<th>Physical Operators</th>
<th>Applicable Scenarios</th>
</tr>
</thead>
<tbody>
<tr>
<td>BroadCast</td>
<td>N * T(R)</td>
<td>Hash Join / Nest Loop Join</td>
<td>Universal</td>
</tr>
<tr>
<td>Shuffle</td>
<td>T(S) + T(R)</td>
<td>Hash Join</td>
<td>General</td>
</tr>
<tr>
<td>Bucket Shuffle</td>
<td>T(R)</td>
<td>Hash Join</td>
<td>There are distributed columns in the left table in the join condition, and the left table is executed as a single partition</td>
</tr>
<tr>
<td>Colocate</td>
<td>0</td>
<td>Hash Join</td>
<td>There are distributed columns in the left table in the join condition, and the left and right tables belong to the same Colocate Group</td>
</tr>
</tbody>
</table>
<p>Runtime Filter Type</p>
<ul>
<li>In</li>
<li>min，max</li>
<li>Bloom Filter
Join Reader，当前支持的 join reoder 规则</li>
<li>大表 join 小表，中间结果尽可能小</li>
<li>将带条件的 join 表往前放</li>
<li>hash join 的优先级比 nest loop join 更高

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/22/7gNAxh.png">
            <img class="mx-auto" alt="https://cdnd.selectdb.com/assets/images/image-20220523152639123-ccc02aa26d7cfa769f09024ebd8395e1.png" src="https://v1.ax1x.com/2024/05/22/7gNAxh.png" />
        </a>
    </li>
</ul>
<p>Doris Join tuning method</p>
<ul>
<li>利用 profile，这里有非常详细的执行信息</li>
<li>了解 jion 的机制</li>
<li>使用session变量更改行为</li>
<li>检查 查询计划</li>
</ul>
<p>Optimization case practice</p>
<ul>
<li>case 1
四个表的 join，检查 profile，build rows 左表太大，probe rows 右表太小<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/22/7gN5L4.png">
            <img class="mx-auto" alt="https://cdnd.selectdb.com/assets/images/image-20220523153600797-8c0110f8498c2b6b54fe9dfa6b6f89bf.png" src="https://v1.ax1x.com/2024/05/22/7gN5L4.png" />
        </a>
    <br>
调整 join order</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">set</span> enable_cost_based_join_reorder <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>之后就好很多了<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/22/7gNV49.png">
            <img class="mx-auto" alt="https://cdnd.selectdb.com/assets/images/image-20220523153757607-aced93bcd65de383a68aca075909885c.png" src="https://v1.ax1x.com/2024/05/22/7gNV49.png" />
        </a>
    </p>
<ul>
<li>
<p>case 2
这个是左右表都挺大，但是 runtime filter 没生效<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/22/7gNc9Y.png">
            <img class="mx-auto" alt="https://cdnd.selectdb.com/assets/images/image-20220523153913059-c430baf5eae63c272d3e1355636ccad8.png" src="https://v1.ax1x.com/2024/05/22/7gNc9Y.png" />
        </a>
    <br>
没生效的原因是 in 条件中做 filter，默认只过滤 1024，所以需要调整<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/22/7gNvKH.png">
            <img class="mx-auto" alt="https://cdnd.selectdb.com/assets/images/image-20220523153958828-1e0aaf5df637b5db23a27c9f97c22bea.png" src="https://v1.ax1x.com/2024/05/22/7gNvKH.png" />
        </a>
    </p>
</li>
<li>
<p>case 3
原始的查询sql</p>
</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">select</span> <span style="color:#bd93f9">100</span>.<span style="color:#bd93f9">00</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">sum</span> (<span style="color:#ff79c6">case</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">when</span> P_type <span style="color:#ff79c6">like</span> <span style="color:#f1fa8c">&#39;PROMOS&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">then</span> <span style="color:#bd93f9">1</span> extendedprice <span style="color:#ff79c6">*</span> (<span style="color:#bd93f9">1</span> <span style="color:#ff79c6">-</span> <span style="color:#bd93f9">1</span> discount)
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">else</span> <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">end</span> ) <span style="color:#ff79c6">/</span> <span style="color:#ff79c6">sum</span>(<span style="color:#bd93f9">1</span> extendedprice <span style="color:#ff79c6">*</span> (<span style="color:#bd93f9">1</span> <span style="color:#ff79c6">-</span> <span style="color:#bd93f9">1</span> discount)) <span style="color:#ff79c6">as</span> promo revenue
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> lineitem, part
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">where</span>
</span></span><span style="display:flex;"><span>    <span style="color:#bd93f9">1</span>_partkey <span style="color:#ff79c6">=</span> p_partkey
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">and</span> <span style="color:#bd93f9">1</span>_shipdate <span style="color:#ff79c6">&gt;=</span> <span style="color:#8be9fd;font-style:italic">date</span> <span style="color:#f1fa8c">&#39;1997-06-01&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">and</span> <span style="color:#bd93f9">1</span> shipdate <span style="color:#ff79c6">&lt;</span> <span style="color:#8be9fd;font-style:italic">date</span> <span style="color:#f1fa8c">&#39;1997-06-01&#39;</span> <span style="color:#ff79c6">+</span> <span style="color:#8be9fd;font-style:italic">interval</span> <span style="color:#f1fa8c">&#39;1&#39;</span> <span style="color:#ff79c6">month</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>左表很小，因为经过了两次 filter过滤，但是却选择了 大表做为 build

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/22/7gND6U.png">
            <img class="mx-auto" alt="https://cdnd.selectdb.com/assets/images/image-20220523154712519-ff90fd895d5eed317bcc989f77b5b8bb.png" src="https://v1.ax1x.com/2024/05/22/7gND6U.png" />
        </a>
       <br>
这是因为 doris 还没有足够的信息，收集这些统计数据，导致错误的 join order<br>
可以手动调整，将上 join hint，使用 shuffle 方式，这样就能提升很多<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/22/7gNa1Z.png">
            <img class="mx-auto" alt="https://cdnd.selectdb.com/assets/images/image-20220523160915229-e2e523c3e6e9e79d17e9849c1d8aa8f1.png" src="https://v1.ax1x.com/2024/05/22/7gNa1Z.png" />
        </a>
    </p>
<p>Doris Join optimization suggestion</p>
<ul>
<li>选择简单类型做join，匹配的类型要相等，避免cast</li>
<li>选择 key 列作为 join 条件，这对延迟物化也有效果</li>
<li>两个大表做 join，选择 Co-location 方式，这样就避免了网络开销，因为大表join 的网络开销会很大</li>
<li>Runtime Filter 在高选择率时效果非常好，但可能会有副作用，需要根据场景细粒度调整 sql</li>
<li>多表 join 的时候，确保左表时大表，右表 build 表是小表，hash 的效果比 nest loop好，必要时可以用 hint 调整</li>
</ul>
<h1 id="lakehouse">Lakehouse</h1>
<h2 id="multi-catalog">Multi-catalog</h2>
<h3 id="multi-catalog-overview">Multi-catalog Overview</h3>
<p>让doris 可以做数据湖分析，联邦查询<br>
之前是两层结构，database -&gt; table，现在是三层结构<br>
catalog -&gt; database -&gt; table<br>
目前支持的数据源</p>
<ul>
<li>Apache Hive</li>
<li>Apache Iceberg</li>
<li>Apache Hudi</li>
<li>Elasticsearch</li>
<li>JDBC</li>
<li>Apache Paimon(Incubating)</li>
</ul>
<p>基本命令</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> CATALOGS
</span></span><span style="display:flex;"><span>SWITCH internal;
</span></span><span style="display:flex;"><span>SWITCH hive_catalog;
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建 hive 外部 catalog</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">CATALOG</span> hive PROPERTIES (
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;type&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;hms&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;hive.metastore.uris&#39;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;thrift://172.21.0.1:7004&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>元数据刷新，支持</p>
<ul>
<li>hive: Hive MetaStore</li>
<li>es: Elasticsearch</li>
<li>jdbc: standard interface for database access (JDBC)</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Set the catalog refresh interval to 20 seconds
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">CATALOG</span> es PROPERTIES (
</span></span><span style="display:flex;"><span>     <span style="color:#f1fa8c">&#34;type&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;es&#34;</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#f1fa8c">&#34;hosts&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;http://127.0.0.1:9200&#34;</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#f1fa8c">&#34;metadata_refresh_interval_sec&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;20&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>也支持 ranger 做鉴权</p>
<h3 id="hive">Hive</h3>
<p>Iceberg, Hudi 也用 hive metasotre作为元数据层，所以兼容 hive metastore 的系统也可以被访问到<br>
配置 ha</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">CATALOG</span> hive PROPERTIES (
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;type&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;hms&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;hive.metastore.uris&#39;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;thrift://172.0.0.1:9083&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;hadoop.username&#39;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;hive&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;dfs.nameservices&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;your-nameservice&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;dfs.ha.namenodes.your-nameservice&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;nn1,nn2&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;dfs.namenode.rpc-address.your-nameservice.nn1&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;172.21.0.2:8088&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;dfs.namenode.rpc-address.your-nameservice.nn2&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;172.21.0.3:8088&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;dfs.client.failover.proxy.provider.your-nameservice&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>HA 和 kerberos</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">CATALOG</span> hive PROPERTIES (
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;type&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;hms&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;hive.metastore.uris&#39;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;thrift://172.0.0.1:9083&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;hive.metastore.sasl.enabled&#39;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;true&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;hive.metastore.kerberos.principal&#39;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;your-hms-principal&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;dfs.nameservices&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;your-nameservice&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;dfs.ha.namenodes.your-nameservice&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;nn1,nn2&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;dfs.namenode.rpc-address.your-nameservice.nn1&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;172.21.0.2:8088&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;dfs.namenode.rpc-address.your-nameservice.nn2&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;172.21.0.3:8088&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;dfs.client.failover.proxy.provider.your-nameservice&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;hadoop.security.authentication&#39;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;kerberos&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;hadoop.kerberos.keytab&#39;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;/your-keytab-filepath/your.keytab&#39;</span>,   
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;hadoop.kerberos.principal&#39;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;your-principal@YOUR.COM&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;yarn.resourcemanager.principal&#39;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;your-rm-principal&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>支持其他的文件系统包括</p>
<ul>
<li>VIEWFS</li>
<li>JuiceFS</li>
<li>S3</li>
<li>OSS</li>
<li>OBS</li>
<li>COS</li>
<li>Glue</li>
</ul>
<p>For Hive Catalog, 4 types of metadata are cached in Doris:</p>
<ul>
<li>Table structure: cache table column information, etc.</li>
<li>Partition value: Cache the partition value information of all partitions of a table.</li>
<li>Partition information: Cache the information of each partition, such as partition data format, partition storage location, partition value, etc.</li>
<li>File information: Cache the file information corresponding to each partition, such as file path location, etc.</li>
</ul>
<p>当节点宕机后，会再次获取 hive 拿到元数据，默认 cache 失效为 10分钟</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">CATALOG</span> hive PROPERTIES (
</span></span><span style="display:flex;"><span>     <span style="color:#f1fa8c">&#39;type&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;hms&#39;</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#f1fa8c">&#39;hive.metastore.uris&#39;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;thrift://172.0.0.1:9083&#39;</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#f1fa8c">&#39;file.meta.cache.ttl-second&#39;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;60&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>手动刷新，指定的库，指定的表</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>REFRESH <span style="color:#ff79c6">CATALOG</span> ctl1 PROPERTIES(<span style="color:#f1fa8c">&#34;invalid_cache&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;true&#34;</span>);
</span></span><span style="display:flex;"><span>REFRESH <span style="color:#ff79c6">DATABASE</span> [ctl.]db1 PROPERTIES(<span style="color:#f1fa8c">&#34;invalid_cache&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;true&#34;</span>);
</span></span><span style="display:flex;"><span>REFRESH <span style="color:#ff79c6">TABLE</span> [ctl.][db.]tbl1;
</span></span></code></pre></td></tr></table>
</div>
</div><p>周期刷新</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">CATALOG</span> hive PROPERTIES (
</span></span><span style="display:flex;"><span>     <span style="color:#f1fa8c">&#39;type&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;hms&#39;</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#f1fa8c">&#39;hive.metastore.uris&#39;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;thrift://172.0.0.1:9083&#39;</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#f1fa8c">&#39;metadata_refresh_interval_sec&#39;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;600&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>整合 rangeer，增加一些配置</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;access_controller.properties.ranger.service.name&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;hive&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;access_controller.class&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;org.apache.doris.catalog.authorizer.RangerHiveAccessControllerFactory&#34;</span>,
</span></span></code></pre></td></tr></table>
</div>
</div><p>Copy the configuration files ranger-hive-audit.xml, ranger-hive-security.xml, and ranger-policymgr-ssl.xml under the HMS conf directory to the FE conf directory<br>
放到 conf 目录中，重启 fe</p>
<p>Best Practices</p>
<ul>
<li>Create user user1 on the ranger side and authorize the query permission of db1.table1.col1</li>
<li>Create role role1 on the ranger side and authorize the query permission of db1.table1.col2</li>
<li>Create a user user1 with the same name in doris, user1 will directly have the query authority of db1.table1.col1</li>
<li>Create role1 with the same name in doris, and assign role1 to user1, user1 will have the query authority of db1.table1.col1 and col2 at the same time</li>
</ul>
<h3 id="jdbc">JDBC</h3>
<p>创建 mysql 的</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">CATALOG</span> jdbc_mysql PROPERTIES (
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;type&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;jdbc&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;user&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;root&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;password&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;123456&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;jdbc_url&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;jdbc:mysql://127.0.0.1:3306/demo&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;driver_url&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;mysql-connector-java-5.1.47.jar&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;driver_class&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;com.mysql.jdbc.Driver&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>查询`</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">show</span> catalogs;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------+-------------+----------+-----------+-------------------------+---------------------+------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> CatalogId <span style="color:#ff79c6">|</span> CatalogName <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Type</span>     <span style="color:#ff79c6">|</span> IsCurrent <span style="color:#ff79c6">|</span> CreateTime              <span style="color:#ff79c6">|</span> LastUpdateTime      <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Comment</span>                <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------+-------------+----------+-----------+-------------------------+---------------------+------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>         <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">|</span> internal    <span style="color:#ff79c6">|</span> internal <span style="color:#ff79c6">|</span>           <span style="color:#ff79c6">|</span> UNRECORDED              <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span>                <span style="color:#ff79c6">|</span> Doris internal <span style="color:#ff79c6">catalog</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>   <span style="color:#bd93f9">1346433</span> <span style="color:#ff79c6">|</span> jdbc_mysql  <span style="color:#ff79c6">|</span> jdbc     <span style="color:#ff79c6">|</span> yes       <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2024</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">01</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">05</span> <span style="color:#bd93f9">09</span>:<span style="color:#bd93f9">37</span>:<span style="color:#bd93f9">58</span>.<span style="color:#bd93f9">788</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2024</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">01</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">05</span> <span style="color:#bd93f9">09</span>:<span style="color:#bd93f9">38</span>:<span style="color:#bd93f9">13</span> <span style="color:#ff79c6">|</span>                        <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-----------+-------------+----------+-----------+-------------------------+---------------------+------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> jdbc_mysql.hello.t1 <span style="color:#ff79c6">LIMIT</span> <span style="color:#bd93f9">10</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------+-------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> id   <span style="color:#ff79c6">|</span> sname <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------+-------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>    <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">|</span> aaa   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>    <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">|</span> bbb   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>    <span style="color:#bd93f9">3</span> <span style="color:#ff79c6">|</span> ccc   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>    <span style="color:#bd93f9">4</span> <span style="color:#ff79c6">|</span> ddd   <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------+-------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>支持的 JDBC 类型</p>
<ul>
<li>MySQL</li>
<li>PostgreSQL</li>
<li>Oracle</li>
<li>SQLServer</li>
<li>Doris</li>
<li>Clickhouse</li>
<li>SAP HANA</li>
<li>Trino</li>
<li>Presto</li>
<li>OceanBase</li>
</ul>
<p>查询</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> TABLES <span style="color:#ff79c6">FROM</span> <span style="color:#ff79c6">&lt;</span><span style="color:#ff79c6">catalog_name</span><span style="color:#ff79c6">&gt;</span>.<span style="color:#ff79c6">&lt;</span>database_name<span style="color:#ff79c6">&gt;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> TABLES <span style="color:#ff79c6">FROM</span> <span style="color:#ff79c6">&lt;</span>database_name<span style="color:#ff79c6">&gt;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> TABLES;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="file-analysis">File Analysis</h2>
<p>支持文件格式自动推断</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">DESC</span> <span style="color:#ff79c6">FUNCTION</span> s3 (
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;URI&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;http://127.0.0.1:9312/test2/test.snappy.parquet&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;s3.access_key&#34;</span><span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;ak&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;s3.secret_key&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;sk&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;format&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;parquet&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;use_path_style&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="file-cache">File Cache</h2>
<p>开启</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SET</span> enable_file_cache <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SET</span> <span style="color:#ff79c6">GLOBAL</span> enable_file_cache <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>当 be 从远端读数据时，会将文件拆分放入 block 中，后续请求就直接命中缓存<br>
相关配置在<code>conf/be.conf</code></p>
<p>通过 profile 检查是否被缓存了</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">-</span>  FileCache:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">-</span>  IOHitCacheNum:  <span style="color:#bd93f9">552</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">-</span>  IOTotalNum:  <span style="color:#bd93f9">835</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">-</span>  ReadFromFileCacheBytes:  <span style="color:#bd93f9">19</span>.<span style="color:#bd93f9">98</span>  MB
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">-</span>  ReadFromWriteCacheBytes:  <span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">00</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">-</span>  ReadTotalBytes:  <span style="color:#bd93f9">29</span>.<span style="color:#bd93f9">52</span>  MB
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">-</span>  WriteInFileCacheBytes:  <span style="color:#bd93f9">915</span>.<span style="color:#bd93f9">77</span>  MB
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">-</span>  WriteInFileCacheNum:  <span style="color:#bd93f9">283</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="external-table-statistics">External Table Statistics</h2>
<p>用于收集外部表的统计信息</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">ANALYZE</span> <span style="color:#ff79c6">TABLE</span>  sample_table;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">--------------+-------------------------+--------------+---------------+---------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Catalog_Name</span> <span style="color:#ff79c6">|</span> DB_Name                 <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Table_Name</span>   <span style="color:#ff79c6">|</span> Columns       <span style="color:#ff79c6">|</span> Job_Id  <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">--------------+-------------------------+--------------+---------------+---------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> hive         <span style="color:#ff79c6">|</span> default_cluster:<span style="color:#ff79c6">default</span> <span style="color:#ff79c6">|</span> sample_table <span style="color:#ff79c6">|</span> [name,id,age] <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1346450</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">--------------+-------------------------+--------------+---------------+---------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>展示结果</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">show</span> <span style="color:#ff79c6">analyze</span> <span style="color:#bd93f9">1346450</span>\<span style="color:#ff79c6">G</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">***************************</span> <span style="color:#bd93f9">1</span>. <span style="color:#ff79c6">row</span> <span style="color:#ff79c6">***************************</span>
</span></span><span style="display:flex;"><span>              job_id: <span style="color:#bd93f9">1346450</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">catalog_name</span>: hive
</span></span><span style="display:flex;"><span>             db_name: default_cluster:<span style="color:#ff79c6">default</span>
</span></span><span style="display:flex;"><span>            tbl_name: sample_table
</span></span><span style="display:flex;"><span>            col_name: [name,id,age]
</span></span><span style="display:flex;"><span>            job_type: MANUAL
</span></span><span style="display:flex;"><span>       analysis_type: FUNDAMENTALS
</span></span><span style="display:flex;"><span>             message: 
</span></span><span style="display:flex;"><span>last_exec_time_in_ms: <span style="color:#bd93f9">2024</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">01</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">05</span> <span style="color:#bd93f9">21</span>:<span style="color:#bd93f9">27</span>:<span style="color:#bd93f9">16</span>
</span></span><span style="display:flex;"><span>               <span style="color:#ff79c6">state</span>: FINISHED
</span></span><span style="display:flex;"><span>            progress: <span style="color:#bd93f9">4</span> Finished<span style="color:#ff79c6">/</span><span style="color:#bd93f9">0</span> Failed<span style="color:#ff79c6">/</span><span style="color:#bd93f9">0</span> <span style="color:#ff79c6">In</span> Progress<span style="color:#ff79c6">/</span><span style="color:#bd93f9">4</span> Total
</span></span><span style="display:flex;"><span>       schedule_type: ONCE
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">1</span> <span style="color:#ff79c6">row</span> <span style="color:#ff79c6">in</span> <span style="color:#ff79c6">set</span> (<span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">00</span> sec)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> <span style="color:#ff79c6">ANALYZE</span> TASK STATUS <span style="color:#bd93f9">1346450</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---------+---------------+---------+------------------------+-----------------+----------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> task_id <span style="color:#ff79c6">|</span> col_name      <span style="color:#ff79c6">|</span> message <span style="color:#ff79c6">|</span> last_state_change_time <span style="color:#ff79c6">|</span> time_cost_in_ms <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">state</span>    <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---------+---------------+---------+------------------------+-----------------+----------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1346451</span> <span style="color:#ff79c6">|</span> name          <span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2024</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">01</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">05</span> <span style="color:#bd93f9">21</span>:<span style="color:#bd93f9">27</span>:<span style="color:#bd93f9">16</span>    <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">115</span>             <span style="color:#ff79c6">|</span> FINISHED <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1346452</span> <span style="color:#ff79c6">|</span> id            <span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2024</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">01</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">05</span> <span style="color:#bd93f9">21</span>:<span style="color:#bd93f9">27</span>:<span style="color:#bd93f9">16</span>    <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">115</span>             <span style="color:#ff79c6">|</span> FINISHED <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1346453</span> <span style="color:#ff79c6">|</span> age           <span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2024</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">01</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">05</span> <span style="color:#bd93f9">21</span>:<span style="color:#bd93f9">27</span>:<span style="color:#bd93f9">16</span>    <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">115</span>             <span style="color:#ff79c6">|</span> FINISHED <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> <span style="color:#bd93f9">1346454</span> <span style="color:#ff79c6">|</span> TableRowCount <span style="color:#ff79c6">|</span>         <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">2024</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">01</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">05</span> <span style="color:#bd93f9">21</span>:<span style="color:#bd93f9">27</span>:<span style="color:#bd93f9">16</span>    <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">77</span>              <span style="color:#ff79c6">|</span> FINISHED <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">---------+---------------+---------+------------------------+-----------------+----------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>收集 mysql 的</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">ANALYZE</span> <span style="color:#ff79c6">TABLE</span> jdbc_mysql.hello.t1;
</span></span></code></pre></td></tr></table>
</div>
</div><p>周期性的收集</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">analyze</span> <span style="color:#ff79c6">table</span> hive.tpch100.orders <span style="color:#ff79c6">with</span> period <span style="color:#bd93f9">86400</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>显示所有的状态</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SHOW</span> <span style="color:#ff79c6">ANALYZE</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>终止</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>KILL <span style="color:#ff79c6">ANALYZE</span> [job_id]
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">DROP</span> <span style="color:#ff79c6">ANALYZE</span> JOB [JOB_ID]
</span></span></code></pre></td></tr></table>
</div>
</div><p>还可以修改和删除</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">DROP</span> STATS hive.tpch100.orders
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">DROP</span> STATS hive.tpch100.orders (o_orderkey, o_orderdate)
</span></span></code></pre></td></tr></table>
</div>
</div><p>当初次查询的时候，统计信息模块会收集外部表的 statistic 信息<br>
如果外部表不支持列等信息统计，则会大致评估，这会影响精准度</p>
<h2 id="file-system-benchmark-tools">File System Benchmark Tools</h2>
<p>编译</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>cd doris 
</span></span><span style="display:flex;"><span>BUILD_FS_BENCHMARK<span style="color:#ff79c6">=</span><span style="color:#ff79c6">ON</span> .<span style="color:#ff79c6">/</span>build.sh  <span style="color:#6272a4">--be
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>sh run<span style="color:#ff79c6">-</span>fs<span style="color:#ff79c6">-</span>benchmark.sh \
</span></span><span style="display:flex;"><span>          <span style="color:#6272a4">--conf= configuration file \
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>          <span style="color:#6272a4">--fs_type= file system \
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>          <span style="color:#6272a4">--operation= operations on the file system  \
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>          <span style="color:#6272a4">--file_size= file size \
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>          <span style="color:#6272a4">--threads= the number of threads \
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>          <span style="color:#6272a4">--iterations= the number of iterations
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>执行 hdfs 的</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>sh run<span style="color:#ff79c6">-</span>fs<span style="color:#ff79c6">-</span>benchmark.sh \
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">--conf=hdfs.conf \
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#6272a4">--fs_type=hdfs \
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#6272a4">--operation=create_write  \
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#6272a4">--file_size=1024000 \
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#6272a4">--threads=3 \
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#6272a4">--iterations=5
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>对象存储</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>sh bin<span style="color:#ff79c6">/</span>run<span style="color:#ff79c6">-</span>fs<span style="color:#ff79c6">-</span>benchmark.sh \
</span></span><span style="display:flex;"><span>     <span style="color:#6272a4">--conf=s3.conf \
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>     <span style="color:#6272a4">--fs_type=s3 \
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>     <span style="color:#6272a4">--operation=single_read \
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>     <span style="color:#6272a4">--threads=1 \
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>     <span style="color:#6272a4">--iterations=1
</span></span></span></code></pre></td></tr></table>
</div>
</div><h1 id="ecosystem">Ecosystem</h1>
<h2 id="spark-doris-connector">Spark Doris Connector</h2>
<p>Spark Doris Connector can support reading data stored in Doris and writing data to Doris through Spark.<br>
Github: <a href="https://github.com/apache/doris-spark-connector">https://github.com/apache/doris-spark-connector</a></p>
<p>概述</p>
<ul>
<li>Support reading data from Doris.</li>
<li>Support Spark DataFrame batch/stream writing data to Doris</li>
<li>You can map the Doris table to DataFrame or RDD, it is recommended to use DataFrame.</li>
<li>Support the completion of data filtering on the Doris side to reduce the amount of data transmission.</li>
</ul>
<p>例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">TEMPORARY</span> <span style="color:#ff79c6">VIEW</span> spark_doris
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">USING</span> doris
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">OPTIONS</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;table.identifier&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;$YOUR_DORIS_DATABASE_NAME.$YOUR_DORIS_TABLE_NAME&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;fenodes&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;$YOUR_DORIS_FE_HOSTNAME:$YOUR_DORIS_FE_RESFUL_PORT&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;user&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;$YOUR_DORIS_USERNAME&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;password&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;$YOUR_DORIS_PASSWORD&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> spark_doris;
</span></span></code></pre></td></tr></table>
</div>
</div><p>data frame</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff79c6">val</span> dorisSparkDF <span style="color:#ff79c6">=</span> spark<span style="color:#ff79c6">.</span>read<span style="color:#ff79c6">.</span>format<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;doris&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">.</span>option<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;doris.table.identifier&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;$YOUR_DORIS_DATABASE_NAME.$YOUR_DORIS_TABLE_NAME&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">.</span>option<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;doris.fenodes&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;$YOUR_DORIS_FE_HOSTNAME:$YOUR_DORIS_FE_RESFUL_PORT&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">.</span>option<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;user&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;$YOUR_DORIS_USERNAME&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">.</span>option<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;password&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;$YOUR_DORIS_PASSWORD&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">.</span>load<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dorisSparkDF<span style="color:#ff79c6">.</span>show<span style="color:#ff79c6">(</span><span style="color:#bd93f9">5</span><span style="color:#ff79c6">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>RDD</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> org.apache.doris.spark._
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">val</span> dorisSparkRDD <span style="color:#ff79c6">=</span> sc<span style="color:#ff79c6">.</span>dorisRDD<span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>  tableIdentifier <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">Some</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;$YOUR_DORIS_DATABASE_NAME.$YOUR_DORIS_TABLE_NAME&#34;</span><span style="color:#ff79c6">),</span>
</span></span><span style="display:flex;"><span>  cfg <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">Some</span><span style="color:#ff79c6">(</span><span style="color:#50fa7b">Map</span><span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;doris.fenodes&#34;</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#f1fa8c">&#34;$YOUR_DORIS_FE_HOSTNAME:$YOUR_DORIS_FE_RESFUL_PORT&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;doris.request.auth.user&#34;</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#f1fa8c">&#34;$YOUR_DORIS_USERNAME&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;doris.request.auth.password&#34;</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#f1fa8c">&#34;$YOUR_DORIS_PASSWORD&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dorisSparkRDD<span style="color:#ff79c6">.</span>collect<span style="color:#ff79c6">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>插入</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> spark_doris
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">VALUES</span> (<span style="color:#f1fa8c">&#34;VALUE1&#34;</span>, <span style="color:#f1fa8c">&#34;VALUE2&#34;</span>, ...);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- or
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> spark_doris
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> YOUR_TABLE
</span></span></code></pre></td></tr></table>
</div>
</div><p>也支持 streaming</p>
<h2 id="other-connector">Other Connector</h2>
<p>flink <a href="https://github.com/apache/doris-flink-connector">https://github.com/apache/doris-flink-connector</a></p>
<p>DataX Doriswriter</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;job&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;content&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&#34;reader&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">&#34;name&#34;</span>: <span style="color:#f1fa8c">&#34;mysqlreader&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">&#34;parameter&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&#34;column&#34;</span>: [<span style="color:#f1fa8c">&#34;id&#34;</span>,<span style="color:#f1fa8c">&#34;order_code&#34;</span>,<span style="color:#f1fa8c">&#34;line_code&#34;</span>,<span style="color:#f1fa8c">&#34;remark&#34;</span>,<span style="color:#f1fa8c">&#34;unit_no&#34;</span>,<span style="color:#f1fa8c">&#34;unit_name&#34;</span>,<span style="color:#f1fa8c">&#34;price&#34;</span>],
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&#34;connection&#34;</span>: [
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                <span style="color:#ff79c6">&#34;jdbcUrl&#34;</span>: [<span style="color:#f1fa8c">&#34;jdbc:mysql://localhost:3306/demo&#34;</span>],
</span></span><span style="display:flex;"><span>                                <span style="color:#ff79c6">&#34;table&#34;</span>: [<span style="color:#f1fa8c">&#34;employees_1&#34;</span>]
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                        ],
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&#34;username&#34;</span>: <span style="color:#f1fa8c">&#34;root&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&#34;password&#34;</span>: <span style="color:#f1fa8c">&#34;xxxxx&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&#34;where&#34;</span>: <span style="color:#f1fa8c">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&#34;writer&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">&#34;name&#34;</span>: <span style="color:#f1fa8c">&#34;doriswriter&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">&#34;parameter&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&#34;loadUrl&#34;</span>: [<span style="color:#f1fa8c">&#34;127.0.0.1:8030&#34;</span>],
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&#34;loadProps&#34;</span>: {
</span></span><span style="display:flex;"><span>                        },
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&#34;column&#34;</span>: [<span style="color:#f1fa8c">&#34;id&#34;</span>,<span style="color:#f1fa8c">&#34;order_code&#34;</span>,<span style="color:#f1fa8c">&#34;line_code&#34;</span>,<span style="color:#f1fa8c">&#34;remark&#34;</span>,<span style="color:#f1fa8c">&#34;unit_no&#34;</span>,<span style="color:#f1fa8c">&#34;unit_name&#34;</span>,<span style="color:#f1fa8c">&#34;price&#34;</span>],
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&#34;username&#34;</span>: <span style="color:#f1fa8c">&#34;root&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&#34;password&#34;</span>: <span style="color:#f1fa8c">&#34;xxxxxx&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&#34;postSql&#34;</span>: [<span style="color:#f1fa8c">&#34;select count(1) from all_employees_info&#34;</span>],
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&#34;preSql&#34;</span>: [],
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&#34;flushInterval&#34;</span>:<span style="color:#bd93f9">30000</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&#34;connection&#34;</span>: [
</span></span><span style="display:flex;"><span>                          {
</span></span><span style="display:flex;"><span>                            <span style="color:#ff79c6">&#34;jdbcUrl&#34;</span>: <span style="color:#f1fa8c">&#34;jdbc:mysql://127.0.0.1:9030/demo&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ff79c6">&#34;selectedDatabase&#34;</span>: <span style="color:#f1fa8c">&#34;demo&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ff79c6">&#34;table&#34;</span>: [<span style="color:#f1fa8c">&#34;all_employees_info&#34;</span>]
</span></span><span style="display:flex;"><span>                          }
</span></span><span style="display:flex;"><span>                        ],
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&#34;loadProps&#34;</span>: {
</span></span><span style="display:flex;"><span>                            <span style="color:#ff79c6">&#34;format&#34;</span>: <span style="color:#f1fa8c">&#34;json&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ff79c6">&#34;strip_outer_array&#34;</span>:<span style="color:#f1fa8c">&#34;true&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#ff79c6">&#34;line_delimiter&#34;</span>: <span style="color:#f1fa8c">&#34;\\x02&#34;</span>
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;setting&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&#34;speed&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&#34;channel&#34;</span>: <span style="color:#f1fa8c">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Seatunnel Doris Sink</p>
<p>Kyuubi，将 JDBC 作为引擎接入后，可以作为 Kyuubi 的后端<br>
Logstash Doris Output Plugin<br>
Beats Doris Output Plugin(ES)</p>
<h2 id="plugin-development-manual">Plugin Development Manual</h2>
<p>跟 UDF 不一样，这个不参与 sql 计算的<br>
插件结构</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span># plugin <span style="color:#ff79c6">.</span><span style="color:#50fa7b">zip</span>
</span></span><span style="display:flex;"><span>auditodemo<span style="color:#ff79c6">.</span><span style="color:#50fa7b">zip</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">-</span>plugin<span style="color:#ff79c6">.</span><span style="color:#50fa7b">properties</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">-</span>auditdemo<span style="color:#ff79c6">.</span><span style="color:#50fa7b">jar</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">-</span>xxx<span style="color:#ff79c6">.</span><span style="color:#50fa7b">config</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">-</span>data<span style="color:#ff79c6">/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">-</span>test_data<span style="color:#ff79c6">/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># plugin local directory
</span></span><span style="display:flex;"><span>auditodemo<span style="color:#ff79c6">/:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">-</span>plugin<span style="color:#ff79c6">.</span><span style="color:#50fa7b">properties</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">-</span>auditdemo<span style="color:#ff79c6">.</span><span style="color:#50fa7b">jar</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">-</span>xxx<span style="color:#ff79c6">.</span><span style="color:#50fa7b">config</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">-</span>data<span style="color:#ff79c6">/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">-</span>test_data<span style="color:#ff79c6">/</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>plugin.properties 内容</p>
<pre tabindex="0"><code class="language-properties" data-lang="properties">### required:
#
# the plugin name
name = audit_plugin_demo
#
# the plugin type
type = AUDIT
#
# simple summary of the plugin
description = just for test
#
# Doris&#39;s version, like: 0.11.0
version = 0.11.0

### FE-Plugin optional:
#
# version of java the code is built against
# use the command &#34;java -version&#34; value, like 1.8.0, 9.0.1, 13.0.4
java.version = 1.8.31
#
# the name of the class to load, fully-qualified.
classname = AuditPluginDemo

### BE-Plugin optional:
# the name of the so to load
soName = example.so
</code></pre><p>安装</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>install plugin <span style="color:#ff79c6">from</span> <span style="color:#f1fa8c">&#34;/home/users/doris/auditloader.zip&#34;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>查询</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">show</span> plugins\<span style="color:#ff79c6">G</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">***************************</span> <span style="color:#bd93f9">1</span>. <span style="color:#ff79c6">row</span> <span style="color:#ff79c6">***************************</span>
</span></span><span style="display:flex;"><span>       Name: auditloader
</span></span><span style="display:flex;"><span>       <span style="color:#ff79c6">Type</span>: AUDIT
</span></span><span style="display:flex;"><span>Description: <span style="color:#ff79c6">load</span> audit log <span style="color:#ff79c6">to</span> olap <span style="color:#ff79c6">load</span>, <span style="color:#ff79c6">and</span> <span style="color:#ff79c6">user</span> can <span style="color:#ff79c6">view</span> the statistic <span style="color:#ff79c6">of</span> queries
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">Version</span>: <span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">12</span>.<span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>JavaVersion: <span style="color:#bd93f9">1</span>.<span style="color:#bd93f9">8</span>.<span style="color:#bd93f9">31</span>
</span></span><span style="display:flex;"><span>  ClassName: AuditLoaderPlugin
</span></span><span style="display:flex;"><span>     SoName: <span style="color:#ff79c6">NULL</span>
</span></span><span style="display:flex;"><span>    Sources: <span style="color:#ff79c6">/</span>home<span style="color:#ff79c6">/</span>users<span style="color:#ff79c6">/</span>doris<span style="color:#ff79c6">/</span>auditloader.zip
</span></span><span style="display:flex;"><span>     Status: INSTALLED
</span></span><span style="display:flex;"><span> Properties: {}
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">***************************</span> <span style="color:#bd93f9">2</span>. <span style="color:#ff79c6">row</span> <span style="color:#ff79c6">***************************</span>
</span></span><span style="display:flex;"><span>       Name: AuditLogBuilder
</span></span><span style="display:flex;"><span>       <span style="color:#ff79c6">Type</span>: AUDIT
</span></span><span style="display:flex;"><span>Description: builtin audit logger
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">Version</span>: <span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">12</span>.<span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>JavaVersion: <span style="color:#bd93f9">1</span>.<span style="color:#bd93f9">8</span>.<span style="color:#bd93f9">31</span>
</span></span><span style="display:flex;"><span>  ClassName: org.apache.doris.qe.AuditLogBuilder
</span></span><span style="display:flex;"><span>     SoName: <span style="color:#ff79c6">NULL</span>
</span></span><span style="display:flex;"><span>    Sources: Builtin
</span></span><span style="display:flex;"><span>     Status: INSTALLED
</span></span><span style="display:flex;"><span> Properties: {}   
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">2</span> <span style="color:#ff79c6">rows</span> <span style="color:#ff79c6">in</span> <span style="color:#ff79c6">set</span> (<span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">00</span> sec)
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="https://github.com/apache/doris/tree/master/fe_plugins/auditdemo/src/main/java/org/apache/doris/plugin">这里</a> 提供了一些插件的例子</p>
<h2 id="cloudcanal-data-import">CloudCanal Data Import</h2>
<p><a href="https://www.cloudcanalx.com/us/cc-doc/intro/product_intro">官网</a>，文档介绍<br>
目前支持 30+ 数据库<br>
有非常好的可视化界面</p>
<h2 id="dbt-doris-adapter">DBT Doris Adapter</h2>
<p><a href="https://docs.getdbt.com/docs/introduction">dbt官网</a></p>
<blockquote>
<p>DBT(Data Build Tool) is a component that focuses on doing T (Transform) in ELT (extraction, loading, transformation)</p>
<ul>
<li>the &ldquo;transformation data&rdquo; link The dbt-doris adapter is developed based on dbt-core 1.5.0 and relies<br>
on the mysql-connector-python driver to convert data to doris.</li>
</ul>
</blockquote>
<h2 id="udf">UDF</h2>
<p><strong>Remote User Defined Function Service</strong>   <br>
通过 protobuf 传递消息</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">FUNCTION</span> rpc_add_two(<span style="color:#8be9fd;font-style:italic">INT</span>,<span style="color:#8be9fd;font-style:italic">INT</span>) <span style="color:#ff79c6">RETURNS</span> <span style="color:#8be9fd;font-style:italic">INT</span> PROPERTIES (
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;SYMBOL&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;add_int_two&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;OBJECT_FILE&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;127.0.0.1:9114&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;TYPE&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;RPC&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">FUNCTION</span> rpc_add_one(<span style="color:#8be9fd;font-style:italic">INT</span>) <span style="color:#ff79c6">RETURNS</span> <span style="color:#8be9fd;font-style:italic">INT</span> PROPERTIES (
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;SYMBOL&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;add_int_one&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;OBJECT_FILE&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;127.0.0.1:9114&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;TYPE&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;RPC&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">FUNCTION</span> rpc_add_string(<span style="color:#8be9fd;font-style:italic">varchar</span>(<span style="color:#bd93f9">30</span>)) <span style="color:#ff79c6">RETURNS</span> <span style="color:#8be9fd;font-style:italic">varchar</span>(<span style="color:#bd93f9">30</span>) PROPERTIES (
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;SYMBOL&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;add_string&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;OBJECT_FILE&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;127.0.0.1:9114&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;TYPE&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;RPC&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">select</span> rpc_add_string(<span style="color:#f1fa8c">&#39;doris&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> rpc_add_string(<span style="color:#f1fa8c">&#39;doris&#39;</span>) <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> doris_rpc_test          <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>日志中显示的</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>INFO: fnCall request<span style="color:#ff79c6">=</span>function_name: <span style="color:#f1fa8c">&#34;add_string&#34;</span>
</span></span><span style="display:flex;"><span>args {
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">type</span> {
</span></span><span style="display:flex;"><span>    id: STRING
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  has_null: <span style="color:#ff79c6">false</span>
</span></span><span style="display:flex;"><span>  string_value: <span style="color:#f1fa8c">&#34;doris&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>INFO: fnCall res<span style="color:#ff79c6">=</span><span style="color:#ff79c6">result</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">type</span> {
</span></span><span style="display:flex;"><span>    id: STRING
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  has_null: <span style="color:#ff79c6">false</span>
</span></span><span style="display:flex;"><span>  string_value: <span style="color:#f1fa8c">&#34;doris_rpc_test&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>status {
</span></span><span style="display:flex;"><span>  status_code: <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Java UDF</strong>       <br>
这个代码比较简单，没有任何 doris 相关的类，就是纯的 JDK 相关逻辑</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff79c6">package</span> org.apache.doris.udf.demo<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> java.io.DataInputStream<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> java.io.DataOutputStream<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> java.io.IOException<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">SimpleDemo</span>  <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//Need an inner class to store data
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#6272a4">/*required*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">State</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/*some variables if you need */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> sum <span style="color:#ff79c6">=</span> 0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/*required*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> State <span style="color:#50fa7b">create</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* here could do some init work if needed */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">new</span> State<span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/*required*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">destroy</span><span style="color:#ff79c6">(</span>State state<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* here could do some destroy work if needed */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/*Not Required*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">reset</span><span style="color:#ff79c6">(</span>State state<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/*if you want this udaf function can work with window function.*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/*Must impl this, it will be reset to init state after calculate every window frame*/</span>
</span></span><span style="display:flex;"><span>        state<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sum</span> <span style="color:#ff79c6">=</span> 0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/*required*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//first argument is State, then other types your input
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">add</span><span style="color:#ff79c6">(</span>State state<span style="color:#ff79c6">,</span> Integer val<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">throws</span> Exception <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* here doing update work when input data*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>val <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>            state<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sum</span> <span style="color:#ff79c6">+=</span> val<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/*required*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">serialize</span><span style="color:#ff79c6">(</span>State state<span style="color:#ff79c6">,</span> DataOutputStream out<span style="color:#ff79c6">)</span>  <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* serialize some data into buffer */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>            out<span style="color:#ff79c6">.</span><span style="color:#50fa7b">writeInt</span><span style="color:#ff79c6">(</span>state<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sum</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">catch</span> <span style="color:#ff79c6">(</span>Exception e<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">/* Do not throw exceptions */</span>
</span></span><span style="display:flex;"><span>            log<span style="color:#ff79c6">.</span><span style="color:#50fa7b">info</span><span style="color:#ff79c6">(</span>e<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getMessage</span><span style="color:#ff79c6">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/*required*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">deserialize</span><span style="color:#ff79c6">(</span>State state<span style="color:#ff79c6">,</span> DataInputStream in<span style="color:#ff79c6">)</span>  <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* deserialize get data from buffer before you put */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">int</span> val <span style="color:#ff79c6">=</span> 0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>            val <span style="color:#ff79c6">=</span> in<span style="color:#ff79c6">.</span><span style="color:#50fa7b">readInt</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">catch</span> <span style="color:#ff79c6">(</span>Exception e<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">/* Do not throw exceptions */</span>
</span></span><span style="display:flex;"><span>            log<span style="color:#ff79c6">.</span><span style="color:#50fa7b">info</span><span style="color:#ff79c6">(</span>e<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getMessage</span><span style="color:#ff79c6">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>        state<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sum</span> <span style="color:#ff79c6">=</span> val<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/*required*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">merge</span><span style="color:#ff79c6">(</span>State state<span style="color:#ff79c6">,</span> State rhs<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">throws</span> Exception <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* merge data from state */</span>
</span></span><span style="display:flex;"><span>        state<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sum</span> <span style="color:#ff79c6">+=</span> rhs<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sum</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/*required*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//return Type you defined
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">public</span> Integer <span style="color:#50fa7b">getValue</span><span style="color:#ff79c6">(</span>State state<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">throws</span> Exception <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* return finally result */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> state<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sum</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建 一个函数</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">AGGREGATE</span> <span style="color:#ff79c6">FUNCTION</span> simple_sum(<span style="color:#8be9fd;font-style:italic">INT</span>) <span style="color:#ff79c6">RETURNS</span> <span style="color:#8be9fd;font-style:italic">INT</span> PROPERTIES (
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;file&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;file:///pathTo/java-udaf.jar&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;symbol&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;org.apache.doris.udf.demo.SimpleDemo&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;always_nullable&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;true&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;type&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;JAVA_UDF&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">select</span> simple_sum(t1) <span style="color:#ff79c6">from</span> test;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> simple_sum(t1) <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>             <span style="color:#bd93f9">10</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>UDF 是和数据库绑定的，而内置函数是全局的</p>
<p><strong>Native User Defined Function</strong><br>
这个要麻烦不少，还要写 cmake 文件，<a href="https://doris.apache.org/docs/ecosystem/udf/native-user-defined-function">这里</a></p>
<h1 id="sql-manual">SQL Manual</h1>
<h2 id="sql-functions">SQL Functions</h2>
<p>内置的函数</p>
<ul>
<li>Array Functions</li>
<li>Date Functions</li>
<li>Gis Functions</li>
<li>String Functions</li>
<li>Struct Functions</li>
<li>Combinators</li>
<li>Aggregate Functions</li>
<li>Bitmap Functions</li>
<li>Bitwise Functions</li>
<li>Conditional Functions</li>
<li>JSON Functions</li>
<li>Hash Functions</li>
<li>HLL Functions</li>
<li>Numeric Functions</li>
<li>Encryption Functions</li>
<li>Table Functions</li>
<li>Window Functions</li>
<li>IP Functions</li>
<li>Vector Distance Functions</li>
<li>CAST</li>
<li>DIGITAL_MASKING</li>
</ul>
<p>表函数的一个例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">select</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> <span style="color:#ff79c6">local</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">-&gt;</span>         <span style="color:#f1fa8c">&#34;file_path&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;log/be.out&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">-&gt;</span>         <span style="color:#f1fa8c">&#34;backend_id&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;1346034&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">-&gt;</span>         <span style="color:#f1fa8c">&#34;format&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;csv&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">-&gt;</span>        <span style="color:#ff79c6">where</span> c1 <span style="color:#ff79c6">like</span> <span style="color:#f1fa8c">&#34;%start_time%&#34;</span> <span style="color:#ff79c6">limit</span> <span style="color:#bd93f9">10</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> c1                                       <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> <span style="color:#ff79c6">start</span> time: Thu <span style="color:#8be9fd;font-style:italic">Dec</span> <span style="color:#bd93f9">28</span> <span style="color:#bd93f9">11</span>:<span style="color:#bd93f9">15</span>:<span style="color:#bd93f9">19</span> CST <span style="color:#bd93f9">2023</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> <span style="color:#ff79c6">start</span> time: Fri <span style="color:#8be9fd;font-style:italic">Dec</span> <span style="color:#bd93f9">29</span> <span style="color:#bd93f9">11</span>:<span style="color:#bd93f9">11</span>:<span style="color:#bd93f9">35</span> CST <span style="color:#bd93f9">2023</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">------------------------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>显示 fe、be 的函数</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">select</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> frontends()\<span style="color:#ff79c6">G</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">desc</span> <span style="color:#ff79c6">function</span> frontends();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">select</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> backends()\<span style="color:#ff79c6">G</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">desc</span> <span style="color:#ff79c6">function</span> backends(); 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">select</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> catalogs();
</span></span></code></pre></td></tr></table>
</div>
</div><p>数字掩码</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">select</span> digital_masking(<span style="color:#bd93f9">13812345678</span>);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">--------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> digital_masking(<span style="color:#ff79c6">cast</span>(<span style="color:#bd93f9">13812345678</span> <span style="color:#ff79c6">as</span> <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#ff79c6">*</span>))) <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">--------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> <span style="color:#bd93f9">138</span><span style="color:#ff79c6">****</span><span style="color:#bd93f9">5678</span>                                      <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">--------------------------------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="sql-reference">SQL Reference</h2>
<p>Cluster management</p>
<ul>
<li>ALTER-SYSTEM-ADD-FOLLOWER</li>
<li>ALTER-SYSTEM-ADD-OBSERVER</li>
<li>ALTER-SYSTEM-ADD-BACKEND</li>
<li>ALTER-SYSTEM-ADD-BROKER</li>
<li>以及相关的modify、drop 操作</li>
</ul>
<p>Account Management</p>
<ul>
<li>CREATE-ROLE</li>
<li>CREATE-USER</li>
<li>ALTER-USER</li>
<li>SET-PASSWORD</li>
<li>SET-PROPERTY</li>
<li>LDAP</li>
<li>GRANT</li>
<li>REVOKE</li>
<li>DROP-ROLE</li>
<li>DROP-USER</li>
</ul>
<p>Database Administration</p>
<ul>
<li>ADMIN-SHOW-CONFIG</li>
<li>ADMIN-SET-CONFIG</li>
<li>SET-VARIABLE</li>
<li>INSTALL-PLUGIN</li>
<li>ADMIN-SET-REPLICA-STATUS</li>
<li>ADMIN-SET-REPLICA-VERSION</li>
<li>ADMIN-SET-PARTITION-VERSION</li>
<li>ADMIN-SET-TABLE-STATUS</li>
<li>ADMIN-SHOW-REPLICA-DISTRIBUTION</li>
<li>ADMIN-SHOW-REPLICA-STATUS</li>
<li>ADMIN-REPAIR-TABLE</li>
<li>KILL</li>
<li>ADMIN-REBALANCE-DISK</li>
</ul>
<p>Data Types</p>
<ul>
<li>BOOLEAN</li>
<li>TINYINT</li>
<li>SMALLINT</li>
<li>INT</li>
<li>BIGINT</li>
<li>LARGEINT</li>
<li>FLOAT</li>
<li>DOUBLE</li>
<li>DECIMAL</li>
<li>DATE</li>
<li>DATETIME</li>
<li>CHAR</li>
<li>VARCHAR</li>
<li>STRING</li>
<li>HLL (HyperLogLog)</li>
<li>BITMAP</li>
<li>QUANTILE_STATE</li>
<li>ARRAY</li>
<li>MAP</li>
<li>STRUCT</li>
<li>JSON</li>
<li>AGG_STATE</li>
</ul>
<p>DDL</p>
<ul>
<li>Create：catalog,database,table,index,external-table,view,materialized-view,function</li>
<li>Alter：file,policy,resource,workload-group,sql-block-rule,encrypt-key</li>
<li>Drop</li>
<li>Backup and Restore</li>
</ul>
<p>DML</p>
<ul>
<li>Load</li>
<li>Manipulation,CURD</li>
<li>outfile</li>
</ul>
<p>SHOW</p>
<ul>
<li>CREATE CATALOG</li>
<li>CREATE DATABASE</li>
<li>CREATE ENCRYPTKEY</li>
<li>CREATE EXTERNAL TABLE</li>
<li>CREATE FILE</li>
<li>CREATE FUNCTION</li>
<li>CREATE INDEX</li>
<li>CREATE MATERIALIZED VIEW</li>
<li>CREATE POLICY</li>
<li>CREATE REPOSITORY</li>
<li>CREATE RESOURCE</li>
<li>CREATE ROLE</li>
<li>CREATE ROUTINE LOAD</li>
<li>CREATE SQL BLOCK RULE</li>
<li>CREATE SYNC JOB</li>
<li>CREATE TABLE</li>
<li>CREATE TABLE AS SELECT</li>
<li>CREATE TABLE LIKE</li>
<li>CREATE USER</li>
<li>CREATE VIEW</li>
<li>CREATE WORKLOAD GROUP</li>
<li>SHOW CREATE CATALOG</li>
<li>SHOW CREATE DATABASE</li>
<li>SHOW CREATE FUNCTION</li>
<li>SHOW CREATE LOAD</li>
<li>SHOW CREATE REPOSITORY</li>
<li>SHOW CREATE ROUTINE LOAD</li>
<li>SHOW CREATE TABLE</li>
</ul>
<p>Utility</p>
<ul>
<li>HELP</li>
<li>USE</li>
<li>DESCRIBE</li>
<li>SWITCH</li>
<li>REFRESH</li>
<li>SYNC</li>
<li>CLEAN-QUERY-STATS</li>
</ul>
<h1 id="admin-manual">Admin Manual</h1>
<h2 id="cluster-management">cluster management</h2>
<p>Overview of the upgrade process</p>
<ol>
<li>Metadata backup</li>
<li>Turn off the cluster copy repair and balance function</li>
<li>Compatibility testing</li>
<li>Upgrade BE</li>
<li>Upgrade FE</li>
<li>Turn on the cluster replica repair and balance function</li>
</ol>
<p>通过 ALTER SYSTEM，add、或者 delete 节点</p>
<p>loadbalance</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>jdbc:mysql:loadbalance:<span style="color:#ff79c6">//</span>[<span style="color:#ff79c6">host</span>:port],[<span style="color:#ff79c6">host</span>:port]...<span style="color:#ff79c6">/</span>[<span style="color:#ff79c6">database</span>][<span style="color:#ff79c6">?</span>propertyName1][<span style="color:#ff79c6">=</span>propertyValue1][<span style="color:#ff79c6">&amp;</span>propertyName2][<span style="color:#ff79c6">=</span>propertyValue
</span></span></code></pre></td></tr></table>
</div>
</div><p>ProxySQL</p>
<blockquote>
<p>ProxySQL is a flexible and powerful MySQL proxy layer. <br>
It is a MySQL middleware that can be actually used in a production environment. <br>
It can realize read-write separation, support Query routing function, support dynamic designation of a certain SQL for cache, <br>
support dynamic loading configuration, failure Switching and some SQL filtering functions.</p>
</blockquote>
<h2 id="data-admin">Data Admin</h2>
<p>backup 步骤</p>
<ul>
<li>Snapshot and snapshot upload</li>
<li>Metadata preparation and upload</li>
<li>Dynamic Partition Table Description</li>
</ul>
<p>Data Restore，通过命令从 远端存储恢复</p>
<ul>
<li>Create the corresponding metadata locally</li>
<li>Local snapshot</li>
<li>Download snapshot</li>
<li>Effective snapshot</li>
</ul>
<p>Drop Recovery<br>
也有相关的命令</p>
<h2 id="other-manager">Other Manager</h2>
<p>统计信息</p>
<ul>
<li>SHOW QUERY PROFILE</li>
<li>SHOW LOAD PROFILE</li>
</ul>
<p>然后可以查看各种执行算子，通过算子来分析执行情况，<a href="https://doris.apache.org/docs/admin-manual/query-profile#profile-statistic-analysis">这里</a></p>
<p>SQL 拦截，类似黑名单机制</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> SQL_BLOCK_RULE test_rule 
</span></span><span style="display:flex;"><span>PROPERTIES(
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;sql&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;select \\* from order_analysis&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;global&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;false&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;enable&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;true&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;sqlHash&#34;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>安全通讯</p>
<ul>
<li>TLS certificate</li>
<li>FE SSL certificate</li>
</ul>
<h2 id="maintenance-and-monitor">Maintenance and Monitor</h2>
<p>Monitor Metrics</p>
<ul>
<li>包括自身节点信息，主机信息，JVM信息等</li>
<li>FE Process monitoring</li>
<li>FE JVM metrics</li>
<li>BE Process metrics</li>
<li>BE Machine metrics</li>
</ul>
<p>磁盘管理，两个水位</p>
<ul>
<li>High Watermark</li>
<li>Flood Stage，比上面的更高，表示磁盘快不够了</li>
</ul>
<p>Data replica management</p>
<ul>
<li>Tablet: The logical fragmentation of a Doris table, where a table has multiple fragments.</li>
<li>Replica: A sliced copy, defaulting to three copies of a slice.</li>
<li>Healthy Replica: A healthy copy that survives at Backend and has a complete version.</li>
<li>Tablet Checker (TC): A resident background thread that scans all Tablets regularly, checks the status of these Tablets, and decides whether to send them to Tablet Scheduler based on the results.</li>
<li>Tablet Scheduler (TS): A resident background thread that handles Tablets sent by Tablet Checker that need to be repaired. At the same time, cluster replica balancing will be carried out.</li>
<li>Tablet SchedCtx (TSC): is a tablet encapsulation. When TC chooses a tablet, it encapsulates it as a TSC and sends it to TS.</li>
<li>Storage Medium: Storage medium. Doris supports specifying different storage media for partition granularity, including SSD and HDD. The replica scheduling strategy is also scheduled for different storage media.</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>              <span style="color:#ff79c6">+</span><span style="color:#6272a4">--------+              +-----------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>              <span style="color:#ff79c6">|</span>  Meta  <span style="color:#ff79c6">|</span>              <span style="color:#ff79c6">|</span>  Backends <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>              <span style="color:#ff79c6">+</span><span style="color:#6272a4">---^----+              +------^----+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>                  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span>                        <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">3</span>. Send clone tasks
</span></span><span style="display:flex;"><span> <span style="color:#bd93f9">1</span>. <span style="color:#ff79c6">Check</span> tablets <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">|</span>                        <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span>           <span style="color:#ff79c6">+</span><span style="color:#6272a4">--------v------+        +-----------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>           <span style="color:#ff79c6">|</span> TabletChecker <span style="color:#ff79c6">+</span><span style="color:#6272a4">--------&gt; TabletScheduler |
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>           <span style="color:#ff79c6">+</span><span style="color:#6272a4">---------------+        +-----------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>                   <span style="color:#bd93f9">2</span>. Waiting <span style="color:#ff79c6">to</span> be scheduled
</span></span></code></pre></td></tr></table>
</div>
</div><p>监控和报警，支持整合 prometheus<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/22/7gNSNq.png">
            <img class="mx-auto" alt="https://cdnd.selectdb.com/assets/images/monitor_arch-1c53c13bb72ba1970574ca0428791ad0.png" src="https://v1.ax1x.com/2024/05/22/7gNSNq.png" />
        </a>
    </p>
<p>TABLETS 查看</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">show</span> tablets <span style="color:#ff79c6">from</span> test\<span style="color:#ff79c6">G</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">***************************</span> <span style="color:#bd93f9">1</span>. <span style="color:#ff79c6">row</span> <span style="color:#ff79c6">***************************</span>
</span></span><span style="display:flex;"><span>               TabletId: <span style="color:#bd93f9">1346417</span>
</span></span><span style="display:flex;"><span>              ReplicaId: <span style="color:#bd93f9">1346418</span>
</span></span><span style="display:flex;"><span>              BackendId: <span style="color:#bd93f9">1346034</span>
</span></span><span style="display:flex;"><span>             SchemaHash: <span style="color:#bd93f9">1990704458</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">Version</span>: <span style="color:#bd93f9">2</span>
</span></span><span style="display:flex;"><span>      LstSuccessVersion: <span style="color:#bd93f9">2</span>
</span></span><span style="display:flex;"><span>       LstFailedVersion: <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>          LstFailedTime: <span style="color:#ff79c6">NULL</span>
</span></span><span style="display:flex;"><span>          LocalDataSize: <span style="color:#bd93f9">218</span>
</span></span><span style="display:flex;"><span>         RemoteDataSize: <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>               RowCount: <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#ff79c6">State</span>: NORMAL
</span></span><span style="display:flex;"><span>LstConsistencyCheckTime: <span style="color:#ff79c6">NULL</span>
</span></span><span style="display:flex;"><span>           CheckVersion: <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>           VersionCount: <span style="color:#bd93f9">2</span>
</span></span><span style="display:flex;"><span>              QueryHits: <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>               PathHash: <span style="color:#ff79c6">-</span><span style="color:#bd93f9">2566916266841741493</span>
</span></span><span style="display:flex;"><span>                MetaUrl: http:<span style="color:#ff79c6">//</span><span style="color:#bd93f9">192</span>.<span style="color:#bd93f9">168</span>.<span style="color:#bd93f9">1</span>.<span style="color:#bd93f9">2</span>:<span style="color:#bd93f9">8040</span><span style="color:#ff79c6">/</span>api<span style="color:#ff79c6">/</span>meta<span style="color:#ff79c6">/</span>header<span style="color:#ff79c6">/</span><span style="color:#bd93f9">1346417</span>
</span></span><span style="display:flex;"><span>       CompactionStatus: http:<span style="color:#ff79c6">//</span><span style="color:#bd93f9">192</span>.<span style="color:#bd93f9">168</span>.<span style="color:#bd93f9">1</span>.<span style="color:#bd93f9">2</span>:<span style="color:#bd93f9">8040</span><span style="color:#ff79c6">/</span>api<span style="color:#ff79c6">/</span>compaction<span style="color:#ff79c6">/</span><span style="color:#ff79c6">show</span><span style="color:#ff79c6">?</span>tablet_id<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1346417</span>
</span></span><span style="display:flex;"><span>      CooldownReplicaId: <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>         CooldownMetaId: 
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">***************************</span> <span style="color:#bd93f9">2</span>. <span style="color:#ff79c6">row</span> <span style="color:#ff79c6">***************************</span>
</span></span><span style="display:flex;"><span>               TabletId: <span style="color:#bd93f9">1346419</span>
</span></span><span style="display:flex;"><span>              ReplicaId: <span style="color:#bd93f9">1346420</span>
</span></span><span style="display:flex;"><span>              BackendId: <span style="color:#bd93f9">1346034</span>
</span></span><span style="display:flex;"><span>             SchemaHash: <span style="color:#bd93f9">1990704458</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">Version</span>: <span style="color:#bd93f9">2</span>
</span></span><span style="display:flex;"><span>      LstSuccessVersion: <span style="color:#bd93f9">2</span>
</span></span><span style="display:flex;"><span>       LstFailedVersion: <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>          LstFailedTime: <span style="color:#ff79c6">NULL</span>
</span></span><span style="display:flex;"><span>          LocalDataSize: <span style="color:#bd93f9">219</span>
</span></span><span style="display:flex;"><span>         RemoteDataSize: <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>               RowCount: <span style="color:#bd93f9">3</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#ff79c6">State</span>: NORMAL
</span></span><span style="display:flex;"><span>LstConsistencyCheckTime: <span style="color:#ff79c6">NULL</span>
</span></span><span style="display:flex;"><span>           CheckVersion: <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>           VersionCount: <span style="color:#bd93f9">2</span>
</span></span><span style="display:flex;"><span>              QueryHits: <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>               PathHash: <span style="color:#ff79c6">-</span><span style="color:#bd93f9">2566916266841741493</span>
</span></span><span style="display:flex;"><span>                MetaUrl: http:<span style="color:#ff79c6">//</span><span style="color:#bd93f9">192</span>.<span style="color:#bd93f9">168</span>.<span style="color:#bd93f9">1</span>.<span style="color:#bd93f9">2</span>:<span style="color:#bd93f9">8040</span><span style="color:#ff79c6">/</span>api<span style="color:#ff79c6">/</span>meta<span style="color:#ff79c6">/</span>header<span style="color:#ff79c6">/</span><span style="color:#bd93f9">1346419</span>
</span></span><span style="display:flex;"><span>       CompactionStatus: http:<span style="color:#ff79c6">//</span><span style="color:#bd93f9">192</span>.<span style="color:#bd93f9">168</span>.<span style="color:#bd93f9">1</span>.<span style="color:#bd93f9">2</span>:<span style="color:#bd93f9">8040</span><span style="color:#ff79c6">/</span>api<span style="color:#ff79c6">/</span>compaction<span style="color:#ff79c6">/</span><span style="color:#ff79c6">show</span><span style="color:#ff79c6">?</span>tablet_id<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1346419</span>
</span></span><span style="display:flex;"><span>      CooldownReplicaId: <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>         CooldownMetaId: 
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">2</span> <span style="color:#ff79c6">rows</span> <span style="color:#ff79c6">in</span> <span style="color:#ff79c6">set</span> (<span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">00</span> sec)
</span></span></code></pre></td></tr></table>
</div>
</div><p>根据 ID 查看</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">show</span> tablet <span style="color:#bd93f9">1346417</span>\<span style="color:#ff79c6">G</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">***************************</span> <span style="color:#bd93f9">1</span>. <span style="color:#ff79c6">row</span> <span style="color:#ff79c6">***************************</span>
</span></span><span style="display:flex;"><span>       DbName: default_cluster:demo
</span></span><span style="display:flex;"><span>    TableName: test
</span></span><span style="display:flex;"><span>PartitionName: test
</span></span><span style="display:flex;"><span>    IndexName: test
</span></span><span style="display:flex;"><span>         DbId: <span style="color:#bd93f9">1345111</span>
</span></span><span style="display:flex;"><span>      TableId: <span style="color:#bd93f9">1346415</span>
</span></span><span style="display:flex;"><span>  PartitionId: <span style="color:#bd93f9">1346414</span>
</span></span><span style="display:flex;"><span>      IndexId: <span style="color:#bd93f9">1346416</span>
</span></span><span style="display:flex;"><span>       IsSync: <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">Order</span>: <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>    QueryHits: <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>    DetailCmd: <span style="color:#ff79c6">SHOW</span> PROC <span style="color:#f1fa8c">&#39;/dbs/1345111/1346415/partitions/1346414/1346416/1346417&#39;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>meta-tool 工具</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>./lib/meta_tool --root_path<span style="color:#ff79c6">=</span>/path/to/storage --operation<span style="color:#ff79c6">=</span>load_meta --json_meta_path<span style="color:#ff79c6">=</span>/path/to/10017.hdr.json
</span></span></code></pre></td></tr></table>
</div>
</div><p>配置自动启动，如</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>systemctl <span style="color:#8be9fd;font-style:italic">enable</span> doris-fe
</span></span><span style="display:flex;"><span>systemctl <span style="color:#8be9fd;font-style:italic">enable</span> doris-be
</span></span></code></pre></td></tr></table>
</div>
</div><p>HTTP-API</p>
<ul>
<li><a href="https://doris.apache.org/docs/admin-manual/http-actions/fe/config-action">FE</a></li>
<li><a href="https://doris.apache.org/docs/admin-manual/http-actions/be/check-rpc-channel">BE</a></li>
</ul>
<p>BE 的 web-UI 有 memory tracker 信息</p>
<h2 id="metadata-operations-and-maintenance">Metadata Operations and Maintenance</h2>
<p><a href="https://doris.apache.org/community/design/metadata-design/">Metadata Design Document</a></p>
<h1 id="starrocks">StarRocks</h1>
<p>来自 StarRocks 官网的文档记录<br>
核心功能</p>
<ul>
<li>FE 和 BE 架构，多个 FE对等，都可以接收请求</li>
<li>元数据存在 Berkeley DB 中，存在 FE 中，每个 FE 存全量</li>
<li>基于 paxos 协议实现选主功能，包括 Leader、Follower、Observer</li>
<li>前缀索引、列级索引、预先聚合、bloom filter、bitmap 索引、zone map 索引</li>
<li>数据分布：Round-Robin、range、list、hash，数据压缩</li>
</ul>
<p>数据管理</p>
<ul>
<li>对比传统Scatter-Gather 框架模式只有一个汇总点，这里可以有多个汇总点，并行度更高</li>
<li>实时更新的列存，merge-on-read、copy-on-write、delta-store、delete-and-insert</li>
<li>数据湖支持，物化视图</li>
<li>catalog，默认可以自己管理数据，external catalog：hive、delta-lake、ice-berg、hudi、JDBC catalog</li>
<li>工具集成，BI类的：Hex、Querybook、 superset、tableau、工具：DataGrip、DBeaver</li>
<li>各种导入导出，导入：MySQL、Flink导入、Spark导入、流导入、insert语句、kakfa；export关键字，spark、flink导出</li>
</ul>
<p>查询加速</p>
<ul>
<li>Cascades 风格的CBO 优化器；手动采集、自动采集、全量采集、直方图</li>
<li>前缀索引、列级索引、预先聚合、bloom filter、bitmap 索引、zone map 索引</li>
<li>数据分布：Round-Robin、range、list、hash，数据压缩</li>
<li>同步物化视图、异步物化视图</li>
<li>HyperLogLog去重、bitmap去重，查询缓存</li>
<li>Colocate Join，创建 Colocation Group（CG），同一个CG内按照相同的分区分桶规则，这样可以本地join</li>
<li>Bucked shffle join，只shuffle 小表的部分数据到不同的分片</li>
</ul>
<p>集群管理和其他</p>
<ul>
<li>K8S支持，缩容、扩容</li>
<li>报警监控、备份，审计日志</li>
<li>内部的 information_schema 库</li>
<li>权限认证管理，创建用户、用户组、角色、权限</li>
<li>资源隔离、查询队列、内存管理、黑名单，这些都有自定义的SQL</li>
<li>查询计划，有点类似 impala，Query Profile</li>
<li>集群管理命令、AUTO_INCREMENT</li>
<li>函数：日期、字符串、聚合、array、bitmap、json、map、binary、加密、正则、条件、百分位、标量、工具、地理位置</li>
</ul>
<h1 id="reference">Reference</h1>
<ul>
<li><a href="https://medium.com/python-in-plain-english/a-deep-dive-into-the-inner-workings-of-apache-spark-join-strategies-5d47dd29a4cb">A Deep Dive into Apache Spark Join Strategies</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/420682814">Spark Doris Connector设计方案</a></li>
<li><a href="https://doris.apache.org/docs/admin-manual/query-profile#profile-statistic-analysis">Profile statistic analysis</a></li>
</ul>

			<script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>
        </div>

        


        

<div class="post-archive">
    <h2>相关文章</h2>
    <ul class="listing">
        
        <li><a href="/post/2024/01/doris/">Doris Basic</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/doris'>Doris</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "himichael/hugoblogtalks"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>


                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://code0xff.org/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://code0xff.org/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://code0xff.org/post/2025/01/logs_collection_based_cloud/" title="云环境中的日志收集和处理方案">云环境中的日志收集和处理方案</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2025/01/btrace/" title="BTrace">BTrace</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2025/01/yarn/" title="YARN原理分析">YARN原理分析</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2025/01/spark_register_source/" title="Spark 注册数据源">Spark 注册数据源</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2025/01/spark_core_2/" title="Spark Core相关-2">Spark Core相关-2</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/12/llamafactory/" title="Llama Factory">Llama Factory</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/11/spark_core/" title="Spark Core相关-1">Spark Core相关-1</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/11/sae_tunnel/" title="sea tunnel">sea tunnel</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/11/k8s_networks/" title="k8s 网络">k8s 网络</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/11/ozone/" title="ozone">ozone</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://code0xff.org/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式 (6)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/">原理分析 (26)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E5%95%86%E4%B8%9A/">商业 (3)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据 (56)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库 (41)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%96%87%E5%AD%A6%E5%92%8C%E8%89%BA%E6%9C%AF/">文学和艺术 (3)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%97%85%E8%A1%8C/">旅行 (12)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%9E%B6%E6%9E%84/">架构 (14)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E7%AE%97%E6%B3%95/">算法 (8)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E7%B3%BB%E7%BB%9F/">系统 (7)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言 (7)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E8%A1%8C%E4%B8%9A%E8%A7%82%E5%AF%9F/">行业观察 (3)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记 (14)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E9%9A%8F%E4%BE%BF%E5%86%99%E5%86%99/">随便写写 (3)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">归档</a></h3>
<ul class="widget-list">
    
    <li><a href="https://code0xff.org/years/2021%E5%B9%B4/">2021年 (41)</a></li>
    
    <li><a href="https://code0xff.org/years/2022%E5%B9%B4/">2022年 (55)</a></li>
    
    <li><a href="https://code0xff.org/years/2023%E5%B9%B4/">2023年 (54)</a></li>
    
    <li><a href="https://code0xff.org/years/2024%E5%B9%B4/">2024年 (48)</a></li>
    
    <li><a href="https://code0xff.org/years/2025%E5%B9%B4/">2025年 (5)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://code0xff.org/tags/ai/">AI </a>
    
    <a href="https://code0xff.org/tags/ambari/">Ambari </a>
    
    <a href="https://code0xff.org/tags/architecture/">architecture </a>
    
    <a href="https://code0xff.org/tags/bigdata/">bigdata </a>
    
    <a href="https://code0xff.org/tags/btrace/">BTrace </a>
    
    <a href="https://code0xff.org/tags/b%E6%A0%91/">B树 </a>
    
    <a href="https://code0xff.org/tags/c&#43;&#43;/">C&#43;&#43; </a>
    
    <a href="https://code0xff.org/tags/calcite/">calcite </a>
    
    <a href="https://code0xff.org/tags/cmu-database/">CMU-Database </a>
    
    <a href="https://code0xff.org/tags/data_ingestion/">Data_Ingestion </a>
    
    <a href="https://code0xff.org/tags/deltalake/">DeltaLake </a>
    
    <a href="https://code0xff.org/tags/doris/">Doris </a>
    
    <a href="https://code0xff.org/tags/english/">English </a>
    
    <a href="https://code0xff.org/tags/es/">ES </a>
    
    <a href="https://code0xff.org/tags/facebook/">Facebook </a>
    
    <a href="https://code0xff.org/tags/flink/">flink </a>
    
    <a href="https://code0xff.org/tags/flume/">flume </a>
    
    <a href="https://code0xff.org/tags/gc/">GC </a>
    
    <a href="https://code0xff.org/tags/gluten/">Gluten </a>
    
    <a href="https://code0xff.org/tags/hana/">HANA </a>
    
    <a href="https://code0xff.org/tags/hive/">Hive </a>
    
    <a href="https://code0xff.org/tags/iceberg/">iceberg </a>
    
    <a href="https://code0xff.org/tags/impala/">Impala </a>
    
    <a href="https://code0xff.org/tags/janino/">janino </a>
    
    <a href="https://code0xff.org/tags/k8s/">k8s </a>
    
    <a href="https://code0xff.org/tags/kafka/">Kafka </a>
    
    <a href="https://code0xff.org/tags/kudu/">kudu </a>
    
    <a href="https://code0xff.org/tags/kyuubi/">Kyuubi </a>
    
    <a href="https://code0xff.org/tags/lakehouse/">Lakehouse </a>
    
    <a href="https://code0xff.org/tags/leveldb/">LevelDB </a>
    
    <a href="https://code0xff.org/tags/llamafactory/">LlamaFactory </a>
    
    <a href="https://code0xff.org/tags/llvm/">LLVM </a>
    
    <a href="https://code0xff.org/tags/log4j/">log4j </a>
    
    <a href="https://code0xff.org/tags/manacher/">Manacher </a>
    
    <a href="https://code0xff.org/tags/mapreduce/">MapReduce </a>
    
    <a href="https://code0xff.org/tags/micro-service/">micro-service </a>
    
    <a href="https://code0xff.org/tags/mysql/">MySQL </a>
    
    <a href="https://code0xff.org/tags/newsql/">NewSQL </a>
    
    <a href="https://code0xff.org/tags/oceanbase/">OceanBase </a>
    
    <a href="https://code0xff.org/tags/openlogreplicator/">OpenLogReplicator </a>
    
    <a href="https://code0xff.org/tags/parquet/">parquet </a>
    
    <a href="https://code0xff.org/tags/paxos/">paxos </a>
    
    <a href="https://code0xff.org/tags/presto/">Presto </a>
    
    <a href="https://code0xff.org/tags/quick-sql/">quick-sql </a>
    
    <a href="https://code0xff.org/tags/raft/">raft </a>
    
    <a href="https://code0xff.org/tags/scala/">scala </a>
    
    <a href="https://code0xff.org/tags/simd/">SIMD </a>
    
    <a href="https://code0xff.org/tags/snowflake/">snowflake </a>
    
    <a href="https://code0xff.org/tags/spark/">spark </a>
    
    <a href="https://code0xff.org/tags/sre/">SRE </a>
    
    <a href="https://code0xff.org/tags/teradata/">TeraData </a>
    
    <a href="https://code0xff.org/tags/tpcx-hs/">TPCx-HS </a>
    
    <a href="https://code0xff.org/tags/trino/">Trino </a>
    
    <a href="https://code0xff.org/tags/tuning/">Tuning </a>
    
    <a href="https://code0xff.org/tags/unix/">unix </a>
    
    <a href="https://code0xff.org/tags/yarn/">YARN </a>
    
    <a href="https://code0xff.org/tags/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/">二分查找 </a>
    
    <a href="https://code0xff.org/tags/%E4%BA%8C%E5%8F%89%E6%A0%91%E9%81%8D%E5%8E%86/">二叉树遍历 </a>
    
    <a href="https://code0xff.org/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式 </a>
    
    <a href="https://code0xff.org/tags/%E5%88%97%E5%AD%98/">列存 </a>
    
    <a href="https://code0xff.org/tags/%E5%8A%A8%E6%80%81%E6%B3%A8%E5%85%A5/">动态注入 </a>
    
    <a href="https://code0xff.org/tags/%E5%8E%86%E5%8F%B2/">历史 </a>
    
    <a href="https://code0xff.org/tags/%E5%90%91%E9%87%8F%E5%8C%96/">向量化 </a>
    
    <a href="https://code0xff.org/tags/%E5%9B%9E%E6%BA%AF/">回溯 </a>
    
    <a href="https://code0xff.org/tags/%E5%9B%BD%E5%86%85%E6%97%85%E8%A1%8C/">国内旅行 </a>
    
    <a href="https://code0xff.org/tags/%E5%9B%BD%E5%A4%96%E6%97%85%E8%A1%8C/">国外旅行 </a>
    
    <a href="https://code0xff.org/tags/%E5%A4%9A%E7%A7%9F%E6%88%B7/">多租户 </a>
    
    <a href="https://code0xff.org/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据 </a>
    
    <a href="https://code0xff.org/tags/%E5%AD%98%E5%82%A8/">存储 </a>
    
    <a href="https://code0xff.org/tags/%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/">工作记录 </a>
    
    <a href="https://code0xff.org/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务 </a>
    
    <a href="https://code0xff.org/tags/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0/">数据中台 </a>
    
    <a href="https://code0xff.org/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库 </a>
    
    <a href="https://code0xff.org/tags/%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B/">数据模型 </a>
    
    <a href="https://code0xff.org/tags/%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB/">数据迁移 </a>
    
    <a href="https://code0xff.org/tags/%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/">查询优化 </a>
    
    <a href="https://code0xff.org/tags/%E6%9F%A5%E8%AF%A2%E7%BC%96%E8%AF%91/">查询编译 </a>
    
    <a href="https://code0xff.org/tags/%E6%A6%82%E7%8E%87/">概率 </a>
    
    <a href="https://code0xff.org/tags/%E6%B1%87%E7%BC%96/">汇编 </a>
    
    <a href="https://code0xff.org/tags/%E6%B5%8B%E8%AF%95/">测试 </a>
    
    <a href="https://code0xff.org/tags/%E7%94%9F%E6%B4%BB/">生活 </a>
    
    <a href="https://code0xff.org/tags/%E7%94%B5%E5%BD%B1/">电影 </a>
    
    <a href="https://code0xff.org/tags/%E7%AE%97%E6%B3%95/">算法 </a>
    
    <a href="https://code0xff.org/tags/%E7%B4%A2%E5%BC%95/">索引 </a>
    
    <a href="https://code0xff.org/tags/%E7%BB%8F%E6%B5%8E/">经济 </a>
    
    <a href="https://code0xff.org/tags/%E7%BC%93%E5%AD%98/">缓存 </a>
    
    <a href="https://code0xff.org/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/">编译原理 </a>
    
    <a href="https://code0xff.org/tags/%E7%BD%91%E7%BB%9C/">网络 </a>
    
    <a href="https://code0xff.org/tags/%E8%AE%A1%E7%AE%97%E6%A1%86%E6%9E%B6/">计算框架 </a>
    
    <a href="https://code0xff.org/tags/%E8%AE%BA%E6%96%87/">论文 </a>
    
    <a href="https://code0xff.org/tags/%E8%AF%BB%E4%B9%A6/">读书 </a>
    
    <a href="https://code0xff.org/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记 </a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">RSS</h3>
        <ul class="widget-list">
            <li><a href="https://code0xff.org/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
    <footer id="footer">
    <div>
        &copy; 2025 <a href="https://code0xff.org/">记录每个瞬间 By 老王</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script src="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'GA ID', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




</body>

</html>