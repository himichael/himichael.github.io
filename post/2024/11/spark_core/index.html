<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>Spark Core相关-1 | 记录每个瞬间</title>
    <meta property="og:title" content="Spark Core相关-1 - 记录每个瞬间">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2024-11-25T09:08:07&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2024-11-25T09:08:07&#43;08:00'>
        
    <meta name="Keywords" content="">
    <meta name="description" content="Spark Core相关-1">
        <meta name="author" content="隔壁老王">
        
    <meta property="og:url" content="https://code0xff.org/post/2024/11/spark_core/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
        <link href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://code0xff.org/">
                        记录每个瞬间
                    </a>
                
                
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://code0xff.org/">首页</a>
                    
                    <a  href="https://code0xff.org/linked/" title="链接">链接</a>
                    
                    <a  href="https://code0xff.org/archives/" title="归档">归档</a>
                    
                    <a  href="https://code0xff.org/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">Spark Core相关-1</h1>
        </header>
        <date class="post-meta meta-date">
            2024年11月25日
        </date>
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#存储体系">存储体系</a>
          <ul>
            <li><a href="#整体架构">整体架构</a></li>
            <li><a href="#执行流程">执行流程</a></li>
            <li><a href="#map-监控体系">Map 监控体系</a></li>
          </ul>
        </li>
        <li><a href="#web-ui">WEB-UI</a>
          <ul>
            <li><a href="#整体结构">整体结构</a></li>
            <li><a href="#自定义-ui">自定义 UI</a></li>
          </ul>
        </li>
        <li><a href="#执行环境">执行环境</a></li>
        <li><a href="#prc-体系">PRC 体系</a>
          <ul>
            <li><a href="#客户端服务端例子">客户端服务端例子</a></li>
            <li><a href="#network-包">network 包</a></li>
            <li><a href="#发送过程">发送过程</a></li>
            <li><a href="#接收过程">接收过程</a></li>
          </ul>
        </li>
        <li><a href="#参考">参考</a></li>
      </ul>
    </li>
  </ul>
</nav>
        
        <div class="post-meta">
            
            <span class="post-meta meta-tags">
                <ul class="clearfix">
                    <a href='/categories/%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90'>原理分析</a>
                </ul>
            </span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <p>Spark-Core 相关的模块</p>
<ul>
<li>执行环境，Env和SparkContext</li>
<li>RPC 相关</li>
<li>存储体系</li>
<li>计算</li>
<li>scheduler</li>
<li>deploy</li>
<li>API 相关</li>
</ul>
<h2 id="存储体系">存储体系</h2>
<h3 id="整体架构">整体架构</h3>
<p>BlockManager 相关的架构图<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/12/01/7AiTz5.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/12/01/7AiTz5.png" />
        </a>
    </p>
<p>BlockId 相关</p>
<table>
<thead>
<tr>
<th>BlockId Implementation</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>RDDBlockId</td>
<td>Identifies a partition of an RDD.</td>
</tr>
<tr>
<td>ShuffleBlockId</td>
<td>Identifies shuffle data output by a shuffle stage.</td>
</tr>
<tr>
<td>BroadcastBlockId</td>
<td>Identifies broadcast variables for tasks.</td>
</tr>
<tr>
<td>TaskResultBlockId</td>
<td>Identifies task result blocks stored temporarily.</td>
</tr>
</tbody>
</table>
<p>一些核心组件</p>
<ul>
<li>BlockManager</li>
<li>BlockInfoManager</li>
<li>BlockManagerMaster</li>
<li>MemoryManager</li>
<li>MemoryStore</li>
<li>DiskBlockManager</li>
<li>DiskStore</li>
<li>BlockManagerMasterEndpoint</li>
<li>BlockManagerSlaveEndpoint</li>
<li>BlockTransferService</li>
</ul>
<p>内存相关类</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Layer</th>
<th>Scope</th>
<th>Responsibilities</th>
</tr>
</thead>
<tbody>
<tr>
<td>MemoryManager</td>
<td>Low-Level</td>
<td>Executor-specific</td>
<td>Manages memory allocation between execution and storage pools.</td>
</tr>
<tr>
<td>MemoryStore</td>
<td>High-Level</td>
<td>Executor-specific</td>
<td>Manages in-memory storage of blocks, relies on MemoryManager for memory allocation.</td>
</tr>
</tbody>
</table>
<p>MemoryManager 将内存分为</p>
<ul>
<li>execution memory</li>
<li>storage memory</li>
</ul>
<p>而 MemoryStore 则作为一个更高层的组件，负责 block 的管理</p>
<ul>
<li>块的创建</li>
<li>从内存中驱逐块，LRU 算法</li>
</ul>
<hr>
<p>磁盘存储相关</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Layer</th>
<th>Scope</th>
<th>Responsibilities</th>
</tr>
</thead>
<tbody>
<tr>
<td>DiskBlockManager</td>
<td>Low-Level</td>
<td>Executor-specific</td>
<td>Handles physical file operations for block storage on disk.</td>
</tr>
<tr>
<td>DiskStore</td>
<td>High-Level</td>
<td>Executor-specific</td>
<td>Provides a block-level interface for disk storage, relies on DiskBlockManager.</td>
</tr>
</tbody>
</table>
<p>DiskStore 和 DiskBlockManager 的关系，跟 内存的类似，只是读写的是磁盘</p>
<hr>
<p>主从节点 相关的几个类</p>
<ul>
<li>BlockManagerMaster，这个是中央类，包含了：block_id  &ndash;&gt;  具体 block 所在的节点</li>
<li>BlockManager，每个executor 上都有一个，负责跨集群的块管理，block 的生命周期管理等</li>
<li>BlockInfoManager，每个executor 一个，存储：block id -&gt; 大小，存储级别等元信息</li>
</ul>
<hr>
<p>RPC 相关的</p>
<ul>
<li>BlockTransferService，当本地内存、磁盘都没有，则向远端 其他节点的 block-manager获取数据</li>
<li>BlockManagerMasterEndpoint，主节点 RPC，负责接受 block-manager的一些查询，以及元数据更新请求</li>
<li>BlockManagerSlaveEndpoint，从节点 RPC，向 master 发送元数据更新等信息</li>
</ul>
<h3 id="执行流程">执行流程</h3>
<p>另一个视角<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/11/26/7A1J7V.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/11/26/7A1J7V.png" />
        </a>
    </p>
<p>一个完整的流程<br>
存储一个block</p>
<ul>
<li>executor 创建一个 分区</li>
<li>存储这些block，发送给 BlockManager</li>
<li>存储的 block 放在 RDD_0_0，如果内存不足就放磁盘</li>
<li>BlockInfoManager，记录元信息</li>
<li>全局注册，发送给 BlockManagerMaster  记录 block_id -&gt; 块的具体位置信息</li>
</ul>
<p>检索块信息</p>
<ul>
<li>executor 上的 task，检索：RDD_0_0</li>
<li>调用：BlockManager.getBlockData(BlockId) 获取块信息</li>
<li>这里会使用 BlockInfoManager 做一些读、写加锁操作，防止并发问题</li>
<li>调用 MemoryStore 、DiskStore 从内存或者磁盘读取</li>
<li>如果本地没有，则向 BlockManagerMaster  通讯，查询 RDD_0_0 的具体位置</li>
<li>通过 BlockTransferService 向远端机器真正的获取数据</li>
<li>之后将这个 block 存储在本地内存/磁盘</li>
</ul>
<p>shuffle 操作</p>
<ul>
<li>map task 写中间结果到磁盘，这里会委托 BlockManager 完成 block 的写磁盘操作</li>
<li>BlockManager 将 block 的信息发送给BlockManagerMaster，记录block 的元信息</li>
<li>reduce task 请求这些 shuffle 数据</li>
<li>executor 上的 BlockManager 从 BlockManagerMaster 上获取 shuffle 的 block 具体位置</li>
<li>通过 BlockTransferService 从远程节点上获取数据</li>
</ul>
<hr>
<p>block 存储的内容一般为：</p>
<ul>
<li>RDD partitions: Each RDD partition is stored as a block.</li>
<li>Shuffle data: Intermediate data generated during shuffle operations.</li>
<li>Broadcast variables: Data shared across tasks.</li>
<li>Task results: Intermediate task results temporarily stored for fault tolerance.</li>
</ul>
<p>block 大小和内容</p>
<ul>
<li>一般跟分区是 1 对 1 映射的，多少分区，多少 block</li>
<li>可以配置 shuffle 的文件大小，也就是 shuffle block 的大小</li>
<li>内存中一般是 raw 的java对象，磁盘中是序列化后的内容</li>
<li>广播变量等也会存储为 block，但是大小不固定</li>
</ul>
<hr>
<p>测试代码，观察本地 block 的情况</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> org.apache.spark.storage.StorageLevel
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> org.apache.spark.sql.SparkSession
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">object</span> <span style="color:#50fa7b">BlockStorageTest</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">def</span> main<span style="color:#ff79c6">(</span>args<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Array</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">String</span><span style="color:#ff79c6">])</span><span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Unit</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// Step 1: Create Spark Session
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">val</span> spark <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">SparkSession</span><span style="color:#ff79c6">.</span>builder<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">.</span>appName<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Block Storage Test&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">.</span>master<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;local[*]&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">.</span>config<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;spark.local.dir&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;D:\\tmp\\spark_data&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">.</span>getOrCreate<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> sc <span style="color:#ff79c6">=</span> spark<span style="color:#ff79c6">.</span>sparkContext
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// Step 2: Create an RDD
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">val</span> data <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span> to <span style="color:#bd93f9">1000</span> <span style="color:#6272a4">// Sample data
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">val</span> rdd <span style="color:#ff79c6">=</span> sc<span style="color:#ff79c6">.</span>parallelize<span style="color:#ff79c6">(</span>data<span style="color:#ff79c6">,</span> numSlices <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">4</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// Step 3: Persist the RDD to memory and disk
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    rdd<span style="color:#ff79c6">.</span>persist<span style="color:#ff79c6">(</span><span style="color:#50fa7b">StorageLevel</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">DISK_ONLY</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// Step 4: Trigger an action to store the blocks
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    rdd<span style="color:#ff79c6">.</span>count<span style="color:#ff79c6">()</span> <span style="color:#6272a4">// Action to compute and store the blocks
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// Step 5: Log the disk storage location
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    println<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Disk storage location: &#34;</span> <span style="color:#ff79c6">+</span> sc<span style="color:#ff79c6">.</span>getConf<span style="color:#ff79c6">.</span>get<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;spark.local.dir&#34;</span><span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// Keep the application alive to inspect the disk manually
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#50fa7b">Thread</span><span style="color:#ff79c6">.</span>sleep<span style="color:#ff79c6">(</span><span style="color:#bd93f9">60000</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// Stop SparkSession
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    spark<span style="color:#ff79c6">.</span>stop<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在 spark.local.dir 目录下，生成了</p>
<ul>
<li>blockmgr-f733139a-820e-4ef9-9b1d-cae27c6debfa</li>
</ul>
<p>这里目录又包含了</p>
<ul>
<li>0e</li>
<li>11</li>
<li>14，里面有 rdd_0_0 文件</li>
<li>15，里面有 rdd_0_1 文件</li>
<li>16，有 rdd_0_2</li>
<li>17，有 rdd_0_3</li>
</ul>
<p>本地可以观察 spark-ui<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/11/26/7APEc9.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/11/26/7APEc9.png" />
        </a>
    </p>
<p>BoradcastManager 执行流程<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/12/01/7AiqLU.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/12/01/7AiqLU.png" />
        </a>
    </p>
<h3 id="map-监控体系">Map 监控体系</h3>
<p>Tracker 的几个类</p>
<ul>
<li>MapOutputTracker，父类</li>
<li>MapOutputTrackerMaster</li>
<li>MapOutputTrackerWorker</li>
</ul>
<p>这些类还引用了：ShuffleStatus</p>
<p>相关的类</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff79c6">private</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">spark</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">sealed</span> <span style="color:#ff79c6">trait</span> <span style="color:#50fa7b">MapOutputTrackerMessage</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>MapOutputTrackerMessage 的实现类</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff79c6">private</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">spark</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">GetMapOutputStatuses</span><span style="color:#ff79c6">(</span>shuffleId<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Int</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">MapOutputTrackerMessage</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">private</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">spark</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">GetMapAndMergeResultStatuses</span><span style="color:#ff79c6">(</span>shuffleId<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Int</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">MapOutputTrackerMessage</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">private</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">spark</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">GetShufflePushMergerLocations</span><span style="color:#ff79c6">(</span>shuffleId<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Int</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">MapOutputTrackerMessage</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">private</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">spark</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">object</span> <span style="color:#50fa7b">StopMapOutputTracker</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">MapOutputTrackerMessage</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">private</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">spark</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">sealed</span> <span style="color:#ff79c6">trait</span> <span style="color:#50fa7b">MapOutputTrackerMasterMessage</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">private</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">spark</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">GetMapOutputMessage</span><span style="color:#ff79c6">(</span>shuffleId<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Int</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>  context<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">RpcCallContext</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">MapOutputTrackerMasterMessage</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">private</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">spark</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">GetMapAndMergeOutputMessage</span><span style="color:#ff79c6">(</span>shuffleId<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Int</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>  context<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">RpcCallContext</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">MapOutputTrackerMasterMessage</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">private</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">spark</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">GetShufflePushMergersMessage</span><span style="color:#ff79c6">(</span>shuffleId<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Int</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>  context<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">RpcCallContext</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">MapOutputTrackerMasterMessage</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">private</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">spark</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">MapSizesByExecutorId</span><span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>  iter<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Iterator</span><span style="color:#ff79c6">[(</span><span style="color:#8be9fd">BlockManagerId</span>, 
</span></span></code></pre></td></tr></table>
</div>
</div><p>调用解释</p>
<ul>
<li>(1)表示某个Executor调用MapOutputTrackerWorker的getStatuses方法获取某个shuffle的map任务状态信息</li>
<li>(2)MessageLoop线程从mapOutputRequests队头取出GetMapOutputMessage</li>
<li>(3)从shuffleIdLocks数组中取出与当前GetMapOutputMessage携带的shuffleId相对应的锁</li>
<li>(4)首先从cachedSerializedStatuses缓存中获取shuffleId对应的序列化任务状态信息</li>
<li>(5)第四步没找到，从 mapStatuses中缓存的shuffleId对应的任务状态数组</li>
<li>(6)序列化后广播</li>
<li>(7)将序列化的任务状态放入cachedSerializedStatuses缓存中</li>
<li>(8)将广播对象放入cachedSerializedBroadcast缓存中</li>
<li>(9)将获得的序列化任务状态信息，通过回调GetMapOutputMessage消息携带的RpcCallContext的reply方法回复客户端

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/12/01/7Aiuxq.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/12/01/7Aiuxq.png" />
        </a>
    </li>
</ul>
<h2 id="web-ui">WEB-UI</h2>
<h3 id="整体结构">整体结构</h3>
<p>入口类： org.apache.spark.ui.SparkUI</p>
<p>层次体系</p>
<ul>
<li>SparkUI，该类继承子WebUI，中枢类，负责启动jetty,保存页面和URL Path之间的关系等</li>
<li>SparkUITab(继承自WebUITab) ，就是首页的标签栏</li>
<li>WebUIPage，这个是具体的页面。</li>
<li>SparkUI 负责整个Spark UI构建是，同时它是一切页面的根对象。</li>
<li>对应的层级结构为： SparkUI -&gt; WebUITab -&gt; WebUIPage</li>
</ul>
<p>初始化类</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>  <span style="color:#ff79c6">def</span> initialize<span style="color:#ff79c6">()</span><span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Unit</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> jobsTab <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> <span style="color:#50fa7b">JobsTab</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">this</span><span style="color:#ff79c6">,</span> store<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    attachTab<span style="color:#ff79c6">(</span>jobsTab<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> stagesTab <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> <span style="color:#50fa7b">StagesTab</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">this</span><span style="color:#ff79c6">,</span> store<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    attachTab<span style="color:#ff79c6">(</span>stagesTab<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    attachTab<span style="color:#ff79c6">(</span><span style="color:#ff79c6">new</span> <span style="color:#50fa7b">StorageTab</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">this</span><span style="color:#ff79c6">,</span> store<span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>    attachTab<span style="color:#ff79c6">(</span><span style="color:#ff79c6">new</span> <span style="color:#50fa7b">EnvironmentTab</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">this</span><span style="color:#ff79c6">,</span> store<span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>    attachTab<span style="color:#ff79c6">(</span><span style="color:#ff79c6">new</span> <span style="color:#50fa7b">ExecutorsTab</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">this</span><span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>    addStaticHandler<span style="color:#ff79c6">(</span><span style="color:#50fa7b">SparkUI</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">STATIC_RESOURCE_DIR</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    attachHandler<span style="color:#ff79c6">(</span>createRedirectHandler<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;/&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;/jobs/&#34;</span><span style="color:#ff79c6">,</span> basePath <span style="color:#ff79c6">=</span> basePath<span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>    attachHandler<span style="color:#ff79c6">(</span><span style="color:#50fa7b">ApiRootResource</span><span style="color:#ff79c6">.</span>getServletHandler<span style="color:#ff79c6">(</span><span style="color:#ff79c6">this</span><span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>sc<span style="color:#ff79c6">.</span>map<span style="color:#ff79c6">(</span><span style="color:#ff79c6">_</span><span style="color:#ff79c6">.</span>conf<span style="color:#ff79c6">.</span>get<span style="color:#ff79c6">(</span><span style="color:#50fa7b">UI_PROMETHEUS_ENABLED</span><span style="color:#ff79c6">)).</span>getOrElse<span style="color:#ff79c6">(</span><span style="color:#ff79c6">false</span><span style="color:#ff79c6">))</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>      attachHandler<span style="color:#ff79c6">(</span><span style="color:#50fa7b">PrometheusResource</span><span style="color:#ff79c6">.</span>getServletHandler<span style="color:#ff79c6">(</span><span style="color:#ff79c6">this</span><span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// These should be POST only, but, the YARN AM proxy won&#39;t proxy POSTs
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    attachHandler<span style="color:#ff79c6">(</span>createRedirectHandler<span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;/jobs/job/kill&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;/jobs/&#34;</span><span style="color:#ff79c6">,</span> jobsTab<span style="color:#ff79c6">.</span>handleKillRequest<span style="color:#ff79c6">,</span> httpMethods <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">Set</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;GET&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;POST&#34;</span><span style="color:#ff79c6">)))</span>
</span></span><span style="display:flex;"><span>    attachHandler<span style="color:#ff79c6">(</span>createRedirectHandler<span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;/stages/stage/kill&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;/stages/&#34;</span><span style="color:#ff79c6">,</span> stagesTab<span style="color:#ff79c6">.</span>handleKillRequest<span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      httpMethods <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">Set</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;GET&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;POST&#34;</span><span style="color:#ff79c6">)))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>attachPage 的核心逻辑：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>  <span style="color:#ff79c6">def</span> attachPage<span style="color:#ff79c6">(</span>page<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">WebUIPage</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Unit</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> pagePath <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;/&#34;</span> <span style="color:#ff79c6">+</span> page<span style="color:#ff79c6">.</span>prefix
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> renderHandler <span style="color:#ff79c6">=</span> createServletHandler<span style="color:#ff79c6">(</span>pagePath<span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">(</span>request<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">HttpServletRequest</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">=&gt;</span> page<span style="color:#ff79c6">.</span>render<span style="color:#ff79c6">(</span>request<span style="color:#ff79c6">),</span> conf<span style="color:#ff79c6">,</span> basePath<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> renderJsonHandler <span style="color:#ff79c6">=</span> createServletHandler<span style="color:#ff79c6">(</span>pagePath<span style="color:#ff79c6">.</span>stripSuffix<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;/&#34;</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;/json&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">(</span>request<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">HttpServletRequest</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">=&gt;</span> page<span style="color:#ff79c6">.</span>renderJson<span style="color:#ff79c6">(</span>request<span style="color:#ff79c6">),</span> conf<span style="color:#ff79c6">,</span> basePath<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    attachHandler<span style="color:#ff79c6">(</span>renderHandler<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    attachHandler<span style="color:#ff79c6">(</span>renderJsonHandler<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> handlers <span style="color:#ff79c6">=</span> pageToHandlers<span style="color:#ff79c6">.</span>getOrElseUpdate<span style="color:#ff79c6">(</span>page<span style="color:#ff79c6">,</span> <span style="color:#50fa7b">ArrayBuffer</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">ServletContextHandler</span><span style="color:#ff79c6">]())</span>
</span></span><span style="display:flex;"><span>    handlers <span style="color:#ff79c6">+=</span> renderHandler
</span></span><span style="display:flex;"><span>    handlers <span style="color:#ff79c6">+=</span> renderJsonHandler
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建 createServletHandler 的逻辑<br>
就是 创建一个 HttpServlet，然后加入到 jetty 的体系中</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>  <span style="color:#ff79c6">def</span> createServletHandler<span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>      path<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      servlet<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">HttpServlet</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      basePath<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">:</span> <span style="color:#8be9fd">ServletContextHandler</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> prefixedPath <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>basePath <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;&#34;</span> <span style="color:#ff79c6">&amp;&amp;</span> path <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;/&#34;</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>      path
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">(</span>basePath <span style="color:#ff79c6">+</span> path<span style="color:#ff79c6">).</span>stripSuffix<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;/&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> contextHandler <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> <span style="color:#50fa7b">ServletContextHandler</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> holder <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> <span style="color:#50fa7b">ServletHolder</span><span style="color:#ff79c6">(</span>servlet<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    contextHandler<span style="color:#ff79c6">.</span>setContextPath<span style="color:#ff79c6">(</span>prefixedPath<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    contextHandler<span style="color:#ff79c6">.</span>addServlet<span style="color:#ff79c6">(</span>holder<span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;/&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    contextHandler
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Web table 继承关系<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/11/29/7AfMGb.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/11/29/7AfMGb.png" />
        </a>
    </p>
<p>WEB-ui page 继承关系<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/11/29/7AfIpt.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/11/29/7AfIpt.png" />
        </a>
    </p>
<p>而 WebUI 会创建 HttpServlet，并加入到 Jetty 的 Hanlder 体系中</p>
<h3 id="自定义-ui">自定义 UI</h3>
<p>增加一个自定义的 页面</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">MyTab</span><span style="color:#ff79c6">(</span>parent<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">SparkUI</span><span style="color:#ff79c6">,</span> store<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">AppStatusStore</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">SparkUITab</span><span style="color:#ff79c6">(</span>parent<span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;my_tab&#34;</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  attachPage<span style="color:#ff79c6">(</span><span style="color:#ff79c6">new</span> <span style="color:#50fa7b">MyStoragePage</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">this</span><span style="color:#ff79c6">,</span> store<span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>MyStoragePage 内容内容拷贝自 StoragePage<br>
注意要将这个类中的 [storage] 删除，不然编译会出错</p>
<p>启动类</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>  <span style="color:#ff79c6">def</span> go<span style="color:#ff79c6">()</span><span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Unit</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> spark <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">SparkSession</span><span style="color:#ff79c6">.</span>builder<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">.</span>appName<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Block Storage Test&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">.</span>master<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;local[*]&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">.</span>getOrCreate<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> sc <span style="color:#ff79c6">=</span> spark<span style="color:#ff79c6">.</span>sparkContext
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> ui<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">SparkUI</span> <span style="color:#ff79c6">=</span> sc<span style="color:#ff79c6">.</span>ui<span style="color:#ff79c6">.</span>getOrElse<span style="color:#ff79c6">(</span><span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> <span style="color:#50fa7b">RuntimeException</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Not support web ui.&#34;</span><span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> store <span style="color:#ff79c6">=</span> ui<span style="color:#ff79c6">.</span>store
</span></span><span style="display:flex;"><span>    ui<span style="color:#ff79c6">.</span>attachTab<span style="color:#ff79c6">(</span><span style="color:#ff79c6">new</span> <span style="color:#50fa7b">MyTab</span><span style="color:#ff79c6">(</span>ui<span style="color:#ff79c6">,</span> store<span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">Thread</span><span style="color:#ff79c6">.</span>sleep<span style="color:#ff79c6">(</span><span style="color:#50fa7b">Long</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">MaxValue</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>启动后，spark-ui 中就多了一个 page<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/11/29/7Affte.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/11/29/7Affte.png" />
        </a>
    </p>
<p>也可以增加其他类型</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>    ui<span style="color:#ff79c6">.</span>attachHandler<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>    ui<span style="color:#ff79c6">.</span>addStaticHandler<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>    ui<span style="color:#ff79c6">.</span>attachPage<span style="color:#ff79c6">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="执行环境">执行环境</h2>
<p>env<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/11/29/7AfioP.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/11/29/7AfioP.png" />
        </a>
    </p>
<p>安全体系</p>
<ul>
<li>SecurityManager</li>
<li>用于设置 yarn，hadoop 的 secret key</li>
</ul>
<p>SparkContext 会附带初始化</p>
<ul>
<li>Metrics 体系</li>
<li>Listener</li>
<li>SparkUI</li>
<li>RPC 整套体系</li>
<li>BlockManager，storage 体系</li>
<li>Executor 体系</li>
<li>Heartbeater</li>
<li>KVStore</li>
<li>SerializerManager</li>
</ul>
<p>度量类</p>
<ul>
<li>MetricsSystem</li>
<li>提供了 source、sink</li>
</ul>
<p>日志体系</p>
<ul>
<li>org.apache.spark.internal.Logging</li>
<li>整合了 org.slf4j</li>
<li>提供了 info，warn 等函数</li>
</ul>
<h2 id="prc-体系">PRC 体系</h2>
<h3 id="客户端服务端例子">客户端服务端例子</h3>
<p>一个服务端的类</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> org.apache.spark.<span style="color:#ff79c6">{</span><span style="color:#50fa7b">SparkConf</span><span style="color:#ff79c6">,</span> <span style="color:#50fa7b">SparkContext</span><span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">object</span> <span style="color:#50fa7b">RpcServer</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">HelloWorldEndpoint</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">val</span> rpcEnv<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">RpcEnv</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">RpcEndpoint</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">override</span> <span style="color:#ff79c6">def</span> receiveAndReply<span style="color:#ff79c6">(</span>context<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">RpcCallContext</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">:</span> <span style="color:#8be9fd">PartialFunction</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">Any</span>, <span style="color:#8be9fd">Unit</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">case</span> <span style="color:#f1fa8c">&#34;Hello&#34;</span> <span style="color:#ff79c6">=&gt;</span>
</span></span><span style="display:flex;"><span>        println<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Received &#39;Hello&#39; message&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>        context<span style="color:#ff79c6">.</span>reply<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Hello from the server!&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">_</span> <span style="color:#ff79c6">=&gt;</span>
</span></span><span style="display:flex;"><span>        context<span style="color:#ff79c6">.</span>reply<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Unknown message&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">override</span> <span style="color:#ff79c6">def</span> receive<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">PartialFunction</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">Any</span>, <span style="color:#8be9fd">Unit</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">case</span> msg <span style="color:#ff79c6">=&gt;</span> println<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">s&#34;Received: </span><span style="color:#f1fa8c">$msg</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">override</span> <span style="color:#ff79c6">def</span> onStop<span style="color:#ff79c6">()</span><span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Unit</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>      println<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Stopping the server endpoint&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">def</span> main<span style="color:#ff79c6">(</span>args<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Array</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">String</span><span style="color:#ff79c6">])</span><span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Unit</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> conf <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> <span style="color:#50fa7b">SparkConf</span><span style="color:#ff79c6">().</span>setAppName<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Spark RPC Hello World&#34;</span><span style="color:#ff79c6">).</span>setMaster<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;local[2]&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> sc <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> <span style="color:#50fa7b">SparkContext</span><span style="color:#ff79c6">(</span>conf<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> rpcEnv<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">RpcEnv</span> <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">RpcEnv</span><span style="color:#ff79c6">.</span>create<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;HelloWorldServer&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;localhost&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#bd93f9">9999</span><span style="color:#ff79c6">,</span> conf<span style="color:#ff79c6">,</span> sc<span style="color:#ff79c6">.</span>env<span style="color:#ff79c6">.</span>securityManager<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// Register the HelloWorld endpoint
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">val</span> helloEndpoint <span style="color:#ff79c6">=</span> rpcEnv<span style="color:#ff79c6">.</span>setupEndpoint<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;helloEndpoint&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#ff79c6">new</span> <span style="color:#50fa7b">HelloWorldEndpoint</span><span style="color:#ff79c6">(</span>rpcEnv<span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    println<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Server is running and waiting for messages...&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#50fa7b">Thread</span><span style="color:#ff79c6">.</span>sleep<span style="color:#ff79c6">(</span><span style="color:#50fa7b">Long</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">MaxValue</span><span style="color:#ff79c6">)</span>  <span style="color:#6272a4">// Keep the server running
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    rpcEnv<span style="color:#ff79c6">.</span>stop<span style="color:#ff79c6">(</span>helloEndpoint<span style="color:#ff79c6">)</span>  <span style="color:#6272a4">// Shutdown the server
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    sc<span style="color:#ff79c6">.</span>stop<span style="color:#ff79c6">()</span>  <span style="color:#6272a4">// Stop SparkContext
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>客户端类</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> org.apache.spark.<span style="color:#ff79c6">{</span><span style="color:#50fa7b">SparkConf</span><span style="color:#ff79c6">,</span> <span style="color:#50fa7b">SparkContext</span><span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> scala.concurrent.ExecutionContext.Implicits.global
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> scala.util.<span style="color:#ff79c6">{</span><span style="color:#50fa7b">Failure</span><span style="color:#ff79c6">,</span> <span style="color:#50fa7b">Success</span><span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">object</span> <span style="color:#50fa7b">RpcClient</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">def</span> main<span style="color:#ff79c6">(</span>args<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Array</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">String</span><span style="color:#ff79c6">])</span><span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Unit</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> conf <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> <span style="color:#50fa7b">SparkConf</span><span style="color:#ff79c6">().</span>setAppName<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Spark RPC Hello World Client&#34;</span><span style="color:#ff79c6">).</span>setMaster<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;local[2]&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> sc <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> <span style="color:#50fa7b">SparkContext</span><span style="color:#ff79c6">(</span>conf<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> rpcEnv<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">RpcEnv</span> <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">RpcEnv</span><span style="color:#ff79c6">.</span>create<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;HelloWorldClient&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;localhost&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#bd93f9">9999</span><span style="color:#ff79c6">,</span> conf<span style="color:#ff79c6">,</span> sc<span style="color:#ff79c6">.</span>env<span style="color:#ff79c6">.</span>securityManager<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// Connect to the server endpoint
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">val</span> address <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> <span style="color:#50fa7b">RpcAddress</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;localhost&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#bd93f9">9999</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> helloEndpoint <span style="color:#ff79c6">=</span> rpcEnv<span style="color:#ff79c6">.</span>setupEndpointRef<span style="color:#ff79c6">(</span>address<span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;helloEndpoint&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// Send a message to the server
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    helloEndpoint<span style="color:#ff79c6">.</span>ask<span style="color:#ff79c6">[</span><span style="color:#8be9fd">String</span><span style="color:#ff79c6">](</span><span style="color:#f1fa8c">&#34;Hello&#34;</span><span style="color:#ff79c6">).</span>onComplete <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">case</span> <span style="color:#50fa7b">Success</span><span style="color:#ff79c6">(</span>response<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">=&gt;</span>
</span></span><span style="display:flex;"><span>        println<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">s&#34;Received from server: </span><span style="color:#f1fa8c">$response</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">case</span> <span style="color:#50fa7b">Failure</span><span style="color:#ff79c6">(</span>e<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">=&gt;</span>
</span></span><span style="display:flex;"><span>        println<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">s&#34;Failed to receive response from server: </span><span style="color:#f1fa8c">${</span>e<span style="color:#ff79c6">.</span>getMessage<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// Let the client wait for the response
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#50fa7b">Thread</span><span style="color:#ff79c6">.</span>sleep<span style="color:#ff79c6">(</span><span style="color:#bd93f9">2000</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    sc<span style="color:#ff79c6">.</span>stop<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="network-包">network 包</h3>
<p>org.apache.spark.network 包的结构<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/11/30/7AfF2O.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/11/30/7AfF2O.png" />
        </a>
      <br>
解释</p>
<ul>
<li>这个包里面的主要是对 netty 的封装，还有一些 server 和 client 类</li>
<li>以及 安全传输方面的，sasl 的</li>
<li>shuffle db，包括了 LevelDB、RocksDB</li>
<li>protocl 是 spark继承了 netty 体系，发送时封装的包协议</li>
<li>buffer 是 发送的 protocol 中用到的 一些buffer</li>
</ul>
<p>初始化过程<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/11/30/7AfdQQ.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/11/30/7AfdQQ.png" />
        </a>
    </p>
<h3 id="发送过程">发送过程</h3>
<p>RpcEndpoint 和 RpcEndpointRef 之间的关系<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/12/01/7Ai369.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/12/01/7Ai369.png" />
        </a>
    </p>
<p>发送过程<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/12/01/7Afecf.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/12/01/7Afecf.png" />
        </a>
    </p>
<p>NettyRpcEnv 中维护了 Outbox 的 map</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff79c6">val</span> outboxes <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> <span style="color:#50fa7b">ConcurrentHashMap</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">RpcAddress</span>, <span style="color:#8be9fd">Outbox</span><span style="color:#ff79c6">]()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>而 Outbox 内部为了 OutboxMessage 的 list</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff79c6">val</span> messages <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> java<span style="color:#ff79c6">.</span>util<span style="color:#ff79c6">.</span><span style="color:#50fa7b">LinkedList</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">OutboxMessage</span><span style="color:#ff79c6">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>发送体系的结构如下图，所以一个节点是可以发送给多个接收方的<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/12/01/7Afonc.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/12/01/7Afonc.png" />
        </a>
    </p>
<h3 id="接收过程">接收过程</h3>
<p>接收的体系<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/12/01/7AiBGj.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/12/01/7AiBGj.png" />
        </a>
    <br>
解释</p>
<ul>
<li>MessageLoop 中维护了 Inbox 的链表</li>
<li>每个Inbox 中为了 InboxMessage 的链表</li>
<li>InboxMessage 是抽象类，实现类如上图</li>
<li>如果是 RpcMessage 还需要回复响应，调用 endpoint.receiveAndReply 回复</li>
<li>这里的 endpoint 类型非常多，比如有 HeartbeatReceiver 这种的，他的 函数大致如下：</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff79c6">override</span> <span style="color:#ff79c6">def</span> receiveAndReply<span style="color:#ff79c6">(</span>context<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">RpcCallContext</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">:</span> <span style="color:#8be9fd">PartialFunction</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">Any</span>, <span style="color:#8be9fd">Unit</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// Messages sent and received locally
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">case</span> <span style="color:#50fa7b">ExecutorRegistered</span><span style="color:#ff79c6">(</span>executorId<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">=&gt;</span>
</span></span><span style="display:flex;"><span>      executorLastSeen<span style="color:#ff79c6">(</span>executorId<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">=</span> clock<span style="color:#ff79c6">.</span>getTimeMillis<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>      context<span style="color:#ff79c6">.</span>reply<span style="color:#ff79c6">(</span><span style="color:#ff79c6">true</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">case</span> <span style="color:#50fa7b">ExecutorRemoved</span><span style="color:#ff79c6">(</span>executorId<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">=&gt;</span>
</span></span><span style="display:flex;"><span>      executorLastSeen<span style="color:#ff79c6">.</span>remove<span style="color:#ff79c6">(</span>executorId<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>      context<span style="color:#ff79c6">.</span>reply<span style="color:#ff79c6">(</span><span style="color:#ff79c6">true</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">case</span> <span style="color:#50fa7b">TaskSchedulerIsSet</span> <span style="color:#ff79c6">=&gt;</span>
</span></span><span style="display:flex;"><span>      scheduler <span style="color:#ff79c6">=</span> sc<span style="color:#ff79c6">.</span>taskScheduler
</span></span><span style="display:flex;"><span>      context<span style="color:#ff79c6">.</span>reply<span style="color:#ff79c6">(</span><span style="color:#ff79c6">true</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">case</span> <span style="color:#50fa7b">ExpireDeadHosts</span> <span style="color:#ff79c6">=&gt;</span>
</span></span><span style="display:flex;"><span>      expireDeadHosts<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>      context<span style="color:#ff79c6">.</span>reply<span style="color:#ff79c6">(</span><span style="color:#ff79c6">true</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">...</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">...</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>	  
</span></span></code></pre></td></tr></table>
</div>
</div><p>读取的时序图</p>
<ul>
<li>netty 的线程接收到请求，交给 Dispatcher</li>
<li>Dispatcher 中定义了 endpoint 名字 和 MessageLoop 的关系</li>
<li>获取到 MessageLoop 后，交给 MessageLoop 去处理</li>
<li>在 MessageLoop#post 中，将消息放到 Inbox 中，然后往阻塞队列中方一个消息</li>
<li>后面阻塞队列会被唤醒，然后由 MessageLoop 线程再去处理这些具体的消息

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/12/01/7Aip9m.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/12/01/7Aip9m.png" />
        </a>
    </li>
</ul>
<p>下面是 Dispatcher 中定义的映射关系</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff79c6">val</span> endpoints<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">ConcurrentMap</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">String</span>, <span style="color:#8be9fd">MessageLoop</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">new</span> <span style="color:#50fa7b">ConcurrentHashMap</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">String</span>, <span style="color:#8be9fd">MessageLoop</span><span style="color:#ff79c6">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>MessageLoop 线程处理的时序图</p>
<ul>
<li>MessageLoop 中接收到消息，转给 Inbox 处理</li>
<li>Inbox 则交给 具体的 Endpoint#receiveAndReply响应</li>
<li>具体的类型有很多，比如 HeartbeatReceiver 会接受到请求，再回复响应

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/12/01/7AiLH4.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/12/01/7AiLH4.png" />
        </a>
    </li>
</ul>
<p>RpcEndpoint 相关类图 

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/12/01/7Ai7QY.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/12/01/7Ai7QY.png" />
        </a>
    </p>
<p>ThreadSafeRpcEndpoint 相关类图<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/12/01/7Ai01h.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/12/01/7Ai01h.png" />
        </a>
    </p>
<p>InboxMessage 继承关系<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/12/01/7AiEvH.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/12/01/7AiEvH.png" />
        </a>
    </p>
<p>下图简述了一个发送关系</p>
<ul>
<li>(1)表示本地发送</li>
<li>(2)源端发送</li>
<li>(3)每个Outbox的drainOutbox 通过循环，不断从messages列表中取得OutboxMessage</li>
<li>(4)和(5)表示真实发送

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/12/01/7AiQnZ.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/12/01/7AiQnZ.png" />
        </a>
    </li>
</ul>
<h2 id="参考">参考</h2>
<ul>
<li><a href="https://www.cnblogs.com/jcchoiling/p/6507162.html">BlockManager架构原理、运行流程图和源码解密</a></li>
<li><a href="https://blog.csdn.net/qq_26442553/article/details/135935315">深入理解Spark BlockManager：定义、原理与实践</a></li>
<li><a href="https://blog.csdn.net/weixin_45162906/article/details/128804470">SparkUI的分析与定制</a></li>
<li><a href="https://www.cnblogs.com/listenfwind/p/10434983.html">Spark rpc框架概述</a></li>
<li><a href="https://cloud.tencent.com/developer/article/1733862">Spark集群启动流程的简单分析</a></li>
<li><a href="https://juejin.cn/post/7316796493299531786">Spark源码阅读篇-Rpc通信-概述</a></li>
<li><a href="https://cloud.tencent.com/developer/article/1887740">Spark Rpc 三剑客的理解</a></li>
<li><a href="https://www.waitingforcode.com/apache-spark/rpc-apache-spark/read">RPC in Apache Spark</a></li>
</ul>

			<script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>
        </div>

        


        

<div class="post-archive">
    <h2>相关文章</h2>
    <ul class="listing">
        
        <li><a href="/post/2024/10/spark_optimize/">Spark的一些优化</a></li>
        
        <li><a href="/post/2024/09/spark_streaming/">Spark-Streaming 原理</a></li>
        
        <li><a href="/post/2024/09/data_distribution/">Spark的 数据分布</a></li>
        
        <li><a href="/post/2024/05/spark_codegen/">code-gen</a></li>
        
        <li><a href="/post/2024/05/spark_join/">Spark原理-JOIN</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/spark'>Spark</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "himichael/hugoblogtalks"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>


                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://code0xff.org/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://code0xff.org/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://code0xff.org/post/2025/01/spark_register_source/" title="Spark 注册数据源">Spark 注册数据源</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2025/01/spark_core_2/" title="Spark Core相关-2">Spark Core相关-2</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/12/llamafactory/" title="Llama Factory">Llama Factory</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/11/spark_core/" title="Spark Core相关-1">Spark Core相关-1</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/11/sae_tunnel/" title="sea tunnel">sea tunnel</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/11/k8s_networks/" title="k8s 网络">k8s 网络</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/11/ozone/" title="ozone">ozone</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/11/es/" title="ES的简单学习">ES的简单学习</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2025/02/ai/" title="AI的简单学习">AI的简单学习</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/11/big_data_investigation/" title="国内几个云厂商大数据平台">国内几个云厂商大数据平台</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://code0xff.org/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式 (6)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/">原理分析 (24)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E5%95%86%E4%B8%9A/">商业 (3)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据 (56)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库 (41)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%96%87%E5%AD%A6%E5%92%8C%E8%89%BA%E6%9C%AF/">文学和艺术 (3)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%97%85%E8%A1%8C/">旅行 (12)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%9E%B6%E6%9E%84/">架构 (13)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E7%AE%97%E6%B3%95/">算法 (8)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E7%B3%BB%E7%BB%9F/">系统 (7)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言 (7)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E8%A1%8C%E4%B8%9A%E8%A7%82%E5%AF%9F/">行业观察 (3)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记 (14)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E9%9A%8F%E4%BE%BF%E5%86%99%E5%86%99/">随便写写 (3)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">归档</a></h3>
<ul class="widget-list">
    
    <li><a href="https://code0xff.org/years/2021%E5%B9%B4/">2021年 (41)</a></li>
    
    <li><a href="https://code0xff.org/years/2022%E5%B9%B4/">2022年 (55)</a></li>
    
    <li><a href="https://code0xff.org/years/2023%E5%B9%B4/">2023年 (54)</a></li>
    
    <li><a href="https://code0xff.org/years/2024%E5%B9%B4/">2024年 (48)</a></li>
    
    <li><a href="https://code0xff.org/years/2025%E5%B9%B4/">2025年 (2)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://code0xff.org/tags/ai/">AI </a>
    
    <a href="https://code0xff.org/tags/ambari/">Ambari </a>
    
    <a href="https://code0xff.org/tags/architecture/">architecture </a>
    
    <a href="https://code0xff.org/tags/bigdata/">bigdata </a>
    
    <a href="https://code0xff.org/tags/b%E6%A0%91/">B树 </a>
    
    <a href="https://code0xff.org/tags/c&#43;&#43;/">C&#43;&#43; </a>
    
    <a href="https://code0xff.org/tags/calcite/">calcite </a>
    
    <a href="https://code0xff.org/tags/cmu-database/">CMU-Database </a>
    
    <a href="https://code0xff.org/tags/data_ingestion/">Data_Ingestion </a>
    
    <a href="https://code0xff.org/tags/deltalake/">DeltaLake </a>
    
    <a href="https://code0xff.org/tags/doris/">Doris </a>
    
    <a href="https://code0xff.org/tags/english/">English </a>
    
    <a href="https://code0xff.org/tags/es/">ES </a>
    
    <a href="https://code0xff.org/tags/facebook/">Facebook </a>
    
    <a href="https://code0xff.org/tags/flink/">flink </a>
    
    <a href="https://code0xff.org/tags/flume/">flume </a>
    
    <a href="https://code0xff.org/tags/gc/">GC </a>
    
    <a href="https://code0xff.org/tags/gluten/">Gluten </a>
    
    <a href="https://code0xff.org/tags/hana/">HANA </a>
    
    <a href="https://code0xff.org/tags/hive/">Hive </a>
    
    <a href="https://code0xff.org/tags/iceberg/">iceberg </a>
    
    <a href="https://code0xff.org/tags/impala/">Impala </a>
    
    <a href="https://code0xff.org/tags/janino/">janino </a>
    
    <a href="https://code0xff.org/tags/k8s/">k8s </a>
    
    <a href="https://code0xff.org/tags/kafka/">Kafka </a>
    
    <a href="https://code0xff.org/tags/kudu/">kudu </a>
    
    <a href="https://code0xff.org/tags/kyuubi/">Kyuubi </a>
    
    <a href="https://code0xff.org/tags/lakehouse/">Lakehouse </a>
    
    <a href="https://code0xff.org/tags/leveldb/">LevelDB </a>
    
    <a href="https://code0xff.org/tags/llamafactory/">LlamaFactory </a>
    
    <a href="https://code0xff.org/tags/llvm/">LLVM </a>
    
    <a href="https://code0xff.org/tags/manacher/">Manacher </a>
    
    <a href="https://code0xff.org/tags/mapreduce/">MapReduce </a>
    
    <a href="https://code0xff.org/tags/micro-service/">micro-service </a>
    
    <a href="https://code0xff.org/tags/mysql/">MySQL </a>
    
    <a href="https://code0xff.org/tags/newsql/">NewSQL </a>
    
    <a href="https://code0xff.org/tags/oceanbase/">OceanBase </a>
    
    <a href="https://code0xff.org/tags/openlogreplicator/">OpenLogReplicator </a>
    
    <a href="https://code0xff.org/tags/parquet/">parquet </a>
    
    <a href="https://code0xff.org/tags/paxos/">paxos </a>
    
    <a href="https://code0xff.org/tags/presto/">Presto </a>
    
    <a href="https://code0xff.org/tags/quick-sql/">quick-sql </a>
    
    <a href="https://code0xff.org/tags/raft/">raft </a>
    
    <a href="https://code0xff.org/tags/scala/">scala </a>
    
    <a href="https://code0xff.org/tags/simd/">SIMD </a>
    
    <a href="https://code0xff.org/tags/snowflake/">snowflake </a>
    
    <a href="https://code0xff.org/tags/spark/">spark </a>
    
    <a href="https://code0xff.org/tags/sre/">SRE </a>
    
    <a href="https://code0xff.org/tags/teradata/">TeraData </a>
    
    <a href="https://code0xff.org/tags/tpcx-hs/">TPCx-HS </a>
    
    <a href="https://code0xff.org/tags/trino/">Trino </a>
    
    <a href="https://code0xff.org/tags/tuning/">Tuning </a>
    
    <a href="https://code0xff.org/tags/unix/">unix </a>
    
    <a href="https://code0xff.org/tags/yarn/">YARN </a>
    
    <a href="https://code0xff.org/tags/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/">二分查找 </a>
    
    <a href="https://code0xff.org/tags/%E4%BA%8C%E5%8F%89%E6%A0%91%E9%81%8D%E5%8E%86/">二叉树遍历 </a>
    
    <a href="https://code0xff.org/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式 </a>
    
    <a href="https://code0xff.org/tags/%E5%88%97%E5%AD%98/">列存 </a>
    
    <a href="https://code0xff.org/tags/%E5%8A%A8%E6%80%81%E6%B3%A8%E5%85%A5/">动态注入 </a>
    
    <a href="https://code0xff.org/tags/%E5%8E%86%E5%8F%B2/">历史 </a>
    
    <a href="https://code0xff.org/tags/%E5%90%91%E9%87%8F%E5%8C%96/">向量化 </a>
    
    <a href="https://code0xff.org/tags/%E5%9B%9E%E6%BA%AF/">回溯 </a>
    
    <a href="https://code0xff.org/tags/%E5%9B%BD%E5%86%85%E6%97%85%E8%A1%8C/">国内旅行 </a>
    
    <a href="https://code0xff.org/tags/%E5%9B%BD%E5%A4%96%E6%97%85%E8%A1%8C/">国外旅行 </a>
    
    <a href="https://code0xff.org/tags/%E5%A4%9A%E7%A7%9F%E6%88%B7/">多租户 </a>
    
    <a href="https://code0xff.org/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据 </a>
    
    <a href="https://code0xff.org/tags/%E5%AD%98%E5%82%A8/">存储 </a>
    
    <a href="https://code0xff.org/tags/%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/">工作记录 </a>
    
    <a href="https://code0xff.org/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务 </a>
    
    <a href="https://code0xff.org/tags/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0/">数据中台 </a>
    
    <a href="https://code0xff.org/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库 </a>
    
    <a href="https://code0xff.org/tags/%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B/">数据模型 </a>
    
    <a href="https://code0xff.org/tags/%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB/">数据迁移 </a>
    
    <a href="https://code0xff.org/tags/%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/">查询优化 </a>
    
    <a href="https://code0xff.org/tags/%E6%9F%A5%E8%AF%A2%E7%BC%96%E8%AF%91/">查询编译 </a>
    
    <a href="https://code0xff.org/tags/%E6%A6%82%E7%8E%87/">概率 </a>
    
    <a href="https://code0xff.org/tags/%E6%B1%87%E7%BC%96/">汇编 </a>
    
    <a href="https://code0xff.org/tags/%E6%B5%8B%E8%AF%95/">测试 </a>
    
    <a href="https://code0xff.org/tags/%E7%94%9F%E6%B4%BB/">生活 </a>
    
    <a href="https://code0xff.org/tags/%E7%94%B5%E5%BD%B1/">电影 </a>
    
    <a href="https://code0xff.org/tags/%E7%AE%97%E6%B3%95/">算法 </a>
    
    <a href="https://code0xff.org/tags/%E7%B4%A2%E5%BC%95/">索引 </a>
    
    <a href="https://code0xff.org/tags/%E7%BB%8F%E6%B5%8E/">经济 </a>
    
    <a href="https://code0xff.org/tags/%E7%BC%93%E5%AD%98/">缓存 </a>
    
    <a href="https://code0xff.org/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/">编译原理 </a>
    
    <a href="https://code0xff.org/tags/%E7%BD%91%E7%BB%9C/">网络 </a>
    
    <a href="https://code0xff.org/tags/%E8%AE%A1%E7%AE%97%E6%A1%86%E6%9E%B6/">计算框架 </a>
    
    <a href="https://code0xff.org/tags/%E8%AE%BA%E6%96%87/">论文 </a>
    
    <a href="https://code0xff.org/tags/%E8%AF%BB%E4%B9%A6/">读书 </a>
    
    <a href="https://code0xff.org/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记 </a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">RSS</h3>
        <ul class="widget-list">
            <li><a href="https://code0xff.org/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
    <footer id="footer">
    <div>
        &copy; 2025 <a href="https://code0xff.org/">记录每个瞬间 By 老王</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script src="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'GA ID', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




</body>

</html>