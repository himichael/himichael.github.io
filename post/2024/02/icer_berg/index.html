<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>Iceberg 简单总结 | 记录每个瞬间</title>
    <meta property="og:title" content="Iceberg 简单总结 - 记录每个瞬间">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2024-02-25T09:08:07&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2024-02-25T09:08:07&#43;08:00'>
        
    <meta name="Keywords" content="">
    <meta name="description" content="Iceberg 简单总结">
        <meta name="author" content="隔壁老王">
        
    <meta property="og:url" content="https://code0xff.org/post/2024/02/icer_berg/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
        <link href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://code0xff.org/">
                        记录每个瞬间
                    </a>
                
                
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://code0xff.org/">首页</a>
                    
                    <a  href="https://code0xff.org/linked/" title="链接">链接</a>
                    
                    <a  href="https://code0xff.org/archives/" title="归档">归档</a>
                    
                    <a  href="https://code0xff.org/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">Iceberg 简单总结</h1>
        </header>
        <date class="post-meta meta-date">
            2024年2月25日
        </date>
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#basic-use">Basic Use</a></li>
        <li><a href="#table">Table</a>
          <ul>
            <li><a href="#branching-and-tagging">Branching and Tagging</a></li>
            <li><a href="#configuration">Configuration</a></li>
            <li><a href="#evolution">Evolution</a></li>
            <li><a href="#sort-order-evolution">Sort order evolution</a></li>
            <li><a href="#maintenance">Maintenance</a></li>
            <li><a href="#performance">Performance</a></li>
            <li><a href="#reliability">Reliability</a></li>
            <li><a href="#schemas">Schemas</a></li>
          </ul>
        </li>
        <li><a href="#spark">Spark</a>
          <ul>
            <li><a href="#api">API</a></li>
            <li><a href="#spark-configuration">Spark Configuration</a></li>
            <li><a href="#spark-ddl">Spark DDL</a></li>
            <li><a href="#spark-procedures">Spark Procedures</a></li>
            <li><a href="#queries">Queries</a></li>
            <li><a href="#structured-streaming">Structured Streaming</a></li>
          </ul>
        </li>
        <li><a href="#hive">Hive</a></li>
        <li><a href="#flink">Flink</a>
          <ul>
            <li><a href="#api-1">API</a></li>
            <li><a href="#flink-connector">Flink Connector</a></li>
            <li><a href="#ddl-queries">DDL Queries</a></li>
          </ul>
        </li>
        <li><a href="#roadmap">Roadmap</a></li>
        <li><a href="#reference">Reference</a></li>
      </ul>
    </li>
  </ul>
</nav>
        
        <div class="post-meta">
            
            <span class="post-meta meta-tags">
                <ul class="clearfix">
                    <a href='/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE'>大数据</a>
                </ul>
            </span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <blockquote>
<p><strong>Apache Iceberg is an open table format for huge analytic datasets.</strong><br>
Iceberg adds tables to compute engines including Spark, Trino, PrestoDB, Flink, Hive and Impala<br>
using a high-performance table format that works just like a SQL table.</p>
</blockquote>
<h2 id="basic-use">Basic Use</h2>
<p>一些特性：</p>
<ul>
<li>Schema evolution supports add, drop, update, or rename, and has no side-effects</li>
<li>Hidden partitioning prevents user mistakes that cause silently incorrect results or extremely slow queries</li>
<li>Partition layout evolution can update the layout of a table as data volume or query patterns change</li>
<li>Time travel enables reproducible queries that use exactly the same table snapshot, or lets users easily examine changes</li>
<li>Version rollback allows users to quickly correct problems by resetting tables to a good state</li>
</ul>
<p>目前支持的计算引擎</p>
<ul>
<li>Spark</li>
<li>Flink</li>
<li>Hive</li>
<li>Trino</li>
<li>ClickHouse</li>
<li>Presto</li>
<li>Dremio</li>
<li>Starrocks</li>
<li>Amazon Athena</li>
<li>Amazone EMR</li>
<li>Impala</li>
<li>Doris</li>
</ul>
<h2 id="table">Table</h2>
<h3 id="branching-and-tagging">Branching and Tagging</h3>
<p>版本，time travel 等都是通过 元数据实现的，每次变更就是一个快照，支持快照过期策略，也就是快照的生命周期策略<br>
iceberg 还提供了更丰富的功能，可以给这个快照 打 branch、tag，这样他们的生命周期，也就是过期策略 就独立了   <br>
支持 branch、tag 的快照管理<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/21/7gQ8mV.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/05/21/7gQ8mV.png" />
        </a>
    </p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Create a tag for the first end of week snapshot. Retain the snapshot for a week
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> prod.db.<span style="color:#ff79c6">table</span> <span style="color:#ff79c6">CREATE</span> TAG <span style="color:#ff79c6">`</span>EOW<span style="color:#ff79c6">-</span><span style="color:#bd93f9">01</span><span style="color:#ff79c6">`</span> <span style="color:#ff79c6">AS</span> <span style="color:#ff79c6">OF</span> <span style="color:#ff79c6">VERSION</span> <span style="color:#bd93f9">7</span> RETAIN <span style="color:#bd93f9">7</span> DAYS;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Create a tag for the first end of month snapshot. Retain the snapshot for 6 months
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> prod.db.<span style="color:#ff79c6">table</span> <span style="color:#ff79c6">CREATE</span> TAG <span style="color:#ff79c6">`</span>EOM<span style="color:#ff79c6">-</span><span style="color:#bd93f9">01</span><span style="color:#ff79c6">`</span> <span style="color:#ff79c6">AS</span> <span style="color:#ff79c6">OF</span> <span style="color:#ff79c6">VERSION</span> <span style="color:#bd93f9">30</span> RETAIN <span style="color:#bd93f9">180</span> DAYS;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Create a tag for the end of the year and retain it forever.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> prod.db.<span style="color:#ff79c6">table</span> <span style="color:#ff79c6">CREATE</span> TAG <span style="color:#ff79c6">`</span>EOY<span style="color:#ff79c6">-</span><span style="color:#bd93f9">2023</span><span style="color:#ff79c6">`</span> <span style="color:#ff79c6">AS</span> <span style="color:#ff79c6">OF</span> <span style="color:#ff79c6">VERSION</span> <span style="color:#bd93f9">365</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Create a branch &#34;test-branch&#34; which will be retained for 7 days along with the  latest 2 snapshots
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> prod.db.<span style="color:#ff79c6">table</span> <span style="color:#ff79c6">CREATE</span> BRANCH <span style="color:#ff79c6">`</span>test<span style="color:#ff79c6">-</span>branch<span style="color:#ff79c6">`</span> RETAIN <span style="color:#bd93f9">7</span> DAYS <span style="color:#ff79c6">WITH</span> SNAPSHOT RETENTION <span style="color:#bd93f9">2</span> SNAPSHOTS;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Audit Branch

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/21/7gQG8L.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/05/21/7gQG8L.png" />
        </a>
    <br>
设置如下：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> db.<span style="color:#ff79c6">table</span> <span style="color:#ff79c6">SET</span> TBLPROPERTIES (
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;write.wap.enabled&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;true&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Create audit-branch starting from snapshot 3, which will be written to and retained for 1 week.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> db.<span style="color:#ff79c6">table</span> <span style="color:#ff79c6">CREATE</span> BRANCH <span style="color:#ff79c6">`</span>audit<span style="color:#ff79c6">-</span>branch<span style="color:#ff79c6">`</span> <span style="color:#ff79c6">AS</span> <span style="color:#ff79c6">OF</span> <span style="color:#ff79c6">VERSION</span> <span style="color:#bd93f9">3</span> RETAIN <span style="color:#bd93f9">7</span> DAYS;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- WAP Branch write
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SET</span> spark.wap.branch <span style="color:#ff79c6">=</span> audit<span style="color:#ff79c6">-</span>branch
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> prod.db.<span style="color:#ff79c6">table</span> <span style="color:#ff79c6">VALUES</span> (<span style="color:#bd93f9">3</span>, <span style="color:#f1fa8c">&#39;c&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- After validation, the main branch can be fastForward to the head of audit-branch to update the main table state.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">CALL</span> <span style="color:#ff79c6">catalog_name</span>.<span style="color:#ff79c6">system</span>.fast_forward(<span style="color:#f1fa8c">&#39;prod.db.table&#39;</span>, <span style="color:#f1fa8c">&#39;main&#39;</span>, <span style="color:#f1fa8c">&#39;audit-branch&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- The branch reference will be removed when expireSnapshots is run 1 week later.
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="configuration">Configuration</h3>
<p><a href="https://iceberg.apache.org/docs/latest/configuration/">链接</a></p>
<h3 id="evolution">Evolution</h3>
<p>Schema evolution</p>
<ul>
<li>Add &ndash; add a new column to the table or to a nested struct</li>
<li>Drop &ndash; remove an existing column from the table or a nested struct</li>
<li>Rename &ndash; rename an existing column or field in a nested struct</li>
<li>Update &ndash; widen the type of a column, struct field, map key, map value, or list element</li>
<li>Reorder &ndash; change the order of columns or fields in a nested struct</li>
</ul>
<p>Iceberg schema updates are <strong>metadata changes</strong>, so no data files need to be rewritten to perform the update.</p>
<p>Iceberg guarantees that <strong>schema evolution changes are independent and free of side-effects</strong>, without rewriting files:</p>
<ul>
<li>Added columns never read existing values from another column.</li>
<li>Dropping a column or field does not change the values in any other column.</li>
<li>Updating a column or field does not change values in any other column.</li>
<li>Changing the order of columns or fields in a struct does not change the values associated with a column or field name.</li>
</ul>
<p>Iceberg uses unique IDs to track each column in a table. When you add a column, it is assigned a new ID so existing data is never used by mistake.</p>
<p>支持分区演化</p>
<ul>
<li>老的分区格式保持不变，新的分区格式变了，新数据写入到新分区后按照新格式</li>
<li>自动适配，SQL 不需要更改，通过元数据来实现的

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/21/7gQxrJ.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/05/21/7gQxrJ.png" />
        </a>
    </li>
</ul>
<h3 id="sort-order-evolution">Sort order evolution</h3>
<p>可以通过 API 修改排序顺序</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Table sampleTable <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">...;</span>
</span></span><span style="display:flex;"><span>sampleTable<span style="color:#ff79c6">.</span><span style="color:#50fa7b">replaceSortOrder</span><span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">.</span><span style="color:#50fa7b">asc</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;id&#34;</span><span style="color:#ff79c6">,</span> NullOrder<span style="color:#ff79c6">.</span><span style="color:#50fa7b">NULLS_LAST</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">.</span><span style="color:#50fa7b">dec</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;category&#34;</span><span style="color:#ff79c6">,</span> NullOrder<span style="color:#ff79c6">.</span><span style="color:#50fa7b">NULL_FIRST</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">.</span><span style="color:#50fa7b">commit</span><span style="color:#ff79c6">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>老版本的保持不动，新写入的会自动适配</p>
<h3 id="maintenance">Maintenance</h3>
<p>Expire Snapshots</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6272a4">// This example expires snapshots that are older than 1 day:
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>Table table <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">...</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">long</span> tsToExpire <span style="color:#ff79c6">=</span> System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">currentTimeMillis</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">-</span> <span style="color:#ff79c6">(</span>1000 <span style="color:#ff79c6">*</span> 60 <span style="color:#ff79c6">*</span> 60 <span style="color:#ff79c6">*</span> 24<span style="color:#ff79c6">);</span> <span style="color:#6272a4">// 1 day
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>table<span style="color:#ff79c6">.</span><span style="color:#50fa7b">expireSnapshots</span><span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ff79c6">.</span><span style="color:#50fa7b">expireOlderThan</span><span style="color:#ff79c6">(</span>tsToExpire<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ff79c6">.</span><span style="color:#50fa7b">commit</span><span style="color:#ff79c6">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>以及</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Table table <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">...</span>
</span></span><span style="display:flex;"><span>SparkActions
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">get</span><span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">expireSnapshots</span><span style="color:#ff79c6">(</span>table<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">expireOlderThan</span><span style="color:#ff79c6">(</span>tsToExpire<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">execute</span><span style="color:#ff79c6">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Remove old metadata files</p>
<ul>
<li>write.metadata.delete-after-commit.enabled</li>
<li>write.metadata.previous-versions-max</li>
</ul>
<p>删除孤儿文件，比如任务执行时候后留下的</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Table table <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">...</span>
</span></span><span style="display:flex;"><span>SparkActions
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">get</span><span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">deleteOrphanFiles</span><span style="color:#ff79c6">(</span>table<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">execute</span><span style="color:#ff79c6">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>小文件压缩，对于流场景需要</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Table table <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">...</span>
</span></span><span style="display:flex;"><span>SparkActions
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">get</span><span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">rewriteDataFiles</span><span style="color:#ff79c6">(</span>table<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">filter</span><span style="color:#ff79c6">(</span>Expressions<span style="color:#ff79c6">.</span><span style="color:#50fa7b">equal</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;date&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;2020-08-18&#34;</span><span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">option</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;target-file-size-bytes&#34;</span><span style="color:#ff79c6">,</span> Long<span style="color:#ff79c6">.</span><span style="color:#50fa7b">toString</span><span style="color:#ff79c6">(</span>500 <span style="color:#ff79c6">*</span> 1024 <span style="color:#ff79c6">*</span> 1024<span style="color:#ff79c6">))</span> <span style="color:#6272a4">// 500 MB
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">execute</span><span style="color:#ff79c6">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>重写元数据文件</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Table table <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">...</span>
</span></span><span style="display:flex;"><span>SparkActions
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">get</span><span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">rewriteManifests</span><span style="color:#ff79c6">(</span>table<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">rewriteIf</span><span style="color:#ff79c6">(</span>file <span style="color:#ff79c6">-&gt;</span> file<span style="color:#ff79c6">.</span><span style="color:#50fa7b">length</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">&lt;</span> 10 <span style="color:#ff79c6">*</span> 1024 <span style="color:#ff79c6">*</span> 1024<span style="color:#ff79c6">)</span> <span style="color:#6272a4">// 10 MB
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">execute</span><span style="color:#ff79c6">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>metrics 类型</p>
<ul>
<li>ScanReport</li>
<li>CommitReport</li>
</ul>
<p>可用的 metrics</p>
<ul>
<li>LoggingMetricsReporter</li>
<li>RESTMetricsReporter</li>
<li>custom Metrics Reporter</li>
</ul>
<p>自定义的例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">InMemoryMetricsReporter</span> <span style="color:#8be9fd;font-style:italic">implements</span> MetricsReporter <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">private</span> List<span style="color:#ff79c6">&lt;</span>MetricsReport<span style="color:#ff79c6">&gt;</span> metricsReports <span style="color:#ff79c6">=</span> Lists<span style="color:#ff79c6">.</span><span style="color:#50fa7b">newArrayList</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  @Override
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">report</span><span style="color:#ff79c6">(</span>MetricsReport report<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    metricsReports<span style="color:#ff79c6">.</span><span style="color:#50fa7b">add</span><span style="color:#ff79c6">(</span>report<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">public</span> List<span style="color:#ff79c6">&lt;</span>MetricsReport<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">reports</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> metricsReports<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>注册</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>TableScan tableScan <span style="color:#ff79c6">=</span> 
</span></span><span style="display:flex;"><span>    table
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">.</span><span style="color:#50fa7b">newScan</span><span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">.</span><span style="color:#50fa7b">metricsReporter</span><span style="color:#ff79c6">(</span>customReporterOne<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">.</span><span style="color:#50fa7b">metricsReporter</span><span style="color:#ff79c6">(</span>customReporterTwo<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">try</span> <span style="color:#ff79c6">(</span>CloseableIterable<span style="color:#ff79c6">&lt;</span>FileScanTask<span style="color:#ff79c6">&gt;</span> fileScanTasks <span style="color:#ff79c6">=</span> tableScan<span style="color:#ff79c6">.</span><span style="color:#50fa7b">planFiles</span><span style="color:#ff79c6">())</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以自动处理分区列<br>
支持分区演化</p>
<h3 id="performance">Performance</h3>
<p>plan 是单节点的，好处是</p>
<ul>
<li>Lower latency SQL queries &ndash; by eliminating a distributed scan to plan a distributed scan</li>
<li>Access from any client &ndash; stand-alone processes can read data directly from Iceberg tables</li>
</ul>
<p>两级的 manifest</p>
<ul>
<li><strong>Manifest files</strong> store a list of data files, along each data file&rsquo;s partition data and column-level stats</li>
<li><strong>manifest list</strong> stores the snapshot&rsquo;s list of manifests, along with the range of values for each partition field</li>
<li><strong>Metadata files</strong> Defines the table, and tracks manifest lists, current and previous snapshots, schemas, and partition schemes.<br>

        <a data-fancybox="gallery" href="https://v1.ax1x.com/2024/05/21/7gQVyB.png">
            <img class="mx-auto" alt="" src="https://v1.ax1x.com/2024/05/21/7gQVyB.png" />
        </a>
    </li>
</ul>
<p>首先通过分区的range，读取 manifest list，这样就可以找到 manifest files<br>
之后，读取每个 manifest files，获取数据<br>
manifest list 相当于一个高层的索引<br>
而 manifest file 也包含了 列的统计信息，通过 lower &amp; upper bounds 的谓词 skip，可以过滤掉很多数据，加速查询</p>
<h3 id="reliability">Reliability</h3>
<p>Hive 的问题</p>
<ul>
<li>元数据用的是数据库，存储系统用的是分布式系统，两套系统，可能会导致不一致</li>
<li>大量分区 scan 的时候压力会很大，list分区，对文件系统是 O(N) 的操作</li>
</ul>
<p>iceberg 的设计</p>
<ul>
<li><strong>Serializable isolation:</strong> All table changes occur in a linear history of atomic table updates</li>
<li><strong>Reliable reads:</strong> Readers always use a consistent snapshot of the table without holding a lock</li>
<li><strong>Version history and rollback:</strong> Table snapshots are kept as history and tables can roll back if a job produces bad data</li>
<li><strong>Safe file-level operations.</strong> By supporting atomic changes, Iceberg enables new use cases, like safely compacting small files and safely appending late data to tables</li>
</ul>
<p>可以解决的问题</p>
<ul>
<li><strong>O(1) RPCs to plan:</strong> Instead of listing O(n) directories in a table to plan a job, reading a snapshot requires O(1) RPC calls</li>
<li><strong>Distributed planning:</strong> File pruning and predicate push-down is distributed to jobs, removing the metastore as a bottleneck</li>
<li><strong>Finer granularity partitioning:</strong> Distributed planning and O(1) RPC calls remove the current barriers to finer-grained partitioning</li>
</ul>
<p>Concurrent write operations</p>
<ul>
<li>用的是 OCC</li>
<li>提交的时候，swap metadata file</li>
<li>如果失败了，则重试</li>
<li>也可以使用 append 方式，这样写入的时候就不会有失败了</li>
</ul>
<p>支持重命名，底层支持任何对象存储，不需要 list 操作</p>
<h3 id="schemas">Schemas</h3>
<p>支持下面类型</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>boolean</td>
<td>True or false</td>
<td></td>
</tr>
<tr>
<td>int</td>
<td>32-bit signed integers</td>
<td>Can promote to long</td>
</tr>
<tr>
<td>long</td>
<td>64-bit signed integers</td>
<td></td>
</tr>
<tr>
<td>float</td>
<td>32-bit IEEE 754 floating point</td>
<td>Can promote to double</td>
</tr>
<tr>
<td>double</td>
<td>64-bit IEEE 754 floating point</td>
<td></td>
</tr>
<tr>
<td>decimal(P,S)</td>
<td>Fixed-point decimal; precision P, scale S</td>
<td>Scale is fixed and precision must be 38 or less</td>
</tr>
<tr>
<td>date</td>
<td>Calendar date without timezone or time</td>
<td></td>
</tr>
<tr>
<td>time</td>
<td>Time of day without date, timezone</td>
<td>Stored as microseconds</td>
</tr>
<tr>
<td>timestamp</td>
<td>Timestamp without timezone</td>
<td>Stored as microseconds</td>
</tr>
<tr>
<td>timestamptz</td>
<td>Timestamp with timezone</td>
<td>Stored as microseconds</td>
</tr>
<tr>
<td>string</td>
<td>Arbitrary-length character sequences</td>
<td>Encoded with UTF-8</td>
</tr>
<tr>
<td>fixed(L)</td>
<td>Fixed-length byte array of length L</td>
<td></td>
</tr>
<tr>
<td>binary</td>
<td>Arbitrary-length byte array</td>
<td></td>
</tr>
<tr>
<td>struct&lt;&hellip;&gt;</td>
<td>A record with named fields of any data type</td>
<td></td>
</tr>
<tr>
<td>list<!-- raw HTML omitted --></td>
<td>A list with elements of any data type</td>
<td></td>
</tr>
<tr>
<td>map&lt;K, V&gt;</td>
<td>A map with keys and values of any data type</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="spark">Spark</h2>
<h3 id="api">API</h3>
<p>一些例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>  <span style="color:#ff79c6">def</span> xx<span style="color:#ff79c6">()</span><span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Unit</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> spark <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">SparkSession</span><span style="color:#ff79c6">.</span>builder
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">.</span>master<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;local&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">.</span>appName<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Iceberg spark example&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">.</span>config<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;spark.sql.extensions&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">.</span>config<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;spark.sql.catalog.local&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;org.apache.iceberg.spark.SparkCatalog&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">.</span>config<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;spark.sql.catalog.local.type&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;hadoop&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">.</span>config<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;spark.sql.catalog.local.warehouse&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;iceberg_warehouse&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">.</span>getOrCreate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    spark<span style="color:#ff79c6">.</span>sql<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;create database iceberg_db&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>    spark<span style="color:#ff79c6">.</span>sql<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;CREATE TABLE local.iceberg_db.table (id bigint, data string) USING iceberg\n&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>    spark<span style="color:#ff79c6">.</span>sql<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;INSERT INTO local.iceberg_db.table VALUES (1, &#39;a&#39;), (2, &#39;b&#39;), (3, &#39;c&#39;)&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    spark<span style="color:#ff79c6">.</span>sql<span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        | CREATE TABLE if not exist local.iceberg_db.wokao(id int, name string) using iceberg
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |&#34;&#34;&#34;</span><span style="color:#ff79c6">.</span>stripMargin<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    spark<span style="color:#ff79c6">.</span>sql<span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |INSERT INTO local.iceberg_db.wokao
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |VALUES (1, &#39;wokao111&#39;), (2, &#39;wokao222&#39;), (3, &#39;wokao333&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |&#34;&#34;&#34;</span><span style="color:#ff79c6">.</span>stripMargin<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">val</span> result <span style="color:#ff79c6">=</span> spark<span style="color:#ff79c6">.</span>sql<span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        | select * from local.iceberg_db.wokao
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |&#34;&#34;&#34;</span><span style="color:#ff79c6">.</span>stripMargin<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    result<span style="color:#ff79c6">.</span>show<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    spark<span style="color:#ff79c6">.</span>sql<span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        | SELECT count(1) as count, data
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |FROM local.iceberg_db.table
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |GROUP BY data;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |&#34;&#34;&#34;</span><span style="color:#ff79c6">.</span>stripMargin<span style="color:#ff79c6">).</span>show<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    spark<span style="color:#ff79c6">.</span>sql<span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        | SELECT * FROM local.iceberg_db.wokao.snapshots;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        |&#34;&#34;&#34;</span><span style="color:#ff79c6">.</span>stripMargin<span style="color:#ff79c6">).</span>show<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">val</span> df <span style="color:#ff79c6">=</span> spark<span style="color:#ff79c6">.</span>table<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;local.db.table&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  df<span style="color:#ff79c6">.</span>count<span style="color:#ff79c6">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>打印结果</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff79c6">+---+--------+</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span> id<span style="color:#ff79c6">|</span>    name<span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+---+--------+</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>  1<span style="color:#ff79c6">|</span>wokao111<span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>  2<span style="color:#ff79c6">|</span>wokao222<span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>  3<span style="color:#ff79c6">|</span>wokao333<span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+---+--------+</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+-----+----+</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>count<span style="color:#ff79c6">|</span>data<span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+-----+----+</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>    1<span style="color:#ff79c6">|</span>   a<span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>    1<span style="color:#ff79c6">|</span>   b<span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>    1<span style="color:#ff79c6">|</span>   c<span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+-----+----+</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+--------------------+-------------------+---------+---------+--------------------+--------------------+</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>        committed_at<span style="color:#ff79c6">|</span>        snapshot_id<span style="color:#ff79c6">|</span>parent_id<span style="color:#ff79c6">|</span>operation<span style="color:#ff79c6">|</span>       manifest_list<span style="color:#ff79c6">|</span>             summary<span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+--------------------+-------------------+---------+---------+--------------------+--------------------+</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>2024<span style="color:#ff79c6">-</span>02<span style="color:#ff79c6">-</span>24 11<span style="color:#ff79c6">:</span>52<span style="color:#ff79c6">:...|</span>1288202450499236155<span style="color:#ff79c6">|</span>     <span style="color:#ff79c6">null</span><span style="color:#ff79c6">|</span>   append<span style="color:#ff79c6">|</span>iceberg_warehouse<span style="color:#ff79c6">...|{</span>spark<span style="color:#ff79c6">.</span><span style="color:#50fa7b">app</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">id</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#ff79c6">...|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+--------------------+-------------------+---------+---------+--------------------+--------------------+</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="spark-configuration">Spark Configuration</h3>
<p>hive 的</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>spark<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalog</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">hive_prod</span> <span style="color:#ff79c6">=</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">iceberg</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">SparkCatalog</span>
</span></span><span style="display:flex;"><span>spark<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalog</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">hive_prod</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">type</span> <span style="color:#ff79c6">=</span> hive
</span></span><span style="display:flex;"><span>spark<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalog</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">hive_prod</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">uri</span> <span style="color:#ff79c6">=</span> thrift<span style="color:#ff79c6">:</span><span style="color:#6272a4">//metastore-host:port
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span># omit uri to use the same URI as Spark<span style="color:#ff79c6">:</span> hive<span style="color:#ff79c6">.</span><span style="color:#50fa7b">metastore</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">uris</span> in hive<span style="color:#ff79c6">-</span>site<span style="color:#ff79c6">.</span><span style="color:#50fa7b">xml</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>rest</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>spark<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalog</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">rest_prod</span> <span style="color:#ff79c6">=</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">iceberg</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">SparkCatalog</span>
</span></span><span style="display:flex;"><span>spark<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalog</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">rest_prod</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">type</span> <span style="color:#ff79c6">=</span> rest
</span></span><span style="display:flex;"><span>spark<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalog</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">rest_prod</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">uri</span> <span style="color:#ff79c6">=</span> http<span style="color:#ff79c6">:</span><span style="color:#6272a4">//localhost:8080
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>hadoop</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>spark<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalog</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">hadoop_prod</span> <span style="color:#ff79c6">=</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">iceberg</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">SparkCatalog</span>
</span></span><span style="display:flex;"><span>spark<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalog</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">hadoop_prod</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">type</span> <span style="color:#ff79c6">=</span> hadoop
</span></span><span style="display:flex;"><span>spark<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalog</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">hadoop_prod</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">warehouse</span> <span style="color:#ff79c6">=</span> hdfs<span style="color:#ff79c6">:</span><span style="color:#6272a4">//nn:8020/warehouse/path
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>自定义的</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>spark<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalog</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">custom_prod</span> <span style="color:#ff79c6">=</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">iceberg</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">spark</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">SparkCatalog</span>
</span></span><span style="display:flex;"><span>spark<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalog</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">custom_prod</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalog</span><span style="color:#ff79c6">-</span>impl <span style="color:#ff79c6">=</span> com<span style="color:#ff79c6">.</span><span style="color:#50fa7b">my</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">custom</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">CatalogImpl</span>
</span></span><span style="display:flex;"><span>spark<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">catalog</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">custom_prod</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">my</span><span style="color:#ff79c6">-</span>additional<span style="color:#ff79c6">-</span>catalog<span style="color:#ff79c6">-</span>config <span style="color:#ff79c6">=</span> my<span style="color:#ff79c6">-</span>value
</span></span></code></pre></td></tr></table>
</div>
</div><p>读和写</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6272a4">// time travel
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>spark<span style="color:#ff79c6">.</span><span style="color:#50fa7b">read</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">option</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;snapshot-id&#34;</span><span style="color:#ff79c6">,</span> 10963874102873L<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">table</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;catalog.db.table&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// write with Avro instead of Parquet
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>df<span style="color:#ff79c6">.</span><span style="color:#50fa7b">write</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">option</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;write-format&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;avro&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">option</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;snapshot-property.key&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;value&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">insertInto</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;catalog.db.table&#34;</span><span style="color:#ff79c6">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>CommitMetadata</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> org.apache.iceberg.spark.CommitMetadata<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Map<span style="color:#ff79c6">&lt;</span>String<span style="color:#ff79c6">,</span> String<span style="color:#ff79c6">&gt;</span> properties <span style="color:#ff79c6">=</span> Maps<span style="color:#ff79c6">.</span><span style="color:#50fa7b">newHashMap</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>properties<span style="color:#ff79c6">.</span><span style="color:#50fa7b">put</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;property_key&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;property_value&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>CommitMetadata<span style="color:#ff79c6">.</span><span style="color:#50fa7b">withCommitProperties</span><span style="color:#ff79c6">(</span>properties<span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">()</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>            spark<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sql</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;DELETE FROM &#34;</span> <span style="color:#ff79c6">+</span> tableName <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34; where id = 1&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> 0<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">},</span>
</span></span><span style="display:flex;"><span>        RuntimeException<span style="color:#ff79c6">.</span><span style="color:#50fa7b">class</span><span style="color:#ff79c6">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="spark-ddl">Spark DDL</h3>
<p>一些例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> prod.db.sample (
</span></span><span style="display:flex;"><span>    id <span style="color:#8be9fd;font-style:italic">bigint</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#39;unique id&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">data</span> string)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">USING</span> iceberg;
</span></span></code></pre></td></tr></table>
</div>
</div><p>设置分区</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> prod.db.sample (
</span></span><span style="display:flex;"><span>    id <span style="color:#8be9fd;font-style:italic">bigint</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">data</span> string,
</span></span><span style="display:flex;"><span>    category string)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">USING</span> iceberg
</span></span><span style="display:flex;"><span>PARTITIONED <span style="color:#ff79c6">BY</span> (category);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> prod.db.sample (
</span></span><span style="display:flex;"><span>    id <span style="color:#8be9fd;font-style:italic">bigint</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">data</span> string,
</span></span><span style="display:flex;"><span>    category string,
</span></span><span style="display:flex;"><span>    ts <span style="color:#ff79c6">timestamp</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">USING</span> iceberg
</span></span><span style="display:flex;"><span>PARTITIONED <span style="color:#ff79c6">BY</span> (bucket(<span style="color:#bd93f9">16</span>, id), days(ts), category);
</span></span></code></pre></td></tr></table>
</div>
</div><p>其他一些建表方式</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> prod.db.sample
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">USING</span> iceberg
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">AS</span> <span style="color:#ff79c6">SELECT</span> ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> prod.db.sample
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">USING</span> iceberg
</span></span><span style="display:flex;"><span>PARTITIONED <span style="color:#ff79c6">BY</span> (part)
</span></span><span style="display:flex;"><span>TBLPROPERTIES (<span style="color:#f1fa8c">&#39;key&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;value&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">AS</span> <span style="color:#ff79c6">SELECT</span> ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">REPLACE</span> <span style="color:#ff79c6">TABLE</span> prod.db.sample
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">USING</span> iceberg
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">AS</span> <span style="color:#ff79c6">SELECT</span> ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">REPLACE</span> <span style="color:#ff79c6">TABLE</span> prod.db.sample
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">USING</span> iceberg
</span></span><span style="display:flex;"><span>PARTITIONED <span style="color:#ff79c6">BY</span> (part)
</span></span><span style="display:flex;"><span>TBLPROPERTIES (<span style="color:#f1fa8c">&#39;key&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;value&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">AS</span> <span style="color:#ff79c6">SELECT</span> ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">OR</span> <span style="color:#ff79c6">REPLACE</span> <span style="color:#ff79c6">TABLE</span> prod.db.sample
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">USING</span> iceberg
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">AS</span> <span style="color:#ff79c6">SELECT</span> ...
</span></span></code></pre></td></tr></table>
</div>
</div><p>Iceberg has full ALTER TABLE support in Spark 3, including:</p>
<ul>
<li>Renaming a table</li>
<li>Setting or removing table properties</li>
<li>Adding, deleting, and renaming columns</li>
<li>Adding, deleting, and renaming nested fields</li>
<li>Reordering top-level columns and nested struct fields</li>
<li>Widening the type of int, float, and decimal fields</li>
<li>Making required columns optional</li>
</ul>
<p>branch、tag</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- CREATE audit-branch at current snapshot with default retention.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> prod.db.sample <span style="color:#ff79c6">CREATE</span> BRANCH <span style="color:#ff79c6">`</span>audit<span style="color:#ff79c6">-</span>branch<span style="color:#ff79c6">`</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- CREATE audit-branch at current snapshot with default retention if it doesn&#39;t exist.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> prod.db.sample <span style="color:#ff79c6">CREATE</span> BRANCH <span style="color:#ff79c6">IF</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">EXISTS</span> <span style="color:#ff79c6">`</span>audit<span style="color:#ff79c6">-</span>branch<span style="color:#ff79c6">`</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- CREATE audit-branch at current snapshot with default retention or REPLACE it if it already exists.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> prod.db.sample <span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">OR</span> <span style="color:#ff79c6">REPLACE</span> BRANCH <span style="color:#ff79c6">`</span>audit<span style="color:#ff79c6">-</span>branch<span style="color:#ff79c6">`</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- CREATE audit-branch at snapshot 1234 with default retention.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> prod.db.sample <span style="color:#ff79c6">CREATE</span> BRANCH <span style="color:#ff79c6">`</span>audit<span style="color:#ff79c6">-</span>branch<span style="color:#ff79c6">`</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">AS</span> <span style="color:#ff79c6">OF</span> <span style="color:#ff79c6">VERSION</span> <span style="color:#bd93f9">1234</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- CREATE audit-branch at snapshot 1234, retain audit-branch for 31 days, and retain the latest 31 days. 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">-- The latest 3 snapshot snapshots, and 2 days worth of snapshots. 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">TABLE</span> prod.db.sample <span style="color:#ff79c6">CREATE</span> BRANCH <span style="color:#ff79c6">`</span>audit<span style="color:#ff79c6">-</span>branch<span style="color:#ff79c6">`</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">AS</span> <span style="color:#ff79c6">OF</span> <span style="color:#ff79c6">VERSION</span> <span style="color:#bd93f9">1234</span> RETAIN <span style="color:#bd93f9">30</span> DAYS 
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WITH</span> SNAPSHOT RETENTION <span style="color:#bd93f9">3</span> SNAPSHOTS <span style="color:#bd93f9">2</span> DAYS
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="spark-procedures">Spark Procedures</h3>
<p>一些例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CALL</span> <span style="color:#ff79c6">catalog_name</span>.<span style="color:#ff79c6">system</span>.procedure_name(arg_name_2 <span style="color:#ff79c6">=&gt;</span> arg_2, arg_name_1 <span style="color:#ff79c6">=&gt;</span> arg_1);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CALL</span> <span style="color:#ff79c6">catalog_name</span>.<span style="color:#ff79c6">system</span>.procedure_name(arg_1, arg_2, ... arg_n);
</span></span></code></pre></td></tr></table>
</div>
</div><p>Roll back table db.sample to snapshot ID 1:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CALL</span> <span style="color:#ff79c6">catalog_name</span>.<span style="color:#ff79c6">system</span>.rollback_to_snapshot(<span style="color:#f1fa8c">&#39;db.sample&#39;</span>, <span style="color:#bd93f9">1</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>Set the current snapshot for db.sample to 1:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CALL</span> <span style="color:#ff79c6">catalog_name</span>.<span style="color:#ff79c6">system</span>.set_current_snapshot(<span style="color:#f1fa8c">&#39;db.sample&#39;</span>, <span style="color:#bd93f9">1</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CALL</span> <span style="color:#ff79c6">catalog_name</span>.<span style="color:#ff79c6">system</span>.set_current_snapshot(<span style="color:#ff79c6">table</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#f1fa8c">&#39;db.sample&#39;</span>, tag <span style="color:#ff79c6">=&gt;</span> <span style="color:#f1fa8c">&#39;s1&#39;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>expire_snapshots</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CALL</span> hive_prod.<span style="color:#ff79c6">system</span>.expire_snapshots(<span style="color:#f1fa8c">&#39;db.sample&#39;</span>, <span style="color:#ff79c6">TIMESTAMP</span> <span style="color:#f1fa8c">&#39;2021-06-30 00:00:00.000&#39;</span>, <span style="color:#bd93f9">100</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CALL</span> hive_prod.<span style="color:#ff79c6">system</span>.expire_snapshots(<span style="color:#ff79c6">table</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#f1fa8c">&#39;db.sample&#39;</span>, snapshot_ids <span style="color:#ff79c6">=&gt;</span> <span style="color:#8be9fd;font-style:italic">ARRAY</span>(<span style="color:#bd93f9">123</span>));
</span></span></code></pre></td></tr></table>
</div>
</div><p>rewrite_manifests</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CALL</span> <span style="color:#ff79c6">catalog_name</span>.<span style="color:#ff79c6">system</span>.rewrite_manifests(<span style="color:#f1fa8c">&#39;db.sample&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CALL</span> <span style="color:#ff79c6">catalog_name</span>.<span style="color:#ff79c6">system</span>.rewrite_manifests(<span style="color:#f1fa8c">&#39;db.sample&#39;</span>, <span style="color:#ff79c6">false</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>Table migration</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CALL</span> <span style="color:#ff79c6">catalog_name</span>.<span style="color:#ff79c6">system</span>.snapshot(<span style="color:#f1fa8c">&#39;db.sample&#39;</span>, <span style="color:#f1fa8c">&#39;db.snap&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CALL</span> <span style="color:#ff79c6">catalog_name</span>.<span style="color:#ff79c6">system</span>.snapshot(<span style="color:#f1fa8c">&#39;db.sample&#39;</span>, <span style="color:#f1fa8c">&#39;db.snap&#39;</span>, <span style="color:#f1fa8c">&#39;/tmp/temptable/&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CALL</span> <span style="color:#ff79c6">catalog_name</span>.<span style="color:#ff79c6">system</span>.migrate(<span style="color:#f1fa8c">&#39;spark_catalog.db.sample&#39;</span>, <span style="color:#ff79c6">map</span>(<span style="color:#f1fa8c">&#39;foo&#39;</span>, <span style="color:#f1fa8c">&#39;bar&#39;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CALL</span> <span style="color:#ff79c6">catalog_name</span>.<span style="color:#ff79c6">system</span>.migrate(<span style="color:#f1fa8c">&#39;db.sample&#39;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>Metadata information</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CALL</span> spark_catalog.<span style="color:#ff79c6">system</span>.ancestors_of(<span style="color:#f1fa8c">&#39;db.tbl&#39;</span>, <span style="color:#bd93f9">1</span>);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CALL</span> spark_catalog.<span style="color:#ff79c6">system</span>.ancestors_of(snapshot_id <span style="color:#ff79c6">=&gt;</span> <span style="color:#bd93f9">1</span>, <span style="color:#ff79c6">table</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#f1fa8c">&#39;db.tbl&#39;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Change Data Capture</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CALL</span> spark_catalog.<span style="color:#ff79c6">system</span>.create_changelog_view(
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">table</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#f1fa8c">&#39;db.tbl&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">options</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#ff79c6">map</span>(<span style="color:#f1fa8c">&#39;start-snapshot-id&#39;</span>,<span style="color:#f1fa8c">&#39;1&#39;</span>,<span style="color:#f1fa8c">&#39;end-snapshot-id&#39;</span>, <span style="color:#f1fa8c">&#39;2&#39;</span>)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CALL</span> spark_catalog.<span style="color:#ff79c6">system</span>.create_changelog_view(
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">table</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#f1fa8c">&#39;db.tbl&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">options</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#ff79c6">map</span>(<span style="color:#f1fa8c">&#39;start-timestamp&#39;</span>,<span style="color:#f1fa8c">&#39;1678335750489&#39;</span>,<span style="color:#f1fa8c">&#39;end-timestamp&#39;</span>, <span style="color:#f1fa8c">&#39;1678992105265&#39;</span>),
</span></span><span style="display:flex;"><span>  changelog_view <span style="color:#ff79c6">=&gt;</span> <span style="color:#f1fa8c">&#39;my_changelog_view&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CALL</span> spark_catalog.<span style="color:#ff79c6">system</span>.create_changelog_view(
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">table</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#f1fa8c">&#39;db.tbl&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">options</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#ff79c6">map</span>(<span style="color:#f1fa8c">&#39;start-snapshot-id&#39;</span>,<span style="color:#f1fa8c">&#39;1&#39;</span>,<span style="color:#f1fa8c">&#39;end-snapshot-id&#39;</span>, <span style="color:#f1fa8c">&#39;2&#39;</span>),
</span></span><span style="display:flex;"><span>  identifier_columns <span style="color:#ff79c6">=&gt;</span> <span style="color:#8be9fd;font-style:italic">array</span>(<span style="color:#f1fa8c">&#39;id&#39;</span>, <span style="color:#f1fa8c">&#39;name&#39;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> tbl_changes;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> tbl_changes <span style="color:#ff79c6">where</span> _change_type <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;INSERT&#39;</span> <span style="color:#ff79c6">AND</span> id <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">3</span> <span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">BY</span> _change_ordinal;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="queries">Queries</h3>
<p>For example, to read from the files metadata table for prod.db.table:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> prod.db.<span style="color:#ff79c6">table</span>.files;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Time travel</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- time travel to October 26, 1986 at 01:21:00
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> prod.db.<span style="color:#ff79c6">table</span> <span style="color:#ff79c6">TIMESTAMP</span> <span style="color:#ff79c6">AS</span> <span style="color:#ff79c6">OF</span> <span style="color:#f1fa8c">&#39;1986-10-26 01:21:00&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- time travel to snapshot with id 10963874102873L
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> prod.db.<span style="color:#ff79c6">table</span> <span style="color:#ff79c6">VERSION</span> <span style="color:#ff79c6">AS</span> <span style="color:#ff79c6">OF</span> <span style="color:#bd93f9">10963874102873</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- time travel to the head snapshot of audit-branch
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> prod.db.<span style="color:#ff79c6">table</span> <span style="color:#ff79c6">VERSION</span> <span style="color:#ff79c6">AS</span> <span style="color:#ff79c6">OF</span> <span style="color:#f1fa8c">&#39;audit-branch&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- time travel to the snapshot referenced by the tag historical-snapshot
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> prod.db.<span style="color:#ff79c6">table</span> <span style="color:#ff79c6">VERSION</span> <span style="color:#ff79c6">AS</span> <span style="color:#ff79c6">OF</span> <span style="color:#f1fa8c">&#39;historical-snapshot&#39;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>DataFrame</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#6272a4">// time travel to October 26, 1986 at 01:21:00
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>spark<span style="color:#ff79c6">.</span>read
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>option<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;as-of-timestamp&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;499162860000&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>format<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;iceberg&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>load<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;path/to/table&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// time travel to snapshot with ID 10963874102873L
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>spark<span style="color:#ff79c6">.</span>read
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>option<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;snapshot-id&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#bd93f9">10963874102873L</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>format<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;iceberg&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>load<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;path/to/table&#34;</span><span style="color:#ff79c6">)</span>	
</span></span></code></pre></td></tr></table>
</div>
</div><p>Incremental read</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6272a4">// get the data added after start-snapshot-id (10963874102873L) until end-snapshot-id (63874143573109L)
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>spark<span style="color:#ff79c6">.</span><span style="color:#50fa7b">read</span><span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">.</span><span style="color:#50fa7b">format</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;iceberg&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">.</span><span style="color:#50fa7b">option</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;start-snapshot-id&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;10963874102873&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">.</span><span style="color:#50fa7b">option</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;end-snapshot-id&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;63874143573109&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">.</span><span style="color:#50fa7b">load</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;path/to/table&#34;</span><span style="color:#ff79c6">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Inspecting tables</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> prod.db.<span style="color:#ff79c6">table</span>.history;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">--------------------+-------------------+---------+-------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>     made_current_at<span style="color:#ff79c6">|</span>        snapshot_id<span style="color:#ff79c6">|</span>parent_id<span style="color:#ff79c6">|</span>is_current_ancestor<span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">--------------------+-------------------+---------+-------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">2024</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">02</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">24</span> <span style="color:#bd93f9">11</span>:<span style="color:#bd93f9">52</span>:...<span style="color:#ff79c6">|</span><span style="color:#bd93f9">1288202450499236155</span><span style="color:#ff79c6">|</span>     <span style="color:#ff79c6">null</span><span style="color:#ff79c6">|</span>               <span style="color:#ff79c6">true</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">--------------------+-------------------+---------+-------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> prod.db.<span style="color:#ff79c6">table</span>.metadata_log_entries;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> prod.db.<span style="color:#ff79c6">table</span>.snapshots;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">select</span>
</span></span><span style="display:flex;"><span>    h.made_current_at,
</span></span><span style="display:flex;"><span>    s.<span style="color:#ff79c6">operation</span>,
</span></span><span style="display:flex;"><span>    h.snapshot_id,
</span></span><span style="display:flex;"><span>    h.is_current_ancestor,
</span></span><span style="display:flex;"><span>    s.summary[<span style="color:#f1fa8c">&#39;spark.app.id&#39;</span>]
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> prod.db.<span style="color:#ff79c6">table</span>.history h
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">join</span> prod.db.<span style="color:#ff79c6">table</span>.snapshots s
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">on</span> h.snapshot_id <span style="color:#ff79c6">=</span> s.snapshot_id
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">order</span> <span style="color:#ff79c6">by</span> made_current_at;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> prod.db.<span style="color:#ff79c6">table</span>.entries;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Files</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> prod.db.<span style="color:#ff79c6">table</span>.files
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------+--------------------+-----------+------------+------------------+------------------+----------------+-----------------+----------------+--------------------+--------------------+------------+-------------+------------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>content<span style="color:#ff79c6">|</span>           file_path<span style="color:#ff79c6">|</span>file_format<span style="color:#ff79c6">|</span>record_count<span style="color:#ff79c6">|</span>file_size_in_bytes<span style="color:#ff79c6">|</span>      column_sizes<span style="color:#ff79c6">|</span>    value_counts<span style="color:#ff79c6">|</span>null_value_counts<span style="color:#ff79c6">|</span>nan_value_counts<span style="color:#ff79c6">|</span>        lower_bounds<span style="color:#ff79c6">|</span>        upper_bounds<span style="color:#ff79c6">|</span>key_metadata<span style="color:#ff79c6">|</span>split_offsets<span style="color:#ff79c6">|</span>equality_ids<span style="color:#ff79c6">|</span>sort_order_id<span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------+--------------------+-----------+------------+------------------+------------------+----------------+-----------------+----------------+--------------------+--------------------+------------+-------------+------------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>      <span style="color:#bd93f9">0</span><span style="color:#ff79c6">|</span>iceberg_warehouse...<span style="color:#ff79c6">|</span>    PARQUET<span style="color:#ff79c6">|</span>           <span style="color:#bd93f9">3</span><span style="color:#ff79c6">|</span>               <span style="color:#bd93f9">666</span><span style="color:#ff79c6">|</span>{<span style="color:#bd93f9">1</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#bd93f9">52</span>, <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#bd93f9">65</span>}<span style="color:#ff79c6">|</span>{<span style="color:#bd93f9">1</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#bd93f9">3</span>}<span style="color:#ff79c6">|</span> {<span style="color:#bd93f9">1</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#bd93f9">0</span>}<span style="color:#ff79c6">|</span>              {}<span style="color:#ff79c6">|</span>{<span style="color:#bd93f9">1</span> <span style="color:#ff79c6">-&gt;</span>    , <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">-&gt;</span> ...<span style="color:#ff79c6">|</span>{<span style="color:#bd93f9">1</span> <span style="color:#ff79c6">-&gt;</span>    , <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">-&gt;</span> ...<span style="color:#ff79c6">|</span>        <span style="color:#ff79c6">null</span><span style="color:#ff79c6">|</span>          [<span style="color:#bd93f9">4</span>]<span style="color:#ff79c6">|</span>        <span style="color:#ff79c6">null</span><span style="color:#ff79c6">|</span>            <span style="color:#bd93f9">0</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------+--------------------+-----------+------------+------------------+------------------+----------------+-----------------+----------------+--------------------+--------------------+------------+-------------+------------+-------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Manifests</p>
<pre tabindex="0"><code>SELECT * FROM prod.db.table.manifests;
</code></pre><p>Partitions</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> prod.db.<span style="color:#ff79c6">table</span>.partitions;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Positional Delete Files</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> prod.db.<span style="color:#ff79c6">table</span>.position_deletes;
</span></span></code></pre></td></tr></table>
</div>
</div><p>All Data Files</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> prod.db.<span style="color:#ff79c6">table</span>.all_data_files;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------+--------------------+-----------+------------+------------------+------------------+----------------+-----------------+----------------+--------------------+--------------------+------------+-------------+------------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>content<span style="color:#ff79c6">|</span>           file_path<span style="color:#ff79c6">|</span>file_format<span style="color:#ff79c6">|</span>record_count<span style="color:#ff79c6">|</span>file_size_in_bytes<span style="color:#ff79c6">|</span>      column_sizes<span style="color:#ff79c6">|</span>    value_counts<span style="color:#ff79c6">|</span>null_value_counts<span style="color:#ff79c6">|</span>nan_value_counts<span style="color:#ff79c6">|</span>        lower_bounds<span style="color:#ff79c6">|</span>        upper_bounds<span style="color:#ff79c6">|</span>key_metadata<span style="color:#ff79c6">|</span>split_offsets<span style="color:#ff79c6">|</span>equality_ids<span style="color:#ff79c6">|</span>sort_order_id<span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------+--------------------+-----------+------------+------------------+------------------+----------------+-----------------+----------------+--------------------+--------------------+------------+-------------+------------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>      <span style="color:#bd93f9">0</span><span style="color:#ff79c6">|</span>iceberg_warehouse...<span style="color:#ff79c6">|</span>    PARQUET<span style="color:#ff79c6">|</span>           <span style="color:#bd93f9">3</span><span style="color:#ff79c6">|</span>               <span style="color:#bd93f9">666</span><span style="color:#ff79c6">|</span>{<span style="color:#bd93f9">1</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#bd93f9">52</span>, <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#bd93f9">65</span>}<span style="color:#ff79c6">|</span>{<span style="color:#bd93f9">1</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#bd93f9">3</span>}<span style="color:#ff79c6">|</span> {<span style="color:#bd93f9">1</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#bd93f9">0</span>}<span style="color:#ff79c6">|</span>              {}<span style="color:#ff79c6">|</span>{<span style="color:#bd93f9">1</span> <span style="color:#ff79c6">-&gt;</span>    , <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">-&gt;</span> ...<span style="color:#ff79c6">|</span>{<span style="color:#bd93f9">1</span> <span style="color:#ff79c6">-&gt;</span>    , <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">-&gt;</span> ...<span style="color:#ff79c6">|</span>        <span style="color:#ff79c6">null</span><span style="color:#ff79c6">|</span>          [<span style="color:#bd93f9">4</span>]<span style="color:#ff79c6">|</span>        <span style="color:#ff79c6">null</span><span style="color:#ff79c6">|</span>            <span style="color:#bd93f9">0</span><span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">-------+--------------------+-----------+------------+------------------+------------------+----------------+-----------------+----------------+--------------------+--------------------+------------+-------------+------------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> prod.db.<span style="color:#ff79c6">table</span>.all_delete_files;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> prod.db.<span style="color:#ff79c6">table</span>.all_entries;
</span></span></code></pre></td></tr></table>
</div>
</div><p>All Manifests</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> prod.db.<span style="color:#ff79c6">table</span>.all_manifests;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">--------------------+------+-----------------+-------------------+----------------------+-------------------------+------------------------+-------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>                path<span style="color:#ff79c6">|</span><span style="color:#ff79c6">length</span><span style="color:#ff79c6">|</span>partition_spec_id<span style="color:#ff79c6">|</span>  added_snapshot_id<span style="color:#ff79c6">|</span>added_data_files_count<span style="color:#ff79c6">|</span>existing_data_files_count<span style="color:#ff79c6">|</span>deleted_data_files_count<span style="color:#ff79c6">|</span>partition_summaries<span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">--------------------+------+-----------------+-------------------+----------------------+-------------------------+------------------------+-------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>iceberg_warehouse...<span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">5781</span><span style="color:#ff79c6">|</span>                <span style="color:#bd93f9">0</span><span style="color:#ff79c6">|</span><span style="color:#bd93f9">1288202450499236155</span><span style="color:#ff79c6">|</span>                     <span style="color:#bd93f9">1</span><span style="color:#ff79c6">|</span>                        <span style="color:#bd93f9">0</span><span style="color:#ff79c6">|</span>                       <span style="color:#bd93f9">0</span><span style="color:#ff79c6">|</span>                 []<span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">--------------------+------+-----------------+-------------------+----------------------+-------------------------+------------------------+-------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>References</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> prod.db.<span style="color:#ff79c6">table</span>.refs;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="structured-streaming">Structured Streaming</h3>
<p>Streaming Reads</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff79c6">val</span> df <span style="color:#ff79c6">=</span> spark<span style="color:#ff79c6">.</span>readStream
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>format<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;iceberg&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>option<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;stream-from-timestamp&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#50fa7b">Long</span><span style="color:#ff79c6">.</span>toString<span style="color:#ff79c6">(</span>streamStartTimestamp<span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>load<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;database.table_name&#34;</span><span style="color:#ff79c6">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Streaming Writes</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>data<span style="color:#ff79c6">.</span>writeStream
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>format<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;iceberg&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>outputMode<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;append&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>trigger<span style="color:#ff79c6">(</span><span style="color:#50fa7b">Trigger</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ProcessingTime</span><span style="color:#ff79c6">(</span><span style="color:#bd93f9">1</span><span style="color:#ff79c6">,</span> <span style="color:#50fa7b">TimeUnit</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">MINUTES</span><span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>option<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;checkpointLocation&#34;</span><span style="color:#ff79c6">,</span> checkpointPath<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>toTable<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;database.table_name&#34;</span><span style="color:#ff79c6">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In the case of the directory-based Hadoop catalog:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>data<span style="color:#ff79c6">.</span>writeStream
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>format<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;iceberg&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>outputMode<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;append&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>trigger<span style="color:#ff79c6">(</span><span style="color:#50fa7b">Trigger</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ProcessingTime</span><span style="color:#ff79c6">(</span><span style="color:#bd93f9">1</span><span style="color:#ff79c6">,</span> <span style="color:#50fa7b">TimeUnit</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">MINUTES</span><span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>option<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;path&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;hdfs://nn:8020/path/to/table&#34;</span><span style="color:#ff79c6">)</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>option<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;checkpointLocation&#34;</span><span style="color:#ff79c6">,</span> checkpointPath<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>start<span style="color:#ff79c6">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Iceberg supports append and complete output modes:</p>
<ul>
<li>append: appends the rows of every micro-batch to the table</li>
<li>complete: replaces the table contents every micro-batch</li>
</ul>
<p>Partitioned table</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>data<span style="color:#ff79c6">.</span>writeStream
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>format<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;iceberg&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>outputMode<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;append&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>trigger<span style="color:#ff79c6">(</span><span style="color:#50fa7b">Trigger</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ProcessingTime</span><span style="color:#ff79c6">(</span><span style="color:#bd93f9">1</span><span style="color:#ff79c6">,</span> <span style="color:#50fa7b">TimeUnit</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">MINUTES</span><span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>option<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;fanout-enabled&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;true&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>option<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;checkpointLocation&#34;</span><span style="color:#ff79c6">,</span> checkpointPath<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span>toTable<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;database.table_name&#34;</span><span style="color:#ff79c6">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="hive">Hive</h2>
<p>With Hive version 4.0.0-alpha-2 and above, the Iceberg integration when using HiveCatalog supports the following additional features:</p>
<ul>
<li>Altering a table with expiring snapshots.</li>
<li>Create a table like an existing table (CTLT table)</li>
<li>Support adding parquet compression type via Table properties Compression types</li>
<li>Altering a table metadata location</li>
<li>Supporting table rollback</li>
<li>Honors sort orders on existing tables when writing a table Sort orders specification</li>
</ul>
<p>With Hive version 4.0.0-alpha-1 and above, the Iceberg integration when using HiveCatalog supports the following additional features</p>
<ul>
<li>Creating an Iceberg identity-partitioned table</li>
<li>Creating an Iceberg table with any partition spec, including the various transforms supported by Iceberg</li>
<li>Creating a table from an existing table (CTAS table)</li>
<li>Altering a table while keeping Iceberg and Hive schemas in sync</li>
<li>Altering the partition schema (updating columns)</li>
<li>Altering the partition schema by specifying partition transforms</li>
<li>Truncating a table</li>
<li>Migrating tables in Avro, Parquet, or ORC (Non-ACID) format to Iceberg</li>
<li>Reading the schema of a table</li>
<li>Querying Iceberg metadata tables</li>
<li>Time travel applications</li>
<li>Inserting into a table (INSERT INTO)</li>
<li>Inserting data overwriting existing data (INSERT OVERWRITE)</li>
</ul>
<p>指定Catalog类型HiveCatalog</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">set</span> iceberg.<span style="color:#ff79c6">catalog</span>.iceberg_hive.<span style="color:#ff79c6">type</span><span style="color:#ff79c6">=</span>hive;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">set</span> iceberg.<span style="color:#ff79c6">catalog</span>.iceberg_hive.url<span style="color:#ff79c6">=</span>thrift:<span style="color:#ff79c6">//</span>hadoop1:<span style="color:#bd93f9">9083</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">set</span> iceberg.<span style="color:#ff79c6">catalog</span>.iceberg_hive.clients<span style="color:#ff79c6">=</span><span style="color:#bd93f9">10</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">set</span> iceberg.<span style="color:#ff79c6">catalog</span>.iceberg_hive.warehouse<span style="color:#ff79c6">=</span>hdfs:<span style="color:#ff79c6">//</span>hadoop1:<span style="color:#bd93f9">8020</span><span style="color:#ff79c6">/</span>warehouse<span style="color:#ff79c6">/</span>iceberg<span style="color:#ff79c6">-</span>hive;
</span></span></code></pre></td></tr></table>
</div>
</div><p>建表</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> iceberg_test2 (i <span style="color:#8be9fd;font-style:italic">int</span>)
</span></span><span style="display:flex;"><span>STORED <span style="color:#ff79c6">BY</span> <span style="color:#f1fa8c">&#39;org.apache.iceberg.mr.hive.HiveIcebergStorageHandler&#39;</span>
</span></span><span style="display:flex;"><span>TBLPROPERTIES(<span style="color:#f1fa8c">&#39;iceberg.catalog&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;iceberg_hive&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> iceberg_test2 <span style="color:#ff79c6">values</span>(<span style="color:#bd93f9">1</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>指定Catalog类型HadoopCatalog</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">set</span> iceberg.<span style="color:#ff79c6">catalog</span>.iceberg_hadoop.<span style="color:#ff79c6">type</span><span style="color:#ff79c6">=</span>hadoop;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">set</span> iceberg.<span style="color:#ff79c6">catalog</span>.iceberg_hadoop.warehouse<span style="color:#ff79c6">=</span>hdfs:<span style="color:#ff79c6">//</span>hadoop1:<span style="color:#bd93f9">8020</span><span style="color:#ff79c6">/</span>warehouse<span style="color:#ff79c6">/</span>iceberg<span style="color:#ff79c6">-</span>hadoop
</span></span></code></pre></td></tr></table>
</div>
</div><p>建表</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> iceberg_test3 (i <span style="color:#8be9fd;font-style:italic">int</span>)
</span></span><span style="display:flex;"><span>STORED <span style="color:#ff79c6">BY</span> <span style="color:#f1fa8c">&#39;org.apache.iceberg.mr.hive.HiveIcebergStorageHandler&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">LOCATION</span> <span style="color:#f1fa8c">&#39;hdfs://hadoop1:8020/warehouse/iceberg-hadoop/default/iceberg_test3&#39;</span>
</span></span><span style="display:flex;"><span>TBLPROPERTIES(<span style="color:#f1fa8c">&#39;iceberg.catalog&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;iceberg_hadoop&#39;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>hive 读取 hbase 上的表</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">EXTERNAL</span> <span style="color:#ff79c6">TABLE</span> hive_hbase_table_example(
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">key</span> <span style="color:#8be9fd;font-style:italic">int</span>,
</span></span><span style="display:flex;"><span>  value string
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>STORED <span style="color:#ff79c6">BY</span> <span style="color:#f1fa8c">&#39;org.apache.hadoop.hive.hbase.HBaseStorageHandler&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WITH</span> SERDEPROPERTIES (
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;hbase.columns.mapping&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;:key,cf:value&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>TBLPROPERTIES (
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;hbase.table.name&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;hbase_table_name&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#34;hbase.mapred.output.outputtable&#34;</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;hbase_table_name&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="flink">Flink</h2>
<h3 id="api-1">API</h3>
<p>建 catalog，建库等</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">CATALOG</span> hive_catalog <span style="color:#ff79c6">WITH</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#39;type&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;iceberg&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#39;catalog-type&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;hive&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#39;uri&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;thrift://localhost:9083&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#39;clients&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;5&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#39;property-version&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;1&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#39;warehouse&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;hdfs://nn:8020/warehouse/path&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">`</span>hive_catalog<span style="color:#ff79c6">`</span>.<span style="color:#ff79c6">`</span><span style="color:#ff79c6">default</span><span style="color:#ff79c6">`</span>.<span style="color:#ff79c6">`</span>sample<span style="color:#ff79c6">`</span> (
</span></span><span style="display:flex;"><span>    id <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#39;unique id&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">data</span> STRING
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>写入</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> <span style="color:#ff79c6">`</span>hive_catalog<span style="color:#ff79c6">`</span>.<span style="color:#ff79c6">`</span><span style="color:#ff79c6">default</span><span style="color:#ff79c6">`</span>.<span style="color:#ff79c6">`</span>sample<span style="color:#ff79c6">`</span> <span style="color:#ff79c6">VALUES</span> (<span style="color:#bd93f9">1</span>, <span style="color:#f1fa8c">&#39;a&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> <span style="color:#ff79c6">`</span>hive_catalog<span style="color:#ff79c6">`</span>.<span style="color:#ff79c6">`</span><span style="color:#ff79c6">default</span><span style="color:#ff79c6">`</span>.<span style="color:#ff79c6">`</span>sample<span style="color:#ff79c6">`</span> <span style="color:#ff79c6">SELECT</span> id, <span style="color:#ff79c6">data</span> <span style="color:#ff79c6">from</span> other_kafka_table;
</span></span></code></pre></td></tr></table>
</div>
</div><p>API</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>StreamExecutionEnvironment env <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">...;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DataStream<span style="color:#ff79c6">&lt;</span>RowData<span style="color:#ff79c6">&gt;</span> input <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">...</span> <span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>Configuration hadoopConf <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Configuration<span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>TableLoader tableLoader <span style="color:#ff79c6">=</span> TableLoader<span style="color:#ff79c6">.</span><span style="color:#50fa7b">fromHadoopTable</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;hdfs://nn:8020/warehouse/path&#34;</span><span style="color:#ff79c6">,</span> hadoopConf<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FlinkSink<span style="color:#ff79c6">.</span><span style="color:#50fa7b">forRowData</span><span style="color:#ff79c6">(</span>input<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">tableLoader</span><span style="color:#ff79c6">(</span>tableLoader<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">append</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>env<span style="color:#ff79c6">.</span><span style="color:#50fa7b">execute</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Test Iceberg DataStream&#34;</span><span style="color:#ff79c6">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>读取</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Submit the flink job in streaming mode for current session.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SET</span> execution.runtime<span style="color:#ff79c6">-</span><span style="color:#ff79c6">mode</span> <span style="color:#ff79c6">=</span> streaming;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Enable this switch because streaming read SQL will provide few job options in flink SQL hint options.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SET</span> <span style="color:#ff79c6">table</span>.<span style="color:#ff79c6">dynamic</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">table</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">options</span>.enabled<span style="color:#ff79c6">=</span><span style="color:#ff79c6">true</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Read all the records from the iceberg current snapshot, and then read incremental data starting from that snapshot.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> <span style="color:#ff79c6">`</span>hive_catalog<span style="color:#ff79c6">`</span>.<span style="color:#ff79c6">`</span><span style="color:#ff79c6">default</span><span style="color:#ff79c6">`</span>.<span style="color:#ff79c6">`</span>sample<span style="color:#ff79c6">`</span> <span style="color:#6272a4">/*+ OPTIONS(&#39;streaming&#39;=&#39;true&#39;, &#39;monitor-interval&#39;=&#39;1s&#39;)*/</span> ;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Read all incremental data starting from the snapshot-id &#39;3821550127947089987&#39; (records from this snapshot will be excluded).
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> <span style="color:#ff79c6">`</span>hive_catalog<span style="color:#ff79c6">`</span>.<span style="color:#ff79c6">`</span><span style="color:#ff79c6">default</span><span style="color:#ff79c6">`</span>.<span style="color:#ff79c6">`</span>sample<span style="color:#ff79c6">`</span> <span style="color:#6272a4">/*+ OPTIONS(&#39;streaming&#39;=&#39;true&#39;, 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	&#39;monitor-interval&#39;=&#39;1s&#39;, &#39;start-snapshot-id&#39;=&#39;3821550127947089987&#39;)*/</span> ;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="flink-connector">Flink Connector</h3>
<p>connector 方式</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> flink_table (
</span></span><span style="display:flex;"><span>    id   <span style="color:#8be9fd;font-style:italic">BIGINT</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">data</span> STRING
</span></span><span style="display:flex;"><span>) <span style="color:#ff79c6">WITH</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;connector&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;iceberg&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;catalog-name&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;hive_prod&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;uri&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;thrift://localhost:9083&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;warehouse&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;hdfs://nn:8020/path/to/warehouse&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> flink_table (
</span></span><span style="display:flex;"><span>    id   <span style="color:#8be9fd;font-style:italic">BIGINT</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">data</span> STRING
</span></span><span style="display:flex;"><span>) <span style="color:#ff79c6">WITH</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;connector&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;iceberg&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;catalog-name&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;hive_prod&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;catalog-database&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;hive_db&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;catalog-table&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;hive_iceberg_table&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;uri&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;thrift://localhost:9083&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;warehouse&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;hdfs://nn:8020/path/to/warehouse&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>hadoop catalog</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> flink_table (
</span></span><span style="display:flex;"><span>    id   <span style="color:#8be9fd;font-style:italic">BIGINT</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">data</span> STRING
</span></span><span style="display:flex;"><span>) <span style="color:#ff79c6">WITH</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;connector&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;iceberg&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;catalog-name&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;hadoop_prod&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;catalog-type&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;hadoop&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;warehouse&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;hdfs://nn:8020/path/to/warehouse&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>rest catalog</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">CATALOG</span> rest_catalog <span style="color:#ff79c6">WITH</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#39;type&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;iceberg&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#39;catalog-type&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;rest&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f1fa8c">&#39;uri&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;https://localhost/&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>自定义的 catalog</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> flink_table (
</span></span><span style="display:flex;"><span>    id   <span style="color:#8be9fd;font-style:italic">BIGINT</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">data</span> STRING
</span></span><span style="display:flex;"><span>) <span style="color:#ff79c6">WITH</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;connector&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;iceberg&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;catalog-name&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;custom_prod&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;catalog-impl&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;com.my.custom.CatalogImpl&#39;</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#6272a4">-- More table properties for the customized catalog
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#f1fa8c">&#39;my-additional-catalog-config&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;my-value&#39;</span>,
</span></span><span style="display:flex;"><span>     ...
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>完整的例子</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> flink_table (
</span></span><span style="display:flex;"><span>    id   <span style="color:#8be9fd;font-style:italic">BIGINT</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">data</span> STRING
</span></span><span style="display:flex;"><span>) <span style="color:#ff79c6">WITH</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;connector&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;iceberg&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;catalog-name&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;hive_prod&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;uri&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;thrift://localhost:9083&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#39;warehouse&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;file:///path/to/warehouse&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> flink_table <span style="color:#ff79c6">VALUES</span> (<span style="color:#bd93f9">1</span>, <span style="color:#f1fa8c">&#39;AAA&#39;</span>), (<span style="color:#bd93f9">2</span>, <span style="color:#f1fa8c">&#39;BBB&#39;</span>), (<span style="color:#bd93f9">3</span>, <span style="color:#f1fa8c">&#39;CCC&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SET</span> execution.<span style="color:#ff79c6">result</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">mode</span><span style="color:#ff79c6">=</span>tableau;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> flink_table;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----+------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> id <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">data</span> <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----+------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">|</span>  AAA <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">|</span>  BBB <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">3</span> <span style="color:#ff79c6">|</span>  CCC <span style="color:#ff79c6">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span><span style="color:#6272a4">----+------+
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#bd93f9">3</span> <span style="color:#ff79c6">rows</span> <span style="color:#ff79c6">in</span> <span style="color:#ff79c6">set</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ddl-queries">DDL Queries</h3>
<p>主键和分区</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">`</span>hive_catalog<span style="color:#ff79c6">`</span>.<span style="color:#ff79c6">`</span><span style="color:#ff79c6">default</span><span style="color:#ff79c6">`</span>.<span style="color:#ff79c6">`</span>sample<span style="color:#ff79c6">`</span> (
</span></span><span style="display:flex;"><span>    id <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#39;unique id&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">data</span> STRING <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span>(<span style="color:#ff79c6">`</span>id<span style="color:#ff79c6">`</span>) <span style="color:#ff79c6">NOT</span> ENFORCED
</span></span><span style="display:flex;"><span>) <span style="color:#ff79c6">WITH</span> (<span style="color:#f1fa8c">&#39;format-version&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;2&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">`</span>hive_catalog<span style="color:#ff79c6">`</span>.<span style="color:#ff79c6">`</span><span style="color:#ff79c6">default</span><span style="color:#ff79c6">`</span>.<span style="color:#ff79c6">`</span>sample<span style="color:#ff79c6">`</span> (
</span></span><span style="display:flex;"><span>    id <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">COMMENT</span> <span style="color:#f1fa8c">&#39;unique id&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">data</span> STRING <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>
</span></span><span style="display:flex;"><span>) 
</span></span><span style="display:flex;"><span>PARTITIONED <span style="color:#ff79c6">BY</span> (<span style="color:#ff79c6">data</span>) 
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WITH</span> (<span style="color:#f1fa8c">&#39;format-version&#39;</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;2&#39;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>查询</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Execute the flink job in streaming mode for current session context
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SET</span> execution.runtime<span style="color:#ff79c6">-</span><span style="color:#ff79c6">mode</span> <span style="color:#ff79c6">=</span> streaming;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Execute the flink job in batch mode for current session context
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SET</span> execution.runtime<span style="color:#ff79c6">-</span><span style="color:#ff79c6">mode</span> <span style="color:#ff79c6">=</span> batch;
</span></span></code></pre></td></tr></table>
</div>
</div><p>批量读</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Execute the flink job in batch mode for current session context
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SET</span> execution.runtime<span style="color:#ff79c6">-</span><span style="color:#ff79c6">mode</span> <span style="color:#ff79c6">=</span> batch;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> sample;
</span></span></code></pre></td></tr></table>
</div>
</div><p>批量读 API</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>StreamExecutionEnvironment env <span style="color:#ff79c6">=</span> StreamExecutionEnvironment<span style="color:#ff79c6">.</span><span style="color:#50fa7b">createLocalEnvironment</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>TableLoader tableLoader <span style="color:#ff79c6">=</span> TableLoader<span style="color:#ff79c6">.</span><span style="color:#50fa7b">fromHadoopTable</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;hdfs://nn:8020/warehouse/path&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>DataStream<span style="color:#ff79c6">&lt;</span>RowData<span style="color:#ff79c6">&gt;</span> batch <span style="color:#ff79c6">=</span> FlinkSource<span style="color:#ff79c6">.</span><span style="color:#50fa7b">forRowData</span><span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ff79c6">.</span><span style="color:#50fa7b">env</span><span style="color:#ff79c6">(</span>env<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ff79c6">.</span><span style="color:#50fa7b">tableLoader</span><span style="color:#ff79c6">(</span>tableLoader<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ff79c6">.</span><span style="color:#50fa7b">streaming</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">false</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ff79c6">.</span><span style="color:#50fa7b">build</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// Print all records to stdout.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>batch<span style="color:#ff79c6">.</span><span style="color:#50fa7b">print</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// Submit and execute this batch read job.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>env<span style="color:#ff79c6">.</span><span style="color:#50fa7b">execute</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Test Iceberg Batch Read&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>StreamExecutionEnvironment env <span style="color:#ff79c6">=</span> StreamExecutionEnvironment<span style="color:#ff79c6">.</span><span style="color:#50fa7b">createLocalEnvironment</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>TableLoader tableLoader <span style="color:#ff79c6">=</span> TableLoader<span style="color:#ff79c6">.</span><span style="color:#50fa7b">fromHadoopTable</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;hdfs://nn:8020/warehouse/path&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>IcebergSource<span style="color:#ff79c6">&lt;</span>RowData<span style="color:#ff79c6">&gt;</span> source <span style="color:#ff79c6">=</span> IcebergSource<span style="color:#ff79c6">.</span><span style="color:#50fa7b">forRowData</span><span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">tableLoader</span><span style="color:#ff79c6">(</span>tableLoader<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">assignerFactory</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">new</span> SimpleSplitAssignerFactory<span style="color:#ff79c6">())</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">build</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DataStream<span style="color:#ff79c6">&lt;</span>RowData<span style="color:#ff79c6">&gt;</span> batch <span style="color:#ff79c6">=</span> env<span style="color:#ff79c6">.</span><span style="color:#50fa7b">fromSource</span><span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>    source<span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>    WatermarkStrategy<span style="color:#ff79c6">.</span><span style="color:#50fa7b">noWatermarks</span><span style="color:#ff79c6">(),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;My Iceberg Source&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>    TypeInformation<span style="color:#ff79c6">.</span><span style="color:#50fa7b">of</span><span style="color:#ff79c6">(</span>RowData<span style="color:#ff79c6">.</span><span style="color:#50fa7b">class</span><span style="color:#ff79c6">));</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// Print all records to stdout.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>batch<span style="color:#ff79c6">.</span><span style="color:#50fa7b">print</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// Submit and execute this batch read job.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>env<span style="color:#ff79c6">.</span><span style="color:#50fa7b">execute</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Test Iceberg Batch Read&#34;</span><span style="color:#ff79c6">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>流式读</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Submit the flink job in streaming mode for current session.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SET</span> execution.runtime<span style="color:#ff79c6">-</span><span style="color:#ff79c6">mode</span> <span style="color:#ff79c6">=</span> streaming;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Enable this switch because streaming read SQL will provide few job options in flink SQL hint options.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SET</span> <span style="color:#ff79c6">table</span>.<span style="color:#ff79c6">dynamic</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">table</span><span style="color:#ff79c6">-</span><span style="color:#ff79c6">options</span>.enabled<span style="color:#ff79c6">=</span><span style="color:#ff79c6">true</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Read all the records from the iceberg current snapshot, and then read incremental data starting from that snapshot.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> sample <span style="color:#6272a4">/*+ OPTIONS(&#39;streaming&#39;=&#39;true&#39;, &#39;monitor-interval&#39;=&#39;1s&#39;)*/</span> ;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Read all incremental data starting from the snapshot-id &#39;3821550127947089987&#39; (records from this snapshot will be excluded).
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> sample <span style="color:#6272a4">/*+ OPTIONS(&#39;streaming&#39;=&#39;true&#39;, &#39;monitor-interval&#39;=&#39;1s&#39;, &#39;start-snapshot-id&#39;=&#39;3821550127947089987&#39;)*/</span> ;
</span></span></code></pre></td></tr></table>
</div>
</div><p>流式读 API</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>StreamExecutionEnvironment env <span style="color:#ff79c6">=</span> StreamExecutionEnvironment<span style="color:#ff79c6">.</span><span style="color:#50fa7b">createLocalEnvironment</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>TableLoader tableLoader <span style="color:#ff79c6">=</span> TableLoader<span style="color:#ff79c6">.</span><span style="color:#50fa7b">fromHadoopTable</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;hdfs://nn:8020/warehouse/path&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>DataStream<span style="color:#ff79c6">&lt;</span>RowData<span style="color:#ff79c6">&gt;</span> stream <span style="color:#ff79c6">=</span> FlinkSource<span style="color:#ff79c6">.</span><span style="color:#50fa7b">forRowData</span><span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ff79c6">.</span><span style="color:#50fa7b">env</span><span style="color:#ff79c6">(</span>env<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ff79c6">.</span><span style="color:#50fa7b">tableLoader</span><span style="color:#ff79c6">(</span>tableLoader<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ff79c6">.</span><span style="color:#50fa7b">streaming</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">true</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ff79c6">.</span><span style="color:#50fa7b">startSnapshotId</span><span style="color:#ff79c6">(</span>3821550127947089987L<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ff79c6">.</span><span style="color:#50fa7b">build</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// Print all records to stdout.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>stream<span style="color:#ff79c6">.</span><span style="color:#50fa7b">print</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// Submit and execute this streaming read job.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>env<span style="color:#ff79c6">.</span><span style="color:#50fa7b">execute</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Test Iceberg Streaming Read&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>StreamExecutionEnvironment env <span style="color:#ff79c6">=</span> StreamExecutionEnvironment<span style="color:#ff79c6">.</span><span style="color:#50fa7b">createLocalEnvironment</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>TableLoader tableLoader <span style="color:#ff79c6">=</span> TableLoader<span style="color:#ff79c6">.</span><span style="color:#50fa7b">fromHadoopTable</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;hdfs://nn:8020/warehouse/path&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>IcebergSource source <span style="color:#ff79c6">=</span> IcebergSource<span style="color:#ff79c6">.</span><span style="color:#50fa7b">forRowData</span><span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">tableLoader</span><span style="color:#ff79c6">(</span>tableLoader<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">assignerFactory</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">new</span> SimpleSplitAssignerFactory<span style="color:#ff79c6">())</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">streaming</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">true</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">streamingStartingStrategy</span><span style="color:#ff79c6">(</span>StreamingStartingStrategy<span style="color:#ff79c6">.</span><span style="color:#50fa7b">INCREMENTAL_FROM_LATEST_SNAPSHOT</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">monitorInterval</span><span style="color:#ff79c6">(</span>Duration<span style="color:#ff79c6">.</span><span style="color:#50fa7b">ofSeconds</span><span style="color:#ff79c6">(</span>60<span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">.</span><span style="color:#50fa7b">build</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DataStream<span style="color:#ff79c6">&lt;</span>RowData<span style="color:#ff79c6">&gt;</span> stream <span style="color:#ff79c6">=</span> env<span style="color:#ff79c6">.</span><span style="color:#50fa7b">fromSource</span><span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>    source<span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>    WatermarkStrategy<span style="color:#ff79c6">.</span><span style="color:#50fa7b">noWatermarks</span><span style="color:#ff79c6">(),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;My Iceberg Source&#34;</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>    TypeInformation<span style="color:#ff79c6">.</span><span style="color:#50fa7b">of</span><span style="color:#ff79c6">(</span>RowData<span style="color:#ff79c6">.</span><span style="color:#50fa7b">class</span><span style="color:#ff79c6">));</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// Print all records to stdout.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>stream<span style="color:#ff79c6">.</span><span style="color:#50fa7b">print</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// Submit and execute this streaming read job.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>env<span style="color:#ff79c6">.</span><span style="color:#50fa7b">execute</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Test Iceberg Streaming Read&#34;</span><span style="color:#ff79c6">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="roadmap">Roadmap</h2>
<p>General</p>
<ul>
<li>Multi-table transaction support</li>
<li>Views Support</li>
<li>Change Data Capture (CDC) Support</li>
<li>Snapshot tagging and branching</li>
<li>Inline file compaction</li>
<li>Delete File compaction</li>
<li>Z-ordering / Space-filling curves</li>
<li>Support UPSERT</li>
</ul>
<p>Clients</p>
<ul>
<li>Add the Iceberg Python Client</li>
<li>Add the Iceberg Rust Client</li>
<li>Add the Iceberg Go Client</li>
</ul>
<p>Spec V2</p>
<ul>
<li>Views Spec</li>
<li>DSv2 streaming improvements</li>
<li>Secondary indexes</li>
</ul>
<p>Spec V3</p>
<ul>
<li>Encryption</li>
<li>Relative paths</li>
<li>Default field values</li>
</ul>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://iceberg.apache.org/docs/latest/">iceberg官方文档</a></li>
<li><a href="https://www.zhihu.com/column/c_1424876654934470656">iceberg源码阅读</a></li>
<li><a href="https://www.dremio.com/resources/guides/apache-iceberg/">What Is Apache Iceberg? Features &amp; Benefits</a></li>
<li><a href="https://roysandip.medium.com/lakehouse-trifecta-delta-lake-apache-iceberg-apache-hudi-747e99c467b">Lakehouse Trifecta — Delta Lake, Apache Iceberg &amp; Apache Hudi</a></li>
<li><a href="https://medium.com/tag/apache-iceberg">Apache Iceberg medium tag</a></li>
<li><a href="https://iceberg.apache.org/spec/">Iceberg Table Spec</a></li>
<li><a href="https://iceberg.apache.org/blogs/">blogs</a></li>
<li><a href="https://github.com/apache/iceberg">github</a></li>
<li><a href="https://conferences.oreilly.com/strata/strata-ny-2018/cdn.oreillystatic.com/en/assets/1/event/278/Introducing%20Iceberg_%20Tables%20designed%20for%20object%20stores%20Presentation.pdf">A modern table format for big data PPT</a></li>
<li><a href="https://www.dremio.com/blog/the-life-of-a-read-query-for-apache-iceberg-tables/">The Life of a Read Query for Apache Iceberg Tables</a></li>
<li><a href="https://www.doria.fi/bitstream/handle/10024/187408/hellman_fredrik.pdf?sequence=2&amp;isAllowed=y">Study and Comparison of Data Lakehouse
Systems</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/StorageHandlers">Hive StorageHandlers</a></li>
<li><a href="https://blog.csdn.net/zhengzaifeidelushang/article/details/131340488">Iceberg集成Hive</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/488467438">Iceberg 原理分析</a></li>
</ul>

			<script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>
        </div>

        


        


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/iceberg'>iceberg</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "himichael/hugoblogtalks"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>


                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://code0xff.org/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://code0xff.org/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://code0xff.org/post/2025/01/logs_collection_based_cloud/" title="云环境中的日志收集和处理方案">云环境中的日志收集和处理方案</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2025/01/btrace/" title="BTrace">BTrace</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2025/01/yarn/" title="YARN原理分析">YARN原理分析</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2025/01/spark_register_source/" title="Spark 注册数据源">Spark 注册数据源</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2025/01/spark_core_2/" title="Spark Core相关-2">Spark Core相关-2</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/12/llamafactory/" title="Llama Factory">Llama Factory</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/11/spark_core/" title="Spark Core相关-1">Spark Core相关-1</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/11/sae_tunnel/" title="sea tunnel">sea tunnel</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/11/k8s_networks/" title="k8s 网络">k8s 网络</a>
    </li>
    
    <li>
        <a href="https://code0xff.org/post/2024/11/ozone/" title="ozone">ozone</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://code0xff.org/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式 (6)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/">原理分析 (26)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E5%95%86%E4%B8%9A/">商业 (3)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据 (56)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库 (41)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%96%87%E5%AD%A6%E5%92%8C%E8%89%BA%E6%9C%AF/">文学和艺术 (3)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%97%85%E8%A1%8C/">旅行 (12)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E6%9E%B6%E6%9E%84/">架构 (14)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E7%AE%97%E6%B3%95/">算法 (8)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E7%B3%BB%E7%BB%9F/">系统 (7)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言 (7)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E8%A1%8C%E4%B8%9A%E8%A7%82%E5%AF%9F/">行业观察 (3)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记 (14)</a></li>
    
    <li><a href="https://code0xff.org/categories/%E9%9A%8F%E4%BE%BF%E5%86%99%E5%86%99/">随便写写 (3)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">归档</a></h3>
<ul class="widget-list">
    
    <li><a href="https://code0xff.org/years/2021%E5%B9%B4/">2021年 (41)</a></li>
    
    <li><a href="https://code0xff.org/years/2022%E5%B9%B4/">2022年 (55)</a></li>
    
    <li><a href="https://code0xff.org/years/2023%E5%B9%B4/">2023年 (54)</a></li>
    
    <li><a href="https://code0xff.org/years/2024%E5%B9%B4/">2024年 (48)</a></li>
    
    <li><a href="https://code0xff.org/years/2025%E5%B9%B4/">2025年 (5)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://code0xff.org/tags/ai/">AI </a>
    
    <a href="https://code0xff.org/tags/ambari/">Ambari </a>
    
    <a href="https://code0xff.org/tags/architecture/">architecture </a>
    
    <a href="https://code0xff.org/tags/bigdata/">bigdata </a>
    
    <a href="https://code0xff.org/tags/btrace/">BTrace </a>
    
    <a href="https://code0xff.org/tags/b%E6%A0%91/">B树 </a>
    
    <a href="https://code0xff.org/tags/c&#43;&#43;/">C&#43;&#43; </a>
    
    <a href="https://code0xff.org/tags/calcite/">calcite </a>
    
    <a href="https://code0xff.org/tags/cmu-database/">CMU-Database </a>
    
    <a href="https://code0xff.org/tags/data_ingestion/">Data_Ingestion </a>
    
    <a href="https://code0xff.org/tags/deltalake/">DeltaLake </a>
    
    <a href="https://code0xff.org/tags/doris/">Doris </a>
    
    <a href="https://code0xff.org/tags/english/">English </a>
    
    <a href="https://code0xff.org/tags/es/">ES </a>
    
    <a href="https://code0xff.org/tags/facebook/">Facebook </a>
    
    <a href="https://code0xff.org/tags/flink/">flink </a>
    
    <a href="https://code0xff.org/tags/flume/">flume </a>
    
    <a href="https://code0xff.org/tags/gc/">GC </a>
    
    <a href="https://code0xff.org/tags/gluten/">Gluten </a>
    
    <a href="https://code0xff.org/tags/hana/">HANA </a>
    
    <a href="https://code0xff.org/tags/hive/">Hive </a>
    
    <a href="https://code0xff.org/tags/iceberg/">iceberg </a>
    
    <a href="https://code0xff.org/tags/impala/">Impala </a>
    
    <a href="https://code0xff.org/tags/janino/">janino </a>
    
    <a href="https://code0xff.org/tags/k8s/">k8s </a>
    
    <a href="https://code0xff.org/tags/kafka/">Kafka </a>
    
    <a href="https://code0xff.org/tags/kudu/">kudu </a>
    
    <a href="https://code0xff.org/tags/kyuubi/">Kyuubi </a>
    
    <a href="https://code0xff.org/tags/lakehouse/">Lakehouse </a>
    
    <a href="https://code0xff.org/tags/leveldb/">LevelDB </a>
    
    <a href="https://code0xff.org/tags/llamafactory/">LlamaFactory </a>
    
    <a href="https://code0xff.org/tags/llvm/">LLVM </a>
    
    <a href="https://code0xff.org/tags/log4j/">log4j </a>
    
    <a href="https://code0xff.org/tags/manacher/">Manacher </a>
    
    <a href="https://code0xff.org/tags/mapreduce/">MapReduce </a>
    
    <a href="https://code0xff.org/tags/micro-service/">micro-service </a>
    
    <a href="https://code0xff.org/tags/mysql/">MySQL </a>
    
    <a href="https://code0xff.org/tags/newsql/">NewSQL </a>
    
    <a href="https://code0xff.org/tags/oceanbase/">OceanBase </a>
    
    <a href="https://code0xff.org/tags/openlogreplicator/">OpenLogReplicator </a>
    
    <a href="https://code0xff.org/tags/parquet/">parquet </a>
    
    <a href="https://code0xff.org/tags/paxos/">paxos </a>
    
    <a href="https://code0xff.org/tags/presto/">Presto </a>
    
    <a href="https://code0xff.org/tags/quick-sql/">quick-sql </a>
    
    <a href="https://code0xff.org/tags/raft/">raft </a>
    
    <a href="https://code0xff.org/tags/scala/">scala </a>
    
    <a href="https://code0xff.org/tags/simd/">SIMD </a>
    
    <a href="https://code0xff.org/tags/snowflake/">snowflake </a>
    
    <a href="https://code0xff.org/tags/spark/">spark </a>
    
    <a href="https://code0xff.org/tags/sre/">SRE </a>
    
    <a href="https://code0xff.org/tags/teradata/">TeraData </a>
    
    <a href="https://code0xff.org/tags/tpcx-hs/">TPCx-HS </a>
    
    <a href="https://code0xff.org/tags/trino/">Trino </a>
    
    <a href="https://code0xff.org/tags/tuning/">Tuning </a>
    
    <a href="https://code0xff.org/tags/unix/">unix </a>
    
    <a href="https://code0xff.org/tags/yarn/">YARN </a>
    
    <a href="https://code0xff.org/tags/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/">二分查找 </a>
    
    <a href="https://code0xff.org/tags/%E4%BA%8C%E5%8F%89%E6%A0%91%E9%81%8D%E5%8E%86/">二叉树遍历 </a>
    
    <a href="https://code0xff.org/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式 </a>
    
    <a href="https://code0xff.org/tags/%E5%88%97%E5%AD%98/">列存 </a>
    
    <a href="https://code0xff.org/tags/%E5%8A%A8%E6%80%81%E6%B3%A8%E5%85%A5/">动态注入 </a>
    
    <a href="https://code0xff.org/tags/%E5%8E%86%E5%8F%B2/">历史 </a>
    
    <a href="https://code0xff.org/tags/%E5%90%91%E9%87%8F%E5%8C%96/">向量化 </a>
    
    <a href="https://code0xff.org/tags/%E5%9B%9E%E6%BA%AF/">回溯 </a>
    
    <a href="https://code0xff.org/tags/%E5%9B%BD%E5%86%85%E6%97%85%E8%A1%8C/">国内旅行 </a>
    
    <a href="https://code0xff.org/tags/%E5%9B%BD%E5%A4%96%E6%97%85%E8%A1%8C/">国外旅行 </a>
    
    <a href="https://code0xff.org/tags/%E5%A4%9A%E7%A7%9F%E6%88%B7/">多租户 </a>
    
    <a href="https://code0xff.org/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据 </a>
    
    <a href="https://code0xff.org/tags/%E5%AD%98%E5%82%A8/">存储 </a>
    
    <a href="https://code0xff.org/tags/%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/">工作记录 </a>
    
    <a href="https://code0xff.org/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务 </a>
    
    <a href="https://code0xff.org/tags/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0/">数据中台 </a>
    
    <a href="https://code0xff.org/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库 </a>
    
    <a href="https://code0xff.org/tags/%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B/">数据模型 </a>
    
    <a href="https://code0xff.org/tags/%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB/">数据迁移 </a>
    
    <a href="https://code0xff.org/tags/%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/">查询优化 </a>
    
    <a href="https://code0xff.org/tags/%E6%9F%A5%E8%AF%A2%E7%BC%96%E8%AF%91/">查询编译 </a>
    
    <a href="https://code0xff.org/tags/%E6%A6%82%E7%8E%87/">概率 </a>
    
    <a href="https://code0xff.org/tags/%E6%B1%87%E7%BC%96/">汇编 </a>
    
    <a href="https://code0xff.org/tags/%E6%B5%8B%E8%AF%95/">测试 </a>
    
    <a href="https://code0xff.org/tags/%E7%94%9F%E6%B4%BB/">生活 </a>
    
    <a href="https://code0xff.org/tags/%E7%94%B5%E5%BD%B1/">电影 </a>
    
    <a href="https://code0xff.org/tags/%E7%AE%97%E6%B3%95/">算法 </a>
    
    <a href="https://code0xff.org/tags/%E7%B4%A2%E5%BC%95/">索引 </a>
    
    <a href="https://code0xff.org/tags/%E7%BB%8F%E6%B5%8E/">经济 </a>
    
    <a href="https://code0xff.org/tags/%E7%BC%93%E5%AD%98/">缓存 </a>
    
    <a href="https://code0xff.org/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/">编译原理 </a>
    
    <a href="https://code0xff.org/tags/%E7%BD%91%E7%BB%9C/">网络 </a>
    
    <a href="https://code0xff.org/tags/%E8%AE%A1%E7%AE%97%E6%A1%86%E6%9E%B6/">计算框架 </a>
    
    <a href="https://code0xff.org/tags/%E8%AE%BA%E6%96%87/">论文 </a>
    
    <a href="https://code0xff.org/tags/%E8%AF%BB%E4%B9%A6/">读书 </a>
    
    <a href="https://code0xff.org/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记 </a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">RSS</h3>
        <ul class="widget-list">
            <li><a href="https://code0xff.org/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
    <footer id="footer">
    <div>
        &copy; 2025 <a href="https://code0xff.org/">记录每个瞬间 By 老王</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script src="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'GA ID', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




</body>

</html>